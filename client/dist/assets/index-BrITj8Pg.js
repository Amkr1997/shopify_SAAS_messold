import{r,j as e,R as _e}from"./react-D8ek_KWF.js";import{c as ja}from"./react-dom-RQgP6e1v.js";import{N as ba,L as Ie,B as ya}from"./react-router-dom-DiyYWLFJ.js";import{a as U}from"./axios-CCb-kr4I.js";import{c as wa}from"./clsx-B-dksMZM.js";import{t as va}from"./tailwind-merge-Dnoi3Axr.js";import{S as Na,R as tt,V as at,a as rt,A as nt,C as lt,b as ot,T as it,D as ct,P as Ca,c as Sa,d as dt,e as Aa,f as Ra,g as Da,h as mt,i as La,j as Ma,k as xt,l as ka,m as Ta,n as ht,o as $a,p as ut,q as Fa,r as Pa,s as pt,t as gt,u as Ea,v as ft,I as jt,w as bt,x as yt,y as Vs,z as wt,B as Ia,L as vt,E as Nt,F as Ba,G as Oa,H as za,O as Ct,J as St,K as Va,M as At,N as Rt,Q as Ua,U as Ga,W as _a,X as Ha,Y as Dt,Z as Za,_ as Lt,$ as Ka,a0 as Mt,a1 as kt,a2 as Ya,a3 as Tt,a4 as qa,a5 as $t,a6 as Wa,a7 as Ft,a8 as Pt,a9 as Ja,aa as Xa,ab as Et,ac as Qa,ad as er,ae as It,af as Bt,ag as Ot,ah as zt}from"./@radix-ui-C8O2bW7Q.js";import{c as Us}from"./class-variance-authority-Bb4qSo10.js";import{F as sr,M as Vt,a as tr}from"./react-icons-DhvbYyui.js";import{a as Ne,b as ar,e as Ce,f as rr,g as he}from"./react-router-BPDGJUDi.js";import{U as nr,M as lr,L as or,E as ir,a as cr,C as bs,b as He,S as dr,c as mr,d as Te,e as xr,f as Gs,g as Ut,P as Gt,h as _t,i as hr,j as ur,k as pr,l as gr,m as fr,n as jr,B as _s,R as Se,D as Hs,o as us,T as ts,F as ls,p as br,q as yr,r as Ze,A as wr,s as Ht,t as vr,u as Zt,v as Nr,w as Cr,x as os,y as qs,z as Sr,I as Ar,G as Ws,H as Kt,J as Bs,K as Rr,N as Dr,O as ys,Q as ws,V as Zs,W as vs,X as Ye,Y as Lr,Z as Mr,_ as kr,$ as Tr,a0 as Yt,a1 as qt,a2 as $r,a3 as Fr,a4 as Pr,a5 as Er,a6 as Ir,a7 as Br,a8 as Or,a9 as zr,aa as Vr}from"./lucide-react-B7v_UTfd.js";import{R as Be,P as Wt,a as Jt,C as Xt,T as Oe,B as ps,b as Os,X as Je,Y as Xe,L as gs,c as Qe,A as Ur,d as Gr}from"./recharts-BreeTN_J.js";import{D as _r}from"./react-day-picker-C7ZE1YgV.js";import{s as Js,F as Hr,G as Zr,C as H,e as Xs}from"./date-fns-Bj6RO4k6.js";import"./eventemitter3-_gqcMBhN.js";import"./scheduler-CzFDRTuY.js";import"./@remix-run-BSEpXHBb.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-Bt6Gud5F.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-CRMJ-gRD.js";import"./react-style-singleton-DaAuT6gv.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-BnZEYIWv.js";import"./use-callback-ref-at-3vvNE.js";import"./@floating-ui-B0O51yml.js";import"./lodash-BVU3G9Cn.js";import"./react-is-DcfIKM1A.js";import"./react-smooth-C_iu3JyY.js";import"./prop-types-BbijBPcD.js";import"./fast-equals-C7I1S-bJ.js";import"./tiny-invariant-BaFNuDhB.js";import"./d3-shape-DjFPhhqo.js";import"./d3-path-CimkQT29.js";import"./victory-vendor-6_AdwBXU.js";import"./d3-scale-BYIooUZQ.js";import"./internmap-BkD7Hj8s.js";import"./d3-array-g_qRI3rN.js";import"./d3-time-format-BKO53YJi.js";import"./d3-time-QpEiTrED.js";import"./d3-interpolate-CvRPKVI0.js";import"./d3-color-9lF95FHy.js";import"./d3-format-CzD4bSOQ.js";import"./recharts-scale-DiOBu8nk.js";import"./decimal.js-light-B5-9uEc-.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const p of o)if(p.type==="childList")for(const u of p.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&l(u)}).observe(document,{childList:!0,subtree:!0});function a(o){const p={};return o.integrity&&(p.integrity=o.integrity),o.referrerPolicy&&(p.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?p.credentials="include":o.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function l(o){if(o.ep)return;o.ep=!0;const p=a(o);fetch(o.href,p)}})();const Qt=r.createContext(void 0),Kr=({children:s})=>{const[t,a]=r.useState(()=>{const l=localStorage.getItem("user");return l?JSON.parse(l):null});return r.useEffect(()=>{t?localStorage.setItem("user",JSON.stringify(t)):localStorage.removeItem("user")},[t]),e.jsx(Qt.Provider,{value:{user:t,setUser:a},children:s})},Ge=()=>{const s=r.useContext(Qt);if(s===void 0)throw new Error("useUser must be used within a UserProvider");return s};function O(...s){return va(wa(s))}const je=r.forwardRef(({className:s,type:t,...a},l)=>e.jsx("input",{type:t,className:O("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:l,...a}));je.displayName="Input";const zs=Us("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),F=r.forwardRef(({className:s,variant:t,size:a,asChild:l=!1,...o},p)=>{const u=l?Na:"button";return e.jsx(u,{className:O(zs({variant:t,size:a,className:s})),ref:p,...o})});F.displayName="Button";const Yr=Us("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Pe=r.forwardRef(({className:s,...t},a)=>e.jsx(tt,{ref:a,className:O(Yr(),s),...t}));Pe.displayName=tt.displayName;const qr=1,Wr=1e6;let Ts=0;function Jr(){return Ts=(Ts+1)%Number.MAX_SAFE_INTEGER,Ts.toString()}const $s=new Map,Qs=s=>{if($s.has(s))return;const t=setTimeout(()=>{$s.delete(s),We({type:"REMOVE_TOAST",toastId:s})},Wr);$s.set(s,t)},Xr=(s,t)=>{switch(t.type){case"ADD_TOAST":return{...s,toasts:[t.toast,...s.toasts].slice(0,qr)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?Qs(a):s.toasts.forEach(l=>{Qs(l.id)}),{...s,toasts:s.toasts.map(l=>l.id===a||a===void 0?{...l,open:!1}:l)}}case"REMOVE_TOAST":return t.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(a=>a.id!==t.toastId)}}},ms=[];let xs={toasts:[]};function We(s){xs=Xr(xs,s),ms.forEach(t=>{t(xs)})}function Qr({...s}){const t=Jr(),a=o=>We({type:"UPDATE_TOAST",toast:{...o,id:t}}),l=()=>We({type:"DISMISS_TOAST",toastId:t});return We({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:o=>{o||l()}}}),{id:t,dismiss:l,update:a}}function Ns(){const[s,t]=r.useState(xs);return r.useEffect(()=>(ms.push(t),()=>{const a=ms.indexOf(t);a>-1&&ms.splice(a,1)}),[s]),{...s,toast:Qr,dismiss:a=>We({type:"DISMISS_TOAST",toastId:a})}}function en(){const[s,t]=r.useState(!0),[a,l]=r.useState(""),[o,p]=r.useState(""),[u,w]=r.useState(""),[h,I]=r.useState(!1),{toast:C}=Ns(),L=Ne(),[k,B]=r.useState({username:"",email:"",password:""}),{setUser:P}=Ge(),z=()=>t(!s),D=()=>{const v={username:"",email:"",password:""};let j=!0;return!s&&!a.trim()&&(v.username="Username is required",j=!1),o.trim()?/\S+@\S+\.\S+/.test(o)||(v.email="Email is invalid",j=!1):(v.email="Email is required",j=!1),u?u.length<8&&(v.password="Password must be at least 8 characters",j=!1):(v.password="Password is required",j=!1),B(v),j},E=async v=>{if(v.preventDefault(),!!D())try{let j;const y="https://parallels.messold.com";s?(j=await U.post(`${y}/api/auth/login/normal`,{email:o,password:u},{withCredentials:!0}),j.data.success&&(P(j.data.user),console.log("User set in context:",j.data.user),C({title:"Login successful!",description:"Welcome! Redirecting to your dashboard.",variant:"default"}),L("/dashboard"),console.log(y))):(j=await U.post(`${y}/api/auth/signup`,{username:a,email:o,password:u},{withCredentials:!0}),j.data.success&&(C({title:"Registration successful!",description:"Please log in with your new account.",variant:"default"}),t(!0)))}catch(j){U.isAxiosError(j)&&j.response?C({title:"Error",description:j.response.data.message||"An error occurred",variant:"destructive"}):C({title:"Unexpected Error",description:"An unexpected error occurred",variant:"destructive"})}},f=async()=>{try{const j=await U.get("https://parallels.messold.com/api/auth/google?context=userLogin"),{authUrl:y}=j.data;window.location.href=y}catch(v){console.error("Error getting Google Auth URL:",v)}};return e.jsxs("div",{className:"flex h-screen",children:[e.jsx("div",{className:"hidden md:flex md:w-1/2 bg-cover bg-center",style:{backgroundImage:"url('https://images.unsplash.com/photo-1460925895917-afdab827c52f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2015&q=80')"},children:e.jsx("div",{className:"flex items-center justify-center w-full h-full bg-black bg-opacity-40",children:e.jsxs("div",{className:"text-white text-center p-8",children:[e.jsx("h3",{className:"text-4xl font-bold mb-6",children:"Unified Marketing Analytics"}),e.jsx("p",{className:"text-xl",children:"View your Shopify, Facebook, and Google Ads data all in one place."})]})})}),e.jsx("div",{className:"w-full md:w-1/2 flex items-center justify-center bg-gradient-to-br from-blue-50 to-white p-8",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-3",children:s?"Welcome Back":"Create an Account"}),e.jsx("p",{className:"mb-8",children:s?"Sign in to access your marketing dashboard":"Join us to view all your marketing data in one place"}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[!s&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Pe,{htmlFor:"username",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(nr,{className:"absolute left-3 top-3 h-5 w-5"}),e.jsx(je,{id:"username",type:"text",value:a,onChange:v=>l(v.target.value),placeholder:"Enter your username",required:!s,className:"pl-10 border-blue-300 focus:border-blue-500 focus:ring-blue-500"})]}),k.username&&e.jsx("p",{className:"text-red-500 text-sm",children:k.username})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Pe,{htmlFor:"email",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(lr,{className:"absolute left-3 top-3 h-5 w-5"}),e.jsx(je,{id:"email",type:"email",value:o,onChange:v=>p(v.target.value),placeholder:"Enter your email",required:!0,className:"pl-10 border-blue-300 focus:border-blue-500 focus:ring-blue-500"})]}),k.email&&e.jsx("p",{className:"text-red-500 text-sm",children:k.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Pe,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(or,{className:"absolute left-3 top-3 h-5 w-5"}),e.jsx(je,{id:"password",type:h?"text":"password",value:u,onChange:v=>w(v.target.value),placeholder:"Enter your password",required:!0,className:"pl-10 border-blue-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>I(!h),className:"absolute right-3 top-3 ",children:h?e.jsx(ir,{className:"h-5 w-5"}):e.jsx(cr,{className:"h-5 w-5"})})]}),k.password&&e.jsx("p",{className:"text-red-500 text-sm",children:k.password})]}),e.jsx(F,{type:"submit",className:"w-full text-white",children:s?"Sign In":"Sign Up"})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(F,{variant:"outline",className:"w-full flex items-center justify-center space-x-2",onClick:f,children:[e.jsx(sr,{className:"h-5 w-5"}),e.jsx("span",{children:"Continue with Google"})]})}),e.jsxs("p",{className:"mt-6 text-center text-sm",children:[s?"Don't have an account? ":"Already have an account? ",e.jsx("button",{onClick:z,className:"font-semibold hover:underline",children:s?"Sign Up":"Sign In"})]})]})})]})}const sn=Ca,ea=r.forwardRef(({className:s,...t},a)=>e.jsx(at,{ref:a,className:O("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...t}));ea.displayName=at.displayName;const tn=Us("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),sa=r.forwardRef(({className:s,variant:t,...a},l)=>e.jsx(rt,{ref:l,className:O(tn({variant:t}),s),...a}));sa.displayName=rt.displayName;const an=r.forwardRef(({className:s,...t},a)=>e.jsx(nt,{ref:a,className:O("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...t}));an.displayName=nt.displayName;const ta=r.forwardRef(({className:s,...t},a)=>e.jsx(lt,{ref:a,className:O("absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...t,children:e.jsx(ot,{className:"h-4 w-4"})}));ta.displayName=lt.displayName;const aa=r.forwardRef(({className:s,...t},a)=>e.jsx(it,{ref:a,className:O("text-sm font-semibold [&+div]:text-xs",s),...t}));aa.displayName=it.displayName;const ra=r.forwardRef(({className:s,...t},a)=>e.jsx(ct,{ref:a,className:O("text-sm opacity-90",s),...t}));ra.displayName=ct.displayName;function rn(){const{toasts:s}=Ns();return e.jsxs(sn,{children:[s.map(function({id:t,title:a,description:l,action:o,...p}){return e.jsxs(sa,{...p,children:[e.jsxs("div",{className:"grid gap-1",children:[a&&e.jsx(aa,{children:a}),l&&e.jsx(ra,{children:l})]}),o,e.jsx(ta,{})]},t)}),e.jsx(ea,{})]})}const na=r.createContext(void 0),nn=({children:s})=>{const[t,a]=r.useState(null),[l,o]=r.useState([]);r.useEffect(()=>{const u=localStorage.getItem("brands");u&&o(JSON.parse(u))},[]),r.useEffect(()=>{l.length>0&&localStorage.setItem("brands",JSON.stringify(l))},[l]);const p=()=>{a(null)};return e.jsx(na.Provider,{value:{selectedBrandId:t,setSelectedBrandId:a,resetBrand:p,brands:l,setBrands:o},children:s})},Cs=()=>{const s=r.useContext(na);if(s===void 0)throw new Error("useBrand must be used within a BrandProvider");return s},la=Aa,Ss=Ra,As=Da,as=r.forwardRef(({className:s,sideOffset:t=4,...a},l)=>e.jsx(Sa,{children:e.jsx(dt,{ref:l,sideOffset:t,className:O("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a})}));as.displayName=dt.displayName;const ln="/assets/messold-icon-jcccRy_s.png",Ks=r.forwardRef(({className:s,children:t,...a},l)=>e.jsxs(mt,{ref:l,className:O("relative overflow-hidden",s),...a,children:[e.jsx(La,{className:"h-full w-full rounded-[inherit]",children:t}),e.jsx(oa,{}),e.jsx(Ma,{})]}));Ks.displayName=mt.displayName;const oa=r.forwardRef(({className:s,orientation:t="vertical",...a},l)=>e.jsx(xt,{ref:l,orientation:t,className:O("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...a,children:e.jsx(ka,{className:"relative flex-1 rounded-full bg-border"})}));oa.displayName=xt.displayName;function Ae(){var E;const[s,t]=r.useState(!1),{selectedBrandId:a,setSelectedBrandId:l,brands:o,setBrands:p}=Cs(),{user:u,setUser:w}=Ge(),h=ar(),I=Ne(),C=r.useRef(null),L="https://parallels.messold.com";r.useEffect(()=>{(async()=>{try{const v=await U.get(`${L}/api/brands/all`,{withCredentials:!0});p(v.data)}catch(v){console.error("Error fetching brands:",v)}})()},[p,L]);const k=()=>t(f=>!f),B=async()=>{try{(await U.post(`${L}/api/auth/logout`,{},{withCredentials:!0})).status===200&&(w(null),localStorage.removeItem("user"),l(null),I("/"))}catch(f){console.error("Error logging out:",f)}};r.useEffect(()=>{const f=h.pathname.split("/");f[2]&&l(f[2])},[h.pathname,l]);const P=[{name:"Monthly Ad Metrics Reports",path:`/ad-metrics/${a}`,icon:e.jsx(xr,{size:20}),requiresAdsData:!1},{name:"Daily E-Commerce Metrics Reports",path:`/ecommerce-metrics/${a}`,icon:e.jsx(Gs,{size:20})},{name:"City based Reports",path:`/city-metrics/${a}`,icon:e.jsx(Ut,{size:20})},{name:"Landing Page based Reports",path:`/page-metrics/${a}`,icon:e.jsx(Gt,{size:20})},{name:"Referring Channel based Reports",path:`/channel-metrics/${a}`,icon:e.jsx(_t,{size:20})}],z=[{name:"Business Dashboard",path:`/business-dashboard/${a}`,icon:e.jsx(hr,{size:20})},{name:"Analytics Dashboard",path:`/analytics-dashboard/${a}`,icon:e.jsx(ur,{size:20})},{name:"Campaign Metrics",path:`/campaign-metrics/${a}`,icon:e.jsx(Vt,{size:20})},{name:"Segment Scope",path:`/segment-dashboard/${a}`,icon:e.jsx(pr,{size:20})}],D=f=>{if(!a)return!0;const v=o.find(j=>j._id===a);return(f.name==="Analytics Dashboard"||f.name==="Campaign Metrics")&&!(v!=null&&v.fbAdAccounts)&&!(v!=null&&v.googleAdAccount)};return e.jsx(la,{children:e.jsxs("div",{ref:C,className:`bg-[rgb(4,16,33)] text-white transition-all duration-300 ease-in-out flex flex-col ${s?"w-64":"w-16"}`,style:{height:"100vh"},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 relative",children:[e.jsxs("div",{className:"flex items-center cursor-pointer",onClick:()=>I("/dashboard"),children:[e.jsx("img",{src:ln,alt:"Messold Logo",className:"h-8 w-8"}),s?e.jsx("span",{className:"text-sm ml-2",children:"Messold"}):null]}),e.jsx("span",{className:"transition-all duration-300 ease-in-out bg-[rgb(4,16,33)] rounded-full flex items-center justify-center",style:{width:"25px",height:"25px",position:"absolute",right:"-10px",top:"50%",transform:"translateY(-50%)",zIndex:50},onClick:k,children:s?e.jsx(bs,{size:15}):e.jsx(He,{size:15})})]}),e.jsx("div",{className:`flex-1 overflow-y-auto ${s?"h-[calc(100vh-64px)]":"h-[calc(100vh-16px)]"}`,children:e.jsx(Ks,{className:"h-full",children:e.jsxs("nav",{className:"mt-3",children:[e.jsx(Fs,{icon:e.jsx(dr,{size:24}),text:a?((E=o.find(f=>f._id===a))==null?void 0:E.name.replace(/_/g," "))||"Unknown Brand":"Your Brands",isExpanded:s,openIcon:e.jsx(mr,{}),closeIcon:e.jsx(Te,{}),isSelected:!!a,tooltipContent:"Your Brands",children:o.map(f=>e.jsx(on,{path:`/business-dashboard/${f._id}`,text:f.name.replace(/_/g," "),onClick:()=>{l(f._id),I(`/business-dashboard/${f._id}`)},isSelected:a===f._id},f._id))}),z.map((f,v)=>e.jsx(Fs,{icon:f.icon,text:f.name,isExpanded:s,isSelected:h.pathname===f.path,tooltipContent:`${f.name}${D(f)?" (No Analytics data available)":""}`,onClick:()=>{D(f)||I(f.path)},disabled:D(f)},v)),P.map((f,v)=>e.jsx(Fs,{icon:f.icon,text:f.name,isExpanded:s,isSelected:h.pathname===f.path,tooltipContent:`${f.name}${D(f)?" (No campaign data available)":""}`,onClick:()=>{D(f)||I(f.path)},disabled:D(f)},v))]})})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(cn,{isExpanded:s,user:u}),e.jsx(dn,{handleLogout:B,isExpanded:s})]})]})})}function Fs({icon:s,text:t,isExpanded:a,openIcon:l,closeIcon:o,children:p,isSelected:u,tooltipContent:w,onClick:h,disabled:I}){const[C,L]=r.useState(!1),k=()=>{L(P=>!P)},B=e.jsxs("div",{onClick:I?void 0:h||k,className:`flex items-center px-4 py-2 mb-2 text-gray-300 hover:bg-gray-700 hover:text-white transition-colors duration-200 cursor-pointer ${u?"text-white font-semibold relative":"text-gray-100"} ${I?"cursor-not-allowed opacity-50":""}`,children:[e.jsx("span",{className:"mr-2",children:s}),a&&e.jsx("span",{className:"text-xs",children:t}),a&&e.jsx("span",{className:"ml-auto",children:C?l:o})]});return e.jsxs("div",{children:[a?B:e.jsxs(Ss,{children:[e.jsx(As,{asChild:!0,children:B}),e.jsxs(as,{side:"right",children:[e.jsx("p",{className:_e.Children.count(p)>0?"mb-4":"",children:w}),_e.Children.map(p,P=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-0 w-1 h-full bg-gray-500"}),P]}))]})]}),C&&a&&e.jsxs("div",{className:"relative pl-8",children:[e.jsx("div",{className:"absolute top-0 w-1 h-full bg-gray-500"}),_e.Children.map(p,P=>e.jsx("div",{children:P}))]})]})}function on({path:s,text:t,onClick:a,disabled:l=!1,isSelected:o=!1}){const p=`flex items-center text-xs w-full p-2.5 transition-colors duration-200 ${o?"text-white font-semibold relative bg-gray-700":"text-gray-100"} ${l?"cursor-not-allowed text-gray-400":"hover:bg-gray-700"}`;return l?e.jsxs("div",{className:p,children:[t,o&&e.jsx("div",{className:"absolute left-0 w-1 h-full bg-white"})]}):e.jsxs(ba,{to:s,className:p,onClick:u=>{a&&(u.preventDefault(),a())},children:[t,o&&e.jsx("div",{className:"absolute left-0 top-0 w-1 h-full bg-white"})]})}function cn({isExpanded:s,user:t}){const a=e.jsxs("div",{className:"flex items-center gap-4 px-4 py-2 mb-2 text-gray-300 hover:bg-gray-700 hover:text-white transition-colors duration-200 cursor-pointer",children:[e.jsx("span",{className:"text-gray-300 hover:text-white",children:e.jsx(gr,{size:24})}),s&&e.jsx("span",{className:"text-sm mr-2",children:(t==null?void 0:t.username)||"user"})]});return e.jsx("div",{children:s?a:e.jsxs(Ss,{children:[e.jsx(As,{asChild:!0,children:a}),e.jsx(as,{side:"right",children:e.jsx("p",{children:(t==null?void 0:t.username)||"user"})})]})})}function dn({handleLogout:s,isExpanded:t}){const a=e.jsxs("div",{onClick:s,className:"flex items-center gap-4 px-4 py-2 mb-2 text-gray-300 hover:bg-gray-700 hover:text-white transition-colors duration-200 cursor-pointer",children:[e.jsx("span",{className:"text-gray-300 hover:text-white",children:e.jsx(fr,{size:24})}),t&&e.jsx("span",{className:"hidden sm:inline",children:"Logout"})]});return e.jsx("div",{children:t?a:e.jsxs(Ss,{children:[e.jsx(As,{asChild:!0,children:a}),e.jsx(as,{side:"right",children:e.jsx("p",{children:"Logout"})})]})})}const ee=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:O("rounded-xl border bg-card text-card-foreground shadow",s),...t}));ee.displayName="Card";const te=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:O("flex flex-col space-y-1.5 p-6",s),...t}));te.displayName="CardHeader";const le=r.forwardRef(({className:s,...t},a)=>e.jsx("h3",{ref:a,className:O("font-semibold leading-none tracking-tight",s),...t}));le.displayName="CardTitle";const me=r.forwardRef(({className:s,...t},a)=>e.jsx("p",{ref:a,className:O("text-sm text-muted-foreground",s),...t}));me.displayName="CardDescription";const se=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:O("p-6 pt-0",s),...t}));se.displayName="CardContent";const mn=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:O("flex items-center p-6 pt-0",s),...t}));mn.displayName="CardFooter";const is=["#071952","#088395","#37B7C3","#4A628A","#98DED9","#FF33CC"],xn=({rawData:s})=>{if(s.length===0)return e.jsx("div",{style:{textAlign:"center",marginTop:"50px"},children:e.jsx("p",{children:"No data available. Please set up Google Analytics for this data."})});const t=s.reduce((o,p)=>{const u=p.Channel,w=parseInt(p.Visitors,10);return o[u]||(o[u]={Channel:u,totalVisitors:0}),o[u].totalVisitors+=w,o},{}),a=Object.values(t).sort((o,p)=>p.totalVisitors-o.totalVisitors).slice(0,5),l=()=>e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:a.map((o,p)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 mr-2",style:{backgroundColor:is[p%is.length]}}),e.jsx("span",{className:"text-xs",children:o.Channel})]},`legend-${p}`))});return e.jsxs("div",{children:[l(),e.jsx(Be,{width:"100%",height:280,children:e.jsxs(Wt,{children:[e.jsx(Jt,{data:a,dataKey:"totalVisitors",nameKey:"channel",cx:"50%",cy:"50%",outerRadius:"60%",label:!0,children:a.map((o,p)=>e.jsx(Xt,{fill:is[p%is.length]},`cell-${p}`))}),e.jsx(Oe,{})]})})]})},hn=s=>s.map(t=>({city:t.City,visitors:parseInt(t.Visitors,10)})).filter(t=>!isNaN(t.visitors)).sort((t,a)=>a.visitors-t.visitors).slice(0,5),un=(s,t)=>{const a=["#E0F7FA","#B2EBF2","#80DEEA","#4DD0E1","#00ACC1"],l=Math.floor(s/t*(a.length-1));return a[l]},pn=({cityData:s})=>{const t=hn(s),a=Math.max(...t.map(l=>l.visitors));return e.jsx(Be,{width:"100%",height:300,children:t.length>0?e.jsxs(ps,{data:t,layout:"vertical",margin:{right:30,left:35,bottom:30},children:[e.jsx(Os,{strokeDasharray:"3 3"}),e.jsx(Je,{type:"number",label:{value:"Visitors",position:"insideBottom",offset:-5}}),e.jsx(Xe,{dataKey:"city",type:"category"}),e.jsx(Oe,{formatter:l=>[l,"Visitors"],contentStyle:{backgroundColor:"hsl(var(--background))",borderColor:"hsl(var(--border))"}}),e.jsx(gs,{verticalAlign:"top",height:36}),e.jsx(Qe,{dataKey:"visitors",name:"Visitors",barSize:20,fill:"#00ACC1",shape:l=>{const{visitors:o}=l.payload;return e.jsx("rect",{...l,fill:un(o,a)})}})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available. Please set up Google Analytics for this data."})})})},gn=s=>s.map(t=>({LandingPage:t["Landing Page"],Visitors:parseInt(t.Visitors,10)})).sort((t,a)=>a.Visitors-t.Visitors).slice(0,5),et=["#050C9C","#3572EF","#3ABEF9","#577B8D","#8dd1e1"],fn=({PageData:s})=>{console.log(s);const t=gn(s);console.log(t);const[a,l]=r.useState(window.innerWidth<768);return r.useEffect(()=>{const o=()=>{l(window.innerWidth<768)};return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]),e.jsx("div",{children:e.jsx(Be,{width:"100%",height:280,children:t.length>0?e.jsxs(Wt,{className:"px-6",children:[e.jsx(Oe,{formatter:(o,p)=>[`${o}`,`${p}`]}),!a&&e.jsx(gs,{layout:"vertical",align:"right",verticalAlign:"middle"}),e.jsx(Jt,{data:t,dataKey:"Visitors",nameKey:"LandingPage",cx:"35%",cy:"50%",outerRadius:100,innerRadius:40,label:!0,children:t.map((o,p)=>e.jsx(Xt,{fill:et[p%et.length]},`cell-${p}`))})]}):e.jsx("div",{style:{textAlign:"center",marginTop:"50px"},children:e.jsx("p",{children:"No data available for top landing pages.Please set up Google Analytics for this data."})})})})};function fs({className:s,classNames:t,showOutsideDays:a=!0,...l}){return e.jsx(_r,{showOutsideDays:a,className:O("px-3",s),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:O(zs({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:O("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected].day-range-end)]:rounded-r-md",l.mode==="range"?"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md":"[&:has([aria-selected])]:rounded-md"),day:O(zs({variant:"ghost"}),"h-8 w-8 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start",day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50  aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:()=>e.jsx(Ta,{className:"h-4 w-4"}),IconRight:()=>e.jsx(ht,{className:"h-4 w-4"})},...l})}fs.displayName="Calendar";const es=Fa,ss=Pa,Ke=r.forwardRef(({className:s,align:t="start",sideOffset:a=4,...l},o)=>e.jsx($a,{children:e.jsx(ut,{ref:o,align:t,sideOffset:a,className:O("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})}));Ke.displayName=ut.displayName;function Re({date:s,setDate:t,defaultDate:a,resetToFirstPage:l}){const[o,p]=r.useState(s||a),u=L=>{p(L)},w=()=>{t(o),l&&l()},h=(L,k)=>{p({from:L,to:k})},I=()=>{p(void 0)},C=L=>L?L.from?L.to?`${H(L.from,"LLL dd, y")} - ${H(L.to,"LLL dd, y")}`:H(L.from,"LLL dd, y"):"Pick a date":a&&a.from&&a.to?`${H(a.from,"LLL dd, y")} - ${H(a.to,"LLL dd, y")}`:"Pick a date";return e.jsx("div",{className:"grid gap-2",children:e.jsxs(es,{children:[e.jsx(ss,{asChild:!0,children:e.jsxs(F,{id:"date",variant:"outline",className:O("w-[260px] justify-start text-left font-normal",!o&&!a&&"text-muted-foreground"),children:[e.jsx(jr,{className:"mr-2 h-4 w-4"}),C(o)]})}),e.jsxs(Ke,{className:"w-auto p-4",align:"start",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:"flex flex-col space-y-2 justify-end",children:[e.jsx(F,{size:"sm",variant:"outline",onClick:()=>h(new Date,new Date),children:"Today"}),e.jsx(F,{size:"sm",variant:"outline",onClick:()=>h(Js(new Date,6),new Date),children:"Last 7 days"}),e.jsx(F,{size:"sm",variant:"outline",onClick:()=>h(Js(new Date,29),new Date),children:"Last 30 days"}),e.jsx(F,{size:"sm",variant:"outline",onClick:()=>h(Hr(new Date,3),new Date),children:"Last 3 months"}),e.jsx(F,{size:"sm",variant:"outline",onClick:()=>h(Zr(new Date,1),new Date),children:"Last 1 year"}),e.jsx(F,{size:"sm",variant:"destructive",onClick:I,children:"Clear"})]}),e.jsx("div",{children:e.jsx(fs,{initialFocus:!0,mode:"range",defaultMonth:(o==null?void 0:o.from)||(a==null?void 0:a.from)||new Date,selected:o,onSelect:u,numberOfMonths:2})})]}),e.jsx("div",{className:"mt-4",children:e.jsx(F,{onClick:w,className:"w-full",children:"Update"})})]})]})})}const jn=s=>Object.entries(s).map(([t,a])=>({name:t,value:a})),bn=({active:s,payload:t})=>s&&t&&t.length?e.jsxs("div",{className:"bg-background border border-border p-2 rounded-md shadow-md",children:[e.jsx("p",{className:"font-bold",children:t[0].payload.name}),e.jsx("p",{children:t[0].value.toLocaleString()})]}):null,st=["#4f83cc","#337ab7","#1e6a8c","#0d4d68"];function yn({rawData:s}){const a=jn(s.reduce((l,o)=>(l["Add To Carts"]+=parseInt(o["Add To Carts"],10),l.Checkouts+=parseInt(o.Checkouts,10),l.Sessions+=parseInt(o.Sessions,10),l.Purchases+=parseInt(o.Purchases,10),l),{"Add To Carts":0,Checkouts:0,Sessions:0,Purchases:0}));return s.length===0?e.jsx("div",{style:{textAlign:"center",marginTop:"50px"},children:e.jsx("p",{children:"No data available. Please set up Google Analytics for this data."})}):e.jsx(Be,{width:"100%",height:280,children:e.jsxs(Ur,{data:a,children:[e.jsx(Je,{dataKey:"name"}),e.jsx(Xe,{}),e.jsx(Oe,{content:e.jsx(bn,{})}),e.jsx(Gr,{type:"monotone",dataKey:"value",stroke:"#0d4d68",fillOpacity:.4,fill:"#0d4d68"}),e.jsx("defs",{children:e.jsx("linearGradient",{id:"colorGradient",x1:"0",y1:"0",x2:"1",y2:"0",children:st.map((l,o)=>e.jsx("stop",{offset:`${o/(st.length-1)*100}%`,stopColor:l},o))})})]})})}function wn(){const{brandId:s}=Ce(),[t,a]=r.useState(null),[l,o]=r.useState(!1),[p,u]=r.useState(null),[w,h]=r.useState(void 0),I=Ne(),C=w!=null&&w.from?H(w.from,"yyyy-MM-dd"):"",L=w!=null&&w.to?H(w.to,"yyyy-MM-dd"):"",k=new Date,B=r.useCallback(async()=>{var n;o(!0);try{const i="https://parallels.messold.com";let m=`${i}/api/shopify/data/${s}`;const N=new URLSearchParams;C&&N.append("startDate",C),L&&N.append("endDate",L),N.toString()&&(m+=`?${N.toString()}`);const M=await U.get(m,{withCredentials:!0}),x=await U.post(`${i}/api/analytics/report/${s}`,{startDate:C,endDate:L},{withCredentials:!0});console.log("Analytics Data:",x.data);const c=await U.post(`${i}/api/analytics/atcreport/${s}`,{startDate:C,endDate:L},{withCredentials:!0});console.log("Daily Analytics Data:",c.data);const A={...M.data,analyticsReports:x.data||null,dailyCartCheckoutReports:c.data?[c.data]:[]};a(A),console.log("data",M.data),u(new Date)}catch(i){console.error("Error fetching dashboard data:",i),U.isAxiosError(i)&&((n=i.response)==null?void 0:n.status)===401&&(alert("Your session has expired. Please log in again."),I("/"))}finally{o(!1)}},[I,C,L]);r.useEffect(()=>{B()},[B]),r.useEffect(()=>{B();const n=setInterval(B,5*60*1e3);return()=>clearInterval(n)},[B]);const P=()=>{B()},z=t==null?void 0:t.analyticsReports.find(n=>n.reportType==="Purchase Data");let D=0;z&&Array.isArray(z.data)&&(D=z.data.reduce((n,i)=>n+Number(i.ConversionRate),0));const f=parseFloat((()=>{if(!t||!t.analyticsReports)return 0;const n=t.analyticsReports.find(m=>m.reportType==="Returning Customer Rate");return!n||!n.data?0:n.data.reduce((m,{returnRate:N})=>{const M=parseFloat(N)||0;return m+M},0)})().toFixed(2)),v=()=>{var i;if(!t||!t.analyticsReports)return[];const n=((i=t.analyticsReports.find(m=>m.reportType==="Sessions by Referring Channel"))==null?void 0:i.data)||[];return n?n.map(m=>({Channel:m.Channel,Visitors:m.Visitors,Sessions:m.Sessions})):[]},j=()=>{var i;if(!t||!t.analyticsReports)return[];const n=((i=t.analyticsReports.find(m=>m.reportType==="Sessions by Location"))==null?void 0:i.data)||[];return n?n.map(m=>({City:m.City,Region:m.Region,Country:m.Country,Visitors:m.Visitors,Sessions:m.Sessions})):[]},y=()=>{var i;if(!t||!t.analyticsReports)return[];const n=((i=t.analyticsReports.find(m=>m.reportType==="Landing Page Report"))==null?void 0:i.data)||[];return n?n.map(m=>({"Landing Page":m["Landing Page"],Visitors:m.Visitors})):[]};return t?e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-4 py-4 md:px-6 lg:px-6",children:e.jsxs("div",{className:" flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Business Dashboard"}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx(Re,{date:w,setDate:h,defaultDate:{from:new Date(k.getFullYear(),k.getMonth(),1),to:k}})})]})}),e.jsxs("div",{className:"p-4 md:p-6 bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h1",{className:"text-2xl font-semibold mb-2 flex items-center space-x-3",children:[e.jsx(_s,{className:"h-6 w-6"}),e.jsx("span",{children:"Blended summary"}),e.jsx("svg",{viewBox:"0 0 64 64",className:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",children:e.jsxs("g",{children:[e.jsx("g",{children:e.jsx("path",{d:"M51.759,12.659c-0.221-0.021-4.94-0.371-4.94-0.371s-3.28-3.271-3.639-3.631    c-0.36-0.362-1.063-0.254-1.337-0.171c-0.039,0.011-0.715,0.222-1.834,0.567c-1.096-3.167-3.027-6.077-6.426-6.077    c-0.094,0-0.191,0.004-0.289,0.01c-0.966-1.283-2.164-1.844-3.199-1.844c-7.919,0-11.703,9.951-12.889,15.008    c-3.078,0.956-5.266,1.638-5.542,1.728C9.943,18.42,9.89,18.474,9.667,20.1C9.495,21.331,5,56.264,5,56.264l35.022,6.594    L59,58.731c0,0-6.661-45.261-6.703-45.572C52.255,12.849,51.983,12.677,51.759,12.659z M33.034,10.88    c0,0.119-0.002,0.231-0.002,0.344c-1.928,0.601-4.02,1.251-6.121,1.906c1.179-4.57,3.387-6.78,5.32-7.613    C32.716,6.743,33.034,8.505,33.034,10.88z M29.876,3.278c0.346,0,0.688,0.116,1.018,0.345c-2.539,1.199-5.258,4.224-6.408,10.261    c-1.679,0.522-3.319,1.034-4.838,1.506C20.994,10.783,24.188,3.278,29.876,3.278z M31.241,30.19c0,0-2.05-1.099-4.561-1.099    c-3.686,0-3.872,2.324-3.872,2.908c0,3.195,8.287,4.42,8.287,11.903c0,5.888-3.714,9.678-8.726,9.678    c-6.012,0-9.088-3.761-9.088-3.761l1.609-5.345c0,0,3.16,2.729,5.83,2.729c1.74,0,2.449-1.38,2.449-2.387    c0-4.168-6.799-4.354-6.799-11.203c0-5.761,4.116-11.341,12.428-11.341c3.199,0,4.783,0.923,4.783,0.923L31.241,30.19z     M35.11,10.578c0-0.211,0.002-0.417,0.002-0.644c0-1.966-0.273-3.551-0.709-4.807c1.752,0.219,2.919,2.223,3.67,4.528    C37.194,9.931,36.194,10.241,35.11,10.578z",fill:"#95C675"})}),e.jsx("g",{children:e.jsx("path",{d:"M51.759,12.659c-0.221-0.021-4.94-0.371-4.94-0.371s-3.28-3.271-3.639-3.631    c-0.36-0.362-1.063-0.254-1.337-0.171c-0.039,0.011-0.715,0.222-1.834,0.567c-1.096-3.167-3.027-6.077-6.426-6.077    c-0.094,0-0.191,0.004-0.289,0.01c-0.966-1.283-2.164-1.844-3.199-1.844c-7.919,0-9.873,9.951-11.059,15.008    c-3.078,0.956-5.44,6.219-5.719,6.307c-1.719,0.542-1.772,0.596-1.996,2.223C11.148,25.91,5,56.264,5,56.264l35.022,6.594    L59,58.731c0,0-6.661-45.261-6.703-45.572C52.255,12.849,51.983,12.677,51.759,12.659z M33.034,10.88    c0,0.119-0.002,0.231-0.002,0.344c-1.928,0.601-4.02,1.251-6.121,1.906c1.179-4.57,3.387-6.78,5.32-7.613    C32.716,6.743,33.034,8.505,33.034,10.88z M29.876,3.278c0.346,0,0.688,0.116,1.018,0.345c-2.539,1.199-5.258,4.224-6.408,10.261    c-1.679,0.522-3.319,1.034-4.838,1.506C20.994,10.783,24.188,3.278,29.876,3.278z M31.241,30.19c0,0-2.05-1.099-4.561-1.099    c-3.686,0-3.872,2.324-3.872,2.908c0,3.195,8.287,4.42,8.287,11.903c0,5.888-3.714,9.678-8.726,9.678    c-6.012,0-9.088-3.761-9.088-3.761l1.609-5.345c0,0,3.16,2.729,5.83,2.729c1.74,0,2.449-1.38,2.449-2.387    c0-4.168-6.799-4.354-6.799-11.203c0-5.761,4.116-11.341,12.428-11.341c3.199,0,4.783,0.923,4.783,0.923L31.241,30.19z     M35.11,10.578c0-0.211,0.002-0.417,0.002-0.644c0-1.966-0.273-3.551-0.709-4.807c1.752,0.219,2.919,2.223,3.67,4.528    C37.194,9.931,36.194,10.241,35.11,10.578z",fill:"#79B259"})}),e.jsx("path",{d:"M40.022,62.857L59,58.731c0,0-6.661-45.261-6.703-45.572c-0.042-0.311-0.313-0.482-0.538-0.5   c-0.221-0.021-4.94-0.371-4.94-0.371s-3.28-3.271-3.639-3.631c-0.192-0.194-0.479-0.249-0.75-0.251   c-0.72,1.22-0.571,3.537-0.571,3.537l-2.232,50.839L40.022,62.857z",fill:"#55932C"}),e.jsx("path",{d:"M33.583,2.977c-0.094,0-0.191,0.004-0.289,0.01c-0.966-1.283-2.164-1.844-3.199-1.844   c-7.887,0-11.674,9.873-12.875,14.947l2.447-0.759c1.354-4.609,4.545-12.053,10.209-12.053c0.346,0,0.688,0.116,1.018,0.345   c-2.532,1.195-5.244,4.209-6.398,10.213l2.43-0.75c1.182-4.541,3.381-6.739,5.307-7.569c0.484,1.227,0.803,2.988,0.803,5.363   c0,0.108,0,0.211-0.002,0.314l2.078-0.643c0-0.2,0.002-0.4,0.002-0.617c0-1.966-0.273-3.551-0.709-4.807   c1.746,0.218,2.912,2.213,3.662,4.508l1.938-0.601C38.906,5.876,36.976,2.977,33.583,2.977z",fill:"#4A7A2B"}),e.jsx("path",{d:"M47.611,12.348c-0.474-0.037-0.793-0.06-0.793-0.06s-3.28-3.271-3.639-3.631   c-0.192-0.194-0.479-0.249-0.75-0.251c-0.72,1.22-0.571,3.537-0.571,3.537l-2.232,50.839l0.396,0.075l10.098-2.196L47.611,12.348z",fill:"#4C822A"})]})}),e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",children:[e.jsx("rect",{x:"17",y:"2",width:"5",height:"20",rx:"2.5",fill:"#F9AB00"}),e.jsx("path",{d:"M9.5 13.5C9.5 12.1193 10.6193 11 12 11C13.3807 11 14.5 12.1193 14.5 13.5V19.5C14.5 20.8807 13.3807 22 12 22C10.6193 22 9.5 20.8807 9.5 19.5V13.5Z",fill:"#E37400"}),e.jsx("path",{d:"M2 19.5C2 18.1193 3.11929 17 4.5 17C5.88071 17 7 18.1193 7 19.5C7 20.8807 5.88071 22 4.5 22C3.11929 22 2 20.8807 2 19.5Z",fill:"#E37400"}),e.jsx("path",{d:"M6.92162 10C6.36184 10 5.95724 9.68838 5.95724 9.05977V8.55474H3.2304C2.49881 8.55474 2 8.1088 2 7.45332C2 7.07723 2.12193 6.70651 2.40459 6.22297C2.93666 5.29349 3.57403 4.31565 4.31116 3.23573C4.92637 2.31162 5.39747 2 6.20111 2C7.2209 2 7.88044 2.54265 7.88044 3.38617V7.02351H8.19082C8.72842 7.02351 9 7.34587 9 7.79181C9 8.23774 8.72288 8.55474 8.19082 8.55474H7.88044V9.05977C7.88044 9.68838 7.47585 10 6.92162 10ZM6.01267 7.09335V3.48287H5.97387C5.0095 4.8368 4.34996 5.83076 3.7015 7.03962V7.09335H6.01267Z",fill:"#E37400"})]})]}),e.jsxs("div",{className:"md:flex items-center hidden",children:[p&&e.jsxs("span",{className:"text-sm text-gray-600 mr-4",children:["Last updated: ",p.toLocaleTimeString()]}),e.jsxs(F,{onClick:P,disabled:l,className:"flex items-center",children:[e.jsx(Se,{className:`mr-2 h-4 w-4 ${l?"animate-spin":""}`}),"Refresh"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-2 mb-4 md:mb-5",children:[{title:"Total Orders",value:t.totalOrders,colorClass:"text-cyan-700",icon:Gs},{title:"Total Sales",value:`₹${t.totalSales.toFixed(2)}`,colorClass:"text-cyan-700",icon:Hs},{title:"Monthly Conversion Rate",value:`${D.toFixed(2)}%`,colorClass:"text-cyan-700",icon:us},{title:"Average Order Value",value:`₹${t.averageOrderValue.toFixed(2)}`,colorClass:"text-cyan-700",icon:ts},{title:"Monthly Return Rate",value:`${f}`,colorClass:"text-cyan-700",icon:us}].map((n,i)=>e.jsxs(ee,{className:"shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1",children:[e.jsxs(te,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(le,{className:"text-lg text-gray-600",children:n.title}),e.jsx(n.icon,{className:`h-6 w-6 ${n.colorClass}`})]}),e.jsx(se,{children:e.jsx("p",{className:`text-2xl font-bold ${n.colorClass}`,children:n.value})})]},i))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:[e.jsxs(ee,{className:"shadow-lg hover:shadow-xl transition-all duration-300 mb-5",children:[e.jsxs(te,{className:"flex flex-row justify-between items-center",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(le,{className:"text-base",children:"Aggregated E-commerce Metrics"}),e.jsx(me,{children:"Total Add to Carts, Checkouts, Sessions, and Purchases"})]}),e.jsx(Ie,{to:`/ecommerce-metrics/${s}`,children:e.jsx(F,{className:" bg-blue-50 text-blue-900 hover:text-white ",children:e.jsx(ls,{})})})]}),e.jsx(se,{children:e.jsx(yn,{rawData:(t==null?void 0:t.dailyCartCheckoutReports[0].data)||[]})})]}),e.jsxs(ee,{className:"shadow-lg hover:shadow-xl transition-all duration-300 mb-5",children:[e.jsxs(te,{className:"flex flex-row justify-between items-center",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(le,{className:"text-base",children:"Top Cities"}),e.jsx(me,{children:"Visitor Count For Top cities"})]}),e.jsx(Ie,{to:`/city-metrics/${s}`,children:e.jsx(F,{className:" bg-blue-50 text-blue-900 hover:text-white ",children:e.jsx(ls,{})})})]}),e.jsx(se,{children:e.jsx(pn,{cityData:j()})})]}),e.jsxs(ee,{className:"shadow-lg hover:shadow-xl transition-all duration-300 mb-5",children:[e.jsxs(te,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(le,{className:"text-base",children:"Top Referring Channels"}),e.jsx(me,{children:"Visitor count for reffering channels"})]}),e.jsx(Ie,{to:`/channel-metrics/${s}`,children:e.jsx(F,{className:" bg-blue-50 text-blue-900 hover:text-white ",children:e.jsx(ls,{})})})]}),e.jsx(se,{className:"h-80",children:e.jsx(xn,{rawData:v()})})]})]}),e.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:e.jsxs(ee,{className:"shadow-lg hover:shadow-xl transition-all duration-300 ",children:[e.jsxs(te,{className:"flex flex-row justify-between items-center px-6 py-3",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(le,{className:"text-base",children:"Top Landing Pages"}),e.jsx(me,{children:"Visitors count based on Landing Pages"})]}),e.jsx(Ie,{to:`/page-metrics/${s}`,children:e.jsx(F,{className:" bg-blue-50 text-blue-900 hover:text-white ",children:e.jsx(ls,{})})})]}),e.jsx(fn,{PageData:y()})]})})]})]}):e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-blue-500"})})}function vn(){return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Ae,{}),e.jsx("div",{className:"flex-1 h-screen overflow-auto",children:e.jsx(wn,{})})]})}function Ee({className:s,...t}){return e.jsx("div",{className:O("animate-pulse rounded-md bg-primary/10",s),...t})}const Nn=()=>e.jsxs(ee,{className:"transition-transform transform hover:scale-105 hover:border hover:border-blue-600",children:[e.jsxs(te,{className:"flex flex-col items-start justify-start",children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4 rounded-full"}),e.jsx(Ee,{className:"h-6 w-24"})]}),e.jsx(Ee,{className:"h-4 w-32 mt-2"})]}),e.jsx(se,{children:e.jsx(Ee,{className:"h-8 w-20 mt-2"})})]}),Cn=({label:s,value:t,date:a,icon:l,tooltipContent:o})=>e.jsxs(ee,{className:"transition-transform transform hover:scale-105 hover:border hover:border-blue-600",children:[e.jsxs(te,{className:"flex flex-col items-start justify-start",children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[l==="Facebook"?e.jsx("svg",{className:"w-4 h-4",fill:"#1877F2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}):l==="Google"?e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",children:[e.jsx("path",{d:"M13.5437 4.24116L13.5441 4.24138C13.904 4.43971 14.2179 4.70303 14.4689 5.01529C14.7198 5.3275 14.903 5.68264 15.009 6.0601L15.4904 5.92486L15.009 6.0601C15.115 6.43752 15.1422 6.83078 15.0891 7.21776C15.0361 7.60457 14.9038 7.97861 14.6989 8.31855C14.6988 8.31873 14.6987 8.31891 14.6986 8.3191L8.41444 18.701C7.9918 19.3741 7.30557 19.868 6.49825 20.0687C5.68937 20.2699 4.83087 20.1586 4.10949 19.7614C3.38872 19.3646 2.86649 18.7168 2.64727 17.9633C2.42868 17.212 2.5264 16.4083 2.92214 15.7226L9.20689 5.33823C9.20695 5.33813 9.20702 5.33802 9.20708 5.33792C9.62451 4.65082 10.3142 4.14383 11.1301 3.93599C11.9464 3.72804 12.8151 3.83872 13.5437 4.24116Z",fill:"#FFB70A",stroke:"#FFB70A"}),e.jsx("path",{d:"M21.5404 15.4544L15.24 5.04127C14.7453 4.25097 13.9459 3.67817 13.0138 3.44633C12.0817 3.21448 11.0917 3.34215 10.2572 3.80182C9.4226 4.26149 8.8103 5.01636 8.55224 5.90372C8.29418 6.79108 8.41102 7.73988 8.87757 8.54562L15.178 18.9587C15.6726 19.749 16.4721 20.3218 17.4042 20.5537C18.3362 20.7855 19.3262 20.6579 20.1608 20.1982C20.9953 19.7385 21.6076 18.9836 21.8657 18.0963C22.1238 17.2089 22.0069 16.2601 21.5404 15.4544Z",fill:"#3B8AD8"}),e.jsx("path",{d:"M9.23018 16.2447C9.07335 15.6884 8.77505 15.1775 8.36166 14.7572C7.94827 14.3369 7.43255 14.0202 6.86011 13.835C6.28768 13.6499 5.67618 13.6021 5.07973 13.6958C4.48328 13.7895 3.92026 14.0219 3.44049 14.3723C2.96071 14.7227 2.57898 15.1804 2.32906 15.7049C2.07914 16.2294 1.96873 16.8045 2.00762 17.3794C2.0465 17.9542 2.23347 18.5111 2.55199 19.0007C2.8705 19.4902 3.31074 19.8975 3.83376 20.1863C4.46363 20.5354 5.1882 20.6983 5.91542 20.6542C6.64264 20.6101 7.33969 20.361 7.91802 19.9386C8.49636 19.5162 8.92988 18.9395 9.16351 18.2817C9.39715 17.624 9.42035 16.915 9.23018 16.2447Z",fill:"#2CAA14"})]}):l===""?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"#1877F2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",children:[e.jsx("path",{d:"M13.5437 4.24116L13.5441 4.24138C13.904 4.43971 14.2179 4.70303 14.4689 5.01529C14.7198 5.3275 14.903 5.68264 15.009 6.0601L15.4904 5.92486L15.009 6.0601C15.115 6.43752 15.1422 6.83078 15.0891 7.21776C15.0361 7.60457 14.9038 7.97861 14.6989 8.31855C14.6988 8.31873 14.6987 8.31891 14.6986 8.3191L8.41444 18.701C7.9918 19.3741 7.30557 19.868 6.49825 20.0687C5.68937 20.2699 4.83087 20.1586 4.10949 19.7614C3.38872 19.3646 2.86649 18.7168 2.64727 17.9633C2.42868 17.212 2.5264 16.4083 2.92214 15.7226L9.20689 5.33823C9.20695 5.33813 9.20702 5.33802 9.20708 5.33792C9.62451 4.65082 10.3142 4.14383 11.1301 3.93599C11.9464 3.72804 12.8151 3.83872 13.5437 4.24116Z",fill:"#FFB70A",stroke:"#FFB70A"}),e.jsx("path",{d:"M21.5404 15.4544L15.24 5.04127C14.7453 4.25097 13.9459 3.67817 13.0138 3.44633C12.0817 3.21448 11.0917 3.34215 10.2572 3.80182C9.4226 4.26149 8.8103 5.01636 8.55224 5.90372C8.29418 6.79108 8.41102 7.73988 8.87757 8.54562L15.178 18.9587C15.6726 19.749 16.4721 20.3218 17.4042 20.5537C18.3362 20.7855 19.3262 20.6579 20.1608 20.1982C20.9953 19.7385 21.6076 18.9836 21.8657 18.0963C22.1238 17.2089 22.0069 16.2601 21.5404 15.4544Z",fill:"#3B8AD8"}),e.jsx("path",{d:"M9.23018 16.2447C9.07335 15.6884 8.77505 15.1775 8.36166 14.7572C7.94827 14.3369 7.43255 14.0202 6.86011 13.835C6.28768 13.6499 5.67618 13.6021 5.07973 13.6958C4.48328 13.7895 3.92026 14.0219 3.44049 14.3723C2.96071 14.7227 2.57898 15.1804 2.32906 15.7049C2.07914 16.2294 1.96873 16.8045 2.00762 17.3794C2.0465 17.9542 2.23347 18.5111 2.55199 19.0007C2.8705 19.4902 3.31074 19.8975 3.83376 20.1863C4.46363 20.5354 5.1882 20.6983 5.91542 20.6542C6.64264 20.6101 7.33969 20.361 7.91802 19.9386C8.49636 19.5162 8.92988 18.9395 9.16351 18.2817C9.39715 17.624 9.42035 16.915 9.23018 16.2447Z",fill:"#2CAA14"})]})]}):null,e.jsx("div",{className:"text-base font-medium",children:s}),e.jsx(la,{children:e.jsxs(Ss,{children:[e.jsx(As,{asChild:!0,children:e.jsx("button",{className:"p-0 m-0","aria-label":`Info about ${s}`,children:e.jsx(br,{className:"w-3 h-3 text-gray-400"})})}),e.jsxs(as,{className:"w-64 p-0 bg-white text-black border shadow-sm",children:[e.jsx("div",{className:"p-2 font-semibold border-black",children:s}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full h-[0.5px] bg-black"}),e.jsx("div",{className:"p-2",children:o})]})]})]})})]}),e.jsxs("div",{className:"text-xs text-gray-500 font-bold",children:[a.from?a.from.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",a.from&&a.to?" - ":"",a.to?a.to.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""]})]}),e.jsx(se,{children:e.jsx("p",{className:"text-3xl font-bold text-cyan-950",children:t})})]}),Ps=({title:s,metrics:t=[],date:a,isLoading:l=!1,icon:o,errorMessage:p})=>p&&!l?e.jsx("section",{className:s?"mt-10":"",children:e.jsxs(ee,{className:"p-4",children:[e.jsx(te,{children:e.jsx("h2",{className:"text-xl font-semibold flex items-center space-x-2",children:s&&e.jsxs(e.Fragment,{children:[o==="Facebook"?e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"#1877F2",children:e.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}):e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",children:[e.jsx("path",{d:"M13.5437 4.24116L13.5441 4.24138C13.904 4.43971 14.2179 4.70303 14.4689 5.01529C14.7198 5.3275 14.903 5.68264 15.009 6.0601L15.4904 5.92486L15.009 6.0601C15.115 6.43752 15.1422 6.83078 15.0891 7.21776C15.0361 7.60457 14.9038 7.97861 14.6989 8.31855C14.6988 8.31873 14.6987 8.31891 14.6986 8.3191L8.41444 18.701C7.9918 19.3741 7.30557 19.868 6.49825 20.0687C5.68937 20.2699 4.83087 20.1586 4.10949 19.7614C3.38872 19.3646 2.86649 18.7168 2.64727 17.9633C2.42868 17.212 2.5264 16.4083 2.92214 15.7226L9.20689 5.33823C9.20695 5.33813 9.20702 5.33802 9.20708 5.33792C9.62451 4.65082 10.3142 4.14383 11.1301 3.93599C11.9464 3.72804 12.8151 3.83872 13.5437 4.24116Z",fill:"#FFB70A",stroke:"#FFB70A"}),e.jsx("path",{d:"M21.5404 15.4544L15.24 5.04127C14.7453 4.25097 13.9459 3.67817 13.0138 3.44633C12.0817 3.21448 11.0917 3.34215 10.2572 3.80182C9.4226 4.26149 8.8103 5.01636 8.55224 5.90372C8.29418 6.79108 8.41102 7.73988 8.87757 8.54562L15.178 18.9587C15.6726 19.749 16.4721 20.3218 17.4042 20.5537C18.3362 20.7855 19.3262 20.6579 20.1608 20.1982C20.9953 19.7385 21.6076 18.9836 21.8657 18.0963C22.1238 17.2089 22.0069 16.2601 21.5404 15.4544Z",fill:"#3B8AD8"}),e.jsx("path",{d:"M9.23018 16.2447C9.07335 15.6884 8.77505 15.1775 8.36166 14.7572C7.94827 14.3369 7.43255 14.0202 6.86011 13.835C6.28768 13.6499 5.67618 13.6021 5.07973 13.6958C4.48328 13.7895 3.92026 14.0219 3.44049 14.3723C2.96071 14.7227 2.57898 15.1804 2.32906 15.7049C2.07914 16.2294 1.96873 16.8045 2.00762 17.3794C2.0465 17.9542 2.23347 18.5111 2.55199 19.0007C2.8705 19.4902 3.31074 19.8975 3.83376 20.1863C4.46363 20.5354 5.1882 20.6983 5.91542 20.6542C6.64264 20.6101 7.33969 20.361 7.91802 19.9386C8.49636 19.5162 8.92988 18.9395 9.16351 18.2817C9.39715 17.624 9.42035 16.915 9.23018 16.2447Z",fill:"#2CAA14"})]}),e.jsx("span",{children:s})]})})}),e.jsx(se,{children:e.jsx("p",{className:"text-red-600 text-sm",children:p})})]})}):e.jsxs("section",{className:s?"mt-10":"",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 flex items-center space-x-2",children:s&&e.jsxs(e.Fragment,{children:[o==="Facebook"?e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"#1877F2",children:e.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}):e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",children:[e.jsx("path",{d:"M13.5437 4.24116L13.5441 4.24138C13.904 4.43971 14.2179 4.70303 14.4689 5.01529C14.7198 5.3275 14.903 5.68264 15.009 6.0601L15.4904 5.92486L15.009 6.0601C15.115 6.43752 15.1422 6.83078 15.0891 7.21776C15.0361 7.60457 14.9038 7.97861 14.6989 8.31855C14.6988 8.31873 14.6987 8.31891 14.6986 8.3191L8.41444 18.701C7.9918 19.3741 7.30557 19.868 6.49825 20.0687C5.68937 20.2699 4.83087 20.1586 4.10949 19.7614C3.38872 19.3646 2.86649 18.7168 2.64727 17.9633C2.42868 17.212 2.5264 16.4083 2.92214 15.7226L9.20689 5.33823C9.20695 5.33813 9.20702 5.33802 9.20708 5.33792C9.62451 4.65082 10.3142 4.14383 11.1301 3.93599C11.9464 3.72804 12.8151 3.83872 13.5437 4.24116Z",fill:"#FFB70A",stroke:"#FFB70A"}),e.jsx("path",{d:"M21.5404 15.4544L15.24 5.04127C14.7453 4.25097 13.9459 3.67817 13.0138 3.44633C12.0817 3.21448 11.0917 3.34215 10.2572 3.80182C9.4226 4.26149 8.8103 5.01636 8.55224 5.90372C8.29418 6.79108 8.41102 7.73988 8.87757 8.54562L15.178 18.9587C15.6726 19.749 16.4721 20.3218 17.4042 20.5537C18.3362 20.7855 19.3262 20.6579 20.1608 20.1982C20.9953 19.7385 21.6076 18.9836 21.8657 18.0963C22.1238 17.2089 22.0069 16.2601 21.5404 15.4544Z",fill:"#3B8AD8"}),e.jsx("path",{d:"M9.23018 16.2447C9.07335 15.6884 8.77505 15.1775 8.36166 14.7572C7.94827 14.3369 7.43255 14.0202 6.86011 13.835C6.28768 13.6499 5.67618 13.6021 5.07973 13.6958C4.48328 13.7895 3.92026 14.0219 3.44049 14.3723C2.96071 14.7227 2.57898 15.1804 2.32906 15.7049C2.07914 16.2294 1.96873 16.8045 2.00762 17.3794C2.0465 17.9542 2.23347 18.5111 2.55199 19.0007C2.8705 19.4902 3.31074 19.8975 3.83376 20.1863C4.46363 20.5354 5.1882 20.6983 5.91542 20.6542C6.64264 20.6101 7.33969 20.361 7.91802 19.9386C8.49636 19.5162 8.92988 18.9395 9.16351 18.2817C9.39715 17.624 9.42035 16.915 9.23018 16.2447Z",fill:"#2CAA14"})]}),e.jsx("span",{children:s})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:l?Array(t.length).fill(0).map((u,w)=>e.jsx(Nn,{},w)):t.map((u,w)=>e.jsx(Cn,{label:u.label,value:u.value,date:a,icon:o,tooltipContent:u.tooltipContent},w))})]}),we=Ba,ve=Oa,Sn=za,An=r.forwardRef(({className:s,inset:t,children:a,...l},o)=>e.jsxs(pt,{ref:o,className:O("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",s),...l,children:[a,e.jsx(ht,{className:"ml-auto"})]}));An.displayName=pt.displayName;const Rn=r.forwardRef(({className:s,...t},a)=>e.jsx(gt,{ref:a,className:O("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t}));Rn.displayName=gt.displayName;const fe=r.forwardRef(({className:s,sideOffset:t=4,...a},l)=>e.jsx(Ea,{children:e.jsx(ft,{ref:l,sideOffset:t,className:O("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a})}));fe.displayName=ft.displayName;const oe=r.forwardRef(({className:s,inset:t,...a},l)=>e.jsx(jt,{ref:l,className:O("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",t&&"pl-8",s),...a}));oe.displayName=jt.displayName;const Dn=r.forwardRef(({className:s,children:t,checked:a,...l},o)=>e.jsxs(bt,{ref:o,className:O("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:a,...l,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(yt,{children:e.jsx(Vs,{className:"h-4 w-4"})})}),t]}));Dn.displayName=bt.displayName;const hs=r.forwardRef(({className:s,children:t,...a},l)=>e.jsxs(wt,{ref:l,className:O("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(yt,{children:e.jsx(Ia,{className:"h-2 w-2 fill-current"})})}),t]}));hs.displayName=wt.displayName;const Ln=r.forwardRef(({className:s,inset:t,...a},l)=>e.jsx(vt,{ref:l,className:O("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",s),...a}));Ln.displayName=vt.displayName;const Mn=r.forwardRef(({className:s,...t},a)=>e.jsx(Nt,{ref:a,className:O("-mx-1 my-1 h-px bg-muted",s),...t}));Mn.displayName=Nt.displayName;function kn(){const[s,t]=r.useState({from:new Date,to:new Date}),[a,l]=r.useState(!1),[o,p]=r.useState([]),[u,w]=r.useState(null),[h,I]=r.useState(),[C,L]=r.useState("all"),[k,B]=r.useState(null),{brandId:P}=Ce(),z=Ne(),D=n=>{n!==C&&L(n)},E=r.useCallback(async()=>{var n;l(!0);try{const i="https://parallels.messold.com",m=s!=null&&s.from?H(s.from,"yyyy-MM-dd"):"",N=s!=null&&s.to?H(s.to,"yyyy-MM-dd"):"";let M=[],x=[];if(C==="all"||C==="facebook")try{M=(await U.post(`${i}/api/metrics/fbad/${P}`,{startDate:m,endDate:N},{withCredentials:!0})).data.data,console.log("fbdata",M),p(M)}catch(c){console.error("Error fetching Facebook ad data:",c)}if(C==="all"||C==="google")try{x=(await U.post(`${i}/api/metrics/googlead/${P}`,{startDate:m,endDate:N},{withCredentials:!0})).data.data,console.log(x),I(x)}catch(c){console.error("Error fetching Google ad data:",c)}f(C==="google"?[]:M,C==="facebook"?void 0:x),B(new Date)}catch(i){console.error("Error fetching ad data:",i),U.isAxiosError(i)&&((n=i.response)==null?void 0:n.status)===401&&(alert("Your session has expired. Please log in again."),z("/"))}finally{l(!1)}},[z,s,C,P]);r.useEffect(()=>{E()},[E]),r.useEffect(()=>{E();const n=setInterval(E,5*60*1e3);return()=>clearInterval(n)},[E]);const f=(n,i)=>{let m=0,N=0,M=0,x=0,c=0;n!=null&&n.length&&n.forEach(A=>{var d,R;m+=parseFloat(A.spend||"0"),N+=parseFloat(((d=A.Revenue)==null?void 0:d.value)||"0"),M+=parseFloat(((R=A.purchases)==null?void 0:R.value)||"0"),x+=parseFloat(A.clicks||"0"),c+=parseFloat(A.impressions||"0")}),i&&(m+=parseFloat(i.totalSpend||"0"),N+=parseFloat(i.totalConversionsValue||"0"),M+=parseFloat(i.totalConversions||"0"),x+=parseFloat(i.totalClicks||"0"),c+=parseFloat(i.totalImpressions||"0")),w({totalSpent:`₹ ${m.toLocaleString()}`,totalRevenue:`₹ ${N.toLocaleString()}`,totalROAS:(N/m).toFixed(2).toString(),totalPurchases:M.toLocaleString(),totalCTR:`${(x/c*100).toFixed(2)} %`,totalCPC:(m/x).toFixed(2).toString()})},v=[{label:"Amount Spent",value:u?u.totalSpent:"₹ 0",tooltipContent:"The sum of ad spends for all advertising platform"},{label:"Revenue",value:u?u.totalRevenue:"₹ 0",tooltipContent:"Revenue from Ads Purchases"},{label:"ROAS (Ads only)",value:u?u.totalROAS:"0.00",tooltipContent:"Blended ROAS = Ads Purchases vaue / Blended Ad Spend"},{label:"Ads Purchases",value:u?u.totalPurchases:"0.00",tooltipContent:"Ads Purchases = Fb Ads Purchase + Google Conversions"},{label:"CTR",value:u?u.totalCTR:"0.00",tooltipContent:"Average CTR from all advertising platforms = (Blended Clicks / Blended Impressions)*100"},{label:"CPC",value:u?u.totalCPC:"0.00",tooltipContent:"Average CPC from all advertising platforms = (Blended Ad Spend / Blended Clicks )"}],j=[{label:"Total Cost",value:h?`₹ ${h==null?void 0:h.totalSpend}`:" 0"},{label:"Conversion Value",value:h?`₹ ${h==null?void 0:h.totalConversionsValue}`:" 0"},{label:"ROAS",value:h?h==null?void 0:h.roas:"0.00"},{label:"Conversions",value:h?h==null?void 0:h.totalConversions:"0"},{label:"CPC",value:h?`₹ ${h==null?void 0:h.totalCPC}`:" 0"},{label:"CPM",value:h?`₹ ${h==null?void 0:h.totalCPM}`:" 0"},{label:"CTR",value:h?`${h==null?void 0:h.totalCTR} %`:" 0"},{label:"Cost Per Conversion",value:h?`₹ ${h==null?void 0:h.totalCostPerConversion}`:" 0"}],y=()=>{E()};return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-white border-b border-gray-200 px-4 py-4 md:px-6 lg:px-8",children:e.jsxs("div",{className:" flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Ad Metrics Dashboard"}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(Re,{date:s,setDate:t,defaultDate:{from:new Date,to:new Date}})})]})}),e.jsxs("main",{className:"p-4 md:p-6 lg:px-8",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs("section",{children:[e.jsxs("h2",{className:"text-xl font-semibold flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex flex-row items-center space-x-2",children:[e.jsx(yr,{className:"h-5 w-5"}),e.jsx("span",{children:"Blended summary"}),(C==="all"||C==="facebook")&&e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"#1877F2",children:e.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),(C==="all"||C==="google")&&e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",children:[e.jsx("path",{d:"M13.5437 4.24116L13.5441 4.24138C13.904 4.43971 14.2179 4.70303 14.4689 5.01529C14.7198 5.3275 14.903 5.68264 15.009 6.0601L15.4904 5.92486L15.009 6.0601C15.115 6.43752 15.1422 6.83078 15.0891 7.21776C15.0361 7.60457 14.9038 7.97861 14.6989 8.31855C14.6988 8.31873 14.6987 8.31891 14.6986 8.3191L8.41444 18.701C7.9918 19.3741 7.30557 19.868 6.49825 20.0687C5.68937 20.2699 4.83087 20.1586 4.10949 19.7614C3.38872 19.3646 2.86649 18.7168 2.64727 17.9633C2.42868 17.212 2.5264 16.4083 2.92214 15.7226L9.20689 5.33823C9.20695 5.33813 9.20702 5.33802 9.20708 5.33792C9.62451 4.65082 10.3142 4.14383 11.1301 3.93599C11.9464 3.72804 12.8151 3.83872 13.5437 4.24116Z",fill:"#FFB70A",stroke:"#FFB70A"}),e.jsx("path",{d:"M21.5404 15.4544L15.24 5.04127C14.7453 4.25097 13.9459 3.67817 13.0138 3.44633C12.0817 3.21448 11.0917 3.34215 10.2572 3.80182C9.4226 4.26149 8.8103 5.01636 8.55224 5.90372C8.29418 6.79108 8.41102 7.73988 8.87757 8.54562L15.178 18.9587C15.6726 19.749 16.4721 20.3218 17.4042 20.5537C18.3362 20.7855 19.3262 20.6579 20.1608 20.1982C20.9953 19.7385 21.6076 18.9836 21.8657 18.0963C22.1238 17.2089 22.0069 16.2601 21.5404 15.4544Z",fill:"#3B8AD8"}),e.jsx("path",{d:"M9.23018 16.2447C9.07335 15.6884 8.77505 15.1775 8.36166 14.7572C7.94827 14.3369 7.43255 14.0202 6.86011 13.835C6.28768 13.6499 5.67618 13.6021 5.07973 13.6958C4.48328 13.7895 3.92026 14.0219 3.44049 14.3723C2.96071 14.7227 2.57898 15.1804 2.32906 15.7049C2.07914 16.2294 1.96873 16.8045 2.00762 17.3794C2.0465 17.9542 2.23347 18.5111 2.55199 19.0007C2.8705 19.4902 3.31074 19.8975 3.83376 20.1863C4.46363 20.5354 5.1882 20.6983 5.91542 20.6542C6.64264 20.6101 7.33969 20.361 7.91802 19.9386C8.49636 19.5162 8.92988 18.9395 9.16351 18.2817C9.39715 17.624 9.42035 16.915 9.23018 16.2447Z",fill:"#2CAA14"})]})]}),e.jsxs("div",{className:"flex flex-row items-center space-x-2",children:[e.jsxs("div",{className:"md:flex items-center hidden",children:[k&&e.jsxs("span",{className:"text-sm text-gray-600 mr-4",children:["Last updated: ",k.toLocaleTimeString()]}),e.jsx(F,{onClick:y,disabled:a,className:"flex items-center",children:e.jsx(Se,{className:`h-4 w-4 ${a?"animate-spin":""}`})})]}),e.jsxs(we,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(F,{className:"bg-cyan-800",children:[e.jsx(Ze,{className:"h-5 w-5 mr-2"}),"Filter"]})}),e.jsx(fe,{children:e.jsxs(Sn,{value:C,onValueChange:n=>D(n),children:[e.jsx(hs,{value:"all",children:"All Data"}),e.jsx(hs,{value:"facebook",children:"Facebook Ads"}),e.jsx(hs,{value:"google",children:"Google Ads"})]})})]})]})]}),e.jsx(Ps,{metrics:v,date:s||{from:new Date,to:new Date},isLoading:a,icon:C==="all"?"":C==="facebook"?"Facebook":"Google"})]})}),(C==="all"||C==="facebook")&&(o==null?void 0:o.length)>0&&o.map((n,i)=>{var N,M;const m=[{label:"Amount Spent",value:`₹ ${n.spend||"0"}`},{label:"Revenue",value:`₹ ${parseFloat(((N=n.Revenue)==null?void 0:N.value)||"0").toLocaleString()}`},{label:"ROAS (Ads only)",value:n.purchase_roas&&n.purchase_roas.length>0?parseFloat(n.purchase_roas[0].value).toFixed(2):"0"},{label:"Ads Purchases",value:((M=n.purchases)==null?void 0:M.value)||"0"},{label:"CPC (All clicks)",value:`₹ ${parseFloat(n.cpc||"0").toLocaleString()}`},{label:"CPM",value:`₹ ${parseFloat(n.cpm||"0").toFixed(2).toLocaleString()}`},{label:"CTR",value:`${parseFloat(n.ctr||"0").toFixed(2)} %`},{label:"Cost per Purchase (All)",value:`₹ ${parseFloat(n.cpp||"0").toLocaleString()}`}];return e.jsx(Ps,{icon:"Facebook",title:`Facebook - ${n.account_name}`,metrics:m,date:s||{from:new Date,to:new Date},isLoading:a,errorMessage:n.message},i)}),(C==="all"||C==="google")&&(h&&Object.keys(h).length>0?e.jsx(Ps,{icon:"Google",title:`Google Ads - ${h==null?void 0:h.adAccountName}`,metrics:j,date:s||{from:new Date,to:new Date},isLoading:a}):e.jsxs("section",{children:[e.jsxs("div",{className:"flex flex-row gap-2 items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Google Ad Metrics"}),e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",children:[e.jsx("path",{d:"M13.5437 4.24116L13.5441 4.24138C13.904 4.43971 14.2179 4.70303 14.4689 5.01529C14.7198 5.3275 14.903 5.68264 15.009 6.0601L15.4904 5.92486L15.009 6.0601C15.115 6.43752 15.1422 6.83078 15.0891 7.21776C15.0361 7.60457 14.9038 7.97861 14.6989 8.31855C14.6988 8.31873 14.6987 8.31891 14.6986 8.3191L8.41444 18.701C7.9918 19.3741 7.30557 19.868 6.49825 20.0687C5.68937 20.2699 4.83087 20.1586 4.10949 19.7614C3.38872 19.3646 2.86649 18.7168 2.64727 17.9633C2.42868 17.212 2.5264 16.4083 2.92214 15.7226L9.20689 5.33823C9.20695 5.33813 9.20702 5.33802 9.20708 5.33792C9.62451 4.65082 10.3142 4.14383 11.1301 3.93599C11.9464 3.72804 12.8151 3.83872 13.5437 4.24116Z",fill:"#FFB70A",stroke:"#FFB70A"}),e.jsx("path",{d:"M21.5404 15.4544L15.24 5.04127C14.7453 4.25097 13.9459 3.67817 13.0138 3.44633C12.0817 3.21448 11.0917 3.34215 10.2572 3.80182C9.4226 4.26149 8.8103 5.01636 8.55224 5.90372C8.29418 6.79108 8.41102 7.73988 8.87757 8.54562L15.178 18.9587C15.6726 19.749 16.4721 20.3218 17.4042 20.5537C18.3362 20.7855 19.3262 20.6579 20.1608 20.1982C20.9953 19.7385 21.6076 18.9836 21.8657 18.0963C22.1238 17.2089 22.0069 16.2601 21.5404 15.4544Z",fill:"#3B8AD8"}),e.jsx("path",{d:"M9.23018 16.2447C9.07335 15.6884 8.77505 15.1775 8.36166 14.7572C7.94827 14.3369 7.43255 14.0202 6.86011 13.835C6.28768 13.6499 5.67618 13.6021 5.07973 13.6958C4.48328 13.7895 3.92026 14.0219 3.44049 14.3723C2.96071 14.7227 2.57898 15.1804 2.32906 15.7049C2.07914 16.2294 1.96873 16.8045 2.00762 17.3794C2.0465 17.9542 2.23347 18.5111 2.55199 19.0007C2.8705 19.4902 3.31074 19.8975 3.83376 20.1863C4.46363 20.5354 5.1882 20.6983 5.91542 20.6542C6.64264 20.6101 7.33969 20.361 7.91802 19.9386C8.49636 19.5162 8.92988 18.9395 9.16351 18.2817C9.39715 17.624 9.42035 16.915 9.23018 16.2447Z",fill:"#2CAA14"})]})]}),e.jsx("div",{className:"text-center text-gray-500 mt-4 bg-white p-2",children:"No Google Ad Account for this brand."})]}))]})]})}const Tn=()=>e.jsxs("div",{className:"flex h-screen",children:[" ",e.jsx(Ae,{}),e.jsx("div",{className:"flex-1 h-screen overflow-auto",children:e.jsx(kn,{})})]});function $n(){const{user:s}=Ge(),{brands:t}=Cs();return e.jsx("div",{className:"min-h-screen bg-gray-100 p-6",children:e.jsxs("div",{className:"max-w-full mx-auto space-y-6 px-4",children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight",children:["Welcome back, ",(s==null?void 0:s.username.split(" ")[0])||"user","!"]}),e.jsxs("div",{className:"grid gap-6 grid-cols-1 md:grid-cols-2",children:[e.jsxs(ee,{className:"bg-white shadow-lg border-t-4 border-t-[#071952]",children:[e.jsxs(te,{children:[e.jsxs(le,{className:"text-[#088395] flex items-center",children:[e.jsx(wr,{className:"mr-2 h-5 w-5"}),"Performance & Targets"]}),e.jsx(me,{children:"Overview of your brand performance and targets"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between bg-[#EBF4F6] p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ht,{className:"h-8 w-8 text-blue-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-[#088395]",children:"Active Targets"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:t.length})]})]}),e.jsx(vr,{className:"h-12 w-12 text-blue-300"})]}),e.jsx(F,{asChild:!0,className:"w-full justify-between bg-[#37B7C3] hover:bg-cyan-800 text-white",children:e.jsxs(Ie,{to:"/performance-metrics",children:[e.jsx("span",{children:"View Performance Dashboard"}),e.jsx(Zt,{className:"h-4 w-4"})]})})]})]}),e.jsxs(ee,{className:"bg-white shadow-lg border-t-4 border-t-blue-500",children:[e.jsxs(te,{children:[e.jsxs(le,{className:"text-blue-700 flex items-center",children:[e.jsx(ts,{className:"mr-2 h-5 w-5"}),"Getting Started"]}),e.jsx(me,{children:"Follow these steps to set up your analytics"})]}),e.jsx(se,{children:e.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm",children:[e.jsx("li",{children:'Select a brand from "Your Brands" section'}),e.jsx("li",{children:"Connect your brand's Shopify store"}),e.jsx("li",{children:"Set up Google Analytics 4 property"}),e.jsx("li",{children:"Link Facebook Ads account"}),e.jsx("li",{children:"Configure Google Ads integration"}),e.jsx("li",{children:"Explore your unified brand analytics"})]})})]})]}),e.jsxs("div",{className:"grid gap-6 grid-cols-1 md:grid-cols-2",children:[e.jsxs(ee,{className:"bg-white shadow-lg border-t-4 border-t-blue-500",children:[e.jsxs(te,{children:[e.jsxs(le,{className:"text-blue-700 flex items-center",children:[e.jsx(Nr,{className:"mr-2 h-5 w-5"}),"Dashboard Overview"]}),e.jsx(me,{children:"Key insights and analytics for your brands"})]}),e.jsx(se,{children:e.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:t.map(a=>e.jsx(Ie,{to:`/business-dashboard/${a._id}`,children:e.jsx("div",{className:"border border-[#071952] p-2 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200",children:e.jsx("h3",{className:"text-base font-semibold text-[#071952]",children:a.name})})},a._id))})})]}),e.jsxs(ee,{className:"bg-white shadow-lg border-t-4 border-t-blue-600",children:[e.jsxs(te,{children:[e.jsxs(le,{className:"text-blue-700 flex items-center",children:[e.jsx(Cr,{className:"mr-2 h-5 w-5"}),"Monthly Reports"]}),e.jsx(me,{children:"Access comprehensive monthly reports for your brands"})]}),e.jsx(se,{children:e.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:t.map(a=>e.jsx(Ie,{to:`/ad-metrics/${a._id}`,children:e.jsx("div",{className:"bg-blue-50 p-2 rounded-lg shadow hover:shadow-md transition-shadow duration-200 ",children:e.jsx("h3",{className:"text-base font-semibold text-blue-700",children:a.name})})},a._id))})})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(ee,{className:"bg-white shadow-lg border-t-4 border-t-blue-500",children:[e.jsxs(te,{children:[e.jsxs(le,{className:"text-blue-700 flex items-center",children:[e.jsx(os,{className:"mr-2 h-5 w-5"}),"Notifications"]}),e.jsx(me,{children:"Stay updated with your latest alerts"})]}),e.jsx(se,{children:e.jsxs("ul",{className:"space-y-2",children:[e.jsxs("li",{className:"flex items-center bg-blue-50 p-2 rounded",children:[e.jsx(os,{className:"mr-2 h-4 w-4 text-blue-500"}),e.jsx("span",{className:"text-sm text-blue-700",children:"New Shopify order received for UDD Studio"})]}),e.jsxs("li",{className:"flex items-center bg-blue-50 p-2 rounded",children:[e.jsx(os,{className:"mr-2 h-4 w-4 text-blue-500"}),e.jsx("span",{className:"text-sm text-blue-700",children:"Weekly analytics report ready for Fisherman Hub"})]}),e.jsxs("li",{className:"flex items-center bg-blue-50 p-2 rounded",children:[e.jsx(os,{className:"mr-2 h-4 w-4 text-blue-500"}),e.jsx("span",{className:"text-sm text-blue-700",children:"Facebook Ads campaign ended for UDD Studio"})]})]})})]}),e.jsxs(ee,{className:"bg-white shadow-lg border-t-4 border-t-blue-600",children:[e.jsxs(te,{children:[e.jsxs(le,{className:"text-blue-700 flex items-center",children:[e.jsx(qs,{className:"mr-2 h-5 w-5"}),"Quick Actions"]}),e.jsx(me,{children:"Frequently used features and settings"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs(F,{variant:"outline",className:"w-full justify-start text-blue-600 hover:bg-blue-50 hover:text-blue-700 border-blue-200",children:[e.jsx(qs,{className:"mr-2 h-4 w-4"}),"Account Settings"]}),e.jsxs(F,{variant:"outline",className:"w-full justify-start text-blue-600 hover:bg-blue-50 hover:text-blue-700 border-blue-200",children:[e.jsx(Se,{className:"mr-2 h-4 w-4"}),"Sync Data Sources"]}),e.jsxs(F,{variant:"outline",className:"w-full justify-start text-blue-600 hover:bg-blue-50 hover:text-blue-700 border-blue-200",children:[e.jsx(Sr,{className:"mr-2 h-4 w-4"}),"Manage Brands"]})]})]})]})]})})}const Fn=Ga,Pn=_a,En=Ua,ia=r.forwardRef(({className:s,...t},a)=>e.jsx(Ct,{ref:a,className:O("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t}));ia.displayName=Ct.displayName;const ca=r.forwardRef(({className:s,children:t,...a},l)=>e.jsxs(En,{children:[e.jsx(ia,{}),e.jsxs(St,{ref:l,className:O("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a,children:[t,e.jsxs(Va,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(ot,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ca.displayName=St.displayName;const da=({className:s,...t})=>e.jsx("div",{className:O("flex flex-col space-y-1.5 text-center sm:text-left",s),...t});da.displayName="DialogHeader";const ma=r.forwardRef(({className:s,...t},a)=>e.jsx(At,{ref:a,className:O("text-lg font-semibold leading-none tracking-tight",s),...t}));ma.displayName=At.displayName;const xa=r.forwardRef(({className:s,...t},a)=>e.jsx(Rt,{ref:a,className:O("text-sm text-muted-foreground",s),...t}));xa.displayName=Rt.displayName;function In({onConnect:s}){const[t,a]=r.useState(""),l=()=>{t&&s("Shopify",t,"")};return e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx(je,{type:"text",placeholder:"Enter your Shopify store name",value:t,onChange:o=>a(o.target.value)}),e.jsx(F,{className:"w-full",onClick:l,disabled:!t,children:"Login to Shopify"})]})}const Rs=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:a,className:O("w-full caption-bottom text-sm",s),...t})}));Rs.displayName="Table";const Ds=r.forwardRef(({className:s,...t},a)=>e.jsx("thead",{ref:a,className:O("[&_tr]:border-b",s),...t}));Ds.displayName="TableHeader";const Ls=r.forwardRef(({className:s,...t},a)=>e.jsx("tbody",{ref:a,className:O("[&_tr:last-child]:border-0",s),...t}));Ls.displayName="TableBody";const Bn=r.forwardRef(({className:s,...t},a)=>e.jsx("tfoot",{ref:a,className:O("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...t}));Bn.displayName="TableFooter";const ze=r.forwardRef(({className:s,...t},a)=>e.jsx("tr",{ref:a,className:O("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...t}));ze.displayName="TableRow";const Le=r.forwardRef(({className:s,...t},a)=>e.jsx("th",{ref:a,className:O("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t}));Le.displayName="TableHead";const ne=r.forwardRef(({className:s,...t},a)=>e.jsx("td",{ref:a,className:O("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t}));ne.displayName="TableCell";const On=r.forwardRef(({className:s,...t},a)=>e.jsx("caption",{ref:a,className:O("mt-4 text-sm text-muted-foreground",s),...t}));On.displayName="TableCaption";const qe=()=>e.jsxs(Rs,{className:"text-center min-w-full",children:[e.jsx(Ds,{className:"bg-gray-200 sticky top-0 z-10",children:e.jsx(ze,{children:Array(8).fill(0).map((s,t)=>e.jsx(ne,{className:"font-bold px-4 text-black min-w-[150px]",children:e.jsx(Ee,{className:"h-6 w-full"})},t))})}),e.jsx(Ls,{children:Array(10).fill(0).map((s,t)=>e.jsx(ze,{children:Array(8).fill(0).map((a,l)=>e.jsx(ne,{className:"px-4 py-2 max-w-[200px]",children:e.jsx(Ee,{className:"h-6 w-full"})},l))},t))})]}),js=({width:s="1.25rem",height:t="1.25rem"})=>e.jsx("svg",{viewBox:"0 0 24 24",style:{height:t,width:s,fill:"#1877F2"},children:e.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),Ve=({width:s="1.25rem",height:t="1.25rem"})=>e.jsxs("svg",{viewBox:"0 0 24 24",style:{height:t,width:s},children:[e.jsx("path",{d:"M13.5437 4.24116L13.5441 4.24138C13.904 4.43971 14.2179 4.70303 14.4689 5.01529C14.7198 5.3275 14.903 5.68264 15.009 6.0601L15.4904 5.92486L15.009 6.0601C15.115 6.43752 15.1422 6.83078 15.0891 7.21776C15.0361 7.60457 14.9038 7.97861 14.6989 8.31855C14.6988 8.31873 14.6987 8.31891 14.6986 8.3191L8.41444 18.701C7.9918 19.3741 7.30557 19.868 6.49825 20.0687C5.68937 20.2699 4.83087 20.1586 4.10949 19.7614C3.38872 19.3646 2.86649 18.7168 2.64727 17.9633C2.42868 17.212 2.5264 16.4083 2.92214 15.7226L9.20689 5.33823C9.20695 5.33813 9.20702 5.33802 9.20708 5.33792C9.62451 4.65082 10.3142 4.14383 11.1301 3.93599C11.9464 3.72804 12.8151 3.83872 13.5437 4.24116Z",fill:"#FFB70A",stroke:"#FFB70A"}),e.jsx("path",{d:"M21.5404 15.4544L15.24 5.04127C14.7453 4.25097 13.9459 3.67817 13.0138 3.44633C12.0817 3.21448 11.0917 3.34215 10.2572 3.80182C9.4226 4.26149 8.8103 5.01636 8.55224 5.90372C8.29418 6.79108 8.41102 7.73988 8.87757 8.54562L15.178 18.9587C15.6726 19.749 16.4721 20.3218 17.4042 20.5537C18.3362 20.7855 19.3262 20.6579 20.1608 20.1982C20.9953 19.7385 21.6076 18.9836 21.8657 18.0963C22.1238 17.2089 22.0069 16.2601 21.5404 15.4544Z",fill:"#3B8AD8"}),e.jsx("path",{d:"M9.23018 16.2447C9.07335 15.6884 8.77505 15.1775 8.36166 14.7572C7.94827 14.3369 7.43255 14.0202 6.86011 13.835C6.28768 13.6499 5.67618 13.6021 5.07973 13.6958C4.48328 13.7895 3.92026 14.0219 3.44049 14.3723C2.96071 14.7227 2.57898 15.1804 2.32906 15.7049C2.07914 16.2294 1.96873 16.8045 2.00762 17.3794C2.0465 17.9542 2.23347 18.5111 2.55199 19.0007C2.8705 19.4902 3.31074 19.8975 3.83376 20.1863C4.46363 20.5354 5.1882 20.6983 5.91542 20.6542C6.64264 20.6101 7.33969 20.361 7.91802 19.9386C8.49636 19.5162 8.92988 18.9395 9.16351 18.2817C9.39715 17.624 9.42035 16.915 9.23018 16.2447Z",fill:"#2CAA14"})]}),ha=s=>{if(s==null)return"₹0.00";const t=typeof s=="string"?parseFloat(s):s;return isNaN(t)?"₹0.00":t.toLocaleString("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2})},cs=s=>s?new Date(s).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"}):"",Es=({summaryMetrics:s,startDate:t,endDate:a})=>e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs(ee,{className:"transition-all duration-200 hover:shadow-lg hover:scale-105 hover:border-blue-600",children:[e.jsxs(te,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ar,{className:"h-5 w-5 text-black-500"}),e.jsx(le,{children:"Total Spend"})]}),e.jsxs(me,{className:"flex items-center mt-1",children:[e.jsx(Ws,{className:"h-3 w-3 mr-1"}),cs(t)," - ",cs(a)]})]}),e.jsx(se,{children:e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-3xl font-bold text-[#071952]",children:ha(s.totalSpend)})})})]}),e.jsxs(ee,{className:"transition-all duration-200 hover:shadow-lg hover:scale-105 hover:border-blue-600",children:[e.jsxs(te,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ts,{className:"h-5 w-5 text-black-500"}),e.jsx(le,{children:"Average ROAS"})]}),e.jsxs(me,{className:"flex items-center mt-1",children:[e.jsx(Ws,{className:"h-3 w-3 mr-1"}),cs(t)," - ",cs(a)]})]}),e.jsx(se,{children:e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-3xl font-bold text-[#071952]",children:s.averageRoas.toFixed(2)})})})]})]}),Is=({campaigns:s,isLoading:t})=>e.jsx(ee,{children:e.jsx(se,{className:"p-0",children:e.jsx(Ks,{className:"h-[300px] rounded-lg",children:t?e.jsx(qe,{}):e.jsxs(Rs,{children:[e.jsx(Ds,{className:"sticky top-0 bg-cyan-800 text-white font-medium z-10",children:e.jsxs(ze,{children:[e.jsx(ne,{className:"font-semibold",children:"Campaign Name"}),e.jsx(ne,{className:"font-semibold",children:"Spend"}),e.jsx(ne,{className:"font-semibold",children:"ROAS"})]})}),e.jsx(Ls,{children:s.map((a,l)=>e.jsxs(ze,{children:[e.jsx(ne,{className:"font-medium",children:a.campaignName}),e.jsx(ne,{children:ha(a.spend)}),e.jsx(ne,{children:a.roas})]},l))})]})})})}),zn=()=>{const[s,t]=r.useState({from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}),[a,l]=r.useState(null),[o,p]=r.useState([]),[u,w]=r.useState(""),[h,I]=r.useState(!1),[C,L]=r.useState(!1),[k,B]=r.useState(""),[P,z]=r.useState(null),{selectedBrandId:D}=Cs(),E=Ne(),f=H((s==null?void 0:s.from)||new Date,"yyyy-MM-dd"),v=H((s==null?void 0:s.to)||new Date,"yyyy-MM-dd"),j="https://parallels.messold.com",y=A=>({totalSpend:A.reduce((d,R)=>d+parseFloat(R.spend||"0"),0),averageRoas:A.reduce((d,R)=>d+parseFloat(R.roas||"0"),0)/(A.length||1)}),n=A=>k?A.filter(d=>d.campaignName.toLowerCase().includes(k.toLowerCase())):A,i=r.useCallback(async()=>{var A;if(D){I(!0);try{const d=await U.post(`${j}/api/metrics/googleCampaign/${D}`,{startDate:f,endDate:v},{withCredentials:!0});l(d.data.data),z(new Date)}catch(d){console.error("Error fetching Google metrics:",d),U.isAxiosError(d)&&((A=d.response)==null?void 0:A.status)===401&&(alert("Your session has expired. Please log in again."),E("/"))}finally{I(!1)}}},[D,f,v,E,j]),m=r.useCallback(async()=>{var A;if(D){L(!0);try{const d=await U.post(`${j}/api/metrics/fbCampaign/${D}`,{startDate:f,endDate:v},{withCredentials:!0});p(d.data.data),!u&&d.data.data.length>0&&w(d.data.data[0].account_name),z(new Date)}catch(d){console.error("Error fetching Facebook metrics:",d),U.isAxiosError(d)&&((A=d.response)==null?void 0:A.status)===401&&(alert("Your session has expired. Please log in again."),E("/"))}finally{L(!1)}}},[D,f,v,E,j]);r.useEffect(()=>{const A=async()=>{await Promise.all([i(),m()])};A();const d=setInterval(A,5*60*1e3);return()=>clearInterval(d)},[i,m]);const N=()=>{if(!a)return null;const A=a.campaignData.map(S=>({campaignName:S.campaignName,spend:S.spend,roas:S.roas})),d=n(A),R=y(d);return e.jsxs("div",{className:"mb-4",children:[e.jsx(Es,{summaryMetrics:R,startDate:f,endDate:v}),e.jsx(Is,{campaigns:d,isLoading:h})]})},M=()=>{if(!o||o.length===0)return e.jsx(ee,{children:e.jsx(se,{className:"p-6 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No Facebook campaign data available"})})});const A=o.find(T=>T.account_name===u);if(!A||!A.campaigns)return x();const d=A.campaigns.map(T=>{var V,Z;return{campaignName:T.campaign_name,spend:T.spend||"0",roas:((Z=(V=T.purchase_roas)==null?void 0:V[0])==null?void 0:Z.value)||"0"}}),R=n(d),S=y(R);return e.jsxs("div",{children:[e.jsx(Es,{summaryMetrics:S,startDate:f,endDate:v}),e.jsx(Is,{campaigns:R,isLoading:C})]})},x=()=>{const A={totalSpend:0,averageRoas:0};return e.jsxs("div",{children:[e.jsx(Es,{summaryMetrics:A,startDate:f,endDate:v}),e.jsx(Is,{campaigns:[],isLoading:C})]})},c=A=>{L(!0),w(A),setTimeout(()=>L(!1),500)};return e.jsxs("div",{className:"flex h-screen bg-gray-100",children:[e.jsx(Ae,{}),e.jsxs("div",{className:"flex-1 flex flex-col h-screen overflow-auto",children:[e.jsx("header",{className:"bg-white border-b px-6 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(_s,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Campaign Metrics"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",className:"border px-4 py-2 rounded-lg w-64",placeholder:"Search Campaigns",value:k,onChange:A=>B(A.target.value)}),e.jsx(Ha,{className:"absolute right-4 top-3 h-5 w-5 text-gray-500"})]}),e.jsx(Re,{date:s,setDate:t,defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}}),P&&e.jsxs("span",{className:"text-sm text-gray-600",children:["Last updated: ",P.toLocaleTimeString()]}),e.jsx(F,{size:"icon",onClick:()=>{i(),m()},children:e.jsx(Se,{className:"h-4 w-4"})})]})]})}),e.jsxs("div",{className:"p-6 flex-1 overflow-auto",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(js,{width:"1.25rem",height:"1.25rem"}),e.jsx("h2",{className:"text-xl font-bold",children:"Facebook Campaigns"})]}),o&&o.length>0&&e.jsxs(we,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(F,{variant:"outline",children:[u||"Select Account",e.jsx(Te,{className:"h-4 w-4 ml-1"})]})}),e.jsx(fe,{children:o.map(A=>e.jsx(oe,{onClick:()=>c(A.account_name),children:A.account_name},A.account_name))})]})]}),M()]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ve,{width:"1.25rem",height:"1.25rem"}),e.jsx("h2",{className:"text-xl font-bold",children:"Google Campaigns"}),e.jsxs("span",{className:"text-black-500 font-bold md:uppercase",children:["- ",a==null?void 0:a.adAccountName]})]})}),N()]})]})]})]})},Ue=({width:s="1.25rem",height:t="1.25rem"})=>e.jsxs("svg",{viewBox:"0 0 24 24",style:{height:t,width:s},children:[e.jsx("rect",{x:"17",y:"2",width:"2rem",height:"2rem",rx:"2.5",fill:"#F9AB00"}),e.jsx("path",{d:"M9.5 13.5C9.5 12.1193 10.6193 11 12 11C13.3807 11 14.5 12.1193 14.5 13.5V19.5C14.5 20.8807 13.3807 22 12 22C10.6193 22 9.5 20.8807 9.5 19.5V13.5Z",fill:"#E37400"}),e.jsx("path",{d:"M2 19.5C2 18.1193 3.11929 17 4.5 17C5.88071 17 7 18.1193 7 19.5C7 20.8807 5.88071 22 4.5 22C3.11929 22 2 20.8807 2 19.5Z",fill:"#E37400"}),e.jsx("path",{d:"M6.92162 10C6.36184 10 5.95724 9.68838 5.95724 9.05977V8.55474H3.2304C2.49881 8.55474 2 8.1088 2 7.45332C2 7.07723 2.12193 6.70651 2.40459 6.22297C2.93666 5.29349 3.57403 4.31565 4.31116 3.23573C4.92637 2.31162 5.39747 2 6.20111 2C7.2209 2 7.88044 2.54265 7.88044 3.38617V7.02351H8.19082C8.72842 7.02351 9 7.34587 9 7.79181C9 8.23774 8.72288 8.55474 8.19082 8.55474H7.88044V9.05977C7.88044 9.68838 7.47585 10 6.92162 10ZM6.01267 7.09335V3.48287H5.97387C5.0095 4.8368 4.34996 5.83076 3.7015 7.03962V7.09335H6.01267Z",fill:"#E37400"})]}),Vn=({width:s="1.25rem",height:t="1.25rem"})=>e.jsx("svg",{viewBox:"0 0 64 64",style:{height:t,width:s},xmlns:"http://www.w3.org/2000/svg",children:e.jsxs("g",{children:[e.jsx("g",{children:e.jsx("path",{d:"M51.759,12.659c-0.221-0.021-4.94-0.371-4.94-0.371s-3.28-3.271-3.639-3.631    c-0.36-0.362-1.063-0.254-1.337-0.171c-0.039,0.011-0.715,0.222-1.834,0.567c-1.096-3.167-3.027-6.077-6.426-6.077    c-0.094,0-0.191,0.004-0.289,0.01c-0.966-1.283-2.164-1.844-3.199-1.844c-7.919,0-11.703,9.951-12.889,15.008    c-3.078,0.956-5.266,1.638-5.542,1.728C9.943,18.42,9.89,18.474,9.667,20.1C9.495,21.331,5,56.264,5,56.264l35.022,6.594    L59,58.731c0,0-6.661-45.261-6.703-45.572C52.255,12.849,51.983,12.677,51.759,12.659z M33.034,10.88    c0,0.119-0.002,0.231-0.002,0.344c-1.928,0.601-4.02,1.251-6.121,1.906c1.179-4.57,3.387-6.78,5.32-7.613    C32.716,6.743,33.034,8.505,33.034,10.88z M29.876,3.278c0.346,0,0.688,0.116,1.018,0.345c-2.539,1.199-5.258,4.224-6.408,10.261    c-1.679,0.522-3.319,1.034-4.838,1.506C20.994,10.783,24.188,3.278,29.876,3.278z M31.241,30.19c0,0-2.05-1.099-4.561-1.099    c-3.686,0-3.872,2.324-3.872,2.908c0,3.195,8.287,4.42,8.287,11.903c0,5.888-3.714,9.678-8.726,9.678    c-6.012,0-9.088-3.761-9.088-3.761l1.609-5.345c0,0,3.16,2.729,5.83,2.729c1.74,0,2.449-1.38,2.449-2.387    c0-4.168-6.799-4.354-6.799-11.203c0-5.761,4.116-11.341,12.428-11.341c3.199,0,4.783,0.923,4.783,0.923L31.241,30.19z     M35.11,10.578c0-0.211,0.002-0.417,0.002-0.644c0-1.966-0.273-3.551-0.709-4.807c1.752,0.219,2.919,2.223,3.67,4.528    C37.194,9.931,36.194,10.241,35.11,10.578z",fill:"#95C675"})}),e.jsx("g",{children:e.jsx("path",{d:"M51.759,12.659c-0.221-0.021-4.94-0.371-4.94-0.371s-3.28-3.271-3.639-3.631    c-0.36-0.362-1.063-0.254-1.337-0.171c-0.039,0.011-0.715,0.222-1.834,0.567c-1.096-3.167-3.027-6.077-6.426-6.077    c-0.094,0-0.191,0.004-0.289,0.01c-0.966-1.283-2.164-1.844-3.199-1.844c-7.919,0-9.873,9.951-11.059,15.008    c-3.078,0.956-5.44,6.219-5.719,6.307c-1.719,0.542-1.772,0.596-1.996,2.223C11.148,25.91,5,56.264,5,56.264l35.022,6.594    L59,58.731c0,0-6.661-45.261-6.703-45.572C52.255,12.849,51.983,12.677,51.759,12.659z M33.034,10.88    c0,0.119-0.002,0.231-0.002,0.344c-1.928,0.601-4.02,1.251-6.121,1.906c1.179-4.57,3.387-6.78,5.32-7.613    C32.716,6.743,33.034,8.505,33.034,10.88z M29.876,3.278c0.346,0,0.688,0.116,1.018,0.345c-2.539,1.199-5.258,4.224-6.408,10.261    c-1.679,0.522-3.319,1.034-4.838,1.506C20.994,10.783,24.188,3.278,29.876,3.278z M31.241,30.19c0,0-2.05-1.099-4.561-1.099    c-3.686,0-3.872,2.324-3.872,2.908c0,3.195,8.287,4.42,8.287,11.903c0,5.888-3.714,9.678-8.726,9.678    c-6.012,0-9.088-3.761-9.088-3.761l1.609-5.345c0,0,3.16,2.729,5.83,2.729c1.74,0,2.449-1.38,2.449-2.387    c0-4.168-6.799-4.354-6.799-11.203c0-5.761,4.116-11.341,12.428-11.341c3.199,0,4.783,0.923,4.783,0.923L31.241,30.19z     M35.11,10.578c0-0.211,0.002-0.417,0.002-0.644c0-1.966-0.273-3.551-0.709-4.807c1.752,0.219,2.919,2.223,3.67,4.528    C37.194,9.931,36.194,10.241,35.11,10.578z",fill:"#79B259"})}),e.jsx("path",{d:"M40.022,62.857L59,58.731c0,0-6.661-45.261-6.703-45.572c-0.042-0.311-0.313-0.482-0.538-0.5   c-0.221-0.021-4.94-0.371-4.94-0.371s-3.28-3.271-3.639-3.631c-0.192-0.194-0.479-0.249-0.75-0.251   c-0.72,1.22-0.571,3.537-0.571,3.537l-2.232,50.839L40.022,62.857z",fill:"#55932C"}),e.jsx("path",{d:"M33.583,2.977c-0.094,0-0.191,0.004-0.289,0.01c-0.966-1.283-2.164-1.844-3.199-1.844   c-7.887,0-11.674,9.873-12.875,14.947l2.447-0.759c1.354-4.609,4.545-12.053,10.209-12.053c0.346,0,0.688,0.116,1.018,0.345   c-2.532,1.195-5.244,4.209-6.398,10.213l2.43-0.75c1.182-4.541,3.381-6.739,5.307-7.569c0.484,1.227,0.803,2.988,0.803,5.363   c0,0.108,0,0.211-0.002,0.314l2.078-0.643c0-0.2,0.002-0.4,0.002-0.617c0-1.966-0.273-3.551-0.709-4.807   c1.746,0.218,2.912,2.213,3.662,4.508l1.938-0.601C38.906,5.876,36.976,2.977,33.583,2.977z",fill:"#4A7A2B"}),e.jsx("path",{d:"M47.611,12.348c-0.474-0.037-0.793-0.06-0.793-0.06s-3.28-3.271-3.639-3.631   c-0.192-0.194-0.479-0.249-0.75-0.251c-0.72,1.22-0.571,3.537-0.571,3.537l-2.232,50.839l0.396,0.075l10.098-2.196L47.611,12.348z",fill:"#4C822A"})]})});function Un({platform:s,onConnect:t,connectedId:a}){var n;const[l,o]=r.useState(""),[p,u]=r.useState([]),[w,h]=r.useState([]),[I,C]=r.useState([]),[L,k]=r.useState(!1),[B,P]=r.useState(!1),z="https://parallels.messold.com",D=Ge();r.useEffect(()=>{const i=async()=>{var M,x;P(!0);try{const c=(M=D.user)==null?void 0:M.id,A=await U.post(`${z}/api/setup/google-accounts`,{userId:c},{withCredentials:!0});A.status===200?(k(!1),u((x=A.data)==null?void 0:x.clientAccounts.filter(d=>!d.hidden))):console.log("Unexpected status code:",A.status)}catch(c){E(c,k)}finally{P(!1)}},m=async()=>{var M;P(!0);try{const x=(M=D.user)==null?void 0:M.id,c=await U.post(`${z}/api/setup/ga4-propertyIds`,{userId:x},{withCredentials:!0});c.status===200?(k(!1),h(c.data.propertiesList||[])):console.log("Unexpected status code:",c.status)}catch(x){E(x,k)}finally{P(!1)}},N=async()=>{var M;P(!0);try{const x=(M=D.user)==null?void 0:M.id,c=await U.post(`${z}/api/setup/fb-ad-accounts`,{userId:x},{withCredentials:!0});C(c.data.adAccounts||[])}catch(x){E(x,k)}finally{P(!1)}};s.toLowerCase()==="google ads"&&i(),s.toLowerCase()==="google analytics"&&m(),s.toLowerCase()==="facebook"&&N()},[s,D]);const E=(i,m)=>{const N=i;if(N.response){const{status:M,data:x}=N.response;M===400||M===403?m(!0):(console.error("Unhandled Error Status:",M),console.error("Error Message:",x))}else N.request?console.error("No response received:",N.request):console.error("Unexpected Error:",N.message)},f=()=>s.toLowerCase()==="google ads"?!p||p.length===0?null:p.filter(i=>i.name.toLowerCase().includes(l.toLowerCase())):s.toLowerCase()==="google analytics"?!w||w.length===0?null:w.filter(i=>i.propertyName.toLowerCase().includes(l.toLowerCase())):s.toLowerCase()==="facebook"?!I||I.length===0?null:I.filter(i=>i.adname.toLowerCase().includes(l.toLowerCase())):[],v=i=>{let m,N;"clientId"in i?(m=i.clientId,N=`${i.name} (${m})`):"propertyId"in i?(m=i.propertyId,N=`${i.propertyName} (${m})`):"id"in i?(m=i.id,N=`${i.adname}`):(m="",N=""),t(s,N,m)},j=async()=>{try{const i=await U.get(`${z}/api/auth/google?context=brandSetup`,{withCredentials:!0}),{authUrl:m}=i.data;window.location.href=m}catch(i){console.error("Error getting Google Auth URL:",i)}},y=async()=>{try{const i=await U.get(`${z}/api/auth/facebook`,{withCredentials:!0});i.data.success?window.location.href=i.data.authURL:console.error("Failed to get Facebook Auth URL")}catch(i){console.error("Error getting Google Auth URL:",i)}};return B?e.jsx("div",{children:"Loading..."}):e.jsx(e.Fragment,{children:L?e.jsxs(F,{size:"sm",onClick:s.toLowerCase()==="facebook"?y:j,className:"flex items-center gap-2 bg-white text-black border border-green-800 hover:bg-green-50",children:[s.toLowerCase()==="google ads"&&e.jsxs(e.Fragment,{children:[e.jsx(Ve,{height:"1rem",width:"1rem"}),"Connect to your Google Ads account"]}),s.toLowerCase()==="google analytics"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{height:"1rem",width:"1rem"}),"Connect to your GA4 account"]}),s.toLowerCase()==="facebook"&&e.jsxs(e.Fragment,{children:[e.jsx(js,{height:"1rem",width:"1rem"}),"Connect to your Facebook account"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx(Kt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx(je,{type:"text",placeholder:"Search accounts...",className:"pl-10",value:l,onChange:i=>o(i.target.value)})]}),e.jsx("div",{className:"max-h-[50vh] overflow-auto",children:(n=f())==null?void 0:n.map(i=>{const m=s.toLowerCase()==="google ads",N=s.toLowerCase()==="facebook",M=m?i.clientId:N?i.id:i.propertyId,x=m?i.name:N?i.adname:i.propertyName,c=m?e.jsx(Ve,{height:"1rem",width:"1rem"}):N?e.jsx(js,{height:"1rem",width:"1rem"}):e.jsx(Ue,{height:"1rem",width:"1rem"});return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded hover:bg-gray-50",children:[e.jsx("span",{children:e.jsxs("div",{className:"flex flex-row items-center gap-3",children:[c,N?`${x}`:`${x} (${M})`]})}),e.jsxs(F,{size:"sm",onClick:()=>v(i),disabled:a.includes(M),className:"bg-blue-600",children:[a.includes(M)&&e.jsx(Bs,{className:"h-4 w-4 mr-2"}),a.includes(M)?"Connected":"Connect"]})]},M)})})]})})}const Gn=[{name:"Shopify",color:"from-emerald-50 to-emerald-100",icon:Vn,border:"border-emerald-600",description:"Connect your e-commerce store"},{name:"Facebook",color:"from-blue-50 to-blue-100",icon:js,border:"border-blue-600",description:"Link your ad accounts"},{name:"Google Ads",color:"from-rose-50 to-rose-100",icon:Ve,border:"border-rose-600",description:"Import campaign data"},{name:"Google Analytics",color:"from-yellow-50 to-yellow-100",icon:Ue,border:"border-yellow-600",description:"Track website metrics"}];function _n(){const[s,t]=r.useState(null),[a,l]=r.useState({}),[o,p]=r.useState(""),[u,w]=r.useState(null),[h,I]=r.useState(""),[C,L]=r.useState(""),[k,B]=r.useState([]),{toast:P}=Ns(),z="https://parallels.messold.com",D=(y,n,i)=>{l(m=>({...m,[y]:[...m[y]||[],n]})),y.toLowerCase()==="google ads"?I(i):y.toLowerCase()==="google analytics"?L(i):B(m=>[...m,i]),P({description:`Successfully connected ${n} to ${y}`,variant:"default"})},E=y=>{var i;const n=(i=y.target.files)==null?void 0:i[0];n&&(w(n),P({description:"Logo uploaded successfully",variant:"default"}))},f=y=>{var n;return(((n=a[y])==null?void 0:n.length)||0)>0};function v(y){switch(y.toLowerCase()){case"google ads":return h;case"google analytics":return C;case"facebook":return k.join(",");default:return""}}const j=async()=>{if(!o||Object.keys(a).length===0)return P({description:"Please complete all fields before submitting.",variant:"destructive"});const y={name:o,logoUrl:u||"",googleAdAccount:h||"",ga4Account:{PropertyID:C||""},fbAdAccounts:k.map(n=>n)};try{const n=await U.post(`${z}/api/brands/add`,y,{withCredentials:!0});P({description:"Brand setup completed successfully!",variant:"default"}),console.log(n.data)}catch(n){console.error(n),P({description:"Error creating brand. Please try again.",variant:"destructive"})}};return e.jsxs(ee,{className:"border-2 border-gray-100 shadow-lg",children:[e.jsxs(te,{className:"space-y-4 pb-8",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"rounded-full bg-primary/10 p-2",children:e.jsx(Rr,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx(le,{className:"text-2xl font-bold text-gray-900",children:"Brand Setup"}),e.jsx(me,{className:"mt-1 text-gray-500",children:"Connect your accounts and configure your brand settings"})]})]}),e.jsx("div",{className:"mt-4 h-2 w-full rounded-full bg-gray-100",children:e.jsx("div",{className:"h-2 rounded-full bg-primary transition-all bg-green-700",style:{width:`${Math.min((o?25:0)+(u?25:0)+Object.keys(a).length*12.5,100)}%`}})})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Brand Name"}),e.jsx(je,{id:"brandName",placeholder:"Enter your brand name",value:o,onChange:y=>p(y.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Brand Logo"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(je,{id:"brandLogo",type:"file",accept:"image/*",onChange:E,className:"hidden"}),e.jsxs(F,{variant:"outline",className:"flex-1",onClick:()=>{var y;return(y=document.getElementById("brandLogo"))==null?void 0:y.click()},children:[e.jsx(Dr,{className:"h-4 w-4 mr-2"}),u?"Change Logo":"Upload Logo"]}),u&&e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 bg-gray-50 rounded-md",children:[e.jsx(Bs,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:u.name})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Connect Platforms"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:Gn.map(y=>e.jsxs(Fn,{open:s===y.name,onOpenChange:n=>t(n?y.name:null),children:[e.jsx(Pn,{asChild:!0,children:e.jsxs(F,{variant:"outline",className:`w-full h-32 bg-gradient-to-br ${y.color} hover:shadow-md transition-all duration-200 border ${y.border} relative group`,children:[e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(y.icon,{width:"1.5rem",height:"1.5rem"}),e.jsx("span",{className:"font-medium",children:y.name}),e.jsx("span",{className:"text-xs text-gray-600",children:y.description})]}),f(y.name)&&e.jsx("div",{className:"absolute top-2 right-2 bg-white rounded-full p-1 shadow-sm",children:e.jsx(Bs,{className:"h-4 w-4 text-green-500"})})]})}),e.jsxs(ca,{className:"sm:max-w-[600px]",children:[e.jsxs(da,{children:[e.jsxs(ma,{children:["Connect to ",y.name]}),e.jsx(xa,{children:y.name==="Shopify"?"Enter your Shopify store name and login to connect.":"Select an account to connect with your brand."})]}),y.name==="Shopify"?e.jsx(In,{onConnect:D}):e.jsx(Un,{platform:y.name,onConnect:D,connectedId:v(y.name)})]})]},y.name))})]}),e.jsxs(F,{className:"w-full mt-8 text-sm font-medium",disabled:!o||!u||Object.keys(a).length===0,onClick:j,children:["Complete Setup",e.jsx(Zt,{className:"ml-2 h-5 w-5"})]})]})]})}function Hn({title:s,description:t,icon:a,bgColor:l,ribbonText:o}){return e.jsxs("div",{className:`relative overflow-hidden shadow-md rounded-lg h-36 p-4 transition-transform transform hover:scale-105 ${l} bg-gradient-to-br`,children:[o&&e.jsx("div",{className:"absolute top-0 right-0 bg-blue-500 text-white text-xs font-bold px-2 py-1 rounded-bl-lg",children:o}),e.jsxs("div",{className:"flex items-start space-x-4 h-full",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 bg-white rounded-full shadow-lg",children:a}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:t})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-white to-transparent"})]})}function Zn(){const{user:s}=Ge(),t=[{title:"Revenue Tracking",description:"Monitor your sales performance across all channels",icon:e.jsx(Hs,{className:"h-8 w-8 text-green-500"}),bgColor:"from-green-200 to-green-100"},{title:"Ad Performance",description:"Analyze the effectiveness of your ad campaigns",icon:e.jsx(Vt,{className:"h-8 w-8 text-yellow-500"}),bgColor:"from-yellow-200 to-yellow-100"},{title:"Customer Insights",description:"Understand your audience and their behavior",icon:e.jsx(tr,{className:"h-8 w-8 text-purple-500"}),bgColor:"from-purple-200 to-purple-100"},{title:"Growth Metrics",description:"Track your business growth and identify opportunities",icon:e.jsx(ts,{className:"h-8 w-8 text-amber-500"}),bgColor:"from-amber-200 to-amber-100"}];return e.jsxs("div",{className:"flex-col md:flex",children:[e.jsx("div",{className:"sticky top-0 z-10 border-b bg-white/80 backdrop-blur-sm",children:e.jsx("div",{className:"lg:px-8",children:e.jsx("div",{className:"flex h-16 items-center justify-between",children:e.jsxs("h1",{className:"text-2xl font-bold tracking-tight text-gray-900",children:["Welcome back, ",e.jsx("span",{className:"text-primary",children:(s==null?void 0:s.username.split(" ")[0])||"user"})]})})})}),e.jsxs("div",{className:"flex-1 space-y-4 p-8 pt-6",children:[e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:t.map((a,l)=>e.jsx(Hn,{title:a.title,description:a.description,icon:a.icon,bgColor:a.bgColor,ribbonText:a.ribbonText},l))}),e.jsx(_n,{})]})]})}const Kn=()=>{var t;const{user:s}=Ge();return console.log(s),e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Ae,{}),e.jsx("div",{className:"flex-1 h-screen overflow-auto",children:((t=s==null?void 0:s.brands)==null?void 0:t.length)===0?e.jsx(Zn,{}):e.jsx($n,{})})]})},rs=r.forwardRef(({className:s,...t},a)=>e.jsx(Dt,{ref:a,className:O("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...t,children:e.jsx(Za,{className:O("flex items-center justify-center text-current"),children:e.jsx(Vs,{className:"h-4 w-4"})})}));rs.displayName=Dt.displayName;const Yn=(s,t)=>s>t?"text-green-600":s<t?"text-red-600":"text-gray-600",qn=(s,t)=>s>t?e.jsx(ys,{className:"w-4 h-4 text-green-600"}):s<t?e.jsx(ws,{className:"w-4 h-4 text-red-600"}):null,Wn=({columns:s,data:t,rowsToShow:a})=>{const[l,o]=r.useState(null),[p,u]=r.useState("asc"),[w,h]=r.useState(null),I=["Add To Cart Rate","Checkout Rate","Purchase Rate"],C=n=>parseFloat(n==null?void 0:n.replace("%","").trim())||0,L=r.useMemo(()=>{const n={};return I.forEach(i=>{n[i]=t.reduce((m,N)=>m+C((N==null?void 0:N[i])||"0"),0)/t.length||0}),n},[t]),k=r.useMemo(()=>t.map(n=>{const i=I.some(N=>{const M=C((n==null?void 0:n[N])||"0"),x=L[N];return M>x}),m=I.every(N=>{const M=C((n==null?void 0:n[N])||"0"),x=L[N];return M<x});return i?"top":m?"worst":null}),[t,L]),B=r.useMemo(()=>t.map((n,i)=>({...n,performanceLabel:(k==null?void 0:k[i])||null,Sessions:Number((n==null?void 0:n.Sessions)||0),"Add To Cart Rate":C((n==null?void 0:n["Add To Cart Rate"])||"0"),"Checkout Rate":C((n==null?void 0:n["Checkout Rate"])||"0"),"Purchase Rate":C((n==null?void 0:n["Purchase Rate"])||"0")})),[t,k]),P=r.useMemo(()=>l?[...B].sort((n,i)=>{const m=typeof n[l]=="number"?n[l]:parseFloat((n[l]||"0").toString().replace("%","").trim()),N=typeof i[l]=="number"?i[l]:parseFloat((i[l]||"0").toString().replace("%","").trim());return m<N?p==="asc"?-1:1:m>N?p==="asc"?1:-1:0}):B,[B,l,p]),z=n=>{D(n)&&(l===n?u(p==="asc"?"desc":"asc"):(o(n),u("asc")))},D=n=>["Add To Cart","Checkouts","Sessions","Purchases","Visitors",...I].includes(n),E=n=>{h(w===n?null:n)},f=r.useMemo(()=>w?P.filter(n=>n.performanceLabel===w):P,[P,w]),v=r.useMemo(()=>Math.max(...B.map(n=>n.Sessions)),[B]),j=n=>{const i=n/v;return`rgba(0, 0, 255, ${Math.max(.1,i)})`},y=n=>n/v>.7?"text-white":"text-black";return e.jsx("div",{className:"rounded-md overflow-auto",style:{maxHeight:"calc(100vh - 160px)"},children:e.jsxs("table",{className:"w-full text-center shadow-lg rounded-lg overflow-auto",children:[e.jsx("thead",{className:"bg-white sticky top-0 z-10",children:e.jsx("tr",{children:s.map(n=>e.jsx("th",{className:`font-bold p-3 text-gray-800 text-sm uppercase min-w-[200px] border-b-2 ${D(n)?"cursor-pointer":""}`,onClick:()=>z(n),style:{position:"sticky",top:0},children:e.jsxs("div",{className:"flex items-center justify-center",children:[n,D(n)&&e.jsx("span",{className:"ml-2",children:l===n?p==="asc"?e.jsx(ys,{className:"w-4 h-4 text-blue-600"}):e.jsx(ws,{className:"w-4 h-4 text-blue-600"}):e.jsx(Zs,{className:"w-4 h-4 text-gray-500"})})]})},n))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.slice(0,a).map((n,i)=>e.jsx("tr",{className:`${i%2===0?"bg-gray-100":"bg-white"} hover:bg-gray-100 transition-colors duration-200 rounded-md`,children:s.map(m=>{const N=n[m],M=I.includes(m),x=s[0];return e.jsx("td",{className:`p-3 text-sm font-normal ${m==="Sessions"?y(Number(n.Sessions)):M?Yn(N,L[m]):"text-gray-800"}`,style:{backgroundColor:m==="Sessions"?j(Number(n.Sessions)):""},children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[M?`${N.toFixed(2)}%`:N,M&&qn(N,L[m]),m===x&&n.performanceLabel==="top"&&e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-green-100 text-green-800 text-xs rounded-full cursor-pointer",onClick:()=>E("top"),children:"Top"}),m===x&&n.performanceLabel==="worst"&&e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-red-100 text-red-800 text-xs rounded-full cursor-pointer",onClick:()=>E("worst"),children:"Worst"})]})},m)})},i))})]})})},Ms=_e.memo(Wn),be=Qa,ye=er,pe=r.forwardRef(({className:s,children:t,...a},l)=>e.jsxs(Lt,{ref:l,className:O("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...a,children:[t,e.jsx(Ka,{asChild:!0,children:e.jsx(Mt,{className:"h-4 w-4 opacity-50"})})]}));pe.displayName=Lt.displayName;const ua=r.forwardRef(({className:s,...t},a)=>e.jsx(kt,{ref:a,className:O("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(Ya,{className:"h-4 w-4"})}));ua.displayName=kt.displayName;const pa=r.forwardRef(({className:s,...t},a)=>e.jsx(Tt,{ref:a,className:O("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(Mt,{className:"h-4 w-4"})}));pa.displayName=Tt.displayName;const ge=r.forwardRef(({className:s,children:t,position:a="popper",...l},o)=>e.jsx(qa,{children:e.jsxs($t,{ref:o,className:O("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...l,children:[e.jsx(ua,{}),e.jsx(Wa,{className:O("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(pa,{})]})}));ge.displayName=$t.displayName;const Jn=r.forwardRef(({className:s,...t},a)=>e.jsx(Ft,{ref:a,className:O("px-2 py-1.5 text-sm font-semibold",s),...t}));Jn.displayName=Ft.displayName;const Q=r.forwardRef(({className:s,children:t,...a},l)=>e.jsxs(Pt,{ref:l,className:O("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ja,{children:e.jsx(Vs,{className:"h-4 w-4"})})}),e.jsx(Xa,{children:t})]}));Q.displayName=Pt.displayName;const Xn=r.forwardRef(({className:s,...t},a)=>e.jsx(Et,{ref:a,className:O("-mx-1 my-1 h-px bg-muted",s),...t}));Xn.displayName=Et.displayName;function ks({columns:s,onFiltersChange:t,filters:a,setFilters:l}){const[o,p]=r.useState(""),[u,w]=r.useState(">"),[h,I]=r.useState("");r.useEffect(()=>{t(a)},[a,t]);const C=()=>{o&&h&&(l([...a,{column:o,operator:u,value:h}]),p(""),I(""))};return e.jsx("div",{children:e.jsxs(we,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(F,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Filter"})]})}),e.jsx(fe,{className:"w-80 p-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs(be,{value:o,onValueChange:L=>{p(L)},children:[e.jsx(pe,{children:e.jsx(ye,{placeholder:"Select column"})}),e.jsx(ge,{children:s.map(L=>e.jsx(Q,{value:L,children:L},L))})]}),e.jsxs(be,{value:u,onValueChange:L=>w(L),children:[e.jsx(pe,{children:e.jsx(ye,{placeholder:"Select operator"})}),e.jsxs(ge,{children:[e.jsx(Q,{value:">",children:"Greater than"}),e.jsx(Q,{value:"<",children:"Less than"}),e.jsx(Q,{value:"=",children:"Equal to"})]})]}),e.jsx(je,{type:"text",placeholder:"Enter filter value",value:h,onChange:L=>I(L.target.value)}),e.jsx(F,{onClick:C,children:"Add Filter"})]})})]})})}function Qn(){const[s,t]=r.useState(void 0),[a,l]=r.useState([]),o=new Date,[p,u]=r.useState([]),[w,h]=r.useState(!1),[I,C]=r.useState(null),{brandId:L}=Ce(),k=Ne(),B=s!=null&&s.from?H(s.from,"yyyy-MM-dd"):"",P=s!=null&&s.to?H(s.to,"yyyy-MM-dd"):"",[z,D]=r.useState([]),[E,f]=r.useState(50),[v,j]=r.useState([]),y=d=>{D(R=>R.includes(d)?R.filter(S=>S!==d):[...R,d])},n=r.useCallback(async()=>{var d;h(!0);try{const T=(await U.post(`https://parallels.messold.com/api/analytics/atcreport/${L}`,{startDate:B,endDate:P},{withCredentials:!0})).data.data||[];if(u(T),l(T),C(new Date),T.length>0)if(z.length===0){const V=Object.keys(T[0]);D(V)}else{const V=Object.keys(T[0]);D(Z=>Z.filter(K=>V.includes(K)))}}catch(R){console.error("Error fetching dashboard data:",R),U.isAxiosError(R)&&((d=R.response)==null?void 0:d.status)===401&&(alert("Your session has expired. Please log in again."),k("/"))}finally{h(!1)}},[k,B,P,L]);r.useEffect(()=>{n()},[n]),r.useEffect(()=>{n();const d=setInterval(n,5*60*1e3);return()=>clearInterval(d)},[n]);const i=()=>{n()},m=p.length>0?Object.keys(p[0]):[],N=m.filter(d=>z.includes(d)),M=r.useCallback(d=>{let R=[...p];d.forEach(S=>{R=R.filter(T=>{const V=T[S.column];if([">","<","="].includes(S.operator)){const Z=parseFloat(V),K=parseFloat(S.value);switch(S.operator){case">":return Z>K;case"<":return Z<K;case"=":return Z===K;default:return!0}}return!0})}),l(R)},[p]),x=r.useMemo(()=>a,[a]),c=["Add To Cart","Checkouts","Sessions","Purchases","Purchase Rate","Add To Cart Rate","Checkout Rate"],A=d=>{j(v.filter((R,S)=>S!==d))};return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Ae,{}),e.jsxs("div",{className:"flex-1 h-screen overflow-hidden flex flex-col",children:[e.jsx("header",{className:"px-6 py-4 border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Gs,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-xl font-semibold text-primary",children:"E-Commerce Metrics Overview"})]}),e.jsxs("div",{className:"flex flex-row gap-3 items-center",children:[I&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Last updated: ",I.toLocaleTimeString()]}),e.jsx(F,{onClick:i,disabled:w,size:"icon",variant:"outline",children:e.jsx(Se,{className:`h-4 w-4 ${w?"animate-spin":""}`})}),e.jsx(Re,{date:s,setDate:t,defaultDate:{from:new Date(o.getFullYear(),o.getMonth(),1),to:o}})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto px-6 py-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Analyze your Daily E-Commerce performance"}),e.jsx(Ue,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(we,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(F,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx("span",{children:"Select Columns"})]})}),e.jsx(fe,{className:"w-56",children:m.map(d=>e.jsxs(oe,{className:"flex items-center space-x-2",children:[e.jsx(rs,{id:`column-${d}`,checked:z.includes(d),onCheckedChange:()=>y(d)}),e.jsx("label",{htmlFor:`column-${d}`,className:"flex-1 cursor-pointer",children:d})]},d))})]}),e.jsxs(we,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(F,{variant:"outline",children:["Show ",E===1e6?"all":E," rows",e.jsx(Te,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(fe,{children:[e.jsx(oe,{onSelect:()=>f(50),children:"Show 50 rows"}),e.jsx(oe,{onSelect:()=>f(100),children:"Show 100 rows"}),e.jsx(oe,{onSelect:()=>f(1e6),children:"Show all rows"})]})]}),e.jsx(ks,{columns:c,onFiltersChange:M,filters:v,setFilters:j})]})]}),v.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:v.map((d,R)=>e.jsxs("div",{className:"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:[e.jsx("span",{children:`${d.column} ${d.operator} ${d.value}`}),e.jsx("button",{onClick:()=>A(R),className:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","aria-label":"Remove filter",children:e.jsx(Ye,{className:"h-3 w-3"})})]},R))}),e.jsx("div",{className:"rounded-md border overflow-hidden",children:w?e.jsx(qe,{}):e.jsx(Ms,{columns:N,data:x,rowsToShow:E})})]})})]})]})}function ue({title:s,tooltip:t,colSpan:a=1,rowSpan:l,isSubHeader:o=!1}){return e.jsx("th",{className:`${o?"text-sm font-medium":"font-semibold"} text-center whitespace-nowrap border border-gray-500 text-white z-50`,colSpan:a,rowSpan:l,children:e.jsx(It,{children:e.jsxs(Bt,{children:[e.jsx(Ot,{asChild:!0,children:e.jsx("span",{className:"flex items-center justify-center gap-1 cursor-help",children:s})}),e.jsx(zt,{className:"mb-3",children:e.jsx("div",{className:"text-gray-700 bg-white p-3 rounded-md text-sm border shadow-lg max-w-xs",children:t})})]})})})}const el=()=>{const[s,t]=r.useState([]),[a,l]=r.useState(""),[o,p]=r.useState(!0),[u,w]=r.useState(null),[h,I]=r.useState(void 0),[C,L]=r.useState([]),{brandId:k}=Ce(),B=h!=null&&h.from?H(h.from,"yyyy-MM-dd"):"",P=h!=null&&h.to?H(h.to,"yyyy-MM-dd"):"",z="https://parallels.messold.com";r.useEffect(()=>{(async()=>{p(!0),w(null);try{const y={};B&&(y.startDate=B),P&&(y.endDate=P);const i=(await U.get(`${z}/api/report/${k}`,{params:y,withCredentials:!0})).data.data,N=(await U.get(`${z}/api/brands/${k}`,{withCredentials:!0})).data.name;t(i),l(N)}catch(y){console.error(y),w("Failed to fetch data. Please try again later.")}finally{p(!1)}})()},[k,h,z]);const D=j=>{L(y=>y.includes(j)?y.filter(n=>n!==j):[...y,j])},E=j=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(j),f=j=>`${j.toFixed(2)}`,v=r.useMemo(()=>s.map(j=>{const y=j.dailyMetrics.map(M=>({...M,metaSales:M.metaSpend*(M.metaROAS||0),googleSales:M.googleSpend*(M.googleROAS||0)})),n=y.reduce((M,x)=>M+x.metaSales,0),i=y.reduce((M,x)=>M+x.googleSales,0),m=n+i,N=(M,x)=>x?M/x:0;return{...j,metaSales:n,googleSales:i,totalSales:m,metaROAS:N(n,j.metaSpend),googleROAS:N(i,j.googleSpend),grossROI:N(m,j.totalSpend),netROI:N(j.shopifySales,j.totalSpend),dailyMetrics:y}}),[s]);return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Ae,{}),e.jsxs("div",{className:"flex-1 h-screen overflow-hidden bg-gray-50",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(_s,{className:"h-7 w-7"}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[a," Ad Metrics Overview"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Re,{date:h,setDate:I}),h&&e.jsx(F,{onClick:()=>I(void 0),className:"px-3 py-2 bg-red-500 hover:bg-red-600 transition-colors",children:e.jsx(Lr,{className:"w-5 h-5"})})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Key performance indicators for your Ad Accounts"}),o?e.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-300px)]",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-600"})}):u?e.jsx("div",{className:"rounded-lg bg-red-50 p-4 text-red-600",children:u}):e.jsx("div",{className:"border rounded-lg shadow-sm bg-white overflow-hidden",children:e.jsx("div",{className:"h-[calc(100vh-200px)] overflow-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsxs("thead",{className:"sticky top-0 z-20 bg-cyan-900 border border-gray-500 text-sm",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"w-5 bg-cyan-900 border border-gray-500",rowSpan:2}),e.jsx(ue,{title:"Date",tooltip:"Date",rowSpan:2}),e.jsx(ue,{title:"Meta",tooltip:"Meta Metrics",colSpan:3}),e.jsx(ue,{title:"Google",tooltip:"Google Metrics",colSpan:3}),e.jsx(ue,{title:"Total Spent",tooltip:"Total Spent = Meta Spent + Google Spent",rowSpan:2}),e.jsx(ue,{title:"Gross ROI",tooltip:"Gross ROI = (MetaSales + GoogleSales)/ Total Spent",rowSpan:2}),e.jsx(ue,{title:"Shopify Sales",tooltip:"Shopify Sales",rowSpan:2}),e.jsx(ue,{title:"Net ROI",tooltip:"Net ROI = Shopify Sales / Total Spend",rowSpan:2})]}),e.jsxs("tr",{children:[e.jsx(ue,{title:"Spent",tooltip:"Meta spent",isSubHeader:!0}),e.jsx(ue,{title:"Sales",tooltip:"Meta Sales = Meta Spent * Meta ROAS",isSubHeader:!0}),e.jsx(ue,{title:"ROAS",tooltip:"Meta ROAS",isSubHeader:!0}),e.jsx(ue,{title:"Spent",tooltip:"Google Spent",isSubHeader:!0}),e.jsx(ue,{title:"Sales",tooltip:"Google Sales = Google Spent * Google ROAS",isSubHeader:!0}),e.jsx(ue,{title:"ROAS",tooltip:"Google ROAS",isSubHeader:!0})]})]}),e.jsx("tbody",{children:v.map(j=>{const y=`${j.year}-${j.month.toString().padStart(2,"0")}`,n=C.includes(y);return e.jsxs(_e.Fragment,{children:[e.jsxs("tr",{className:`
                                                        ${n?"bg-gray-200":"bg-gray-50"} 
                                                        border-b border-gray-100 cursor-pointer 
                                                        transition-colors text-sm 
                                                    `,onClick:()=>D(y),children:[e.jsx("td",{className:"w-5 px-4 py-2",children:n?e.jsx(Te,{className:"h-4 w-4 text-gray-500"}):e.jsx(He,{className:"h-4 w-4 text-gray-500"})}),e.jsx("td",{className:"py-3 font-medium text-gray-900",children:H(new Date(j.year,j.month-1),"MMMM yyyy")}),e.jsx("td",{className:"px-4 py-3 text-right",children:E(j.metaSpend)}),e.jsx("td",{className:"px-4 py-3 text-right",children:E(j.metaSales)}),e.jsx("td",{className:"px-4 py-3 text-right",children:f(j.metaROAS)}),e.jsx("td",{className:"px-4 py-3 text-right",children:E(j.googleSpend)}),e.jsx("td",{className:"px-4 py-3 text-right",children:E(j.googleSales)}),e.jsx("td",{className:"px-4 py-3 text-right",children:f(j.googleROAS)}),e.jsx("td",{className:"px-4 py-3 text-right",children:E(j.totalSpend)}),e.jsx("td",{className:"px-4 py-3 text-right",children:f(j.grossROI)}),e.jsx("td",{className:"px-4 py-3 text-right",children:E(j.shopifySales)}),e.jsx("td",{className:"px-4 py-3 text-right",children:f(j.netROI)})]}),n&&j.dailyMetrics.map(i=>e.jsxs("tr",{className:"border-b border-gray-50 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"w-5 px-4 py-2"}),e.jsx("td",{className:"py-2 text-sm text-gray-600",children:H(new Date(i.date),"dd/MM/yyyy")}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:E(i.metaSpend)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:E(i.metaSales)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:f(i.metaROAS)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:E(i.googleSpend)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:E(i.googleSales)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:f(i.googleROAS)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:E(i.totalSpend)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:f(i.grossROI)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:E(i.shopifySales)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:f(i.netROI)})]},i._id))]},y)})})]})})})]})]})]})};function sl(){const[s,t]=r.useState(void 0),[a,l]=r.useState([]),[o,p]=r.useState([]),[u,w]=r.useState(!1),[h,I]=r.useState(null),{brandId:C}=Ce(),L=Ne(),k=s!=null&&s.from?H(s.from,"yyyy-MM-dd"):"",B=s!=null&&s.to?H(s.to,"yyyy-MM-dd"):"",[P,z]=r.useState([]),[D,E]=r.useState(50),[f,v]=r.useState([]),[j,y]=r.useState([]),n=new Date,i=["city","country","region","Visitors","Sessions","Add To Cart","Add To Cart Rate","Checkouts","Checkout Rate","Purchases","Purchase Rate"],m=S=>{z(T=>{const V=T.includes(S)?T.filter(Z=>Z!==S):[...T,S];return y(Z=>["city","region","country"].includes(S)?V.includes(S)?Z.filter(K=>K!==S):[...Z,S]:Z),i.filter(Z=>V.includes(Z))})},N=r.useCallback(async()=>{var S,T;w(!0);try{const V="https://parallels.messold.com",Z={startDate:k,endDate:B,...j.length>0?{filters:{location:j}}:{}},ce=((S=(await U.post(`${V}/api/analytics/report/${C}`,Z,{withCredentials:!0})).data[1])==null?void 0:S.data)||[];if(p(ce),l(ce),I(new Date),ce.length>0){const ie=Object.keys(ce[0]);z(Me=>Me.filter($e=>ie.includes($e)))}}catch(V){console.error("Error fetching dashboard data:",V),U.isAxiosError(V)&&((T=V.response)==null?void 0:T.status)===401&&(alert("Your session has expired. Please log in again."),L("/"))}finally{w(!1)}},[L,C,j,k,B]);r.useEffect(()=>{z(i)},[]),r.useEffect(()=>{N()},[N]),r.useEffect(()=>{N();const S=setInterval(N,5*60*1e3);return()=>clearInterval(S)},[N]);const M=()=>{N()},x=r.useMemo(()=>i.filter(S=>P.includes(S)),[i,P]),c=r.useCallback(S=>{let T=[...o];S.forEach(V=>{T=T.filter(Z=>{const K=Z[V.column];if([">","<","="].includes(V.operator)){const ce=parseFloat(K),ie=parseFloat(V.value);switch(V.operator){case">":return ce>ie;case"<":return ce<ie;case"=":return ce===ie;default:return!0}}return!0})}),l(T)},[o]),A=r.useMemo(()=>a,[a]),d=["Add To Cart","Checkouts","Sessions","Purchases","Purchase Rate","Add To Cart Rate","Checkout Rate"],R=S=>{v(f.filter((T,V)=>V!==S))};return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Ae,{}),e.jsxs("div",{className:"flex-1 h-screen overflow-hidden flex flex-col",children:[e.jsx("header",{className:"px-6 py-4 border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ut,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-xl font-semibold text-primary",children:"Location Metrics Overview"})]}),e.jsxs("div",{className:"flex flex-row gap-3 items-center",children:[h&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Last updated: ",h.toLocaleTimeString()]}),e.jsx(F,{onClick:M,disabled:u,size:"icon",variant:"outline",children:e.jsx(Se,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(Re,{date:s,setDate:t,defaultDate:{from:new Date(n.getFullYear()-4,n.getMonth(),n.getDate()),to:n}})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto px-6 py-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Analyze your location wise performance"}),e.jsx(Ue,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(we,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(F,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx("span",{children:"Select Columns"})]})}),e.jsx(fe,{className:"w-56",children:i.map(S=>e.jsxs(oe,{className:"flex items-center space-x-2",children:[e.jsx(rs,{id:`column-${S}`,checked:P.includes(S),onCheckedChange:()=>m(S)}),e.jsx("label",{htmlFor:`column-${S}`,className:"flex-1 cursor-pointer",children:S})]},S))})]}),e.jsxs(we,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(F,{variant:"outline",children:["Show ",D===1e6?"all":D," rows",e.jsx(Te,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(fe,{children:[e.jsx(oe,{onSelect:()=>E(50),children:"Show 50 rows"}),e.jsx(oe,{onSelect:()=>E(100),children:"Show 100 rows"}),e.jsx(oe,{onSelect:()=>E(1e6),children:"Show all rows"})]})]}),e.jsx(ks,{columns:d,onFiltersChange:c,filters:f,setFilters:v})]})]}),f.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:f.map((S,T)=>e.jsxs("div",{className:"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:[e.jsx("span",{children:`${S.column} ${S.operator} ${S.value}`}),e.jsx("button",{onClick:()=>R(T),className:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","aria-label":"Remove filter",children:e.jsx(Ye,{className:"h-3 w-3"})})]},T))}),e.jsx("div",{className:"rounded-md border overflow-hidden",children:u?e.jsx(qe,{}):e.jsx(Ms,{columns:x,data:A,rowsToShow:D})})]})})]})]})}const tl=()=>{const[s,t]=r.useState(void 0),[a,l]=r.useState([]),[o,p]=r.useState([]),u=new Date,[w,h]=r.useState([]),[I,C]=r.useState(!1),[L,k]=r.useState(null),{brandId:B}=Ce(),P=Ne(),z=s!=null&&s.from?H(s.from,"yyyy-MM-dd"):"",D=s!=null&&s.to?H(s.to,"yyyy-MM-dd"):"",[E,f]=r.useState([]),[v,j]=r.useState(50),y=d=>{f(R=>{const S=R.includes(d)?R.filter(T=>T!==d):[...R,d];return m.filter(T=>S.includes(T))})},n=r.useCallback(async()=>{var d;C(!0);try{const T=(await U.post(`https://parallels.messold.com/api/analytics/report/${B}`,{startDate:z,endDate:D},{withCredentials:!0})).data[2].data||[];if(h(T),l(T),k(new Date),T.length>0)if(E.length===0){const V=Object.keys(T[0]);f(V)}else{const V=Object.keys(T[0]);f(Z=>Z.filter(K=>V.includes(K)))}}catch(R){console.error("Error fetching dashboard data:",R),U.isAxiosError(R)&&((d=R.response)==null?void 0:d.status)===401&&(alert("Your session has expired. Please log in again."),P("/"))}finally{C(!1)}},[P,z,D,B]);r.useEffect(()=>{n()},[n]),r.useEffect(()=>{n();const d=setInterval(n,5*60*1e3);return()=>clearInterval(d)},[n]);const i=()=>{n()},m=w.length>0?Object.keys(w[0]):[],N=m.filter(d=>E.includes(d)),M=r.useCallback(d=>{let R=[...w];d.forEach(S=>{R=R.filter(T=>{const V=T[S.column];if([">","<","="].includes(S.operator)){const Z=parseFloat(V),K=parseFloat(S.value);switch(S.operator){case">":return Z>K;case"<":return Z<K;case"=":return Z===K;default:return!0}}return!0})}),l(R)},[w]),x=r.useMemo(()=>a,[a]),c=["Add To Cart","Checkouts","Sessions","Purchases","Purchase Rate","Add To Cart Rate","Checkout Rate"],A=d=>{p(o.filter((R,S)=>S!==d))};return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Ae,{}),e.jsxs("div",{className:"flex-1 h-screen overflow-hidden flex flex-col",children:[e.jsx("header",{className:"px-6 py-4 border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(_t,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-xl font-semibold text-primary",children:"Channel Metrics Overview"})]}),e.jsxs("div",{className:"flex flex-row gap-3 items-center",children:[L&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Last updated: ",L.toLocaleTimeString()]}),e.jsx(F,{onClick:i,disabled:I,size:"icon",variant:"outline",children:e.jsx(Se,{className:`h-4 w-4 ${I?"animate-spin":""}`})}),e.jsx(Re,{date:s,setDate:t,defaultDate:{from:new Date(u.getFullYear()-4,u.getMonth(),u.getDate()),to:u}})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto px-6 py-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Analyze your Reffering Channel wise performance"}),e.jsx(Ue,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(we,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(F,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx("span",{children:"Select Columns"})]})}),e.jsx(fe,{className:"w-56",children:m.map(d=>e.jsxs(oe,{className:"flex items-center space-x-2",children:[e.jsx(rs,{id:`column-${d}`,checked:E.includes(d),onCheckedChange:()=>y(d)}),e.jsx("label",{htmlFor:`column-${d}`,className:"flex-1 cursor-pointer",children:d})]},d))})]}),e.jsxs(we,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(F,{variant:"outline",children:["Show ",v===1e6?"all":v," rows",e.jsx(Te,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(fe,{children:[e.jsx(oe,{onSelect:()=>j(50),children:"Show 50 rows"}),e.jsx(oe,{onSelect:()=>j(100),children:"Show 100 rows"}),e.jsx(oe,{onSelect:()=>j(1e6),children:"Show all rows"})]})]}),e.jsx(ks,{columns:c,onFiltersChange:M,filters:o,setFilters:p})]})]}),o.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:o.map((d,R)=>e.jsxs("div",{className:"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:[e.jsx("span",{children:`${d.column} ${d.operator} ${d.value}`}),e.jsx("button",{onClick:()=>A(R),className:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","aria-label":"Remove filter",children:e.jsx(Ye,{className:"h-3 w-3"})})]},R))}),e.jsx("div",{className:"rounded-md border overflow-hidden",children:I?e.jsx(qe,{}):e.jsx(Ms,{columns:N,data:x,rowsToShow:v})})]})})]})]})},al=()=>{const[s,t]=r.useState(void 0),[a,l]=r.useState([]),[o,p]=r.useState([]),[u,w]=r.useState([]),[h,I]=r.useState(!1),[C,L]=r.useState(null),{brandId:k}=Ce(),B=Ne(),P=s!=null&&s.from?H(s.from,"yyyy-MM-dd"):"",z=s!=null&&s.to?H(s.to,"yyyy-MM-dd"):"",[D,E]=r.useState([]),[f,v]=r.useState(50),j=new Date,y=d=>{E(R=>{const S=R.includes(d)?R.filter(T=>T!==d):[...R,d];return m.filter(T=>S.includes(T))})},n=r.useCallback(async()=>{var d;I(!0);try{const T=(await U.post(`https://parallels.messold.com/api/analytics/report/${k}`,{startDate:P,endDate:z},{withCredentials:!0})).data[0].data||[];if(w(T),l(T),L(new Date),T.length>0)if(D.length===0){const V=Object.keys(T[0]);E(V)}else{const V=Object.keys(T[0]);E(Z=>Z.filter(K=>V.includes(K)))}}catch(R){console.error("Error fetching dashboard data:",R),U.isAxiosError(R)&&((d=R.response)==null?void 0:d.status)===401&&(alert("Your session has expired. Please log in again."),B("/"))}finally{I(!1)}},[B,P,z,k]);r.useEffect(()=>{n()},[n]),r.useEffect(()=>{n();const d=setInterval(n,5*60*1e3);return()=>clearInterval(d)},[n]);const i=()=>{n()},m=u.length>0?Object.keys(u[0]):[],N=m.filter(d=>D.includes(d)),M=r.useCallback(d=>{let R=[...u];d.forEach(S=>{R=R.filter(T=>{const V=T[S.column];if([">","<","="].includes(S.operator)){const Z=parseFloat(V),K=parseFloat(S.value);switch(S.operator){case">":return Z>K;case"<":return Z<K;case"=":return Z===K;default:return!0}}return!0})}),l(R)},[u]),x=r.useMemo(()=>a,[a]),c=["Add To Cart","Checkouts","Sessions","Purchases","Purchase Rate","Add To Cart Rate","Checkout Rate"],A=d=>{p(o.filter((R,S)=>S!==d))};return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Ae,{}),e.jsxs("div",{className:"flex-1 h-screen overflow-hidden flex flex-col",children:[e.jsx("header",{className:"px-6 py-4 border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Gt,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-xl font-semibold text-primary",children:"Landing Page Metrics Overview"})]}),e.jsxs("div",{className:"flex flex-row gap-3 items-center",children:[C&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Last updated: ",C.toLocaleTimeString()]}),e.jsx(F,{onClick:i,disabled:h,size:"icon",variant:"outline",children:e.jsx(Se,{className:`h-4 w-4 ${h?"animate-spin":""}`})}),e.jsx(Re,{date:s,setDate:t,defaultDate:{from:new Date(j.getFullYear()-4,j.getMonth(),j.getDate()),to:j}})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto px-6 py-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Analyze your landing page wise performance"}),e.jsx(Ue,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(we,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(F,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx("span",{children:"Select Columns"})]})}),e.jsx(fe,{className:"w-56",children:m.map(d=>e.jsxs(oe,{className:"flex items-center space-x-2",children:[e.jsx(rs,{id:`column-${d}`,checked:D.includes(d),onCheckedChange:()=>y(d)}),e.jsx("label",{htmlFor:`column-${d}`,className:"flex-1 cursor-pointer",children:d})]},d))})]}),e.jsxs(we,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(F,{variant:"outline",children:["Show ",f===1e6?"all":f," rows",e.jsx(Te,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(fe,{children:[e.jsx(oe,{onSelect:()=>v(50),children:"Show 50 rows"}),e.jsx(oe,{onSelect:()=>v(100),children:"Show 100 rows"}),e.jsx(oe,{onSelect:()=>v(1e6),children:"Show all rows"})]})]}),e.jsx(ks,{columns:c,onFiltersChange:M,filters:o,setFilters:p})]})]}),o.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:o.map((d,R)=>e.jsxs("div",{className:"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:[e.jsx("span",{children:`${d.column} ${d.operator} ${d.value}`}),e.jsx("button",{onClick:()=>A(R),className:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","aria-label":"Remove filter",children:e.jsx(Ye,{className:"h-3 w-3"})})]},R))}),e.jsx("div",{className:"rounded-md border overflow-hidden",children:h?e.jsx(qe,{}):e.jsx(Ms,{columns:N,data:x,rowsToShow:f})})]})})]})]})};function rl(){const{brands:s}=Cs(),[t,a]=r.useState([]),[l,o]=r.useState({brandId:"",source:"",targetAmount:0,targetDate:Xs(new Date)}),[p,u]=r.useState(null),[w,h]=r.useState(null),[I,C]=r.useState({}),[L,k]=r.useState(!1),B="https://parallels.messold.com",P=Ne(),z=r.useCallback(async x=>{var c;try{return(await U.get(`${B}/api/shopify/dailysales/${x}`,{withCredentials:!0})).data.totalSales}catch(A){return console.error("Error fetching sales data:",A),U.isAxiosError(A)&&((c=A.response)==null?void 0:c.status)===401&&(alert("Your session has expired. Please log in again."),P("/")),0}},[P]),D=r.useCallback(async()=>{k(!0);try{const x={};await Promise.all(t.map(async c=>{x[c.brandId]=await z(c.brandId)})),C(x)}catch(x){console.error("Error fetching sales data:",x)}finally{k(!1)}},[t,z]);r.useEffect(()=>{D()},[D]);const E=x=>{const{name:c,value:A}=x.target;o(d=>({...d,[c]:c==="brandId"?A:Number(A)}))},f=x=>{o(c=>({...c,source:x}))},v=async()=>{const x=s.find(c=>String(c._id)===String(l.brandId));if(x)try{const c={brandId:x._id,name:x.name,source:l.source,targetAmount:l.targetAmount,targetDate:l.targetDate},A=await U.post(`${B}/api/performance/addTarget`,c,{withCredentials:!0});a(d=>[...d,A.data]),o({brandId:"",source:"",targetAmount:0,targetDate:Xs(new Date)})}catch(c){console.error("Error adding brand:",c)}else console.log("Brand not found")},j=x=>{const c=t.find(A=>A.brandId===x);c&&(u(x),h({...c}))},y=async x=>{if(w)try{const c=await U.patch(`${B}/api/performance/updateTarget/${x}`,w,{withCredentials:!0});a(A=>A.map(d=>d.brandId===x?{...d,...c.data}:d)),u(null),h(null),alert("Brand updated successfully!")}catch(c){console.error("Error saving brand edit:",c),alert("Failed to update brand")}},n=()=>{u(null),h(null)},i=async x=>{try{await U.delete(`${B}/api/performance/deleteTarget/${x}`,{withCredentials:!0}),a(c=>c.filter(A=>A.brandId!==x)),console.log("Brand deleted successfully")}catch(c){console.error("Error deleting brand:",c)}},m=()=>e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-blue-500"}),N=x=>{const c=I[x.brandId]||0,A=Math.max(x.targetAmount-c,0),d=new Date;d.setHours(0,0,0,0);const R=new Date(x.targetDate);R.setHours(0,0,0,0);const S=Math.max(Math.ceil((R.getTime()-d.getTime())/(1e3*60*60*24)),0),T=S>0?A/S:0;return{achievedSales:c,remainingTarget:A,remainingDays:S,requiredSalesPerDay:T}},M=t.map(x=>{const{achievedSales:c,remainingTarget:A}=N(x);return{name:x.name,Achieved:c,Remaining:A}});return r.useEffect(()=>{(async()=>{try{const c=await U.get(`${B}/api/performance/brandTarget`,{withCredentials:!0});a(c.data)}catch(c){console.error("Error fetching brands:",c)}})()},[]),e.jsxs("div",{className:"bg-gray-100 min-h-screen",children:[e.jsx("nav",{className:"bg-white border-b border-gray-200 px-4 py-4 md:px-6 lg:px-8",children:e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Brands Performance Metrics"})})}),e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs(ee,{className:"mb-4",children:[e.jsx(te,{children:e.jsx(le,{children:"Add New Brand Target"})}),e.jsx(se,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx(Pe,{htmlFor:"brandName",children:"Brand Name"}),e.jsxs(be,{onValueChange:x=>o(c=>({...c,brandId:x})),children:[e.jsx(pe,{children:e.jsx(ye,{placeholder:"Select brand"})}),e.jsx(ge,{children:s.map(x=>e.jsx(Q,{value:x._id,children:x.name},x._id))})]})]}),e.jsxs("div",{children:[e.jsx(Pe,{htmlFor:"source",children:"Source"}),e.jsxs(be,{onValueChange:f,value:l.source,children:[e.jsx(pe,{children:e.jsx(ye,{placeholder:"Select source"})}),e.jsxs(ge,{children:[e.jsx(Q,{value:"Meta & Google",children:"Meta & Google"}),e.jsx(Q,{value:"Meta",children:"Meta"}),e.jsx(Q,{value:"Google",children:"Google"})]})]})]}),e.jsxs("div",{children:[e.jsx(Pe,{htmlFor:"targetAmount",children:"Target Amount"}),e.jsx(je,{id:"targetAmount",name:"targetAmount",type:"number",value:l.targetAmount,onChange:E,placeholder:"Enter target amount"})]}),e.jsxs("div",{children:[e.jsx(Pe,{children:"Target Date"}),e.jsxs(es,{children:[e.jsx(ss,{asChild:!0,children:e.jsx(F,{variant:"outline",className:O("w-full justify-start text-left font-normal",!l.targetDate&&"text-muted-foreground"),children:l.targetDate?H(l.targetDate,"PPP"):e.jsx("span",{children:"Pick a date"})})}),e.jsx(Ke,{className:"w-auto p-0",children:e.jsx(fs,{mode:"single",selected:l.targetDate,onSelect:x=>x&&o(c=>({...c,targetDate:x})),initialFocus:!0})})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(F,{onClick:v,className:"w-full",children:[e.jsx(Mr,{className:"mr-2 h-4 w-4"})," Add Brand Target"]})})]})})]}),e.jsxs(ee,{className:"mb-4",children:[e.jsx(te,{children:e.jsx(le,{children:"Brand Performance Table"})}),e.jsx(se,{children:e.jsxs(Rs,{children:[e.jsx(Ds,{children:e.jsxs(ze,{children:[e.jsx(Le,{children:"Brand"}),e.jsx(Le,{children:"Source"}),e.jsx(Le,{children:"Target Amount"}),e.jsx(Le,{children:"Target Date"}),e.jsx(Le,{children:"Achieved Sales"}),e.jsx(Le,{children:"Remaining Target"}),e.jsx(Le,{children:"Remaining Days"}),e.jsx(Le,{children:"Required Sales/Day"}),e.jsx(Le,{children:"Actions"})]})}),e.jsx(Ls,{children:t.map(x=>{const{achievedSales:c,remainingTarget:A,remainingDays:d,requiredSalesPerDay:R}=N(x),S=p===x.brandId;return e.jsxs(ze,{children:[e.jsx(ne,{className:"font-medium",children:x.name}),e.jsx(ne,{children:S?e.jsxs(be,{onValueChange:T=>h(V=>V?{...V,source:T}:null),defaultValue:w==null?void 0:w.source,children:[e.jsx(pe,{children:e.jsx(ye,{placeholder:x.source})}),e.jsxs(ge,{children:[e.jsx(Q,{value:"Meta & Google",children:"Meta & Google"}),e.jsx(Q,{value:"Meta",children:"Meta"}),e.jsx(Q,{value:"Google",children:"Google"})]})]}):x.source}),e.jsx(ne,{children:S?e.jsx(je,{type:"number",value:w==null?void 0:w.targetAmount,onChange:T=>h(V=>V?{...V,targetAmount:Number(T.target.value)}:null)}):`₹${x.targetAmount.toLocaleString()}`}),e.jsx(ne,{children:S?e.jsxs(es,{children:[e.jsx(ss,{asChild:!0,children:e.jsx(F,{variant:"outline",children:w!=null&&w.targetDate?H(w.targetDate,"PPP"):e.jsx("span",{children:"Pick a date"})})}),e.jsx(Ke,{className:"w-auto p-0",children:e.jsx(fs,{mode:"single",selected:w==null?void 0:w.targetDate,onSelect:T=>T&&h(V=>V?{...V,targetDate:T}:null),initialFocus:!0})})]}):H(x.targetDate,"PPP")}),e.jsx(ne,{children:L?e.jsx(m,{}):`₹${c.toLocaleString()}`}),e.jsx(ne,{children:L?e.jsx(m,{}):`₹${A.toLocaleString()}`}),e.jsx(ne,{children:d}),e.jsxs(ne,{children:["₹",R.toLocaleString()]}),e.jsx(ne,{children:S?e.jsxs(e.Fragment,{children:[e.jsx(F,{onClick:()=>y(x.brandId),className:"mr-2",children:"Save"}),e.jsx(F,{onClick:n,variant:"outline",children:e.jsx(Ye,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{onClick:()=>j(x.brandId),className:"mr-2",children:e.jsx(kr,{className:"h-4 w-4"})}),e.jsx(F,{onClick:()=>i(x.brandId),variant:"destructive",children:e.jsx(Tr,{className:"h-4 w-4"})})]})})]},x.brandId)})})]})})]}),e.jsxs(ee,{children:[e.jsx(te,{children:e.jsx(le,{children:"Sales Progress"})}),e.jsx(se,{children:e.jsx(Be,{width:"100%",height:300,children:e.jsxs(ps,{data:M,children:[e.jsx(Je,{dataKey:"name"}),e.jsx(Xe,{}),e.jsx(Oe,{}),e.jsx(Qe,{dataKey:"Achieved",stackId:"a",fill:"#4ade80"}),e.jsx(Qe,{dataKey:"Remaining",stackId:"a",fill:"#f87171"})]})})})]})]})]})}const nl=()=>e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Ae,{}),e.jsx("div",{className:"flex-1 h-screen overflow-auto",children:e.jsx(rl,{})})]});function ll(){var V,Z,K,ce,ie,Me,$e;const s="https://parallels.messold.com",{brandId:t}=Ce(),[a,l]=r.useState([{id:"products",label:"Products",apiEndpoint:`${s}/api/segment/productMetrics/${t}`,columns:[],data:[],lastUpdated:null},{id:"categories",label:"Categories",apiEndpoint:`${s}/api/segment/categoryMetrics/${t}`,columns:[],data:[],lastUpdated:null},{id:"brands",label:"Brands",apiEndpoint:`${s}/api/segment/brandMetrics/${t}`,columns:[],data:[],lastUpdated:null},{id:"productTypes",label:"Product types",apiEndpoint:`${s}/api/segment/typeMetrics/${t}`,columns:[],data:[],lastUpdated:null}]),[o,p]=r.useState(a[0].id),[u,w]=r.useState(1),[h,I]=r.useState(new Set),[C,L]=r.useState(!1),[k,B]=r.useState(!1),P=100,[z,D]=r.useState({}),E=r.useRef({}),f=5*60*1e3,[v,j]=r.useState(void 0),y=v!=null&&v.from?H(v.from,"yyyy-MM-dd"):"",n=v!=null&&v.to?H(v.to,"yyyy-MM-dd"):"",i=b=>{p(b),w(1),I(new Set)},m=r.useCallback(async(b,$={},G=!1)=>{if(C)return;L(!0);const Y=a.find(ae=>ae.id===b);if(!Y){console.warn(`Tab not found for ID: ${b}`),L(!1);return}const g={...$,...y&&{startDate:y},...n&&{endDate:n}},_=`${b}-${y||"default"}-${n||"default"}`,q=E.current[_],W=Date.now();if(!G&&b==="products"&&delete E.current[_],!G&&q&&W-q.timestamp<f){l(ae=>ae.map(J=>J.id===b?{...J,data:q.data,lastUpdated:q.timestamp}:J)),L(!1);return}try{const ae=await U.post(Y.apiEndpoint,g,{withCredentials:!0});if(ae.data.success){const de=ae.data[`${b}Data`]||[];console.log("New Data for Tab:",b,de);const xe=Object.keys(de[0]||{}).map(ke=>({id:ke,header:ke.charAt(0).toUpperCase()+ke.slice(1),accessorKey:ke,cell:De=>ke==="issues"&&Array.isArray(De)?De.length>0?De[0].description:"No issues":String(De)}));console.log("Columns for Tab:",xe),l(ke=>ke.map(De=>De.id===b?{...De,columns:xe,data:de,lastUpdated:W}:De)),E.current[_]={data:de,timestamp:W}}else console.error(`Failed to fetch data for ${b}`)}catch(ae){console.error(`Error fetching data for ${b}:`,ae)}finally{L(!1)}},[a,C,E,y,n]);r.useEffect(()=>{const b={...z,...y&&{startDate:y},...n&&{endDate:n}};m(o,k?b:{},!!k)},[o,v,k,z]);const N=(b,$)=>{const G={brands:"Brand",productTypes:"Type",categories:"name",products:"status"},Y={brands:"brands",productTypes:"productType",categories:"categoryName",products:"status"},g=G[b],_=Y[b];if(g&&_){const q=$[g];if(q){const W={[_]:q};b==="categories"&&$.level&&(W.categoryLevel=$.level),D(W),B(!0),p("products")}else console.warn(`No value found for column "${g}" in row`,$)}else console.warn(`No column or body key mapping found for tab: ${b}`)},M=b=>{I($=>{const G=new Set($);return G.has(b)?G.delete(b):G.add(b),G})},x=(b,$=0,G="")=>{const Y=G?`${G}.${b.name}`:b.name,g=h.has(Y);return e.jsxs(_e.Fragment,{children:[e.jsxs("tr",{className:`${g?"bg-gray-100":"bg-white"}`,children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm flex items-center",children:e.jsxs("div",{style:{marginLeft:`${$*20}px`},onClick:()=>M(Y),className:"flex items-center cursor-pointer",children:[b.subcategories.length>0&&e.jsx("button",{className:"mr-2",children:g?e.jsx(Te,{className:"h-4 w-4"}):e.jsx(He,{className:"h-4 w-4"})}),b.name]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm cursor-pointer text-blue-500 underline",onClick:()=>N(o,b),children:b.metrics.products}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:b.metrics.totalCost}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:b.metrics.ROAS}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:b.metrics.conversions}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:b.metrics.ConversionValue}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:b.metrics.ConversionRate}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:b.metrics.totalClicks}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:b.metrics.ctr}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:b.metrics.AvgCPC})]}),g&&b.subcategories.map(_=>x(_,$+1,Y))]},Y)},c=()=>{const b=a.find(Y=>Y.id===o);if(!b||b.id==="categories")return{columns:[],data:[]};const $=(u-1)*P,G=$+P;return{columns:b.columns,data:b.data.slice($,G)}},{columns:A,data:d}=c(),R=Math.ceil((((V=a.find(b=>b.id===o))==null?void 0:V.data.length)||0)/P),S=[{id:"name",header:"Name"},{id:"products",header:"Products"},{id:"totalCost",header:"Cost"},{id:"ROAS",header:"ROAS"},{id:"conversions",header:"Conversions"},{id:"ConversionValue",header:"Conv. Value"},{id:"ConversionRate",header:"Conv. Rate"},{id:"totalClicks",header:"Clicks"},{id:"ctr",header:"CTR"},{id:"AvgCPC",header:"Avg CPC"}];function T(){return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto border-collapse",children:[e.jsx("thead",{children:e.jsx("tr",{children:["w-24","w-32","w-32","w-24","w-24","w-24"].map((b,$)=>e.jsx("th",{className:"px-4 py-2 border-b",children:e.jsx(Ee,{className:`h-4 ${b}`})},$))})}),e.jsx("tbody",{children:Array.from({length:8}).map((b,$)=>e.jsx("tr",{children:["w-24","w-32","w-32","w-24","w-24","w-24"].map((G,Y)=>e.jsx("td",{className:"px-4 py-2 border-b",children:e.jsx(Ee,{className:`h-4 ${G}`})},Y))},$))})]})})}return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-row gap-2 items-center mb-4",children:[e.jsx(Ve,{}),e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Google Ads Product Insights"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 pb-2 mb-2",children:[e.jsx("div",{className:"flex space-x-2",role:"tablist",children:a.map(b=>e.jsxs(F,{variant:o===b.id?"default":"ghost",onClick:()=>i(b.id),className:"relative",children:[b.id==="products"&&e.jsx(Yt,{className:"w-4 h-4 mr-2"}),b.id==="categories"&&e.jsx(qt,{className:"w-4 h-4 mr-2"}),b.id==="brands"&&e.jsx($r,{className:"w-4 h-4 mr-2"}),b.id==="productTypes"&&e.jsx(Fr,{className:"w-4 h-4 mr-2"}),b.label,o===b.id&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600"})]},b.id))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{date:v,setDate:j,defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}}),e.jsx(F,{variant:"outline",size:"icon",children:e.jsx(Ze,{className:`h-4 w-4 ${k?"text-blue-600":"text-gray-600"}`})}),e.jsx(It,{children:e.jsxs(Bt,{children:[e.jsx(Ot,{asChild:!0,children:e.jsx(F,{variant:"outline",size:"icon",onClick:()=>m(o,{},!1),children:e.jsx(Se,{className:`h-4 w-4 ${C?"animate-spin":""}`})})}),((Z=a.find(b=>b.id===o))==null?void 0:Z.lastUpdated)&&e.jsx(zt,{children:e.jsxs("p",{children:["Last updated: ",new Date(((K=a.find(b=>b.id===o))==null?void 0:K.lastUpdated)||0).toLocaleString()]})})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[k&&e.jsxs("div",{className:"flex items-center gap-2 w-fit p-2 bg-blue-50 rounded-full",children:[e.jsx("span",{className:"text-xs font-medium text-blue-700",children:Object.entries(z).map(([b,$])=>`${b}: ${$}`).join(", ")}),e.jsx(F,{variant:"ghost",size:"sm",onClick:()=>{B(!1),D({}),p("products"),E.current.products=null,m("products",{},!1)},className:"text-blue-700 hover:text-blue-800 hover:bg-blue-100 p-1 h-auto",children:e.jsx(Ye,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"rounded-md border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"max-h-[350px] overflow-auto",children:C?e.jsx(T,{}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"sticky top-0 z-10 bg-[#4A628A]",children:e.jsx("tr",{children:(o==="categories"?S:A).map(b=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-50 uppercase tracking-wider min-w-[150px]",children:e.jsxs("div",{className:"flex items-center gap-1",children:[b.header,e.jsx(Te,{className:"h-4 w-4"})]})},b.id))})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[o==="categories"?(ce=a.find(b=>b.id==="categories"))==null?void 0:ce.data.map(b=>x(b)):d.map((b,$)=>e.jsx("tr",{className:"hover:bg-gray-50",children:A.map(G=>{const Y=G.cell(b[G.accessorKey]),g=G.id==="issues",_=G.id==="Products",q=G.id==="status",W=typeof Y=="string"&&Y.trim().toLowerCase()==="no issues",ae=de=>{switch(de.trim().toUpperCase()){case"UNSPECIFIED":return"bg-gray-100 text-gray-800";case"UNKNOWN":return"bg-yellow-100 text-yellow-800";case"NOT_ELIGIBLE":return"bg-red-100 text-red-800";case"ELIGIBLE_LIMITED":return"bg-orange-100 text-orange-800";case"ELIGIBLE":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-700"}},J=()=>{if(g)return e.jsxs("div",{className:`flex items-center ${W?"text-green-600":"text-red-600"}`,children:[W?e.jsx(Pr,{className:"w-4 h-4 mr-2"}):e.jsx(Er,{className:"w-4 h-4 mr-2"}),Y]});if(q){const de=Y?String(Y):"",xe=ae(de);return e.jsx("div",{className:`px-2 py-1.5 rounded-full text-xs font-medium w-full ${xe} cursor-pointer`,onClick:()=>N(o,b),children:de})}return G.cell?G.cell(Y):Y};return e.jsx("td",{className:`px-4 py-2.5 text-sm whitespace-nowrap min-w-[150px] ${_?"cursor-pointer text-blue-600 hover:text-blue-800":""}`,onClick:()=>_&&N(o,b),children:J()},G.id)})},$)),(o==="categories"?((ie=a.find(b=>b.id==="categories"))==null?void 0:ie.data.length)===0:d.length===0)&&e.jsx("tr",{children:e.jsx("td",{colSpan:(o==="categories"?S:A).length,className:"px-4 py-2 text-sm text-gray-500 text-center",children:"No data available"})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gray-50 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",(u-1)*P+1," to ",Math.min(u*P,((Me=a.find(b=>b.id===o))==null?void 0:Me.data.length)||0)," of ",(($e=a.find(b=>b.id===o))==null?void 0:$e.data.length)||0," entries"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>w(b=>Math.max(b-1,1)),disabled:u===1,children:[e.jsx(bs,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Page ",u," of ",R]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>w(b=>Math.min(b+1,R)),disabled:u===R,children:["Next",e.jsx(He,{className:"h-4 w-4 ml-1"})]})]})]})]})]})]})]})}function ol(){var b;const s="https://parallels.messold.com",{brandId:t}=Ce(),[a,l]=r.useState([]),[o,p]=r.useState(!0),[u,w]=r.useState(1),[h,I]=r.useState(!0),[C,L]=r.useState(0),[k,B]=r.useState(0),[P,z]=r.useState([]),[D,E]=r.useState("all"),[f,v]=r.useState([]),[j,y]=r.useState("all"),[n,i]=r.useState("all"),[m,N]=r.useState(void 0),M=m!=null&&m.from?H(m.from,"yyyy-MM-dd"):"",x=m!=null&&m.to?H(m.to,"yyyy-MM-dd"):"",c=100,A=[{id:"searchTerm",header:"Search Term",icon:e.jsx(Kt,{className:"w-4 h-4"})},{id:"matchType",header:"Match Type",icon:e.jsx(Ir,{className:"w-4 h-4"})},{id:"status",header:"Status",icon:e.jsx(Ze,{className:"w-4 h-4"})},{id:"campaignName",header:"Campaign Name",icon:e.jsx(Br,{className:"w-4 h-4"})},{id:"adGroupName",header:"Ad Group",icon:e.jsx(Or,{className:"w-4 h-4"})},{id:"cost",header:"Cost",icon:e.jsx(Hs,{className:"w-4 h-4"})},{id:"conversions",header:"Conversions",icon:e.jsx(Ht,{className:"w-4 h-4"})},{id:"conversionsValue",header:"Conv. Value",icon:e.jsx(ts,{className:"w-4 h-4"})},{id:"conversionsRate",header:"Conv. Rate",icon:e.jsx(us,{className:"w-4 h-4"})},{id:"clicks",header:"Clicks",icon:e.jsx(zr,{className:"w-4 h-4"})},{id:"ctr",header:"CTR",icon:e.jsx(us,{className:"w-4 h-4"})},{id:"avg_cpc",header:"Avg. CPC",icon:e.jsx(Vr,{className:"w-4 h-4"})}],[d,R]=r.useState(null),[S,T]=r.useState("asc"),V=$=>{d===$?T(G=>G==="asc"?"desc":"asc"):(R($),T("asc"))},Z=r.useMemo(()=>d?[...a].sort(($,G)=>{const Y=$[d],g=G[d];if(typeof Y=="number"&&typeof g=="number")return S==="asc"?Y-g:g-Y;const _=String(Y).toLowerCase(),q=String(g).toLowerCase();return _<q?S==="asc"?-1:1:_>q?S==="asc"?1:-1:0}):a,[a,d,S]),K=r.useCallback(async()=>{p(!0);try{const $={limit:c,page:u,startDate:M,endDate:x,...D&&D!=="all"&&{campaign:D},...j&&j!=="all"&&{adGroup:j},...n&&n!=="all"&&{status:n}},{data:G}=await U.post(`${s}/api/segment/searchTermMetrics/${t}`,$,{withCredentials:!0});G.success?(l(G.data),L(G.totalRecords),B(G.totalPages),I(u*c<G.totalRecords),z(G.campaignAdGroupPairs),v(G.statusOptions)):console.error("Failed to fetch search term metrics:",G.message)}catch($){console.error("Error fetching search term metrics:",$)}finally{p(!1)}},[s,t,u,c,D,j,n,M,x]);r.useEffect(()=>{K();const $=setInterval(K,3e5);return()=>clearInterval($)},[K]);const ce=$=>{E($),y("all"),w(1)},ie=$=>{y($),w(1)},Me=$=>{i($),w(1)},$e=D!=="all"?((b=P==null?void 0:P.find($=>$.campaignName===D))==null?void 0:b.adGroups)||[]:[];return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-row gap-2 items-center mb-4",children:[e.jsx(Ve,{}),e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Google Ads Search Term Insights"})]}),e.jsx("div",{className:"bg-white rounded-xl overflow-hidden border border-gray-200 shadow-md",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsxs(es,{children:[e.jsx(ss,{asChild:!0,children:e.jsxs(F,{variant:"outline",className:"bg-white border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"Filter"]})}),e.jsx(Ke,{className:"w-80",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Status"}),e.jsxs(be,{onValueChange:Me,value:n,children:[e.jsx(pe,{className:"w-full",children:e.jsx(ye,{placeholder:"Select Status"})}),e.jsxs(ge,{children:[e.jsx(Q,{value:"all",children:"All Status"}),f.map($=>e.jsx(Q,{value:$,children:$},$))]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Campaign"}),e.jsxs(be,{onValueChange:ce,value:D,children:[e.jsx(pe,{className:"w-full",children:e.jsx(ye,{placeholder:"Select Campaign"})}),e.jsxs(ge,{children:[e.jsx(Q,{value:"all",children:"All Campaigns"}),P.map($=>e.jsx(Q,{value:$.campaignName,children:$.campaignName},$.campaignName))]})]})]}),D!=="all"&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Ad Group"}),e.jsxs(be,{disabled:D==="all",onValueChange:ie,value:j,children:[e.jsx(pe,{className:"w-full",children:e.jsx(ye,{placeholder:"Select Ad Group"})}),e.jsxs(ge,{children:[e.jsx(Q,{value:"all",children:"All Ad Groups"}),$e.map($=>e.jsx(Q,{value:$,children:$},$))]})]})]})]})})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Re,{date:m,setDate:N,defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}}),e.jsxs(F,{variant:"outline",className:"bg-gray-50 text-gray-600 border-gray-200 hover:bg-gray-100",onClick:K,children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Refresh"]})]})]}),e.jsxs("div",{className:"rounded-md border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"max-h-[380px] overflow-auto rounded-lg",children:o?e.jsx(qe,{}):e.jsxs("table",{className:"w-full text-center",children:[e.jsx("thead",{className:"sticky top-0 z-10 bg-[#4A628A] rounded-t-lg",children:e.jsx("tr",{children:A.map($=>e.jsx("th",{className:"px-4 py-3 text-xs font-medium text-gray-50 uppercase tracking-wider min-w-[200px] cursor-pointer",onClick:()=>V($.id),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[$.icon,$.header,d===$.id?S==="asc"?e.jsx(ys,{className:"ml-1 w-4 h-6 text-[#ffffff]"}):e.jsx(ws,{className:"ml-1 w-4 h-6 text-[#ffffff]"}):e.jsx(Zs,{className:"ml-1 w-4 h-6 text-gray-300"})]})},$.id))})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[Z.map(($,G)=>e.jsx("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:A.map(Y=>{const g=$[Y.id],_=Y.id==="status",q=Y.id==="searchTerm",W=()=>{if(_){const ae=g?String(g):"",de=(xe=>{switch(xe.trim().toUpperCase()){case"ADDED":return"bg-green-100 text-green-800";case"NONE":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}})(ae);return e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${de}`,children:ae})}if(q){const ae=g?String(g):"",J=$.performance,de=J==="Best Performing Keyword";return e.jsxs("div",{className:"px-2 py-1 rounded-full font-medium flex flex-col items-center",children:[e.jsx("span",{className:`text-xs ${de?"text-green-600":"text-red-600"}`,children:J}),e.jsx("span",{className:"text-sm mt-1",children:ae})]})}return g};return e.jsx("td",{className:"px-4 py-2.5 text-sm min-w-[200px]",children:W()},Y.id)})},G)),a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:A.length,className:"px-4 py-2 text-sm text-gray-500 text-center",children:"No data available"})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",(u-1)*c+1," to"," ",Math.min(u*c,C||0)," of"," ",C||0," entries"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>w($=>Math.max($-1,1)),disabled:u===1,className:"text-gray-600 border-gray-200 hover:bg-gray-50",children:[e.jsx(bs,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",u," of ",k]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>w($=>$+1),disabled:!h,className:"text-gray-600 border-gray-200 hover:bg-gray-50",children:["Next",e.jsx(He,{className:"h-4 w-4 ml-1"})]})]})]})]})]})})]})}const ds={totalConversions:"Total Conversions",totalClicks:"Total Clicks",totalCost:"Total Cost",totalCTR:"Total C T R"},Fe=100;function il(){const s="https://parallels.messold.com",{brandId:t}=Ce();if(!t)return e.jsx("div",{children:"Error: Brand ID is missing"});const[a,l]=r.useState({campaign:"all",ageRange:"all",gender:"all"}),[o,p]=r.useState({campaigns:[],ageRanges:[],genders:[]}),[u,w]=r.useState([]),[h,I]=r.useState([{id:"age",label:"Age",apiEndpoint:`${s}/api/segment/ageMetrics/${t}`,columns:[],data:[],lastUpdated:null,totalPages:1,currentPage:1},{id:"gender",label:"Gender",apiEndpoint:`${s}/api/segment/genderMetrics/${t}`,columns:[],data:[],lastUpdated:null,totalPages:1,currentPage:1}]),[C,L]=r.useState(1),[k,B]=r.useState(0),[P,z]=r.useState(!0),[D,E]=r.useState(h[0].id),[f,v]=r.useState(1),[j,y]=r.useState(!1),[n,i]=r.useState(!1),[m,N]=r.useState(null),[M,x]=r.useState(["totalClicks","totalCost"]),[c,A]=r.useState({from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}),d=g=>{x(_=>_.includes(g)?_.filter(q=>q!==g):[..._,g])},R=async(g,_,q)=>{try{y(!0);const W=g==="gender"?`${s}/api/segment/genderMetrics/${t}`:`${s}/api/segment/ageMetrics/${t}`,ae=_||{startDate:c!=null&&c.from?H(c.from,"yyyy-MM-dd"):"",endDate:c!=null&&c.to?H(c.to,"yyyy-MM-dd"):"",page:f,limit:Fe},J=await U.post(W,{...ae,...a.campaign!=="all"&&{campaign:a.campaign},...g==="age"&&a.ageRange!=="all"&&{agerange:a.ageRange},...g==="gender"&&a.gender!=="all"&&{gender:a.gender}},{withCredentials:!0});if(J.data.success){const de=J.data.campaignAdGroupPairs?Array.from(new Set(J.data.campaignAdGroupPairs.map(re=>re.campaignName))):[],xe=g==="gender"?J.data.genderData||[]:J.data.ageData||[];if(g==="age"){const re=new Set(xe.map(X=>X.ageRange));p(X=>({...X,campaigns:de,ageRanges:Array.from(re)}))}else{const re=new Set(xe.map(X=>X.gender==="MALE"?"MALE":X.gender==="FEMALE"?"FEMALE":X.gender));p(X=>({...X,genders:Array.from(re)}))}w(xe);const ke=xe.length>0?Object.keys(xe[0]||{}).filter(re=>re!=="adGroupStatus").map(re=>({id:re,header:re.replace(/([A-Z])/g," $1").replace(/^./,X=>X.toUpperCase()),accessorKey:re,cell:X=>re==="cost"?`$${Number(X).toFixed(2)}`:["roas","conversionsRate","ctr"].includes(re)?`${(Number(X)*100).toFixed(2)}%`:String(X)})):[];I(re=>re.map(X=>X.id===g?{...X,columns:ke,data:xe,lastUpdated:Date.now()}:X));const De=g==="gender"?J.data.aggregatedRecords:J.data.ageRangeAggregatedMetrics,ga=Object.entries(De||{}).map(([re,X])=>{const fa=g==="gender"?re==="MALE"?"Male":re==="FEMALE"?"Female":re:re,Ys={[g==="gender"?"gender":"ageRange"]:fa};if(X&&typeof X=="object"&&!Array.isArray(X)){const ns=X;return{...Ys,totalConversions:ns.totalConversions||0,totalClicks:ns.totalClicks||0,totalCost:ns.totalCost||0,totalCTR:ns.totalCTR||0}}return Ys});N(ga),B(J.data.totalRecords||0),L(J.data.totalPages||1),z(f*Fe<J.data.totalRecords)}}catch(W){console.error("Error fetching data:",W),N(null)}finally{y(!1)}},[,S]=r.useState(0),T=(g,_)=>{l(W=>({...W,[g]:_})),v(1);const q={startDate:c!=null&&c.from?H(c.from,"yyyy-MM-dd"):"",endDate:c!=null&&c.to?H(c.to,"yyyy-MM-dd"):"",page:1,limit:Fe};R(D,q),S(W=>W+1)};r.useEffect(()=>{const g={startDate:c!=null&&c.from?H(c.from,"yyyy-MM-dd"):"",endDate:c!=null&&c.to?H(c.to,"yyyy-MM-dd"):"",page:f,limit:Fe};R(D,g);const _=setInterval(()=>{R(D,g)},3e5);return()=>clearInterval(_)},[D,c,f,a.campaign,a.ageRange,a.gender]);const V=g=>{E(g),v(1);const _={startDate:c!=null&&c.from?H(c.from,"yyyy-MM-dd"):"",endDate:c!=null&&c.to?H(c.to,"yyyy-MM-dd"):"",page:1,limit:Fe};R(g,_)},Z=["campaignName","adGroupName","campaignStatus","ageRange","conversionsValue","conversionsRate","avg_cpc","cost","roas","conversions","clicks","ctr"],[K,ce]=r.useState(null),[ie,Me]=r.useState("asc"),$e=g=>{K===g?Me(_=>_==="asc"?"desc":"asc"):(ce(g),Me("asc"))},{columns:b}=(()=>{const g=h.find(_=>_.id===D);return g?{columns:g.columns}:{columns:[]}})(),$=r.useMemo(()=>K?[...u].sort((g,_)=>{const q=g[K],W=_[K];if(typeof q=="number"&&typeof W=="number")return ie==="asc"?q-W:W-q;const ae=String(q||"").toLowerCase(),J=String(W||"").toLowerCase();return ae<J?ie==="asc"?-1:1:ae>J?ie==="asc"?1:-1:0}):u,[u,K,ie]),G=g=>{const _=Math.min(Math.max(1,g),C);v(_);const q={startDate:c!=null&&c.from?H(c.from,"yyyy-MM-dd"):"",endDate:c!=null&&c.to?H(c.to,"yyyy-MM-dd"):"",page:_,limit:Fe};R(D,q)},Y=["#8884d8","#82ca9d","#ffc658","#ff7300"];return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-row gap-2 items-center mb-4",children:[e.jsx(Ve,{}),e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Age and Gender Metrics"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 pb-2 mb-2",children:[e.jsx("div",{className:"flex space-x-2",role:"tablist",children:h.map(g=>e.jsxs(F,{variant:D===g.id?"default":"ghost",onClick:()=>V(g.id),className:"relative",children:[g.id==="age"?e.jsx(Yt,{className:"w-4 h-4 mr-2"}):e.jsx(qt,{className:"w-4 h-4 mr-2"}),g.label,D===g.id&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600"})]},g.id))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{date:c,setDate:A,defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}}),n&&e.jsx("div",{className:"flex gap-2",children:Object.keys(ds).map(g=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:M.includes(g),onChange:()=>d(g)}),e.jsx("span",{className:"text-sm text-gray-700",children:ds[g]})]},g))}),e.jsx(F,{variant:"outline",size:"icon",onClick:()=>{const g={startDate:c!=null&&c.from?H(c.from,"yyyy-MM-dd"):"",endDate:c!=null&&c.to?H(c.to,"yyyy-MM-dd"):"",page:1,limit:1e3};R(D,g)},disabled:j,children:e.jsx(Se,{className:`h-4 w-4 ${j?"animate-spin":""}`})}),e.jsx(F,{variant:"outline",onClick:()=>i(!n),children:n?"Show Table":"Show Graph"}),e.jsxs(es,{children:[e.jsx(ss,{asChild:!0,children:e.jsxs(F,{variant:"outline",className:"bg-white border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"Filter"]})}),e.jsx(Ke,{className:"w-80",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Campaign"}),e.jsxs(be,{onValueChange:g=>T("campaign",g),value:a.campaign,children:[e.jsx(pe,{children:e.jsx(ye,{placeholder:"Select campaign"})}),e.jsxs(ge,{children:[e.jsx(Q,{value:"all",children:"All"}),o.campaigns.map(g=>e.jsx(Q,{value:g,children:g},g))]})]})]}),D==="age"&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Age Range"}),e.jsxs(be,{onValueChange:g=>T("ageRange",g),value:a.ageRange,children:[e.jsx(pe,{children:e.jsx(ye,{placeholder:"Select age range"})}),e.jsxs(ge,{children:[e.jsx(Q,{value:"all",children:"All"}),o.ageRanges.map(g=>e.jsx(Q,{value:g,children:g.replace("AGE_RANGE_","").replace(/_/g,"-")},g))]})]})]}),D==="gender"&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Gender"}),e.jsxs(be,{onValueChange:g=>T("gender",g),value:a.gender,children:[e.jsx(pe,{children:e.jsx(ye,{placeholder:"Select gender"})}),e.jsxs(ge,{children:[e.jsx(Q,{value:"all",children:"All"}),o.genders.map(g=>e.jsx(Q,{value:g,children:g==="MALE"?"Male":g==="FEMALE"?"Female":g},g))]})]})]})]})})]})]})]}),e.jsx("div",{className:"space-y-4",children:j?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-blue-500"})}):n?D==="age"&&m?e.jsx(Be,{width:"100%",height:300,children:e.jsxs(ps,{data:m,children:[e.jsx(Os,{strokeDasharray:"3 3"}),e.jsx(Je,{dataKey:"ageRange"}),e.jsx(Xe,{}),e.jsx(Oe,{}),e.jsx(gs,{}),M.map((g,_)=>e.jsx(Qe,{dataKey:g,fill:Y[_%Y.length],name:ds[g]},g))]})}):D==="gender"&&m?e.jsx(Be,{width:"100%",height:300,children:e.jsxs(ps,{data:m,children:[e.jsx(Os,{strokeDasharray:"3 3"}),e.jsx(Je,{dataKey:"gender"}),e.jsx(Xe,{}),e.jsx(Oe,{}),e.jsx(gs,{}),M.map((g,_)=>e.jsx(Qe,{dataKey:g,fill:Y[_%Y.length],name:ds[g]},g))]})}):null:e.jsxs("div",{className:"rounded-md border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"max-h-[350px] overflow-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"sticky top-0 z-10 bg-[#4A628A]",children:e.jsx("tr",{children:b.map(g=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-50 uppercase tracking-wider min-w-[150px] cursor-pointer",onClick:()=>Z.includes(g.id)&&$e(g.id),children:e.jsxs("div",{className:"flex items-center gap-1",children:[g.header,Z.includes(g.id)&&(K===g.id?ie==="asc"?e.jsx(ys,{className:"ml-1 w-4 h-6 text-[#ffffff]"}):e.jsx(ws,{className:"ml-1 w-4 h-6 text-[#ffffff]"}):e.jsx(Zs,{className:"ml-1 w-4 h-6 text-gray-300"}))]})},g.id))})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[$.map((g,_)=>e.jsx("tr",{className:"hover:bg-gray-50",children:b.map(q=>e.jsx("td",{className:"px-4 py-2.5 text-sm whitespace-nowrap min-w-[150px]",children:q.cell(g[q.accessorKey])},q.id))},_)),$.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:b.length,className:"px-4 py-4 text-center text-gray-500",children:"No data available"})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-white border-t border-gray-200",children:[e.jsx("div",{className:"text-sm text-gray-700",children:$.length>0?`Showing ${(f-1)*Fe+1} to ${Math.min(f*Fe,k)} of ${k} entries`:"Showing 0 entries"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>G(f-1),disabled:f===1,children:[e.jsx(bs,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Page ",f," of ",C]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>G(f+1),disabled:!P,children:["Next",e.jsx(He,{className:"h-4 w-4 ml-1"})]})]})]})]})})]})]})}function cl(){const{brandId:s}=Ce();return s?e.jsxs("div",{className:"bg-gray-100 min-h-screen overflow-hidden",children:[e.jsx("nav",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 px-4 py-4 md:px-6 lg:px-8",children:e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Segment Dashboard"})})}),e.jsxs("div",{className:"flex flex-col p-6 gap-6 overflow-auto",children:[e.jsx(ll,{}),e.jsx(ol,{}),e.jsx(il,{})]})]}):(console.error("Brand ID is not defined"),e.jsx("div",{children:"Error: Brand ID is missing"}))}const dl=()=>e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Ae,{}),e.jsx("div",{className:"flex-1 h-screen overflow-auto",children:e.jsx(cl,{})})]}),ml=()=>{const s=Ne(),{setUser:t}=Ge(),{toast:a}=Ns(),l="https://parallels.messold.com";return r.useEffect(()=>{(async()=>{try{const p=new URLSearchParams(window.location.search),u=p.get("token"),w=p.get("fbToken"),h=p.get("googleRefreshToken"),I=async(C,L,k)=>(await U.get(`${l}${C}?${k}=${L}`,{withCredentials:!0})).data.success?(console.log(`${k} token updated successfully, redirecting to /dashboard`),s("/dashboard"),!0):(console.error(`Failed to update ${k} token`),a({title:"Update Failed",description:`Unable to update ${k} token.`,variant:"destructive"}),s("/"),!1);if(u){console.log("Token found, proceeding with login");const C=await U.post(`${l}/api/auth/login/oauth?auth_token=${u}`,{email:null,password:null});if(C.data.success){console.log("Login successful, redirecting to /dashboard"),t(C.data.user),s("/dashboard");return}else{console.log("Login failed, redirecting to /"),a({title:"Login Failed",description:"Unable to authenticate with Google.",variant:"destructive"}),s("/");return}}if(w){await I("/api/auth/updateTokens/facebook",w,"fbToken");return}if(h){await I("/api/auth/updateTokens/google",h,"googleRefreshToken");return}console.log("No token present, redirecting to /"),s("/")}catch(p){console.error("Error during OAuth callback:",p),a({title:"Error",description:"An error occurred while handling the login callback.",variant:"destructive"}),s("/")}})()},[s,t,a,l]),null};function xl(){return e.jsx(Kr,{children:e.jsx(nn,{children:e.jsxs(ya,{children:[e.jsx(rn,{}),e.jsxs(rr,{children:[e.jsx(he,{path:"/",element:e.jsx(en,{})}),e.jsx(he,{path:"/dashboard",element:e.jsx(Kn,{})}),e.jsx(he,{path:"/business-dashboard/:brandId",element:e.jsx(vn,{})}),e.jsx(he,{path:"/analytics-dashboard/:brandId",element:e.jsx(Tn,{})}),e.jsx(he,{path:"/ecommerce-metrics/:brandId",element:e.jsx(Qn,{})}),e.jsx(he,{path:"/ad-metrics/:brandId",element:e.jsx(el,{})}),e.jsx(he,{path:"/city-metrics/:brandId",element:e.jsx(sl,{})}),e.jsx(he,{path:"/channel-metrics/:brandId",element:e.jsx(tl,{})}),e.jsx(he,{path:"/page-metrics/:brandId",element:e.jsx(al,{})}),e.jsx(he,{path:"/campaign-metrics/:brandId",element:e.jsx(zn,{})}),e.jsx(he,{path:"/performance-metrics",element:e.jsx(nl,{})}),e.jsx(he,{path:"/segment-dashboard/:brandId",element:e.jsx(dl,{})}),e.jsx(he,{path:"/callback",element:e.jsx(ml,{})})]})]})})})}ja(document.getElementById("root")).render(e.jsx(r.StrictMode,{children:e.jsx(xl,{})}));
//# sourceMappingURL=index-BrITj8Pg.js.map
