import{r as t,j as e,R as ls}from"./react-CkuKL7a9.js";import{c as sn}from"./react-dom-CtYNSMMY.js";import{N as tn,L as bt,B as an}from"./react-router-dom-CMpnQT-m.js";import{a as le}from"./axios-CCb-kr4I.js";import{c as nn}from"./clsx-B-dksMZM.js";import{t as rn}from"./tailwind-merge-Dnoi3Axr.js";import{S as on,R as Et,V as Ot,a as Rt,A as Dt,C as zt,b as Gt,T as _t,D as Bt,P as ln,c as cn,d as Vt,e as dn,f as mn,g as un,h as Ut,i as hn,j as xn,k as Ht,l as fn,m as gn,n as Kt,o as jn,p as Wt,q as pn,r as vn,O as Yt,s as Zt,t as yn,u as Jt,v as Xt,w as bn,x as wn,y as Nn,z as Qt,B as qt,E as ea,F as sa,G as ta,I as Cn,H as aa,J as na,K as Sn,L as ra,M as An,N as oa,Q as Mn,U as la,W as ia,X as In,Y as nt,Z as Tn,_ as ca,$ as kn,a0 as Fn,a1 as da,a2 as $n,a3 as ma,a4 as ua,a5 as Pn,a6 as ha,a7 as xa,a8 as fa,a9 as ga,aa as ja,ab as Ln,ac as pa,ad as va,ae as En,af as On}from"./@radix-ui-D5pwljQB.js";import{c as rt}from"./class-variance-authority-Bb4qSo10.js";import{F as Rn,a as ya,S as Dn}from"./react-icons-BdII6c3f.js";import{u as G,a as fe,s as me,P as zn}from"./react-redux-BFum93nM.js";import{c as _s,a as Gn}from"./@reduxjs-CoJy1jWf.js";import{a as js,b as _n,e as re,f as Bn,g as Ke}from"./react-router-Ce0QG7_t.js";import{U as Vn,M as ba,L as Un,E as Hn,a as Kn,C as ms,b as Ye,S as Wn,c as wt,d as qe,e as Ns,f as Yn,g as wa,h as Na,R as ot,i as Zn,j as Jn,k as Xn,l as Qn,m as ce,n as qn,P as er,B as sr,o as lt,p as fs,q as tr,A as it,r as ar,T as Ca,s as Cs,t as nr,u as Nt,v as rr,Z as Sa,w as or,X as ns,x as lr,y as ir,z as Aa,D as Ma,F as cr,G as dr,H as gs,I as As,J as Ms,K as Bs,N as mr,O as Ia,Q as ur,V as hr,W as xr,Y as Ct,_ as fr,$ as gr,a0 as jr,a1 as pr,a2 as Ta,a3 as ka,a4 as ps,a5 as ge,a6 as je,a7 as vr,a8 as Ws,a9 as yr,aa as br,ab as wr,ac as Nr}from"./lucide-react-CgNnsPZm.js";import{c as Cr}from"./reselect-NCCDNIWx.js";import{D as Sr}from"./react-day-picker-C1zOCPfF.js";import{s as os,a as Ar,C as U,F as St,G as Mr,e as At}from"./date-fns-Bj6RO4k6.js";import{R as Xs,B as Qs,X as qs,Y as et,T as st,a as zs,C as Mt,L as It}from"./recharts-D84Y9XII.js";import{x as is}from"./xlsx-js-style-D9kuvFD2.js";import{p as Ir,a as Tr,d as kr,P as Fr}from"./redux-persist-CMICPraH.js";import{c as $r}from"./redux-DITMfSWq.js";import"./eventemitter3-CJ9KO17d.js";import"./scheduler-CzFDRTuY.js";import"./@remix-run-BSEpXHBb.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-C5ifrSBn.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-CPmXGeA2.js";import"./react-style-singleton-DfON9R_v.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-DyqfL0R5.js";import"./use-callback-ref-wNvar0eO.js";import"./@floating-ui-C6Fk-jMm.js";import"./use-sync-external-store-xms5UOqV.js";import"./immer-DqxjFn0G.js";import"./redux-thunk-ClJT1hhx.js";import"./lodash-D-MFwOE9.js";import"./react-is-DcfIKM1A.js";import"./react-smooth-z42qxpQa.js";import"./prop-types-DNLruqPx.js";import"./fast-equals-C7I1S-bJ.js";import"./tiny-invariant-BaFNuDhB.js";import"./d3-shape-DjFPhhqo.js";import"./d3-path-CimkQT29.js";import"./victory-vendor-6_AdwBXU.js";import"./d3-scale-BYIooUZQ.js";import"./internmap-BkD7Hj8s.js";import"./d3-array-g_qRI3rN.js";import"./d3-time-format-BKO53YJi.js";import"./d3-time-QpEiTrED.js";import"./d3-interpolate-CvRPKVI0.js";import"./d3-color-9lF95FHy.js";import"./d3-format-CzD4bSOQ.js";import"./recharts-scale-DiOBu8nk.js";import"./decimal.js-light-B5-9uEc-.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const j of o.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&n(j)}).observe(document,{childList:!0,subtree:!0});function a(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerPolicy&&(o.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?o.credentials="include":l.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(l){if(l.ep)return;l.ep=!0;const o=a(l);fetch(l.href,o)}})();const Fa=t.createContext(void 0),Pr=({children:s})=>{const[r,a]=t.useState(()=>{const j=localStorage.getItem("user");return j?JSON.parse(j):null}),[n,l]=t.useState(()=>r?!r.hasSeenLandingSlides&&(!r.brands||r.brands.length===0):!1);t.useEffect(()=>{r?localStorage.setItem("user",JSON.stringify(r)):localStorage.removeItem("user")},[r]),t.useEffect(()=>{r&&!r.hasSeenLandingSlides&&(!r.brands||r.brands.length===0)&&l(!0)},[r]);const o=j=>{j&&!j.hasSeenLandingSlides&&(!j.brands||j.brands.length===0)&&l(!0),a(j)};return e.jsx(Fa.Provider,{value:{user:r,setUser:o,showLandingPopup:n,setShowLandingPopup:l},children:s})},Je=()=>{const s=t.useContext(Fa);if(s===void 0)throw new Error("useUser must be used within a UserProvider");return s};function q(...s){return rn(nn(s))}const Be=t.forwardRef(({className:s,type:r,...a},n)=>e.jsx("input",{type:r,className:q("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:n,...a}));Be.displayName="Input";const tt=rt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),D=t.forwardRef(({className:s,variant:r,size:a,asChild:n=!1,...l},o)=>{const j=n?on:"button";return e.jsx(j,{className:q(tt({variant:r,size:a,className:s})),ref:o,...l})});D.displayName="Button";const Lr=rt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ss=t.forwardRef(({className:s,...r},a)=>e.jsx(Et,{ref:a,className:q(Lr(),s),...r}));ss.displayName=Et.displayName;const Er=1,Or=1e6;let Ys=0;function Rr(){return Ys=(Ys+1)%Number.MAX_SAFE_INTEGER,Ys.toString()}const Zs=new Map,Tt=s=>{if(Zs.has(s))return;const r=setTimeout(()=>{Zs.delete(s),Ss({type:"REMOVE_TOAST",toastId:s})},Or);Zs.set(s,r)},Dr=(s,r)=>{switch(r.type){case"ADD_TOAST":return{...s,toasts:[r.toast,...s.toasts].slice(0,Er)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(a=>a.id===r.toast.id?{...a,...r.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=r;return a?Tt(a):s.toasts.forEach(n=>{Tt(n.id)}),{...s,toasts:s.toasts.map(n=>n.id===a||a===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return r.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(a=>a.id!==r.toastId)}}},Rs=[];let Ds={toasts:[]};function Ss(s){Ds=Dr(Ds,s),Rs.forEach(r=>{r(Ds)})}function zr({...s}){const r=Rr(),a=l=>Ss({type:"UPDATE_TOAST",toast:{...l,id:r}}),n=()=>Ss({type:"DISMISS_TOAST",toastId:r});return Ss({type:"ADD_TOAST",toast:{...s,id:r,open:!0,onOpenChange:l=>{l||n()}}}),{id:r,dismiss:n,update:a}}function Vs(){const[s,r]=t.useState(Ds);return t.useEffect(()=>(Rs.push(r),()=>{const a=Rs.indexOf(r);a>-1&&Rs.splice(a,1)}),[s]),{...s,toast:zr,dismiss:a=>Ss({type:"DISMISS_TOAST",toastId:a})}}const Gr={user:null,showLandingPopup:!1},$a=_s({name:"user",initialState:Gr,reducers:{setUser:(s,r)=>{s.user=r.payload,s.showLandingPopup=!!r.payload&&!r.payload.hasSeenLandingSlides&&(!r.payload.brands||r.payload.brands.length===0)},setShowLandingPopup:(s,r)=>{s.showLandingPopup=r.payload},clearUser:s=>{s.user=null,s.showLandingPopup=!1}}}),{setUser:at,setShowLandingPopup:Bi,clearUser:_r}=$a.actions,Br=$a.reducer;function Vr(){const[s,r]=t.useState(!0),[a,n]=t.useState(""),[l,o]=t.useState(""),[j,u]=t.useState(""),[d,m]=t.useState(!1),{toast:M}=Vs(),v=js(),[x,T]=t.useState({username:"",email:"",password:""}),N=G(p=>p.user.user),g=fe();t.useEffect(()=>{N&&v("/dashboard")},[N,v]);const f=()=>r(!s),w=()=>{const p={username:"",email:"",password:""};let F=!0;return!s&&!a.trim()&&(p.username="Username is required",F=!1),l.trim()?/\S+@\S+\.\S+/.test(l)||(p.email="Email is invalid",F=!1):(p.email="Email is required",F=!1),j?j.length<8&&(p.password="Password must be at least 8 characters",F=!1):(p.password="Password is required",F=!1),T(p),F},A=async p=>{if(p.preventDefault(),!!w())try{let F;const S="https://parallels.messold.com";if(s){if(F=await le.post(`${S}/api/auth/login/normal`,{email:l,password:j},{withCredentials:!0}),F.data.success){const c={...F.data.user,hasSeenLandingSlides:F.data.user.brands&&F.data.user.brands.length>0};g(at(c)),M({title:"Login successful!",description:"Welcome! Redirecting to your dashboard.",variant:"default"}),v("/dashboard")}}else F=await le.post(`${S}/api/auth/signup`,{username:a,email:l,password:j},{withCredentials:!0}),F.data.success&&(M({title:"Registration successful!",description:"Please log in with your new account.",variant:"default"}),r(!0))}catch(F){le.isAxiosError(F)&&F.response?M({title:"Error",description:F.response.data.message||"An error occurred",variant:"destructive"}):M({title:"Unexpected Error",description:"An unexpected error occurred",variant:"destructive"})}},C=async()=>{try{const F=await le.get("https://parallels.messold.com/api/auth/google?context=userLogin"),{authUrl:S}=F.data;window.location.href=S}catch(p){console.error("Error getting Google Auth URL:",p)}};return e.jsxs("div",{className:"flex h-screen",children:[e.jsx("div",{className:"hidden md:flex md:w-1/2 bg-cover bg-center",style:{backgroundImage:"url('https://images.unsplash.com/photo-1460925895917-afdab827c52f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2015&q=80')"},children:e.jsx("div",{className:"flex items-center justify-center w-full h-full bg-black bg-opacity-40",children:e.jsxs("div",{className:"text-white text-center p-8",children:[e.jsx("h3",{className:"text-4xl font-bold mb-6",children:"Unified Marketing Analytics"}),e.jsx("p",{className:"text-xl",children:"View your Shopify, Facebook, and Google Ads data all in one place."})]})})}),e.jsx("div",{className:"w-full md:w-1/2 flex items-center justify-center bg-gradient-to-br from-blue-50 to-white p-8",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-3",children:s?"Welcome Back":"Create an Account"}),e.jsx("p",{className:"mb-8",children:s?"Sign in to access your marketing dashboard":"Join us to view all your marketing data in one place"}),e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[!s&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ss,{htmlFor:"username",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(Vn,{className:"absolute left-3 top-3 h-5 w-5"}),e.jsx(Be,{id:"username",type:"text",value:a,onChange:p=>n(p.target.value),placeholder:"Enter your username",required:!s,className:"pl-10 border-blue-300 focus:border-blue-500 focus:ring-blue-500"})]}),x.username&&e.jsx("p",{className:"text-red-500 text-sm",children:x.username})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ss,{htmlFor:"email",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(ba,{className:"absolute left-3 top-3 h-5 w-5"}),e.jsx(Be,{id:"email",type:"email",value:l,onChange:p=>o(p.target.value),placeholder:"Enter your email",required:!0,className:"pl-10 border-blue-300 focus:border-blue-500 focus:ring-blue-500"})]}),x.email&&e.jsx("p",{className:"text-red-500 text-sm",children:x.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ss,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Un,{className:"absolute left-3 top-3 h-5 w-5"}),e.jsx(Be,{id:"password",type:d?"text":"password",value:j,onChange:p=>u(p.target.value),placeholder:"Enter your password",required:!0,className:"pl-10 border-blue-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>m(!d),className:"absolute right-3 top-3 ",children:d?e.jsx(Hn,{className:"h-5 w-5"}):e.jsx(Kn,{className:"h-5 w-5"})})]}),x.password&&e.jsx("p",{className:"text-red-500 text-sm",children:x.password})]}),e.jsx(D,{type:"submit",className:"w-full text-white",children:s?"Sign In":"Sign Up"})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(D,{variant:"outline",className:"w-full flex items-center justify-center space-x-2",onClick:C,children:[e.jsx(Rn,{className:"h-5 w-5"}),e.jsx("span",{children:"Continue with Google"})]})}),e.jsxs("p",{className:"mt-6 text-center text-sm",children:[s?"Don't have an account? ":"Already have an account? ",e.jsx("button",{onClick:f,className:"font-semibold hover:underline",children:s?"Sign Up":"Sign In"})]})]})})]})}const Ur=ln,Pa=t.forwardRef(({className:s,...r},a)=>e.jsx(Ot,{ref:a,className:q("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...r}));Pa.displayName=Ot.displayName;const Hr=rt("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),La=t.forwardRef(({className:s,variant:r,...a},n)=>e.jsx(Rt,{ref:n,className:q(Hr({variant:r}),s),...a}));La.displayName=Rt.displayName;const Kr=t.forwardRef(({className:s,...r},a)=>e.jsx(Dt,{ref:a,className:q("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...r}));Kr.displayName=Dt.displayName;const Ea=t.forwardRef(({className:s,...r},a)=>e.jsx(zt,{ref:a,className:q("absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...r,children:e.jsx(Gt,{className:"h-4 w-4"})}));Ea.displayName=zt.displayName;const Oa=t.forwardRef(({className:s,...r},a)=>e.jsx(_t,{ref:a,className:q("text-sm font-semibold [&+div]:text-xs",s),...r}));Oa.displayName=_t.displayName;const Ra=t.forwardRef(({className:s,...r},a)=>e.jsx(Bt,{ref:a,className:q("text-sm opacity-90",s),...r}));Ra.displayName=Bt.displayName;function Wr(){const{toasts:s}=Vs();return e.jsxs(Ur,{children:[s.map(function({id:r,title:a,description:n,action:l,...o}){return e.jsxs(La,{...o,children:[e.jsxs("div",{className:"grid gap-1",children:[a&&e.jsx(Oa,{children:a}),n&&e.jsx(Ra,{children:n})]}),l,e.jsx(Ea,{})]},r)}),e.jsx(Pa,{})]})}const Yr={selectedBrandId:null,brands:[]},Da=_s({name:"brand",initialState:Yr,reducers:{setSelectedBrandId:(s,r)=>{s.selectedBrandId=r.payload},setBrands:(s,r)=>{s.brands=r.payload},resetBrand:s=>{s.selectedBrandId=null}}}),{setSelectedBrandId:ws,setBrands:kt,resetBrand:Zr}=Da.actions,Jr=Da.reducer,ct=dn,Ts=mn,ks=un,vs=t.forwardRef(({className:s,sideOffset:r=4,...a},n)=>e.jsx(cn,{children:e.jsx(Vt,{ref:n,sideOffset:r,className:q("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a})}));vs.displayName=Vt.displayName;const Xr="/assets/messold-icon-jcccRy_s.png",za=t.forwardRef(({className:s,children:r,...a},n)=>e.jsxs(Ut,{ref:n,className:q("relative overflow-hidden",s),...a,children:[e.jsx(hn,{className:"h-full w-full rounded-[inherit]",children:r}),e.jsx(Ga,{}),e.jsx(xn,{})]}));za.displayName=Ut.displayName;const Ga=t.forwardRef(({className:s,orientation:r="vertical",...a},n)=>e.jsx(Ht,{ref:n,orientation:r,className:q("flex touch-none select-none transition-colors",r==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",r==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...a,children:e.jsx(fn,{className:"relative flex-1 rounded-full bg-border"})}));Ga.displayName=Ht.displayName;function Qe(){var N;const[s,r]=t.useState(!0),a=_n(),n=js(),l=t.useRef(null),o="https://parallels.messold.com",j=fe(),u=G(g=>g.brand.selectedBrandId),d=G(g=>g.brand.brands),m=G(g=>g.user.user);t.useEffect(()=>{(async()=>{try{if(!(m!=null&&m.brands)||m.brands.length===0){console.warn("No brand IDs found in user context.");return}const w=(await le.post(`${o}/api/brands/filter`,{brandIds:m.brands},{withCredentials:!0})).data;j(kt(w)),!u&&w.length>0&&j(ws(w[0]._id))}catch(f){console.error("Error fetching brands:",f)}})()},[m==null?void 0:m.brands,kt,ws,o,u]);const M=()=>r(g=>!g),v=async()=>{try{(await le.post(`${o}/api/auth/logout`,{},{withCredentials:!0})).status===200&&(j(_r()),j(Zr()),n("/"))}catch(g){console.error("Error logging out:",g)}};t.useEffect(()=>{const g=a.pathname.split("/");g[2]&&ws(g[2])},[a.pathname,ws]);const x=[{name:"AdMetrics Hub",path:`/analytics-dashboard/${u}`,icon:e.jsx(Ns,{size:20})},{name:"Segment Scope",path:`/segment-dashboard/${u}`,icon:e.jsx(Yn,{size:20})},{name:"Marketing Insights Tracker",path:`/ad-metrics/${u}`,icon:e.jsx(wa,{size:20}),requiresAdsData:!1},{name:"E-Commerce Insights",path:`/ecommerce-reports/${u}`,icon:e.jsx(Na,{size:20})},{name:"Meta Reports",path:`/meta-reports/${u}`,icon:e.jsx(ya,{size:18})},{name:"Google Ads Reports",path:`/google-ads-hub/${u}`,icon:e.jsx(Dn,{size:18})},{name:"Conversion Radar",path:"/#",icon:e.jsx(ot,{size:20}),subItems:[{name:"Audience & Traffic Sources",path:`/conversion-reports/${u}/demographics`},{name:"Camapign and Website Performance",path:`/conversion-reports/${u}/performance`}]}],T=g=>{if(!u)return!0;const f=d.find(w=>w._id===u);return(g.name==="Analytics Dashboard"||g.name==="Campaign Metrics")&&!(f!=null&&f.fbAdAccounts)&&!(f!=null&&f.googleAdAccount)};return e.jsx(ct,{children:e.jsxs("div",{ref:l,className:`bg-[rgb(4,16,33)] text-white transition-all duration-500 ease-in-out flex flex-col ${s?"w-64":"w-16"}`,style:{height:"100vh"},children:[e.jsxs("div",{className:"flex justify-between items-center p-4 relative",children:[e.jsxs("div",{className:"flex items-center cursor-pointer",onClick:()=>n("/dashboard"),children:[e.jsx("img",{src:Xr,alt:"Messold Logo",className:"h-8 w-8"}),s?e.jsx("span",{className:"text-sm ml-2",children:"Messold"}):null]}),e.jsx("span",{className:"transition-all duration-300 ease-in-out bg-[rgb(4,16,33)] rounded-full flex items-center justify-center",style:{width:"25px",height:"25px",position:"absolute",right:"-10px",top:"50%",transform:"translateY(-50%)",zIndex:50},onClick:M,children:s?e.jsx(ms,{size:15}):e.jsx(Ye,{size:15})})]}),e.jsx("div",{className:`flex-1 overflow-y-auto ${s?"h-[calc(100vh-64px)]":"h-[calc(100vh-16px)]"}`,children:e.jsx(za,{className:"h-full",children:d&&d.length>0&&e.jsxs("nav",{className:"mt-3",children:[e.jsx(Ft,{icon:e.jsx(Wn,{size:24}),text:u?((N=d.find(g=>g._id===u))==null?void 0:N.name.replace(/_/g," "))||"Unknown Brand":"Your Brands",isExpanded:s,openIcon:e.jsx(wt,{}),closeIcon:e.jsx(qe,{}),isSelected:!!u,tooltipContent:"Your Brands",autoOpenOnSelect:!1,children:d.map(g=>e.jsx($t,{path:`/analytics-dashboard/${g._id}`,text:g.name.replace(/_/g," "),onClick:()=>{j(ws(g._id)),n(`/analytics-dashboard/${g._id}`)},isSelected:u===g._id},g._id))}),x.map((g,f)=>{var w;return e.jsx(Ft,{icon:g.icon,text:g.name,isExpanded:s,isSelected:a.pathname.startsWith(g.path),tooltipContent:`${g.name}${T(g)?" (No Analytics data available)":""}`,onClick:g.subItems?void 0:()=>{T(g)||n(g.path)},disabled:T(g),openIcon:g.subItems?e.jsx(wt,{}):void 0,closeIcon:g.subItems?e.jsx(qe,{}):void 0,children:(w=g.subItems)==null?void 0:w.map((A,C)=>e.jsx($t,{path:A.path,text:A.name,onClick:()=>n(A.path),isSelected:a.pathname===A.path},C))},f)})]})})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Qr,{isExpanded:s,user:m}),e.jsx(qr,{handleLogout:v,isExpanded:s})]})]})})}function Ft({icon:s,text:r,isExpanded:a,openIcon:n,closeIcon:l,children:o,isSelected:j,tooltipContent:u,onClick:d,disabled:m,autoOpenOnSelect:M=!0}){const[v,x]=t.useState(!1),T=()=>{x(w=>!w)},N=ls.Children.toArray(o).some(w=>{var A;return(A=w==null?void 0:w.props)==null?void 0:A.isSelected}),g=j||N;t.useEffect(()=>{M&&g&&x(!0)},[g,M]);const f=e.jsxs("div",{onClick:m?void 0:d||T,className:`flex items-center px-4 py-2 mb-2 text-gray-300 hover:bg-gray-700 hover:text-white transition-colors duration-200 cursor-pointer ${g?"text-white font-semibold relative":"text-gray-100"} ${m?"cursor-not-allowed opacity-50":""}`,children:[e.jsx("span",{className:"mr-2",children:s}),a&&e.jsx("span",{className:"text-xs",children:r}),a&&e.jsx("span",{className:"ml-auto",children:v?n:l})]});return e.jsxs("div",{children:[a?f:e.jsxs(Ts,{children:[e.jsx(ks,{asChild:!0,children:f}),e.jsxs(vs,{side:"right",children:[e.jsx("p",{className:ls.Children.count(o)>0?"mb-4":"",children:u}),ls.Children.map(o,w=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-0 w-1 h-full bg-gray-500"}),w]}))]})]}),v&&a&&e.jsxs("div",{className:"relative pl-8",children:[e.jsx("div",{className:"absolute top-0 w-1 h-full bg-gray-500"}),ls.Children.map(o,w=>e.jsx("div",{children:w}))]})]})}function $t({path:s,text:r,onClick:a,disabled:n=!1,isSelected:l=!1}){const o=`flex items-center text-xs w-full p-2.5 transition-colors duration-200 ${l?"text-white font-semibold relative bg-gray-700":"text-gray-100"} ${n?"cursor-not-allowed text-gray-400":"hover:bg-gray-700"}`;return n?e.jsxs("div",{className:o,children:[r,l&&e.jsx("div",{className:"absolute left-0 w-1 h-full bg-white"})]}):e.jsxs(tn,{to:s,className:o,onClick:j=>{a&&(j.preventDefault(),a())},children:[r,l&&e.jsx("div",{className:"absolute left-0 top-0 w-1 h-full bg-white"})]})}function Qr({isExpanded:s,user:r}){const a=e.jsxs("div",{className:"flex items-center gap-4 px-4 py-2 mb-2 text-gray-300 hover:bg-gray-700 hover:text-white transition-colors duration-200 cursor-pointer",children:[e.jsx("span",{className:"text-gray-300 hover:text-white",children:e.jsx(Zn,{size:24})}),s&&e.jsx("span",{className:"text-sm mr-2",children:(r==null?void 0:r.username)||"user"})]});return e.jsx("div",{children:s?a:e.jsxs(Ts,{children:[e.jsx(ks,{asChild:!0,children:a}),e.jsx(vs,{side:"right",children:e.jsx("p",{children:(r==null?void 0:r.username)||"user"})})]})})}function qr({handleLogout:s,isExpanded:r}){const a=e.jsxs("div",{onClick:s,className:"flex items-center gap-4 px-4 py-2 mb-2 text-gray-300 hover:bg-gray-700 hover:text-white transition-colors duration-200 cursor-pointer",children:[e.jsx("span",{className:"text-gray-300 hover:text-white",children:e.jsx(Jn,{size:24})}),r&&e.jsx("span",{className:"hidden sm:inline",children:"Logout"})]});return e.jsx("div",{children:r?a:e.jsxs(Ts,{children:[e.jsx(ks,{asChild:!0,children:a}),e.jsx(vs,{side:"right",children:e.jsx("p",{children:"Logout"})})]})})}const te=t.forwardRef(({className:s,...r},a)=>e.jsx("div",{ref:a,className:q("rounded-xl border bg-card text-card-foreground shadow",s),...r}));te.displayName="Card";const ke=t.forwardRef(({className:s,...r},a)=>e.jsx("div",{ref:a,className:q("flex flex-col space-y-1.5 p-3",s),...r}));ke.displayName="CardHeader";const Re=t.forwardRef(({className:s,...r},a)=>e.jsx("h3",{ref:a,className:q("font-semibold leading-none tracking-tight",s),...r}));Re.displayName="CardTitle";const eo=t.forwardRef(({className:s,...r},a)=>e.jsx("p",{ref:a,className:q("text-sm text-muted-foreground",s),...r}));eo.displayName="CardDescription";const ne=t.forwardRef(({className:s,...r},a)=>e.jsx("div",{ref:a,className:q("p-4 pt-3",s),...r}));ne.displayName="CardContent";const so=t.forwardRef(({className:s,...r},a)=>e.jsx("div",{ref:a,className:q("flex items-center p-6 pt-0",s),...r}));so.displayName="CardFooter";function ts({className:s,...r}){return e.jsx("div",{className:q("animate-pulse rounded-md bg-primary/10",s),...r})}const De=({width:s="1.25rem",height:r="1.25rem"})=>e.jsx("svg",{style:{height:r,width:s},fill:"#1877F2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),Ve=({width:s="1.25rem",height:r="1.25rem"})=>e.jsxs("svg",{viewBox:"0 0 24 24",style:{height:r,width:s},children:[e.jsx("path",{d:"M13.5437 4.24116L13.5441 4.24138C13.904 4.43971 14.2179 4.70303 14.4689 5.01529C14.7198 5.3275 14.903 5.68264 15.009 6.0601L15.4904 5.92486L15.009 6.0601C15.115 6.43752 15.1422 6.83078 15.0891 7.21776C15.0361 7.60457 14.9038 7.97861 14.6989 8.31855C14.6988 8.31873 14.6987 8.31891 14.6986 8.3191L8.41444 18.701C7.9918 19.3741 7.30557 19.868 6.49825 20.0687C5.68937 20.2699 4.83087 20.1586 4.10949 19.7614C3.38872 19.3646 2.86649 18.7168 2.64727 17.9633C2.42868 17.212 2.5264 16.4083 2.92214 15.7226L9.20689 5.33823C9.20695 5.33813 9.20702 5.33802 9.20708 5.33792C9.62451 4.65082 10.3142 4.14383 11.1301 3.93599C11.9464 3.72804 12.8151 3.83872 13.5437 4.24116Z",fill:"#FFB70A",stroke:"#FFB70A"}),e.jsx("path",{d:"M21.5404 15.4544L15.24 5.04127C14.7453 4.25097 13.9459 3.67817 13.0138 3.44633C12.0817 3.21448 11.0917 3.34215 10.2572 3.80182C9.4226 4.26149 8.8103 5.01636 8.55224 5.90372C8.29418 6.79108 8.41102 7.73988 8.87757 8.54562L15.178 18.9587C15.6726 19.749 16.4721 20.3218 17.4042 20.5537C18.3362 20.7855 19.3262 20.6579 20.1608 20.1982C20.9953 19.7385 21.6076 18.9836 21.8657 18.0963C22.1238 17.2089 22.0069 16.2601 21.5404 15.4544Z",fill:"#3B8AD8"}),e.jsx("path",{d:"M9.23018 16.2447C9.07335 15.6884 8.77505 15.1775 8.36166 14.7572C7.94827 14.3369 7.43255 14.0202 6.86011 13.835C6.28768 13.6499 5.67618 13.6021 5.07973 13.6958C4.48328 13.7895 3.92026 14.0219 3.44049 14.3723C2.96071 14.7227 2.57898 15.1804 2.32906 15.7049C2.07914 16.2294 1.96873 16.8045 2.00762 17.3794C2.0465 17.9542 2.23347 18.5111 2.55199 19.0007C2.8705 19.4902 3.31074 19.8975 3.83376 20.1863C4.46363 20.5354 5.1882 20.6983 5.91542 20.6542C6.64264 20.6101 7.33969 20.361 7.91802 19.9386C8.49636 19.5162 8.92988 18.9395 9.16351 18.2817C9.39715 17.624 9.42035 16.915 9.23018 16.2447Z",fill:"#2CAA14"})]}),to=()=>e.jsxs(te,{className:"transition-transform transform hover:scale-105 hover:border hover:border-blue-600",children:[e.jsxs(ke,{className:"flex flex-col items-start justify-start",children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4 rounded-full"}),e.jsx(ts,{className:"h-6 w-24"})]}),e.jsx(ts,{className:"h-4 w-32 mt-2"})]}),e.jsx(ne,{children:e.jsx(ts,{className:"h-8 w-20 mt-2"})})]}),ao=({label:s,value:r,date:a,icon:n,tooltipContent:l})=>{const o=j=>j?(typeof j=="string"&&(j=new Date(j)),j.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})):"";return e.jsxs(te,{className:"transition-transform transform hover:scale-105 hover:border hover:border-blue-600",children:[e.jsxs(ke,{className:"flex flex-col items-start justify-start",children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[n==="Facebook"?e.jsx(De,{width:"1rem",height:"1rem"}):n==="Google"?e.jsx(Ve,{width:"1rem",height:"1rem"}):null,e.jsx("div",{className:"text-base font-medium",children:s}),l&&e.jsx(ct,{children:e.jsxs(Ts,{children:[e.jsx(ks,{asChild:!0,children:e.jsx("button",{className:"p-0 m-0","aria-label":`Info about ${s}`,children:e.jsx(Xn,{className:"w-3 h-3 text-gray-400"})})}),e.jsxs(vs,{className:"w-64 p-0 bg-white text-black border shadow-sm",children:[e.jsx("div",{className:"p-2 font-semibold border-black",children:s}),e.jsx("div",{className:"w-full h-[0.5px] bg-black"}),e.jsx("div",{className:"p-2",children:l})]})]})})]}),e.jsxs("div",{className:"text-xs text-gray-500 font-bold",children:[o(a.from),a.from&&a.to?" - ":"",o(a.to)]})]}),e.jsx(ne,{children:e.jsx("p",{className:"text-3xl font-bold text-cyan-950",children:r})})]})},Js=({title:s,metrics:r=[],date:a,isLoading:n=!1,icon:l,errorMessage:o})=>o&&!n?e.jsx("section",{className:s?"mt-10":"",children:e.jsxs(te,{className:"p-4",children:[e.jsx(ke,{children:e.jsx("h2",{className:"text-xl font-semibold flex items-center space-x-2",children:s&&e.jsxs(e.Fragment,{children:[l==="Facebook"?e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"#1877F2",children:e.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}):e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",children:[e.jsx("path",{d:"M13.5437 4.24116L13.5441 4.24138C13.904 4.43971 14.2179 4.70303 14.4689 5.01529C14.7198 5.3275 14.903 5.68264 15.009 6.0601L15.4904 5.92486L15.009 6.0601C15.115 6.43752 15.1422 6.83078 15.0891 7.21776C15.0361 7.60457 14.9038 7.97861 14.6989 8.31855C14.6988 8.31873 14.6987 8.31891 14.6986 8.3191L8.41444 18.701C7.9918 19.3741 7.30557 19.868 6.49825 20.0687C5.68937 20.2699 4.83087 20.1586 4.10949 19.7614C3.38872 19.3646 2.86649 18.7168 2.64727 17.9633C2.42868 17.212 2.5264 16.4083 2.92214 15.7226L9.20689 5.33823C9.20695 5.33813 9.20702 5.33802 9.20708 5.33792C9.62451 4.65082 10.3142 4.14383 11.1301 3.93599C11.9464 3.72804 12.8151 3.83872 13.5437 4.24116Z",fill:"#FFB70A",stroke:"#FFB70A"}),e.jsx("path",{d:"M21.5404 15.4544L15.24 5.04127C14.7453 4.25097 13.9459 3.67817 13.0138 3.44633C12.0817 3.21448 11.0917 3.34215 10.2572 3.80182C9.4226 4.26149 8.8103 5.01636 8.55224 5.90372C8.29418 6.79108 8.41102 7.73988 8.87757 8.54562L15.178 18.9587C15.6726 19.749 16.4721 20.3218 17.4042 20.5537C18.3362 20.7855 19.3262 20.6579 20.1608 20.1982C20.9953 19.7385 21.6076 18.9836 21.8657 18.0963C22.1238 17.2089 22.0069 16.2601 21.5404 15.4544Z",fill:"#3B8AD8"}),e.jsx("path",{d:"M9.23018 16.2447C9.07335 15.6884 8.77505 15.1775 8.36166 14.7572C7.94827 14.3369 7.43255 14.0202 6.86011 13.835C6.28768 13.6499 5.67618 13.6021 5.07973 13.6958C4.48328 13.7895 3.92026 14.0219 3.44049 14.3723C2.96071 14.7227 2.57898 15.1804 2.32906 15.7049C2.07914 16.2294 1.96873 16.8045 2.00762 17.3794C2.0465 17.9542 2.23347 18.5111 2.55199 19.0007C2.8705 19.4902 3.31074 19.8975 3.83376 20.1863C4.46363 20.5354 5.1882 20.6983 5.91542 20.6542C6.64264 20.6101 7.33969 20.361 7.91802 19.9386C8.49636 19.5162 8.92988 18.9395 9.16351 18.2817C9.39715 17.624 9.42035 16.915 9.23018 16.2447Z",fill:"#2CAA14"})]}),e.jsx("span",{children:s})]})})}),e.jsx(ne,{children:e.jsx("p",{className:"text-red-600 text-sm",children:o})})]})}):e.jsxs("section",{className:s?"mt-10":"",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 flex items-center space-x-2",children:s&&e.jsxs(e.Fragment,{children:[l==="Facebook"?e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"#1877F2",children:e.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}):e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",children:[e.jsx("path",{d:"M13.5437 4.24116L13.5441 4.24138C13.904 4.43971 14.2179 4.70303 14.4689 5.01529C14.7198 5.3275 14.903 5.68264 15.009 6.0601L15.4904 5.92486L15.009 6.0601C15.115 6.43752 15.1422 6.83078 15.0891 7.21776C15.0361 7.60457 14.9038 7.97861 14.6989 8.31855C14.6988 8.31873 14.6987 8.31891 14.6986 8.3191L8.41444 18.701C7.9918 19.3741 7.30557 19.868 6.49825 20.0687C5.68937 20.2699 4.83087 20.1586 4.10949 19.7614C3.38872 19.3646 2.86649 18.7168 2.64727 17.9633C2.42868 17.212 2.5264 16.4083 2.92214 15.7226L9.20689 5.33823C9.20695 5.33813 9.20702 5.33802 9.20708 5.33792C9.62451 4.65082 10.3142 4.14383 11.1301 3.93599C11.9464 3.72804 12.8151 3.83872 13.5437 4.24116Z",fill:"#FFB70A",stroke:"#FFB70A"}),e.jsx("path",{d:"M21.5404 15.4544L15.24 5.04127C14.7453 4.25097 13.9459 3.67817 13.0138 3.44633C12.0817 3.21448 11.0917 3.34215 10.2572 3.80182C9.4226 4.26149 8.8103 5.01636 8.55224 5.90372C8.29418 6.79108 8.41102 7.73988 8.87757 8.54562L15.178 18.9587C15.6726 19.749 16.4721 20.3218 17.4042 20.5537C18.3362 20.7855 19.3262 20.6579 20.1608 20.1982C20.9953 19.7385 21.6076 18.9836 21.8657 18.0963C22.1238 17.2089 22.0069 16.2601 21.5404 15.4544Z",fill:"#3B8AD8"}),e.jsx("path",{d:"M9.23018 16.2447C9.07335 15.6884 8.77505 15.1775 8.36166 14.7572C7.94827 14.3369 7.43255 14.0202 6.86011 13.835C6.28768 13.6499 5.67618 13.6021 5.07973 13.6958C4.48328 13.7895 3.92026 14.0219 3.44049 14.3723C2.96071 14.7227 2.57898 15.1804 2.32906 15.7049C2.07914 16.2294 1.96873 16.8045 2.00762 17.3794C2.0465 17.9542 2.23347 18.5111 2.55199 19.0007C2.8705 19.4902 3.31074 19.8975 3.83376 20.1863C4.46363 20.5354 5.1882 20.6983 5.91542 20.6542C6.64264 20.6101 7.33969 20.361 7.91802 19.9386C8.49636 19.5162 8.92988 18.9395 9.16351 18.2817C9.39715 17.624 9.42035 16.915 9.23018 16.2447Z",fill:"#2CAA14"})]}),e.jsx("span",{children:s})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:n?Array(r.length).fill(0).map((j,u)=>e.jsx(to,{},u)):r.map((j,u)=>e.jsx(e.Fragment,{children:e.jsx(ao,{label:j.label,value:j.value,date:a,icon:l,tooltipContent:j.tooltipContent},u)}))})]}),Pt=({campaigns:s,isLoading:r,icon:a})=>r?e.jsx("div",{children:"Loading..."}):e.jsxs(te,{className:" p-4 my-4  hover:border hover:border-blue-600",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[a==="Facebook"?e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"#1877F2",children:e.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}):e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",children:[e.jsx("path",{d:"M13.5437 4.24116L13.5441 4.24138C13.904 4.43971 14.2179 4.70303 14.4689 5.01529C14.7198 5.3275 14.903 5.68264 15.009 6.0601L15.4904 5.92486L15.009 6.0601C15.115 6.43752 15.1422 6.83078 15.0891 7.21776C15.0361 7.60457 14.9038 7.97861 14.6989 8.31855C14.6988 8.31873 14.6987 8.31891 14.6986 8.3191L8.41444 18.701C7.9918 19.3741 7.30557 19.868 6.49825 20.0687C5.68937 20.2699 4.83087 20.1586 4.10949 19.7614C3.38872 19.3646 2.86649 18.7168 2.64727 17.9633C2.42868 17.212 2.5264 16.4083 2.92214 15.7226L9.20689 5.33823C9.20695 5.33813 9.20702 5.33802 9.20708 5.33792C9.62451 4.65082 10.3142 4.14383 11.1301 3.93599C11.9464 3.72804 12.8151 3.83872 13.5437 4.24116Z",fill:"#FFB70A",stroke:"#FFB70A"}),e.jsx("path",{d:"M21.5404 15.4544L15.24 5.04127C14.7453 4.25097 13.9459 3.67817 13.0138 3.44633C12.0817 3.21448 11.0917 3.34215 10.2572 3.80182C9.4226 4.26149 8.8103 5.01636 8.55224 5.90372C8.29418 6.79108 8.41102 7.73988 8.87757 8.54562L15.178 18.9587C15.6726 19.749 16.4721 20.3218 17.4042 20.5537C18.3362 20.7855 19.3262 20.6579 20.1608 20.1982C20.9953 19.7385 21.6076 18.9836 21.8657 18.0963C22.1238 17.2089 22.0069 16.2601 21.5404 15.4544Z",fill:"#3B8AD8"}),e.jsx("path",{d:"M9.23018 16.2447C9.07335 15.6884 8.77505 15.1775 8.36166 14.7572C7.94827 14.3369 7.43255 14.0202 6.86011 13.835C6.28768 13.6499 5.67618 13.6021 5.07973 13.6958C4.48328 13.7895 3.92026 14.0219 3.44049 14.3723C2.96071 14.7227 2.57898 15.1804 2.32906 15.7049C2.07914 16.2294 1.96873 16.8045 2.00762 17.3794C2.0465 17.9542 2.23347 18.5111 2.55199 19.0007C2.8705 19.4902 3.31074 19.8975 3.83376 20.1863C4.46363 20.5354 5.1882 20.6983 5.91542 20.6542C6.64264 20.6101 7.33969 20.361 7.91802 19.9386C8.49636 19.5162 8.92988 18.9395 9.16351 18.2817C9.39715 17.624 9.42035 16.915 9.23018 16.2447Z",fill:"#2CAA14"})]}),e.jsx("h3",{className:"text-lg font-semibold",children:"Campaign Performance"})]}),e.jsx("div",{className:"overflow-x-auto max-h-[280px] overflow-y-auto",children:e.jsxs("table",{className:"min-w-full table-auto border-collapse bg-white shadow-md rounded-lg",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left text-sm font-medium text-gray-700 sticky top-0",children:[e.jsx("th",{className:"px-6 py-3",children:"Campaign Name"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"Spend (₹)"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"ROAS"})]})}),e.jsx("tbody",{children:s.map((n,l)=>{var d,m;const o=parseFloat(n.spend),j=typeof n.purchase_roas=="string"?n.purchase_roas:(m=(d=n.purchase_roas)==null?void 0:d[0])==null?void 0:m.value,u=j?parseFloat(j):null;return e.jsxs("tr",{className:`border-t text-sm ${l%2===0?"bg-gray-50":"bg-white"}`,children:[e.jsx("td",{className:"px-6 py-3 line-clamp-2",title:n.campaign_name,children:n.campaign_name}),e.jsxs("td",{className:"px-6 py-3 text-center text-gray-700 font-semibold",children:["₹",o.toFixed(2)]}),e.jsx("td",{className:"px-6 py-3 text-center",children:u!==null?e.jsx("span",{className:"inline-flex items-center rounded-full font-medium",children:u.toFixed(2)}):e.jsx("span",{className:"text-gray-500",children:"N/A"})})]},l)})})]})})]}),no=({label:s,value:r,isActive:a,onClick:n})=>e.jsx("button",{className:`px-6 py-2 text-sm font-bold transition-colors duration-200 ${a?" text-blue-500":"text-gray-600 hover:text-gray-900"}`,onClick:()=>n(r),children:s}),Fs=({tabs:s,activeTab:r,onTabChange:a})=>e.jsx("div",{className:"flex justify-center items-center border-b border-gray-200",children:s.map(n=>e.jsx(no,{label:n.label,value:n.value,isActive:r===n.value,onClick:a},n.value))});function Gs({className:s,classNames:r,showOutsideDays:a=!0,...n}){return e.jsx(Sr,{showOutsideDays:a,className:q("px-3",s),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-xs font-medium",nav:"space-x-1 flex items-center",nav_button:q(tt({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-7 font-normal text-[0.6rem]",row:"flex w-full mt-2",cell:q("relative p-0 text-center text-[0.7rem] focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected].day-range-end)]:rounded-r-md",n.mode==="range"?"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md":"[&:has([aria-selected])]:rounded-md"),day:q(tt({variant:"ghost"}),"h-7 w-7 p-0 font-normal aria-selected:opacity-100 text-[0.7rem]"),day_range_start:"day-range-start",day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50  aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...r},components:{IconLeft:()=>e.jsx(gn,{className:"h-4 w-4"}),IconRight:()=>e.jsx(Kt,{className:"h-4 w-4"})},...n})}Gs.displayName="Calendar";const cs=pn,ds=vn,as=t.forwardRef(({className:s,align:r="start",sideOffset:a=4,...n},l)=>e.jsx(jn,{children:e.jsx(Wt,{ref:l,align:r,sideOffset:a,className:q("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})}));as.displayName=Wt.displayName;const ro={from:new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString(),to:new Date().toISOString()},_a=_s({name:"date",initialState:ro,reducers:{setDate:(s,r)=>{r.payload?(s.from=r.payload.from,s.to=r.payload.to):(s.from=void 0,s.to=void 0)},clearDate:s=>{s.from=void 0,s.to=void 0}}}),{setDate:se,clearDate:oo}=_a.actions,lo=_a.reducer,io=Cr(s=>s.date.from,s=>s.date.to,(s,r)=>({from:s,to:r}));function pe({defaultDate:s,resetToFirstPage:r}){const a=fe(),n=G(io),l=t.useMemo(()=>n?{from:n.from?new Date(n.from):void 0,to:n.to?new Date(n.to):void 0}:s?{from:s.from?new Date(s.from):void 0,to:s.to?new Date(s.to):void 0}:void 0,[n,s]),[o,j]=t.useState(l),[u,d]=t.useState(!1),[m,M]=t.useState(null),v=t.useMemo(()=>{const A=new Date,C=A.getDay(),p=os(A,C),F=Ar(p,6),S=new Date(A.getFullYear(),A.getMonth(),1),c=new Date(A.getFullYear(),A.getMonth()+1,0),P=os(p,7),O=os(p,1);return{today:A,startOfThisWeek:p,endOfThisWeek:F,startOfThisMonth:S,endOfThisMonth:c,startOfLastWeek:P,endOfLastWeek:O}},[]);t.useEffect(()=>{!n.from&&!n.to&&s&&a(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[n,s,a]);const x=t.useCallback(()=>{o&&a(se({from:o.from?o.from.toISOString():void 0,to:o.to?o.to.toISOString():void 0})),r&&r(),d(!1)},[a,r,o]),T=t.useCallback(()=>{j(void 0),M(null),a(oo()),r&&r(),d(!1)},[a,r]),N=t.useCallback((A,C)=>{j({from:A,to:C})},[]),g=t.useCallback(A=>A?A.from?A.to?`${U(A.from,"LLL dd, y")} - ${U(A.to,"LLL dd, y")}`:U(A.from,"LLL dd, y"):"Pick a date":s&&s.from&&s.to?`${U(s.from,"LLL dd, y")} - ${U(s.to,"LLL dd, y")}`:"Pick a date",[s]),f=t.useMemo(()=>[{label:"Today",fn:()=>N(v.today,v.today)},{label:"Yesterday",fn:()=>N(os(v.today,1),os(v.today,1))},{label:"This Week",fn:()=>N(v.startOfThisWeek,v.endOfThisWeek)},{label:"Last 7 Days",fn:()=>N(os(v.today,6),v.today)},{label:"Last week",fn:()=>N(v.startOfLastWeek,v.endOfLastWeek)},{label:"Last 30 Days",fn:()=>N(os(v.today,29),v.today)},{label:"This Month",fn:()=>N(v.startOfThisMonth,v.endOfThisMonth)},{label:"Last 3 Months",fn:()=>N(St(v.today,3),v.today)},{label:"Last 6 Months",fn:()=>N(St(v.today,6),v.today)},{label:"Last Year",fn:()=>N(Mr(v.today,1),v.today)}],[v,N]),w=t.useCallback(A=>{A!=null&&A.from&&!A.to?j({from:A.from,to:A.from}):A!=null&&A.from&&(A!=null&&A.to)&&A.from>A.to?j({from:A.from,to:A.from}):j(A),M(null)},[]);return e.jsxs(cs,{open:u,onOpenChange:d,children:[e.jsx(ds,{asChild:!0,children:e.jsxs(D,{id:"date",variant:"outline",className:q("w-[250px] justify-start text-left font-normal text-sm",!o&&!s&&"text-muted-foreground"),children:[e.jsx(Qn,{className:"mr-2 h-4 w-4"}),g(o)]})}),e.jsxs(as,{className:"w-auto p-0",align:"start",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"border-r p-2 w-[140px] overflow-y-auto",style:{maxHeight:"240px"},children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-xs pb-2 px-2 font-medium border-b",children:"Custom"}),f.map(A=>e.jsx(D,{size:"sm",variant:"ghost",className:q("w-full justify-start text-xs font-normal",m===A.label&&"bg-accent"),onClick:()=>{A.fn(),M(A.label)},children:A.label},A.label))]})}),e.jsx("div",{className:"p-2",children:e.jsx(Gs,{initialFocus:!0,mode:"range",defaultMonth:(o==null?void 0:o.from)||(s==null?void 0:s.from)||v.today,selected:o,onSelect:w,numberOfMonths:2})})]}),e.jsxs("div",{className:"border-t p-2 flex justify-end gap-2",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:T,children:"Clear"}),e.jsx(D,{size:"sm",onClick:x,children:"Apply"})]})]})]})}function us({title:s,Icon:r,showDatePicker:a=!1,showSettings:n=!1,showRefresh:l=!1,showColorPalette:o=!1,isLoading:j=!1,handleManualRefresh:u,locale:d,setLocale:m,colorInfo:M=[]}){return e.jsx("header",{className:"sticky top-0 z-40 bg-white border-b px-6 py-3 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"rounded-lg bg-secondary p-2 transition-transform duration-300 ease-in-out hover:scale-110",children:e.jsx(r,{className:"h-6 w-6 text-secondary-foreground"})}),e.jsx("h1",{className:"text-2xl font-semibold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-secondary-foreground to-primary",children:s})]}),e.jsxs("div",{className:"flex flex-row items-center space-x-2",children:[a&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}})}),l&&e.jsx("div",{className:"md:flex items-center hidden",children:e.jsx(D,{onClick:u,disabled:j,className:"flex items-center",children:e.jsx(ce,{className:`h-4 w-4 ${j?"animate-spin":""}`})})}),n&&e.jsxs(cs,{children:[e.jsx(ds,{asChild:!0,children:e.jsx(D,{variant:"outline",size:"icon",children:e.jsx(qn,{className:"h-4 w-4"})})}),e.jsx(as,{children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx("h3",{className:"font-medium",children:"Locale Settings"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"radio",name:"locale",value:"en-IN",checked:d==="en-IN",onChange:()=>m&&m("en-IN"),className:"mr-2"}),"Indian Formatting"]}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"radio",name:"locale",value:"en-US",checked:d==="en-US",onChange:()=>m&&m("en-US"),className:"mr-2"}),"Western Formatting"]})]})]})})]}),o&&e.jsxs(cs,{children:[e.jsx(ds,{asChild:!0,children:e.jsx(D,{variant:"outline",size:"icon",children:e.jsx(er,{className:"h-4 w-4"})})}),e.jsx(as,{className:"w-80",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsx("h3",{className:"font-medium leading-none",children:"Color Information"}),e.jsx("div",{className:"grid gap-2",children:M.map(({color:v,condition:x})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-6 h-6 rounded ${v}`}),e.jsx("span",{className:"text-xs",children:x})]},v))})]})})]})]})]})})}function co(){var i,b,k,L,y,I,$,B;const[s,r]=t.useState(!1),[a,n]=t.useState([]),[l,o]=t.useState(),[j,u]=t.useState("all"),[d,m]=t.useState("all"),[M,v]=t.useState("en-IN"),[x,T]=t.useState({totalSpent:0,totalRevenue:0,totalROAS:0,totalPurchases:0,totalCTR:0,totalCPC:0,totalCPM:0,totalCPP:0}),{brandId:N}=re(),g=js(),f=[{label:"All Data",value:"all"},{label:"Meta",value:"facebook"},{label:"Google",value:"google"}],w=G(h=>h.date.from),A=G(h=>h.date.to),C=t.useMemo(()=>({from:w,to:A}),[w,A]),p=h=>{const z=f.find(_=>_.value===h);z&&z.value!==d&&(u(z.value),m(z.value))},F=t.useCallback(async()=>{var h,z;r(!0);try{const _="https://parallels.messold.com",H=C!=null&&C.from?U(C.from,"yyyy-MM-dd"):"",Y=C!=null&&C.to?U(C.to,"yyyy-MM-dd"):"";let W=[],J=[];if(d==="all"||d==="facebook")try{W=(await le.post(`${_}/api/metrics/fbAdAndCampaign/${N}`,{startDate:H,endDate:Y},{withCredentials:!0})).data.data,console.log("fbdata",W),n(W)}catch(xe){console.error("Error fetching Facebook ad data:",xe)}if(d==="all"||d==="google")try{J=((h=(await le.post(`${_}/api/metrics/googleAdAndCampaign/${N}`,{startDate:H,endDate:Y},{withCredentials:!0})).data)==null?void 0:h.data)||[],console.log(J),o(J)}catch(xe){console.error("Error fetching Google ad data:",xe)}S(d==="google"?[]:W,d==="facebook"?void 0:J)}catch(_){console.error("Error fetching ad data:",_),le.isAxiosError(_)&&((z=_.response)==null?void 0:z.status)===401&&(alert("Your session has expired. Please log in again."),g("/"))}finally{r(!1)}},[g,C,d,N]);t.useEffect(()=>{F()},[F]),t.useEffect(()=>{F();const h=setInterval(F,5*60*1e3);return()=>clearInterval(h)},[F]);const S=t.useCallback((h,z)=>{let _=0,H=0,Y=0,W=0,J=0;h!=null&&h.length&&h.forEach(xe=>{var Ae,X;_+=parseFloat(xe.spend||"0"),H+=parseFloat(((Ae=xe.Revenue)==null?void 0:Ae.value)||"0"),Y+=parseFloat(((X=xe.purchases)==null?void 0:X.value)||"0"),W+=parseFloat(xe.clicks||"0"),J+=parseFloat(xe.impressions||"0")}),z!=null&&z.adMetrics&&(_+=parseFloat(z.adMetrics.totalSpent||"0"),H+=parseFloat(z.adMetrics.totalConversionsValue||"0"),Y+=parseFloat(z.adMetrics.totalConversions||"0"),W+=parseFloat(z.adMetrics.totalClicks||"0"),J+=parseFloat(z.adMetrics.totalImpressions||"0")),T({totalSpent:_,totalRevenue:H,totalROAS:H/_||0,totalPurchases:Y,totalCTR:W/J*100||0,totalCPC:_/W||0,totalCPM:_*1e3/J||0,totalCPP:Y>0?_/Y:0})},[]),c=t.useMemo(()=>({totalSpent:`₹ ${x.totalSpent.toLocaleString(M)}`,totalRevenue:`₹ ${x.totalRevenue.toLocaleString(M)}`,totalROAS:Number(x.totalROAS.toFixed(2)).toLocaleString(M),totalPurchases:x.totalPurchases.toLocaleString(M),totalCTR:`${Number(x.totalCTR.toFixed(2)).toLocaleString(M)} %`,totalCPC:Number(x.totalCPC.toFixed(2)).toLocaleString(M),totalCPM:Number(x.totalCPM.toFixed(2)).toLocaleString(M),totalCPP:Number(x.totalCPP.toFixed(2)).toLocaleString(M)}),[x,M]),P=[{label:"Amount Spent",value:c.totalSpent,tooltipContent:"The sum of ad spends for all advertising platforms"},{label:"Revenue",value:c.totalRevenue,tooltipContent:"Revenue from Ads Purchases"},{label:"ROAS (Ads only)",value:c.totalROAS,tooltipContent:"Blended ROAS = Ads Purchases value / Blended Ad Spend"},{label:"Ads Purchases",value:c.totalPurchases,tooltipContent:"Ads Purchases = Fb Ads Purchase + Google Conversions"},{label:"CTR",value:c.totalCTR,tooltipContent:"Average CTR from all advertising platforms = (Blended Clicks / Blended Impressions)*100"},{label:"CPC",value:c.totalCPC,tooltipContent:"Average CPC from all advertising platforms = (Blended Ad Spend / Blended Clicks)"},{label:"CPM",value:c.totalCPM,tooltipContent:"Average CPM from all advertising platforms = (Blended Ad Spend * 1000 / Blended Impressions)"},{label:"CPP",value:c.totalCPP,tooltipContent:"Average CPP from all advertising platforms = (Blended Ad Spend / Blended Purchases)"}],O=[{label:"Total Cost",value:l?`₹ ${new Intl.NumberFormat(M).format(parseFloat((i=l==null?void 0:l.adMetrics)==null?void 0:i.totalSpent))}`:" 0"},{label:"Conversion Value",value:l?`₹ ${parseFloat((b=l==null?void 0:l.adMetrics)==null?void 0:b.totalConversionsValue).toLocaleString(M)}`:" 0"},{label:"ROAS",value:l?parseFloat((k=l==null?void 0:l.adMetrics)==null?void 0:k.roas).toLocaleString(M):"0.00"},{label:"Conversions",value:l?parseFloat((L=l==null?void 0:l.adMetrics)==null?void 0:L.totalConversions).toLocaleString(M):"0"},{label:"CPC",value:l?`₹ ${parseFloat((y=l==null?void 0:l.adMetrics)==null?void 0:y.totalCPC).toLocaleString(M)}`:" 0"},{label:"CPM",value:l?`₹ ${parseFloat((I=l==null?void 0:l.adMetrics)==null?void 0:I.totalCPM).toLocaleString(M)}`:" 0"},{label:"CTR",value:l?`${parseFloat(($=l==null?void 0:l.adMetrics)==null?void 0:$.totalCTR).toLocaleString(M)} %`:" 0"},{label:"Cost Per Conversion",value:l?`₹ ${parseFloat((B=l==null?void 0:l.adMetrics)==null?void 0:B.totalCostPerConversion).toLocaleString(M)}`:" 0"}];return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx(us,{title:"AdMetrics Dashboard",Icon:Ns,showDatePicker:!0,showSettings:!0,showRefresh:!0,isLoading:!1,handleManualRefresh:()=>{F()},locale:M,setLocale:v}),e.jsx("div",{className:"bg-white px-6 sticky top-0 z-10",children:e.jsx(Fs,{tabs:f,activeTab:j,onTabChange:p})}),e.jsxs("main",{className:"p-4 md:p-6 lg:px-8",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold flex flex-row items-center justify-between",children:e.jsxs("div",{className:"flex flex-row items-center space-x-2",children:[e.jsx(sr,{className:"h-5 w-5"}),e.jsx("span",{children:"Blended summary"}),(d==="all"||d==="facebook")&&e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"#1877F2",children:e.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),(d==="all"||d==="google")&&e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",children:[e.jsx("path",{d:"M13.5437 4.24116L13.5441 4.24138C13.904 4.43971 14.2179 4.70303 14.4689 5.01529C14.7198 5.3275 14.903 5.68264 15.009 6.0601L15.4904 5.92486L15.009 6.0601C15.115 6.43752 15.1422 6.83078 15.0891 7.21776C15.0361 7.60457 14.9038 7.97861 14.6989 8.31855C14.6988 8.31873 14.6987 8.31891 14.6986 8.3191L8.41444 18.701C7.9918 19.3741 7.30557 19.868 6.49825 20.0687C5.68937 20.2699 4.83087 20.1586 4.10949 19.7614C3.38872 19.3646 2.86649 18.7168 2.64727 17.9633C2.42868 17.212 2.5264 16.4083 2.92214 15.7226L9.20689 5.33823C9.20695 5.33813 9.20702 5.33802 9.20708 5.33792C9.62451 4.65082 10.3142 4.14383 11.1301 3.93599C11.9464 3.72804 12.8151 3.83872 13.5437 4.24116Z",fill:"#FFB70A",stroke:"#FFB70A"}),e.jsx("path",{d:"M21.5404 15.4544L15.24 5.04127C14.7453 4.25097 13.9459 3.67817 13.0138 3.44633C12.0817 3.21448 11.0917 3.34215 10.2572 3.80182C9.4226 4.26149 8.8103 5.01636 8.55224 5.90372C8.29418 6.79108 8.41102 7.73988 8.87757 8.54562L15.178 18.9587C15.6726 19.749 16.4721 20.3218 17.4042 20.5537C18.3362 20.7855 19.3262 20.6579 20.1608 20.1982C20.9953 19.7385 21.6076 18.9836 21.8657 18.0963C22.1238 17.2089 22.0069 16.2601 21.5404 15.4544Z",fill:"#3B8AD8"}),e.jsx("path",{d:"M9.23018 16.2447C9.07335 15.6884 8.77505 15.1775 8.36166 14.7572C7.94827 14.3369 7.43255 14.0202 6.86011 13.835C6.28768 13.6499 5.67618 13.6021 5.07973 13.6958C4.48328 13.7895 3.92026 14.0219 3.44049 14.3723C2.96071 14.7227 2.57898 15.1804 2.32906 15.7049C2.07914 16.2294 1.96873 16.8045 2.00762 17.3794C2.0465 17.9542 2.23347 18.5111 2.55199 19.0007C2.8705 19.4902 3.31074 19.8975 3.83376 20.1863C4.46363 20.5354 5.1882 20.6983 5.91542 20.6542C6.64264 20.6101 7.33969 20.361 7.91802 19.9386C8.49636 19.5162 8.92988 18.9395 9.16351 18.2817C9.39715 17.624 9.42035 16.915 9.23018 16.2447Z",fill:"#2CAA14"})]})]})}),e.jsx(Js,{metrics:P,date:{from:C.from?new Date(C.from):void 0,to:C.to?new Date(C.to):void 0},isLoading:s,icon:d==="all"?"":d==="facebook"?"Facebook":"Google"})]})}),(d==="all"||d==="facebook")&&(a==null?void 0:a.length)>0&&a.map((h,z)=>{var H,Y;const _=[{label:"Amount Spent",value:`₹ ${parseFloat(h.spend||"0").toLocaleString(M)}`},{label:"Revenue",value:`₹ ${parseFloat(((H=h.Revenue)==null?void 0:H.value)||"0").toLocaleString(M)}`},{label:"ROAS (Ads only)",value:h.purchase_roas&&h.purchase_roas.length>0?parseFloat(h.purchase_roas[0].value).toFixed(2):"0"},{label:"Ads Purchases",value:((Y=h.purchases)==null?void 0:Y.value)||"0"},{label:"CPC (All clicks)",value:`₹ ${new Intl.NumberFormat(M).format(parseFloat(h.cpc||"0"))}`},{label:"CPM",value:`₹ ${new Intl.NumberFormat(M,{minimumFractionDigits:2}).format(parseFloat(h.cpm||"0"))}`},{label:"CTR",value:`${parseFloat(h.ctr||"0").toFixed(2)} %`},{label:"Cost per Purchase (All)",value:`₹ ${new Intl.NumberFormat(M).format(parseFloat(h.cpp||"0"))}`}];return e.jsxs(e.Fragment,{children:[e.jsx(Js,{icon:"Facebook",title:`Facebook - ${h.account_name}`,metrics:_,date:{from:C.from?new Date(C.from):void 0,to:C.to?new Date(C.to):void 0},isLoading:s,errorMessage:h.message},z),e.jsx(Pt,{campaigns:h.campaigns||[],isLoading:s,icon:"Facebook"})]})}),(d==="all"||d==="google")&&(l&&Object.keys(l).length>0?e.jsxs(e.Fragment,{children:[e.jsx(Js,{icon:"Google",title:`Google Ads - ${l==null?void 0:l.adAccountName}`,metrics:O,date:{from:C.from?new Date(C.from):void 0,to:C.to?new Date(C.to):void 0},isLoading:s}),e.jsx(Pt,{campaigns:l.campaignData||[],isLoading:s,icon:"Google"})]}):e.jsxs("section",{children:[e.jsxs("div",{className:"flex flex-row gap-2 items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Google Ad Metrics"}),e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",children:[e.jsx("path",{d:"M13.5437 4.24116L13.5441 4.24138C13.904 4.43971 14.2179 4.70303 14.4689 5.01529C14.7198 5.3275 14.903 5.68264 15.009 6.0601L15.4904 5.92486L15.009 6.0601C15.115 6.43752 15.1422 6.83078 15.0891 7.21776C15.0361 7.60457 14.9038 7.97861 14.6989 8.31855C14.6988 8.31873 14.6987 8.31891 14.6986 8.3191L8.41444 18.701C7.9918 19.3741 7.30557 19.868 6.49825 20.0687C5.68937 20.2699 4.83087 20.1586 4.10949 19.7614C3.38872 19.3646 2.86649 18.7168 2.64727 17.9633C2.42868 17.212 2.5264 16.4083 2.92214 15.7226L9.20689 5.33823C9.20695 5.33813 9.20702 5.33802 9.20708 5.33792C9.62451 4.65082 10.3142 4.14383 11.1301 3.93599C11.9464 3.72804 12.8151 3.83872 13.5437 4.24116Z",fill:"#FFB70A",stroke:"#FFB70A"}),e.jsx("path",{d:"M21.5404 15.4544L15.24 5.04127C14.7453 4.25097 13.9459 3.67817 13.0138 3.44633C12.0817 3.21448 11.0917 3.34215 10.2572 3.80182C9.4226 4.26149 8.8103 5.01636 8.55224 5.90372C8.29418 6.79108 8.41102 7.73988 8.87757 8.54562L15.178 18.9587C15.6726 19.749 16.4721 20.3218 17.4042 20.5537C18.3362 20.7855 19.3262 20.6579 20.1608 20.1982C20.9953 19.7385 21.6076 18.9836 21.8657 18.0963C22.1238 17.2089 22.0069 16.2601 21.5404 15.4544Z",fill:"#3B8AD8"}),e.jsx("path",{d:"M9.23018 16.2447C9.07335 15.6884 8.77505 15.1775 8.36166 14.7572C7.94827 14.3369 7.43255 14.0202 6.86011 13.835C6.28768 13.6499 5.67618 13.6021 5.07973 13.6958C4.48328 13.7895 3.92026 14.0219 3.44049 14.3723C2.96071 14.7227 2.57898 15.1804 2.32906 15.7049C2.07914 16.2294 1.96873 16.8045 2.00762 17.3794C2.0465 17.9542 2.23347 18.5111 2.55199 19.0007C2.8705 19.4902 3.31074 19.8975 3.83376 20.1863C4.46363 20.5354 5.1882 20.6983 5.91542 20.6542C6.64264 20.6101 7.33969 20.361 7.91802 19.9386C8.49636 19.5162 8.92988 18.9395 9.16351 18.2817C9.39715 17.624 9.42035 16.915 9.23018 16.2447Z",fill:"#2CAA14"})]})]}),e.jsx("div",{className:"text-center text-gray-500 mt-4 bg-white p-2",children:"No Google Ad Account for this brand."})]}))]})]})}const mo=()=>e.jsxs("div",{className:"flex h-screen",children:[" ",e.jsx(Qe,{}),e.jsx("div",{className:"flex-1 h-screen overflow-auto",children:e.jsx(co,{})})]}),Ba=wn,uo=Nn,ho=bn,Va=t.forwardRef(({className:s,...r},a)=>e.jsx(Yt,{ref:a,className:q("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r}));Va.displayName=Yt.displayName;const dt=t.forwardRef(({className:s,children:r,...a},n)=>e.jsxs(ho,{children:[e.jsx(Va,{}),e.jsxs(Zt,{ref:n,className:q("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a,children:[r,e.jsxs(yn,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Gt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));dt.displayName=Zt.displayName;const mt=({className:s,...r})=>e.jsx("div",{className:q("flex flex-col space-y-1.5 text-center sm:text-left",s),...r});mt.displayName="DialogHeader";const ut=t.forwardRef(({className:s,...r},a)=>e.jsx(Jt,{ref:a,className:q("text-lg font-semibold leading-none tracking-tight",s),...r}));ut.displayName=Jt.displayName;const Ua=t.forwardRef(({className:s,...r},a)=>e.jsx(Xt,{ref:a,className:q("text-sm text-muted-foreground",s),...r}));Ua.displayName=Xt.displayName;function xo(){const[s,r]=t.useState(""),a="https://parallels.messold.com",n=async()=>{try{const l=await le.post(`${a}/api/auth/shopify`,{shop:s},{withCredentials:!0});if(l.data.success){const{authUrl:o}=l.data;console.log("Generated Shopify Auth URL:",o),window.location.href=o}else console.error("Failed to get Shopify Auth URL")}catch(l){console.error("Error getting Shopify Auth URL:",l)}};return e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx(Be,{type:"text",placeholder:"Enter your Shopify store name",value:s,onChange:l=>r(l.target.value)}),e.jsx(D,{className:"w-full",onClick:n,disabled:!s,children:"Login to Shopify"})]})}const be=({width:s="1.25rem",height:r="1.25rem"})=>e.jsxs("svg",{viewBox:"0 0 24 24",style:{height:r,width:s},children:[e.jsx("rect",{x:"17",y:"2",width:"2rem",height:"2rem",rx:"2.5",fill:"#F9AB00"}),e.jsx("path",{d:"M9.5 13.5C9.5 12.1193 10.6193 11 12 11C13.3807 11 14.5 12.1193 14.5 13.5V19.5C14.5 20.8807 13.3807 22 12 22C10.6193 22 9.5 20.8807 9.5 19.5V13.5Z",fill:"#E37400"}),e.jsx("path",{d:"M2 19.5C2 18.1193 3.11929 17 4.5 17C5.88071 17 7 18.1193 7 19.5C7 20.8807 5.88071 22 4.5 22C3.11929 22 2 20.8807 2 19.5Z",fill:"#E37400"}),e.jsx("path",{d:"M6.92162 10C6.36184 10 5.95724 9.68838 5.95724 9.05977V8.55474H3.2304C2.49881 8.55474 2 8.1088 2 7.45332C2 7.07723 2.12193 6.70651 2.40459 6.22297C2.93666 5.29349 3.57403 4.31565 4.31116 3.23573C4.92637 2.31162 5.39747 2 6.20111 2C7.2209 2 7.88044 2.54265 7.88044 3.38617V7.02351H8.19082C8.72842 7.02351 9 7.34587 9 7.79181C9 8.23774 8.72288 8.55474 8.19082 8.55474H7.88044V9.05977C7.88044 9.68838 7.47585 10 6.92162 10ZM6.01267 7.09335V3.48287H5.97387C5.0095 4.8368 4.34996 5.83076 3.7015 7.03962V7.09335H6.01267Z",fill:"#E37400"})]}),Ha=({width:s="1.25rem",height:r="1.25rem"})=>e.jsx("svg",{viewBox:"0 0 64 64",style:{height:r,width:s},xmlns:"http://www.w3.org/2000/svg",children:e.jsxs("g",{children:[e.jsx("g",{children:e.jsx("path",{d:"M51.759,12.659c-0.221-0.021-4.94-0.371-4.94-0.371s-3.28-3.271-3.639-3.631    c-0.36-0.362-1.063-0.254-1.337-0.171c-0.039,0.011-0.715,0.222-1.834,0.567c-1.096-3.167-3.027-6.077-6.426-6.077    c-0.094,0-0.191,0.004-0.289,0.01c-0.966-1.283-2.164-1.844-3.199-1.844c-7.919,0-11.703,9.951-12.889,15.008    c-3.078,0.956-5.266,1.638-5.542,1.728C9.943,18.42,9.89,18.474,9.667,20.1C9.495,21.331,5,56.264,5,56.264l35.022,6.594    L59,58.731c0,0-6.661-45.261-6.703-45.572C52.255,12.849,51.983,12.677,51.759,12.659z M33.034,10.88    c0,0.119-0.002,0.231-0.002,0.344c-1.928,0.601-4.02,1.251-6.121,1.906c1.179-4.57,3.387-6.78,5.32-7.613    C32.716,6.743,33.034,8.505,33.034,10.88z M29.876,3.278c0.346,0,0.688,0.116,1.018,0.345c-2.539,1.199-5.258,4.224-6.408,10.261    c-1.679,0.522-3.319,1.034-4.838,1.506C20.994,10.783,24.188,3.278,29.876,3.278z M31.241,30.19c0,0-2.05-1.099-4.561-1.099    c-3.686,0-3.872,2.324-3.872,2.908c0,3.195,8.287,4.42,8.287,11.903c0,5.888-3.714,9.678-8.726,9.678    c-6.012,0-9.088-3.761-9.088-3.761l1.609-5.345c0,0,3.16,2.729,5.83,2.729c1.74,0,2.449-1.38,2.449-2.387    c0-4.168-6.799-4.354-6.799-11.203c0-5.761,4.116-11.341,12.428-11.341c3.199,0,4.783,0.923,4.783,0.923L31.241,30.19z     M35.11,10.578c0-0.211,0.002-0.417,0.002-0.644c0-1.966-0.273-3.551-0.709-4.807c1.752,0.219,2.919,2.223,3.67,4.528    C37.194,9.931,36.194,10.241,35.11,10.578z",fill:"#95C675"})}),e.jsx("g",{children:e.jsx("path",{d:"M51.759,12.659c-0.221-0.021-4.94-0.371-4.94-0.371s-3.28-3.271-3.639-3.631    c-0.36-0.362-1.063-0.254-1.337-0.171c-0.039,0.011-0.715,0.222-1.834,0.567c-1.096-3.167-3.027-6.077-6.426-6.077    c-0.094,0-0.191,0.004-0.289,0.01c-0.966-1.283-2.164-1.844-3.199-1.844c-7.919,0-9.873,9.951-11.059,15.008    c-3.078,0.956-5.44,6.219-5.719,6.307c-1.719,0.542-1.772,0.596-1.996,2.223C11.148,25.91,5,56.264,5,56.264l35.022,6.594    L59,58.731c0,0-6.661-45.261-6.703-45.572C52.255,12.849,51.983,12.677,51.759,12.659z M33.034,10.88    c0,0.119-0.002,0.231-0.002,0.344c-1.928,0.601-4.02,1.251-6.121,1.906c1.179-4.57,3.387-6.78,5.32-7.613    C32.716,6.743,33.034,8.505,33.034,10.88z M29.876,3.278c0.346,0,0.688,0.116,1.018,0.345c-2.539,1.199-5.258,4.224-6.408,10.261    c-1.679,0.522-3.319,1.034-4.838,1.506C20.994,10.783,24.188,3.278,29.876,3.278z M31.241,30.19c0,0-2.05-1.099-4.561-1.099    c-3.686,0-3.872,2.324-3.872,2.908c0,3.195,8.287,4.42,8.287,11.903c0,5.888-3.714,9.678-8.726,9.678    c-6.012,0-9.088-3.761-9.088-3.761l1.609-5.345c0,0,3.16,2.729,5.83,2.729c1.74,0,2.449-1.38,2.449-2.387    c0-4.168-6.799-4.354-6.799-11.203c0-5.761,4.116-11.341,12.428-11.341c3.199,0,4.783,0.923,4.783,0.923L31.241,30.19z     M35.11,10.578c0-0.211,0.002-0.417,0.002-0.644c0-1.966-0.273-3.551-0.709-4.807c1.752,0.219,2.919,2.223,3.67,4.528    C37.194,9.931,36.194,10.241,35.11,10.578z",fill:"#79B259"})}),e.jsx("path",{d:"M40.022,62.857L59,58.731c0,0-6.661-45.261-6.703-45.572c-0.042-0.311-0.313-0.482-0.538-0.5   c-0.221-0.021-4.94-0.371-4.94-0.371s-3.28-3.271-3.639-3.631c-0.192-0.194-0.479-0.249-0.75-0.251   c-0.72,1.22-0.571,3.537-0.571,3.537l-2.232,50.839L40.022,62.857z",fill:"#55932C"}),e.jsx("path",{d:"M33.583,2.977c-0.094,0-0.191,0.004-0.289,0.01c-0.966-1.283-2.164-1.844-3.199-1.844   c-7.887,0-11.674,9.873-12.875,14.947l2.447-0.759c1.354-4.609,4.545-12.053,10.209-12.053c0.346,0,0.688,0.116,1.018,0.345   c-2.532,1.195-5.244,4.209-6.398,10.213l2.43-0.75c1.182-4.541,3.381-6.739,5.307-7.569c0.484,1.227,0.803,2.988,0.803,5.363   c0,0.108,0,0.211-0.002,0.314l2.078-0.643c0-0.2,0.002-0.4,0.002-0.617c0-1.966-0.273-3.551-0.709-4.807   c1.746,0.218,2.912,2.213,3.662,4.508l1.938-0.601C38.906,5.876,36.976,2.977,33.583,2.977z",fill:"#4A7A2B"}),e.jsx("path",{d:"M47.611,12.348c-0.474-0.037-0.793-0.06-0.793-0.06s-3.28-3.271-3.639-3.631   c-0.192-0.194-0.479-0.249-0.75-0.251c-0.72,1.22-0.571,3.537-0.571,3.537l-2.232,50.839l0.396,0.075l10.098-2.196L47.611,12.348z",fill:"#4C822A"})]})});function fo({platform:s,onConnect:r,connectedId:a}){var S;const[n,l]=t.useState(""),[o,j]=t.useState([]),[u,d]=t.useState([]),[m,M]=t.useState([]),[v,x]=t.useState(!1),[T,N]=t.useState(!1),g="https://parallels.messold.com",f=Je();t.useEffect(()=>{const c=async()=>{var i,b;N(!0);try{const k=(i=f.user)==null?void 0:i.id,L=await le.post(`${g}/api/setup/google-accounts`,{userId:k},{withCredentials:!0});L.status===200?(x(!1),j((b=L.data)==null?void 0:b.clientAccounts.filter(y=>!y.hidden))):console.log("Unexpected status code:",L.status)}catch(k){w(k,x)}finally{N(!1)}},P=async()=>{var i;N(!0);try{const b=(i=f.user)==null?void 0:i.id,k=await le.post(`${g}/api/setup/ga4-propertyIds`,{userId:b},{withCredentials:!0});k.status===200?(x(!1),d(k.data.propertiesList||[])):console.log("Unexpected status code:",k.status)}catch(b){w(b,x)}finally{N(!1)}},O=async()=>{var i;N(!0);try{const b=(i=f.user)==null?void 0:i.id,k=await le.post(`${g}/api/setup/fb-ad-accounts`,{userId:b},{withCredentials:!0});M(k.data.adAccounts||[])}catch(b){w(b,x)}finally{N(!1)}};s.toLowerCase()==="google ads"&&c(),s.toLowerCase()==="google analytics"&&P(),s.toLowerCase()==="facebook"&&O()},[s,f]);const w=(c,P)=>{const O=c;if(O.response){const{status:i,data:b}=O.response,k=O.code;i===400||i===403?P(!0):i===401||k==="TOKEN_EXPIRED"?(alert("Your Google session has expired. Please log in again."),P(!0)):(console.error("Unhandled Error Status:",i),console.error("Error Message:",b))}else O.request?console.error("No response received:",O.request):console.error("Unexpected Error:",O.message)},A=()=>s.toLowerCase()==="google ads"?!o||o.length===0?null:o.filter(c=>c.name.toLowerCase().includes(n.toLowerCase())):s.toLowerCase()==="google analytics"?!u||u.length===0?null:u.filter(c=>c.propertyName.toLowerCase().includes(n.toLowerCase())):s.toLowerCase()==="facebook"?!m||m.length===0?null:m.filter(c=>c.adname.toLowerCase().includes(n.toLowerCase())):[],C=c=>{let P,O;"clientId"in c?(P=c.clientId,O=`${c.name} (${P})`):"propertyId"in c?(P=c.propertyId,O=`${c.propertyName} (${P})`):"id"in c?(P=c.id,O=`${c.adname}`):(P="",O=""),r(s,O,P)},p=async()=>{try{const c=await le.get(`${g}/api/auth/google?context=brandSetup`,{withCredentials:!0}),{authUrl:P}=c.data;window.location.href=P}catch(c){console.error("Error getting Google Auth URL:",c)}},F=async()=>{try{const c=await le.get(`${g}/api/auth/facebook`,{withCredentials:!0});c.data.success?window.location.href=c.data.authURL:console.error("Failed to get Facebook Auth URL")}catch(c){console.error("Error getting Facebook Auth URL:",c)}};return T?e.jsx("div",{children:"Loading..."}):e.jsx(e.Fragment,{children:v?e.jsxs(D,{size:"sm",onClick:s.toLowerCase()==="facebook"?F:p,className:"flex items-center gap-2 bg-white text-black border border-green-800 hover:bg-green-50",children:[s.toLowerCase()==="google ads"&&e.jsxs(e.Fragment,{children:[e.jsx(Ve,{height:"1rem",width:"1rem"}),"Connect to your Google Ads account"]}),s.toLowerCase()==="google analytics"&&e.jsxs(e.Fragment,{children:[e.jsx(be,{height:"1rem",width:"1rem"}),"Connect to your GA4 account"]}),s.toLowerCase()==="facebook"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{height:"1rem",width:"1rem"}),"Connect to your Facebook account"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx(lt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx(Be,{type:"text",placeholder:"Search accounts...",className:"pl-10",value:n,onChange:c=>l(c.target.value)})]}),e.jsx("div",{className:"max-h-[50vh] overflow-auto",children:(S=A())==null?void 0:S.map(c=>{const P=s.toLowerCase()==="google ads",O=s.toLowerCase()==="facebook",i=P?c.clientId:O?c.id:c.propertyId,b=P?c.name:O?c.adname:c.propertyName,k=P?e.jsx(Ve,{height:"1rem",width:"1rem"}):O?e.jsx(De,{height:"1rem",width:"1rem"}):e.jsx(be,{height:"1rem",width:"1rem"});return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded hover:bg-gray-50",children:[e.jsx("span",{children:e.jsxs("div",{className:"flex flex-row items-center gap-3",children:[k,O?`${b}`:`${b} (${i})`]})}),e.jsxs(D,{size:"sm",onClick:()=>C(c),disabled:a.includes(i),className:"bg-blue-600",children:[a.includes(i)&&e.jsx(fs,{className:"h-4 w-4 mr-2"}),a.includes(i)?"Connected":"Connect"]})]},i)})})]})})}const go=[{name:"Shopify",color:"bg-emerald-50",icon:Ha,textColor:"text-emerald-700",ringColor:"ring-emerald-200",description:"Connect your e-commerce store"},{name:"Facebook",color:"bg-blue-50",icon:De,textColor:"text-blue-700",ringColor:"ring-blue-200",description:"Link your ad accounts"},{name:"Google Ads",color:"bg-rose-50",icon:Ve,textColor:"text-rose-700",ringColor:"ring-rose-200",description:"Import campaign data"},{name:"Google Analytics",color:"bg-yellow-50",icon:be,textColor:"text-yellow-700",ringColor:"ring-yellow-200",description:"Track website metrics"}],Es=["Brand Details","Platform Connections","Review"];function Ka(){const[s,r]=t.useState(0),[a,n]=t.useState(null),[l,o]=t.useState({}),[j,u]=t.useState(""),[d,m]=t.useState(null),[M,v]=t.useState(""),[x,T]=t.useState(""),[N,g]=t.useState([]),[f,w]=t.useState(""),[A,C]=t.useState(""),{toast:p}=Vs(),F="https://parallels.messold.com",{user:S,setUser:c}=Je();t.useEffect(()=>{const I=new URLSearchParams(window.location.search),$=I.get("access_token"),B=I.get("shop_name");$&&B&&(C($),w(B),o(h=>({...h,Shopify:[B]})))},[]);const P=(I,$,B)=>{o(h=>({...h,[I]:[...h[I]||[],$]})),I.toLowerCase()==="google ads"?v(B):I.toLowerCase()==="google analytics"?T(B):g(h=>[...h,B]),p({description:`Successfully connected ${$} to ${I}`,variant:"default"})},O=I=>{var B;const $=(B=I.target.files)==null?void 0:B[0];$&&(m($),p({description:"Logo uploaded successfully",variant:"default"}))},i=I=>{var $;return((($=l[I])==null?void 0:$.length)||0)>0},b=I=>{switch(I.toLowerCase()){case"google ads":return M;case"google analytics":return x;case"facebook":return N.join(",");default:return""}},k=()=>{switch(s){case 0:return!!j&&!!d;case 1:return Object.keys(l).length>0;default:return!0}},L=async()=>{if(!j||Object.keys(l).length===0)return p({description:"Please complete all fields before submitting.",variant:"destructive"});const I={name:j,logoUrl:d||"",googleAdAccount:M||"",ga4Account:{PropertyID:x||""},fbAdAccounts:N.map($=>$),shopifyAccount:{shopName:f||"",shopifyAccessToken:A||""}};try{const B=(await le.post(`${F}/api/brands/add`,I,{withCredentials:!0})).data.brand._id;S&&await le.post(`${F}/api/users/add-brand`,{userId:S.id,brandId:B},{withCredentials:!0});const h=S?{...S,brands:[...S.brands,B]}:null;h&&c(h),p({description:"Brand setup completed successfully!",variant:"default"})}catch($){console.error($),p({description:"Error creating brand. Please try again.",variant:"destructive"})}},y=()=>{switch(s){case 0:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Brand Name"}),e.jsx(Be,{placeholder:"Enter your brand name",value:j,onChange:I=>u(I.target.value),className:"w-full"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Brand Logo"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Be,{id:"brandLogo",type:"file",accept:"image/*",onChange:O,className:"hidden"}),e.jsxs(D,{variant:"outline",className:"flex-1",onClick:()=>{var I;return(I=document.getElementById("brandLogo"))==null?void 0:I.click()},children:[e.jsx(ar,{className:"h-4 w-4 mr-2"}),d?"Change Logo":"Upload Logo"]}),d&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-gray-50 rounded-lg",children:[e.jsx(fs,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:d.name})]})]})]})]});case 1:return e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:go.map(I=>e.jsxs(Ba,{open:a===I.name,onOpenChange:$=>n($?I.name:null),children:[e.jsx(uo,{asChild:!0,children:e.jsx("button",{className:`relative group p-6 rounded-xl ${I.color} ring-1 ${I.ringColor} transition-all duration-200 hover:scale-[1.02]`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(I.icon,{width:"2rem",height:"2rem"}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h3",{className:`font-semibold ${I.textColor}`,children:I.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:I.description})]}),i(I.name)?e.jsx(fs,{className:"h-5 w-5 text-green-500"}):e.jsx(Ye,{className:"h-5 w-5 text-gray-400"})]})})}),e.jsxs(dt,{className:"sm:max-w-[600px]",children:[e.jsxs(mt,{children:[e.jsxs(ut,{children:["Connect to ",I.name]}),e.jsx(Ua,{children:I.name==="Shopify"?"Enter your Shopify store name and login to connect.":"Select an account to connect with your brand."})]}),I.name==="Shopify"?e.jsx(xo,{}):e.jsx(fo,{platform:I.name,onConnect:P,connectedId:b(I.name)})]})]},I.name))});case 2:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-lg bg-gray-50 p-6",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Brand Details"}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Name"}),e.jsx("span",{className:"font-medium",children:j})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Logo"}),e.jsx("span",{className:"font-medium",children:d==null?void 0:d.name})]})]})]}),e.jsxs("div",{className:"rounded-lg bg-gray-50 p-6",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Connected Platforms"}),e.jsx("div",{className:"mt-4 space-y-3",children:Object.entries(l).map(([I,$])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:I}),e.jsx("span",{className:"font-medium",children:$.join(", ")})]},I))})]})]})}};return e.jsx(te,{className:"mx-auto shadow-lg",children:e.jsxs(ne,{className:"p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"rounded-full bg-primary/10 p-2",children:e.jsx(tr,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Brand Setup"}),e.jsx("p",{className:"text-gray-500",children:"Complete the steps below to set up your brand"})]})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex justify-between items-center mb-4",children:Es.map((I,$)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full ${$<=s?"bg-primary text-white":"bg-gray-100 text-gray-400"}`,children:$<s?e.jsx(fs,{className:"h-5 w-5"}):e.jsx("span",{children:$+1})}),e.jsx("span",{className:`ml-2 ${$<=s?"text-gray-900":"text-gray-400"}`,children:I}),$<Es.length-1&&e.jsx("div",{className:`w-24 h-0.5 mx-4 ${$<s?"bg-primary":"bg-gray-100"}`})]},I))})}),y(),e.jsxs("div",{className:"flex justify-between mt-8",children:[s>0&&e.jsx(D,{variant:"outline",onClick:()=>r(I=>I-1),children:"Back"}),e.jsx(D,{className:"ml-auto",disabled:!k(),onClick:()=>{s===Es.length-1?L():r(I=>I+1)},children:s===Es.length-1?e.jsxs(e.Fragment,{children:["Complete Setup",e.jsx(fs,{className:"ml-2 h-5 w-5"})]}):e.jsxs(e.Fragment,{children:["Continue",e.jsx(it,{className:"ml-2 h-5 w-5"})]})})]})]})})}const jo=({onEnd:s})=>{const[r,a]=t.useState(0),n=[{title:"All-in-One Marketing Analytics Platform",description:"Your complete solution for Shopify marketing analytics and performance tracking",features:["Multi-brand performance tracking","Real-time analytics dashboard","Campaign ROI analysis","Segment-based insights"],bgColor:"bg-gradient-to-br from-blue-500 to-indigo-600",image:"/sildeimages/slide-1.webp"},{title:"Advanced Campaign Analytics",description:"Deep dive into your marketing campaigns with detailed performance metrics",features:["Campaign performance tracking","Monthly ad metrics analysis","Cross-channel campaign insights","Custom date range analytics"],bgColor:"bg-gradient-to-br from-purple-500 to-pink-600",image:"/sildeimages/slide-2.webp"},{title:"Interactive Analytics Dashboard",description:"Dive deep into your business metrics with our powerful analytics dashboard",features:["Real-time data visualization","Interactive filtering & sorting","Custom KPI tracking","Multi-dimensional analysis"],bgColor:"bg-gradient-to-br from-blue-500 to-indigo-600",image:"/slideimages/slide-3.webp"},{title:"Customer Segmentation & Insights",description:"Understand your customers better with powerful segmentation tools",features:["Customer behavior analysis","Segment-based performance metrics","Geographic insights","Purchase pattern tracking"],bgColor:"bg-gradient-to-br from-green-500 to-teal-600",image:"/slideimages/slide-4.webp"},{title:"Performance Reporting",description:"Generate comprehensive reports and track your brand's growth",features:["Automated report generation","Brand performance metrics","Revenue tracking & forecasting","Custom KPI monitoring"],bgColor:"bg-gradient-to-br from-orange-500 to-red-600",image:"slideimages/slide-5.webp"},{title:"Marketing Intelligence",description:"Make data-driven decisions with our advanced analytics tools",features:["ROI optimization suggestions","Performance benchmarking","Trend analysis & insights","Marketing spend optimization"],bgColor:"bg-gradient-to-br from-cyan-500 to-blue-600",image:"/slideimages/slide-6.webp"}],l=()=>{r===n.length-1?s():a(j=>j+1)},o=()=>{r>0&&a(j=>j-1)};return e.jsx("div",{className:"relative h-[600px] w-full rounded-xl overflow-hidden",children:e.jsxs("div",{className:`absolute inset-0 ${n[r].bgColor} p-8 transition-all duration-500 bg-opacity-50`,children:[e.jsxs("div",{className:"max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8 items-center h-full",children:[e.jsxs("div",{className:"text-white space-y-6",children:[e.jsx("h2",{className:"text-4xl font-bold mb-4 animate-fade-in",children:n[r].title}),e.jsx("p",{className:"text-xl text-white/90 mb-6 animate-fade-in",children:n[r].description}),e.jsx("div",{className:"space-y-3",children:n[r].features.map((j,u)=>e.jsxs("div",{className:"flex items-center space-x-2 animate-slide-in",style:{animationDelay:`${u*100}ms`},children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-white/75"}),e.jsx("p",{className:"text-lg",children:j})]},u))})]}),e.jsx("div",{className:"hidden md:block relative h-[400px]",children:e.jsx("div",{className:"absolute inset-0 bg-white/10 rounded-lg backdrop-blur-sm overflow-hidden",children:e.jsx("img",{src:n[r].image,alt:n[r].title,className:"w-full h-full object-cover opacity-90 hover:opacity-100 transition-opacity duration-300"})})})]}),e.jsxs("div",{className:"absolute bottom-8 left-8 right-8 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(D,{variant:"secondary",onClick:o,disabled:r===0,className:"bg-white/90 text-gray-800 hover:bg-white shadow-lg hover:shadow-xl transition-all",children:[e.jsx(ms,{className:"mr-2 h-4 w-4"}),"Previous"]}),e.jsx("button",{onClick:s,className:"text-white/80 hover:text-white underline-offset-4 hover:underline transition-all duration-200 text-sm font-medium",children:"Skip"})]}),e.jsx("div",{className:"flex gap-2",children:n.map((j,u)=>e.jsx("button",{onClick:()=>a(u),className:`w-3 h-3 rounded-full transition-all duration-300 ${r===u?"bg-white scale-110":"bg-white/50 hover:bg-white/70"}`,"aria-label":`Go to slide ${u+1}`},u))}),e.jsx(D,{variant:"secondary",onClick:l,className:"bg-white/90 text-gray-800 hover:bg-white shadow-lg hover:shadow-xl transition-all",children:r===n.length-1?"Get Started":e.jsxs(e.Fragment,{children:["Next",e.jsx(Ye,{className:"ml-2 h-4 w-4"})]})})]})]})})};function po(){const{user:s,setUser:r,showLandingPopup:a,setShowLandingPopup:n}=Je(),l=G(N=>N.brand.brands),[o,j]=t.useState("landing"),[u,d]=t.useState([]),[m,M]=t.useState({}),v="https://parallels.messold.com",x=t.useCallback(async N=>{try{return(await le.get(`${v}/api/shopify/dailysales/${N}`,{withCredentials:!0})).data.totalSales}catch(g){return console.error("Error fetching sales data:",g),0}},[v]),T=t.useCallback(async()=>{try{const N={};await Promise.all(u.map(async g=>{N[g.brandId]=await x(g.brandId)})),M(N)}catch(N){console.error("Error fetching sales data:",N)}},[u,x]);return t.useEffect(()=>{(async()=>{try{const g=await le.get(`${v}/api/performance/brandTarget`,{withCredentials:!0});d(g.data)}catch(g){console.error("Error fetching brands:",g)}})()},[v]),t.useEffect(()=>{T()},[T]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-gray-100 p-6 relative",children:[a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-4xl mx-4",children:e.jsx(jo,{onEnd:()=>{n(!1),s&&r({...s,hasSeenLandingSlides:!0}),l.length===0&&j("setup")}})})}),e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-bold text-gray-700",children:["Welcome",l.length===0?"":" back",", ",(s==null?void 0:s.username.split(" ")[0])||"user","! 👋"]}),e.jsx("p",{className:"mt-2 text-gray-500",children:l.length===0?"Let's get started by setting up your first brand!":"Here's what's happening with your brands today."})]})}),l.length===0?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex space-x-4 border-b border-gray-300",children:[e.jsx("div",{onClick:()=>j("landing"),className:`cursor-pointer py-2 px-4 ${o==="landing"?"border-b-2 border-blue-500 font-bold":"text-gray-600"}`,children:"Dashboard"}),e.jsx("div",{onClick:()=>j("setup"),className:`cursor-pointer py-2 px-4 ${o==="setup"?"border-b-2 border-blue-500 font-bold":"text-gray-600"}`,children:"Brand Setup"})]}),o==="landing"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(te,{className:"bg-white shadow-md rounded-lg",children:e.jsx(ne,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-800 font-semibold",children:"Active Brands"}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:l.length})]}),e.jsx(Ca,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(te,{className:"bg-white shadow-md rounded-lg",children:e.jsx(ne,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-800 font-semibold",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold mt-2",children:["$",Object.values(m).reduce((N,g)=>N+g,0).toLocaleString()]})]}),e.jsx(Cs,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(te,{className:"bg-white shadow-md rounded-lg",children:e.jsx(ne,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-800 font-semibold",children:"Active Targets"}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:u.length})]}),e.jsx(nr,{className:"h-8 w-8 text-purple-500"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(te,{children:[e.jsx(ke,{children:e.jsxs(Re,{className:"flex items-center text-lg",children:[e.jsx(Nt,{className:"mr-2 h-5 w-5 text-blue-500"}),"Analytics Dashboards"]})}),e.jsx(ne,{children:e.jsx("div",{className:"grid grid-cols-2 gap-4",children:l.map(N=>e.jsx(bt,{to:`/analytics-dashboard/${N.brandId}`,children:e.jsxs("div",{className:"p-4 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsx("p",{className:"font-medium text-gray-900",children:N.name}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"View Analytics"})]})},N.brandId))})})]}),e.jsxs(te,{children:[e.jsx(ke,{children:e.jsxs(Re,{className:"flex items-center text-lg",children:[e.jsx(Nt,{className:"mr-2 h-5 w-5 text-blue-500"}),"Monthly Reports"]})}),e.jsx(ne,{children:e.jsx("div",{className:"grid grid-cols-2 gap-4",children:l.map(N=>e.jsx(bt,{to:`/ad-metrics/${N.brandId}`,children:e.jsxs("div",{className:"p-4 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsx("p",{className:"font-medium text-gray-900",children:N.name}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"View Report"})]})},N.brandId))})})]})]})]}),o==="setup"&&e.jsx(Ka,{})]})]})]})}function vo(){const{user:s}=Je();return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 py-6 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"space-y-5",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary to-primary/80 text-white rounded-2xl shadow-md overflow-hidden",children:e.jsxs("div",{className:"p-8 flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-4 max-w-2xl",children:[e.jsxs("h1",{className:"text-4xl font-extrabold tracking-tight",children:["Welcome, ",e.jsx("span",{className:"text-white/90",children:(s==null?void 0:s.username.split(" ")[0])||"User"})]}),e.jsx("p",{className:"text-lg text-white/80 leading-relaxed",children:"Embark on your analytics journey! Setting up your first brand will unlock powerful insights, helping you transform data into strategic growth."}),e.jsx("div",{className:"flex space-x-4 pt-4",children:e.jsxs(D,{variant:"secondary",className:"bg-white text-primary hover:bg-gray-100",children:["Get Started",e.jsx(Ye,{className:"ml-2 h-4 w-4"})]})})]}),e.jsx(rr,{className:"h-24 w-24 text-white/20 animate-pulse"})]})}),e.jsxs(te,{className:"border-0 rounded-2xl shadow-xl",children:[e.jsx(ke,{className:"bg-gradient-to-r from-blue-50 to-blue-100/50",children:e.jsxs(Re,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Sa,{className:"h-8 w-8 text-yellow-500 animate-bounce"}),e.jsx("span",{className:"text-2xl font-bold text-gray-800",children:"Add Your First Brand"})]}),e.jsxs(D,{variant:"outline",className:"group border-primary/30 hover:bg-primary/5",children:[e.jsx("span",{className:"text-primary",children:"Quick Setup Guide"}),e.jsx(Ye,{className:"ml-2 h-4 w-4 text-primary group-hover:translate-x-1 transition-transform"})]})]})}),e.jsx(ne,{className:"p-6",children:e.jsx(Ka,{})})]})]})})}const yo=()=>{var r;const{user:s}=Je();return e.jsxs("div",{className:"flex h-screen relative",children:[e.jsx(Qe,{}),e.jsx("div",{className:"flex-1 h-screen overflow-auto",children:((r=s==null?void 0:s.brands)==null?void 0:r.length)===0?e.jsx(vo,{}):e.jsx(po,{})})]})},Wa=t.createContext(void 0),bo=({children:s})=>{const[r,a]=t.useState(null),[n,l]=t.useState([]);t.useEffect(()=>{const j=localStorage.getItem("brands"),u=localStorage.getItem("selectedBrandId");j&&l(JSON.parse(j)),u&&a(u)},[]),t.useEffect(()=>{n.length>0&&localStorage.setItem("brands",JSON.stringify(n))},[n]),t.useEffect(()=>{r&&localStorage.setItem("selectedBrandId",r)},[r]);const o=()=>{a(null),localStorage.removeItem("selectedBrandId")};return e.jsx(Wa.Provider,{value:{selectedBrandId:r,setSelectedBrandId:a,resetBrand:o,brands:n,setBrands:l},children:s})},wo=()=>{const s=t.useContext(Wa);if(s===void 0)throw new Error("useBrand must be used within a BrandProvider");return s};function _e({title:s,tooltip:r,colSpan:a=1,rowSpan:n,isSubHeader:l=!1}){return e.jsx("th",{className:`${l?"text-sm font-medium":"font-medium"} text-center whitespace-nowrap bg-gray-100 border border-gray-300 text-gray-800 z-50`,colSpan:a,rowSpan:n,children:e.jsx(Qt,{children:e.jsxs(qt,{children:[e.jsx(ea,{asChild:!0,children:e.jsx("span",{className:"flex items-center justify-center gap-1 p-0.5 cursor-help",children:s})}),e.jsx(sa,{className:"mb-3",children:e.jsx("div",{className:"text-gray-700 bg-white p-2 rounded-md text-sm border shadow-lg max-w-xs",children:r})})]})})})}const No=()=>{const[s,r]=t.useState([]),[a,n]=t.useState(!0),[l,o]=t.useState(null),j=G(C=>C.date.from),u=G(C=>C.date.to),d=t.useMemo(()=>({from:j,to:u}),[j,u]),[m,M]=t.useState([]),{brandId:v}=re(),x=d!=null&&d.from?U(d.from,"yyyy-MM-dd"):"",T=d!=null&&d.to?U(d.to,"yyyy-MM-dd"):"",N="https://parallels.messold.com";t.useEffect(()=>{(async()=>{n(!0),o(null);try{const p={};x&&(p.startDate=x),T&&(p.endDate=T);const S=(await le.get(`${N}/api/report/${v}`,{params:p,withCredentials:!0})).data.data;r(S)}catch(p){console.error(p),o("Failed to fetch data. Please try again later.")}finally{n(!1)}})()},[v,d,N]);const g=C=>{M(p=>p.includes(C)?p.filter(F=>F!==C):[...p,C])},f=C=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(C),w=C=>`${C.toFixed(2)}`,A=t.useMemo(()=>s.map(C=>{const p=C.dailyMetrics.map(O=>({...O,metaSales:O.metaSpend*(O.metaROAS||0),googleSales:O.googleSpend*(O.googleROAS||0)})),F=p.reduce((O,i)=>O+i.metaSales,0),S=p.reduce((O,i)=>O+i.googleSales,0),c=F+S,P=(O,i)=>i?O/i:0;return{...C,metaSales:F,googleSales:S,totalSales:c,metaROAS:P(F,C.metaSpend),googleROAS:P(S,C.googleSpend),grossROI:P(c,C.totalSpend),netROI:P(C.shopifySales,C.totalSpend),dailyMetrics:p}}),[s]);return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Qe,{}),e.jsxs("div",{className:"flex-1 h-screen overflow-hidden bg-gray-100",children:[e.jsx(us,{title:"Marketing Insights Tracker",Icon:wa,showDatePicker:!0}),e.jsx(te,{className:"m-6",children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-row items-center my-4 gap-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 ",children:"Key Performance Metrics by Month with Daily Drill-Down"}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx(De,{width:20,height:20}),e.jsx(Ve,{width:20,height:20}),e.jsx(Ha,{width:20,height:20})]})]}),a?e.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-300px)]",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-600"})}):l?e.jsx("div",{className:"rounded-lg bg-red-50 p-4 text-red-600",children:l}):e.jsx("div",{className:"border rounded-lg shadow-sm bg-white overflow-hidden",children:e.jsx("div",{className:"h-[calc(100vh-200px)] overflow-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsxs("thead",{className:"sticky top-0 z-20 text-sm",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"w-3 bg-gray-100 border border-gray-300",rowSpan:2}),e.jsx(_e,{title:"Date",tooltip:"Date",rowSpan:2}),e.jsx(_e,{title:"Meta",tooltip:"Meta Metrics",colSpan:3}),e.jsx(_e,{title:"Google",tooltip:"Google Metrics",colSpan:3}),e.jsx(_e,{title:"Total Spent",tooltip:"Total Spent = Meta Spent + Google Spent",rowSpan:2}),e.jsx(_e,{title:"Gross ROI",tooltip:"Gross ROI = (MetaSales + GoogleSales)/ Total Spent",rowSpan:2}),e.jsx(_e,{title:"Shopify Sales",tooltip:"Shopify Sales",rowSpan:2}),e.jsx(_e,{title:"Net ROI",tooltip:"Net ROI = Shopify Sales / Total Spend",rowSpan:2})]}),e.jsxs("tr",{children:[e.jsx(_e,{title:"Spent",tooltip:"Meta spent",isSubHeader:!0}),e.jsx(_e,{title:"Sales",tooltip:"Meta Sales = Meta Spent * Meta ROAS",isSubHeader:!0}),e.jsx(_e,{title:"ROAS",tooltip:"Meta ROAS",isSubHeader:!0}),e.jsx(_e,{title:"Spent",tooltip:"Google Spent",isSubHeader:!0}),e.jsx(_e,{title:"Sales",tooltip:"Google Sales = Google Spent * Google ROAS",isSubHeader:!0}),e.jsx(_e,{title:"ROAS",tooltip:"Google ROAS",isSubHeader:!0})]})]}),e.jsx("tbody",{children:A.map(C=>{const p=`${C.year}-${C.month.toString().padStart(2,"0")}`,F=m.includes(p);return e.jsxs(ls.Fragment,{children:[e.jsxs("tr",{className:`
                                                        ${F?"bg-gray-100":"bg-white"} 
                                                        border-b border-gray-100 cursor-pointer 
                                                        transition-colors text-sm 
                                                    `,onClick:()=>g(p),children:[e.jsx("td",{className:"w-3 px-4 py-2 text-blue-950",children:F?e.jsx(qe,{className:"h-4 w-4 "}):e.jsx(Ye,{className:"h-4 w-4 "})}),e.jsx("td",{className:"py-3 font-medium text-gray-900",children:U(new Date(C.year,C.month-1),"MMMM yyyy")}),e.jsx("td",{className:"px-4 py-3 text-right",children:f(C.metaSpend)}),e.jsx("td",{className:"px-4 py-3 text-right",children:f(C.metaSales)}),e.jsx("td",{className:"px-4 py-3 text-right",children:w(C.metaROAS)}),e.jsx("td",{className:"px-4 py-3 text-right",children:f(C.googleSpend)}),e.jsx("td",{className:"px-4 py-3 text-right",children:f(C.googleSales)}),e.jsx("td",{className:"px-4 py-3 text-right",children:w(C.googleROAS)}),e.jsx("td",{className:"px-4 py-3 text-right",children:f(C.totalSpend)}),e.jsx("td",{className:"px-4 py-3 text-right",children:w(C.grossROI)}),e.jsx("td",{className:"px-4 py-3 text-right",children:f(C.shopifySales)}),e.jsx("td",{className:"px-4 py-3 text-right",children:w(C.netROI)})]}),F&&C.dailyMetrics.map(S=>e.jsxs("tr",{className:"border-b border-gray-50 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"w-5 px-4 py-2"}),e.jsx("td",{className:"py-2 text-sm text-gray-600",children:U(new Date(S.date),"dd/MM/yyyy")}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:f(S.metaSpend)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:f(S.metaSales)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:w(S.metaROAS)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:f(S.googleSpend)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:f(S.googleSales)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:w(S.googleROAS)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:f(S.totalSpend)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:w(S.grossROI)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:f(S.shopifySales)}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:w(S.netROI)})]},S._id))]},p)})})]})})})]})})]})]})},ht=t.forwardRef(({className:s,...r},a)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:a,className:q("w-full caption-bottom text-sm",s),...r})}));ht.displayName="Table";const xt=t.forwardRef(({className:s,...r},a)=>e.jsx("thead",{ref:a,className:q("[&_tr]:border-b",s),...r}));xt.displayName="TableHeader";const ft=t.forwardRef(({className:s,...r},a)=>e.jsx("tbody",{ref:a,className:q("[&_tr:last-child]:border-0",s),...r}));ft.displayName="TableBody";const Co=t.forwardRef(({className:s,...r},a)=>e.jsx("tfoot",{ref:a,className:q("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...r}));Co.displayName="TableFooter";const Is=t.forwardRef(({className:s,...r},a)=>e.jsx("tr",{ref:a,className:q("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...r}));Is.displayName="TableRow";const Xe=t.forwardRef(({className:s,...r},a)=>e.jsx("th",{ref:a,className:q("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...r}));Xe.displayName="TableHead";const We=t.forwardRef(({className:s,...r},a)=>e.jsx("td",{ref:a,className:q("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...r}));We.displayName="TableCell";const So=t.forwardRef(({className:s,...r},a)=>e.jsx("caption",{ref:a,className:q("mt-4 text-sm text-muted-foreground",s),...r}));So.displayName="TableCaption";const Pe=kn,Le=Fn,Fe=t.forwardRef(({className:s,children:r,...a},n)=>e.jsxs(ta,{ref:n,className:q("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...a,children:[r,e.jsx(Cn,{asChild:!0,children:e.jsx(aa,{className:"h-4 w-4 opacity-50"})})]}));Fe.displayName=ta.displayName;const Ya=t.forwardRef(({className:s,...r},a)=>e.jsx(na,{ref:a,className:q("flex cursor-default items-center justify-center py-1",s),...r,children:e.jsx(Sn,{className:"h-4 w-4"})}));Ya.displayName=na.displayName;const Za=t.forwardRef(({className:s,...r},a)=>e.jsx(ra,{ref:a,className:q("flex cursor-default items-center justify-center py-1",s),...r,children:e.jsx(aa,{className:"h-4 w-4"})}));Za.displayName=ra.displayName;const $e=t.forwardRef(({className:s,children:r,position:a="popper",...n},l)=>e.jsx(An,{children:e.jsxs(oa,{ref:l,className:q("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...n,children:[e.jsx(Ya,{}),e.jsx(Mn,{className:q("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),e.jsx(Za,{})]})}));$e.displayName=oa.displayName;const Ao=t.forwardRef(({className:s,...r},a)=>e.jsx(la,{ref:a,className:q("px-2 py-1.5 text-sm font-semibold",s),...r}));Ao.displayName=la.displayName;const de=t.forwardRef(({className:s,children:r,...a},n)=>e.jsxs(ia,{ref:n,className:q("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(In,{children:e.jsx(nt,{className:"h-4 w-4"})})}),e.jsx(Tn,{children:r})]}));de.displayName=ia.displayName;const Mo=t.forwardRef(({className:s,...r},a)=>e.jsx(ca,{ref:a,className:q("-mx-1 my-1 h-px bg-muted",s),...r}));Mo.displayName=ca.displayName;function Io(){const{brands:s}=wo(),[r,a]=t.useState([]),[n,l]=t.useState({brandId:"",source:"",targetAmount:0,targetDate:At(new Date)}),[o,j]=t.useState(null),[u,d]=t.useState(null),[m,M]=t.useState({}),[v,x]=t.useState(!1),T="https://parallels.messold.com",N=js(),g=t.useCallback(async b=>{var k;try{return(await le.get(`${T}/api/shopify/dailysales/${b}`,{withCredentials:!0})).data.totalSales}catch(L){return console.error("Error fetching sales data:",L),le.isAxiosError(L)&&((k=L.response)==null?void 0:k.status)===401&&(alert("Your session has expired. Please log in again."),N("/")),0}},[N]),f=t.useCallback(async()=>{x(!0);try{const b={};await Promise.all(r.map(async k=>{b[k.brandId]=await g(k.brandId)})),M(b)}catch(b){console.error("Error fetching sales data:",b)}finally{x(!1)}},[r,g]);t.useEffect(()=>{f()},[f]);const w=b=>{const{name:k,value:L}=b.target;l(y=>({...y,[k]:k==="brandId"?L:Number(L)}))},A=b=>{l(k=>({...k,source:b}))},C=async()=>{const b=s.find(k=>String(k._id)===String(n.brandId));if(b)try{const k={brandId:b._id,name:b.name,source:n.source,targetAmount:n.targetAmount,targetDate:n.targetDate},L=await le.post(`${T}/api/performance/addTarget`,k,{withCredentials:!0});a(y=>[...y,L.data]),l({brandId:"",source:"",targetAmount:0,targetDate:At(new Date)})}catch(k){console.error("Error adding brand:",k)}else console.log("Brand not found")},p=b=>{const k=r.find(L=>L.brandId===b);k&&(j(b),d({...k}))},F=async b=>{if(u)try{const k=await le.patch(`${T}/api/performance/updateTarget/${b}`,u,{withCredentials:!0});a(L=>L.map(y=>y.brandId===b?{...y,...k.data}:y)),j(null),d(null),alert("Brand updated successfully!")}catch(k){console.error("Error saving brand edit:",k),alert("Failed to update brand")}},S=()=>{j(null),d(null)},c=async b=>{try{await le.delete(`${T}/api/performance/deleteTarget/${b}`,{withCredentials:!0}),a(k=>k.filter(L=>L.brandId!==b)),console.log("Brand deleted successfully")}catch(k){console.error("Error deleting brand:",k)}},P=()=>e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-blue-500"}),O=b=>{const k=m[b.brandId]||0,L=Math.max(b.targetAmount-k,0),y=new Date;y.setHours(0,0,0,0);const I=new Date(b.targetDate);I.setHours(0,0,0,0);const $=Math.max(Math.ceil((I.getTime()-y.getTime())/(1e3*60*60*24)),0),B=$>0?L/$:0;return{achievedSales:k,remainingTarget:L,remainingDays:$,requiredSalesPerDay:B}},i=r.map(b=>{const{achievedSales:k,remainingTarget:L}=O(b);return{name:b.name,Achieved:k,Remaining:L}});return t.useEffect(()=>{(async()=>{try{const k=await le.get(`${T}/api/performance/brandTarget`,{withCredentials:!0});a(k.data)}catch(k){console.error("Error fetching brands:",k)}})()},[]),e.jsxs("div",{className:"bg-gray-100 min-h-screen",children:[e.jsx("nav",{className:"bg-white border-b border-gray-200 px-4 py-4 md:px-6 lg:px-8",children:e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Brands Performance Metrics"})})}),e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs(te,{className:"mb-4",children:[e.jsx(ke,{children:e.jsx(Re,{children:"Add New Brand Target"})}),e.jsx(ne,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx(ss,{htmlFor:"brandName",children:"Brand Name"}),e.jsxs(Pe,{onValueChange:b=>l(k=>({...k,brandId:b})),children:[e.jsx(Fe,{children:e.jsx(Le,{placeholder:"Select brand"})}),e.jsx($e,{children:s.map(b=>e.jsx(de,{value:b._id,children:b.name},b._id))})]})]}),e.jsxs("div",{children:[e.jsx(ss,{htmlFor:"source",children:"Source"}),e.jsxs(Pe,{onValueChange:A,value:n.source,children:[e.jsx(Fe,{children:e.jsx(Le,{placeholder:"Select source"})}),e.jsxs($e,{children:[e.jsx(de,{value:"Meta & Google",children:"Meta & Google"}),e.jsx(de,{value:"Meta",children:"Meta"}),e.jsx(de,{value:"Google",children:"Google"})]})]})]}),e.jsxs("div",{children:[e.jsx(ss,{htmlFor:"targetAmount",children:"Target Amount"}),e.jsx(Be,{id:"targetAmount",name:"targetAmount",type:"number",value:n.targetAmount,onChange:w,placeholder:"Enter target amount"})]}),e.jsxs("div",{children:[e.jsx(ss,{children:"Target Date"}),e.jsxs(cs,{children:[e.jsx(ds,{asChild:!0,children:e.jsx(D,{variant:"outline",className:q("w-full justify-start text-left font-normal",!n.targetDate&&"text-muted-foreground"),children:n.targetDate?U(n.targetDate,"PPP"):e.jsx("span",{children:"Pick a date"})})}),e.jsx(as,{className:"w-auto p-0",children:e.jsx(Gs,{mode:"single",selected:n.targetDate,onSelect:b=>b&&l(k=>({...k,targetDate:b})),initialFocus:!0})})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(D,{onClick:C,className:"w-full",children:[e.jsx(or,{className:"mr-2 h-4 w-4"})," Add Brand Target"]})})]})})]}),e.jsxs(te,{className:"mb-4",children:[e.jsx(ke,{children:e.jsx(Re,{children:"Brand Performance Table"})}),e.jsx(ne,{children:e.jsxs(ht,{children:[e.jsx(xt,{children:e.jsxs(Is,{children:[e.jsx(Xe,{children:"Brand"}),e.jsx(Xe,{children:"Source"}),e.jsx(Xe,{children:"Target Amount"}),e.jsx(Xe,{children:"Target Date"}),e.jsx(Xe,{children:"Achieved Sales"}),e.jsx(Xe,{children:"Remaining Target"}),e.jsx(Xe,{children:"Remaining Days"}),e.jsx(Xe,{children:"Required Sales/Day"}),e.jsx(Xe,{children:"Actions"})]})}),e.jsx(ft,{children:r.map(b=>{const{achievedSales:k,remainingTarget:L,remainingDays:y,requiredSalesPerDay:I}=O(b),$=o===b.brandId;return e.jsxs(Is,{children:[e.jsx(We,{className:"font-medium",children:b.name}),e.jsx(We,{children:$?e.jsxs(Pe,{onValueChange:B=>d(h=>h?{...h,source:B}:null),defaultValue:u==null?void 0:u.source,children:[e.jsx(Fe,{children:e.jsx(Le,{placeholder:b.source})}),e.jsxs($e,{children:[e.jsx(de,{value:"Meta & Google",children:"Meta & Google"}),e.jsx(de,{value:"Meta",children:"Meta"}),e.jsx(de,{value:"Google",children:"Google"})]})]}):b.source}),e.jsx(We,{children:$?e.jsx(Be,{type:"number",value:u==null?void 0:u.targetAmount,onChange:B=>d(h=>h?{...h,targetAmount:Number(B.target.value)}:null)}):`₹${b.targetAmount.toLocaleString()}`}),e.jsx(We,{children:$?e.jsxs(cs,{children:[e.jsx(ds,{asChild:!0,children:e.jsx(D,{variant:"outline",children:u!=null&&u.targetDate?U(u.targetDate,"PPP"):e.jsx("span",{children:"Pick a date"})})}),e.jsx(as,{className:"w-auto p-0",children:e.jsx(Gs,{mode:"single",selected:u==null?void 0:u.targetDate,onSelect:B=>B&&d(h=>h?{...h,targetDate:B}:null),initialFocus:!0})})]}):U(b.targetDate,"PPP")}),e.jsx(We,{children:v?e.jsx(P,{}):`₹${k.toLocaleString()}`}),e.jsx(We,{children:v?e.jsx(P,{}):`₹${L.toLocaleString()}`}),e.jsx(We,{children:y}),e.jsxs(We,{children:["₹",I.toLocaleString()]}),e.jsx(We,{children:$?e.jsxs(e.Fragment,{children:[e.jsx(D,{onClick:()=>F(b.brandId),className:"mr-2",children:"Save"}),e.jsx(D,{onClick:S,variant:"outline",children:e.jsx(ns,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{onClick:()=>p(b.brandId),className:"mr-2",children:e.jsx(lr,{className:"h-4 w-4"})}),e.jsx(D,{onClick:()=>c(b.brandId),variant:"destructive",children:e.jsx(ir,{className:"h-4 w-4"})})]})})]},b.brandId)})})]})})]}),e.jsxs(te,{children:[e.jsx(ke,{children:e.jsx(Re,{children:"Sales Progress"})}),e.jsx(ne,{children:e.jsx(Xs,{width:"100%",height:300,children:e.jsxs(Qs,{data:i,children:[e.jsx(qs,{dataKey:"name"}),e.jsx(et,{}),e.jsx(st,{}),e.jsx(zs,{dataKey:"Achieved",stackId:"a",fill:"#4ade80"}),e.jsx(zs,{dataKey:"Remaining",stackId:"a",fill:"#f87171"})]})})})]})]})]})}const To=()=>e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Qe,{}),e.jsx("div",{className:"flex-1 h-screen overflow-auto",children:e.jsx(Io,{})})]});function ko(){var J,xe,Ae,X,Ne,Me,V;const s="https://parallels.messold.com",{brandId:r}=re(),[a,n]=t.useState([{id:"products",label:"Products",apiEndpoint:`${s}/api/segment/productMetrics/${r}`,columns:[],data:[],lastUpdated:null},{id:"categories",label:"Categories",apiEndpoint:`${s}/api/segment/categoryMetrics/${r}`,columns:[],data:[],lastUpdated:null},{id:"brands",label:"Brands",apiEndpoint:`${s}/api/segment/brandMetrics/${r}`,columns:[],data:[],lastUpdated:null},{id:"productTypes",label:"Product types",apiEndpoint:`${s}/api/segment/typeMetrics/${r}`,columns:[],data:[],lastUpdated:null}]),[l,o]=t.useState(a[0].id),[j,u]=t.useState(1),[d,m]=t.useState(new Set),[M,v]=t.useState(!1),[x,T]=t.useState(!1),N=100,[g,f]=t.useState({}),w=t.useRef({}),A=5*60*1e3,C=G(E=>E.date.from),p=G(E=>E.date.to),F=t.useMemo(()=>({from:C,to:p}),[C,p]),S=F!=null&&F.from?U(F.from,"yyyy-MM-dd"):"",c=F!=null&&F.to?U(F.to,"yyyy-MM-dd"):"",[P,O]=t.useState(null),[i,b]=t.useState("asc"),k=E=>{o(E),u(1),m(new Set)},L=t.useCallback(async(E,Z={},Q=!1)=>{if(M)return;v(!0);const ae=a.find(ie=>ie.id===E);if(!ae){console.warn(`Tab not found for ID: ${E}`),v(!1);return}const R={...Z,...S&&{startDate:S},...c&&{endDate:c}},K=`${E}-${S||"default"}-${c||"default"}`,ee=w.current[K],oe=Date.now();if(!Q&&E==="products"&&delete w.current[K],!Q&&ee&&oe-ee.timestamp<A){n(ie=>ie.map(Ie=>Ie.id===E?{...Ie,data:ee.data,lastUpdated:ee.timestamp}:Ie)),v(!1);return}try{const ie=await le.post(ae.apiEndpoint,R,{withCredentials:!0});if(ie.data.success){const Ge=ie.data[`${E}Data`]||[];console.log("New Data for Tab:",E,Ge);const rs=Object.keys(Ge[0]||{}).map(Ce=>({id:Ce,header:Ce.charAt(0).toUpperCase()+Ce.slice(1),accessorKey:Ce,cell:Ze=>Ce==="issues"&&Array.isArray(Ze)?Ze.length>0?Ze[0].description:"No issues":String(Ze)}));console.log("Columns for Tab:",rs),n(Ce=>Ce.map(Ze=>Ze.id===E?{...Ze,columns:rs,data:Ge,lastUpdated:oe}:Ze)),w.current[K]={data:Ge,timestamp:oe}}else console.error(`Failed to fetch data for ${E}`)}catch(ie){console.error(`Error fetching data for ${E}:`,ie)}finally{v(!1)}},[a,M,w,S,c]);t.useEffect(()=>{const E={...g,...S&&{startDate:S},...c&&{endDate:c}};L(l,x?E:{},!!x)},[l,F,x,g]);const y=(E,Z)=>{const Q={brands:"Brand",productTypes:"Type",categories:"name",products:"status"},ae={brands:"brands",productTypes:"productType",categories:"categoryName",products:"status"},R=Q[E],K=ae[E];if(R&&K){const ee=Z[R];if(ee){const oe={[K]:ee};E==="categories"&&Z.level&&(oe.categoryLevel=Z.level),f(oe),T(!0),o("products")}else console.warn(`No value found for column "${R}" in row`,Z)}else console.warn(`No column or body key mapping found for tab: ${E}`)},I=E=>{m(Z=>{const Q=new Set(Z);return Q.has(E)?Q.delete(E):Q.add(E),Q})},$=(E,Z=0,Q="")=>{const ae=Q?`${Q}.${E.name}`:E.name,R=d.has(ae);return e.jsxs(ls.Fragment,{children:[e.jsxs("tr",{className:`${R?"bg-gray-100":"bg-white"}`,children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm flex items-center",children:e.jsxs("div",{style:{marginLeft:`${Z*20}px`},onClick:()=>I(ae),className:"flex items-center cursor-pointer",children:[E.subcategories.length>0&&e.jsx("button",{className:"mr-2",children:R?e.jsx(qe,{className:"h-4 w-4"}):e.jsx(Ye,{className:"h-4 w-4"})}),E.name]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm cursor-pointer text-blue-500 underline",onClick:()=>y(l,E),children:E.metrics.products}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:E.metrics.totalCost}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:E.metrics.ROAS}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:E.metrics.conversions}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:E.metrics.ConversionValue}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:E.metrics.ConversionRate}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:E.metrics.totalClicks}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:E.metrics.ctr}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:E.metrics.AvgCPC})]}),R&&E.subcategories.map(K=>$(K,Z+1,ae))]},ae)},B=E=>{P===E?b(Z=>Z==="asc"?"desc":"asc"):(O(E),b("asc"))},h=()=>{const E=a.find(R=>R.id===l);if(!E||E.id==="categories")return{columns:[],data:[]};let Z=E.data;P&&(Z=[...Z].sort((R,K)=>{const ee=R[P],oe=K[P];if(typeof ee=="number"&&typeof oe=="number")return i==="asc"?ee-oe:oe-ee;const ie=String(ee||"").toLowerCase(),Ie=String(oe||"").toLowerCase();return ie<Ie?i==="asc"?-1:1:ie>Ie?i==="asc"?1:-1:0}));const Q=(j-1)*N,ae=Q+N;return{columns:E.columns,data:Z.slice(Q,ae)}},{columns:z,data:_}=h(),H=Math.ceil((((J=a.find(E=>E.id===l))==null?void 0:J.data.length)||0)/N),Y=[{id:"name",header:"Name"},{id:"products",header:"Products"},{id:"totalCost",header:"Cost"},{id:"ROAS",header:"ROAS"},{id:"conversions",header:"Conversions"},{id:"ConversionValue",header:"Conv. Value"},{id:"ConversionRate",header:"Conv. Rate"},{id:"totalClicks",header:"Clicks"},{id:"ctr",header:"CTR"},{id:"AvgCPC",header:"Avg CPC"}];function W(){return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto border-collapse",children:[e.jsx("thead",{children:e.jsx("tr",{children:["w-24","w-32","w-32","w-24","w-24","w-24"].map((E,Z)=>e.jsx("th",{className:"px-4 py-2 border-b",children:e.jsx(ts,{className:`h-4 ${E}`})},Z))})}),e.jsx("tbody",{children:Array.from({length:8}).map((E,Z)=>e.jsx("tr",{children:["w-24","w-32","w-32","w-24","w-24","w-24"].map((Q,ae)=>e.jsx("td",{className:"px-4 py-2 border-b",children:e.jsx(ts,{className:`h-4 ${Q}`})},ae))},Z))})]})})}return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-row gap-2 items-center mb-4",children:[e.jsx(Ve,{}),e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Google Ads Product Insights"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 pb-2 mb-2",children:[e.jsx("div",{className:"flex space-x-2",role:"tablist",children:a.map(E=>e.jsxs(D,{variant:l===E.id?"default":"ghost",onClick:()=>k(E.id),className:"relative",children:[E.id==="products"&&e.jsx(Aa,{className:"w-4 h-4 mr-2"}),E.id==="categories"&&e.jsx(Ma,{className:"w-4 h-4 mr-2"}),E.id==="brands"&&e.jsx(cr,{className:"w-4 h-4 mr-2"}),E.id==="productTypes"&&e.jsx(dr,{className:"w-4 h-4 mr-2"}),E.label,l===E.id&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600"})]},E.id))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{}),e.jsx(D,{variant:"outline",size:"icon",children:e.jsx(gs,{className:`h-4 w-4 ${x?"text-blue-600":"text-gray-600"}`})}),e.jsx(Qt,{children:e.jsxs(qt,{children:[e.jsx(ea,{asChild:!0,children:e.jsx(D,{variant:"outline",size:"icon",onClick:()=>L(l,{},!1),children:e.jsx(ce,{className:`h-4 w-4 ${M?"animate-spin":""}`})})}),((xe=a.find(E=>E.id===l))==null?void 0:xe.lastUpdated)&&e.jsx(sa,{children:e.jsxs("p",{children:["Last updated: ",new Date(((Ae=a.find(E=>E.id===l))==null?void 0:Ae.lastUpdated)||0).toLocaleString()]})})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[x&&e.jsxs("div",{className:"flex items-center gap-2 w-fit p-2 bg-blue-50 rounded-full",children:[e.jsx("span",{className:"text-xs font-medium text-blue-700",children:Object.entries(g).map(([E,Z])=>`${E}: ${Z}`).join(", ")}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>{T(!1),f({}),o("products"),w.current.products=null,L("products",{},!1)},className:"text-blue-700 hover:text-blue-800 hover:bg-blue-100 p-1 h-auto",children:e.jsx(ns,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"rounded-md border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"max-h-[350px] overflow-auto",children:M?e.jsx(W,{}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"sticky top-0 z-10 bg-[#4A628A]",children:e.jsx("tr",{children:(l==="categories"?Y:z).map(E=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-50 uppercase tracking-wider min-w-[150px] cursor-pointer",onClick:()=>B(E.id),children:e.jsxs("div",{className:"flex items-center gap-1",children:[E.header,P===E.id?i==="asc"?e.jsx(As,{className:"h-4 w-4"}):e.jsx(Ms,{className:"h-4 w-4"}):e.jsx(Bs,{className:"h-4 w-4"})]})},E.id))})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[l==="categories"?(X=a.find(E=>E.id==="categories"))==null?void 0:X.data.map(E=>$(E)):_.map((E,Z)=>e.jsx("tr",{className:"hover:bg-gray-50",children:z.map(Q=>{const ae=Q.cell(E[Q.accessorKey]),R=Q.id==="issues",K=Q.id==="Products",ee=Q.id==="status",oe=typeof ae=="string"&&ae.trim().toLowerCase()==="no issues",ie=Ge=>{switch(Ge.trim().toUpperCase()){case"UNSPECIFIED":return"bg-gray-100 text-gray-800";case"UNKNOWN":return"bg-yellow-100 text-yellow-800";case"NOT_ELIGIBLE":return"bg-red-100 text-red-800";case"ELIGIBLE_LIMITED":return"bg-orange-100 text-orange-800";case"ELIGIBLE":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-700"}},Ie=()=>{if(R)return e.jsxs("div",{className:`flex items-center ${oe?"text-green-600":"text-red-600"}`,children:[oe?e.jsx(mr,{className:"w-4 h-4 mr-2"}):e.jsx(Ia,{className:"w-4 h-4 mr-2"}),ae]});if(ee){const Ge=ae?String(ae):"",rs=ie(Ge);return e.jsx("div",{className:`px-2 py-1.5 rounded-full text-xs font-medium w-full ${rs} cursor-pointer`,onClick:()=>y(l,E),children:Ge})}return Q.cell?Q.cell(ae):ae};return e.jsx("td",{className:`px-4 py-2.5 text-sm whitespace-nowrap min-w-[150px] ${K?"cursor-pointer text-blue-600 hover:text-blue-800":""}`,onClick:()=>K&&y(l,E),children:Ie()},Q.id)})},Z)),(l==="categories"?((Ne=a.find(E=>E.id==="categories"))==null?void 0:Ne.data.length)===0:_.length===0)&&e.jsx("tr",{children:e.jsx("td",{colSpan:(l==="categories"?Y:z).length,className:"px-4 py-2 text-sm text-gray-500 text-center",children:"No data available"})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gray-50 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",(j-1)*N+1," to ",Math.min(j*N,((Me=a.find(E=>E.id===l))==null?void 0:Me.data.length)||0)," of ",((V=a.find(E=>E.id===l))==null?void 0:V.data.length)||0," entries"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>u(E=>Math.max(E-1,1)),disabled:j===1,children:[e.jsx(ms,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Page ",j," of ",H]}),e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>u(E=>Math.min(E+1,H)),disabled:j===H,children:["Next",e.jsx(Ye,{className:"h-4 w-4 ml-1"})]})]})]})]})]})]})]})}const he=()=>e.jsxs(ht,{className:"text-center min-w-full",children:[e.jsx(xt,{className:"bg-gray-200 sticky top-0 z-10",children:e.jsx(Is,{children:Array(8).fill(0).map((s,r)=>e.jsx(We,{className:"font-bold px-4 text-black min-w-[150px]",children:e.jsx(ts,{className:"h-6 w-full"})},r))})}),e.jsx(ft,{children:Array(10).fill(0).map((s,r)=>e.jsx(Is,{children:Array(8).fill(0).map((a,n)=>e.jsx(We,{className:"px-4 py-2 max-w-[200px]",children:e.jsx(ts,{className:"h-6 w-full"})},n))},r))})]});function Fo(){var Ae;const s="https://parallels.messold.com",{brandId:r}=re(),[a,n]=t.useState([]),[l,o]=t.useState(!0),[j,u]=t.useState(1),[d,m]=t.useState(!0),[M,v]=t.useState(0),[x,T]=t.useState(0),[N,g]=t.useState([]),[f,w]=t.useState("all"),[A,C]=t.useState([]),[p,F]=t.useState("all"),[S,c]=t.useState("all"),P=G(X=>X.date.from),O=G(X=>X.date.to),i=t.useMemo(()=>({from:P,to:O}),[P,O]),b=i!=null&&i.from?U(i.from,"yyyy-MM-dd"):"",k=i!=null&&i.to?U(i.to,"yyyy-MM-dd"):"",L=100,y=[{id:"searchTerm",header:"Search Term",icon:e.jsx(lt,{className:"w-4 h-4"})},{id:"matchType",header:"Match Type",icon:e.jsx(Sa,{className:"w-4 h-4"})},{id:"status",header:"Status",icon:e.jsx(gs,{className:"w-4 h-4"})},{id:"campaignName",header:"Campaign Name",icon:e.jsx(ur,{className:"w-4 h-4"})},{id:"adGroupName",header:"Ad Group",icon:e.jsx(hr,{className:"w-4 h-4"})},{id:"cost",header:"Cost",icon:e.jsx(xr,{className:"w-4 h-4"})},{id:"conversions",header:"Conversions",icon:e.jsx(Ca,{className:"w-4 h-4"})},{id:"conversionsValue",header:"Conv. Value",icon:e.jsx(Cs,{className:"w-4 h-4"})},{id:"conversionsRate",header:"Conv. Rate",icon:e.jsx(Ct,{className:"w-4 h-4"})},{id:"clicks",header:"Clicks",icon:e.jsx(fr,{className:"w-4 h-4"})},{id:"ctr",header:"CTR",icon:e.jsx(Ct,{className:"w-4 h-4"})},{id:"avg_cpc",header:"Avg. CPC",icon:e.jsx(gr,{className:"w-4 h-4"})}],[I,$]=t.useState(null),[B,h]=t.useState("asc"),z=X=>{I===X?h(Ne=>Ne==="asc"?"desc":"asc"):($(X),h("asc"))},_=t.useMemo(()=>I?[...a].sort((X,Ne)=>{const Me=X[I],V=Ne[I];if(typeof Me=="number"&&typeof V=="number")return B==="asc"?Me-V:V-Me;const E=String(Me).toLowerCase(),Z=String(V).toLowerCase();return E<Z?B==="asc"?-1:1:E>Z?B==="asc"?1:-1:0}):a,[a,I,B]),H=t.useCallback(async()=>{o(!0);try{const X={limit:L,page:j,startDate:b,endDate:k,...f&&f!=="all"&&{campaign:f},...p&&p!=="all"&&{adGroup:p},...S&&S!=="all"&&{status:S}},{data:Ne}=await le.post(`${s}/api/segment/searchTermMetrics/${r}`,X,{withCredentials:!0});Ne.success?(n(Ne.data),v(Ne.totalRecords),T(Ne.totalPages),m(j*L<Ne.totalRecords),g(Ne.campaignAdGroupPairs),C(Ne.statusOptions)):console.error("Failed to fetch search term metrics:",Ne.message)}catch(X){console.error("Error fetching search term metrics:",X)}finally{o(!1)}},[s,r,j,L,f,p,S,b,k]);t.useEffect(()=>{H();const X=setInterval(H,3e5);return()=>clearInterval(X)},[H]);const Y=X=>{w(X),F("all"),u(1)},W=X=>{F(X),u(1)},J=X=>{c(X),u(1)},xe=f!=="all"?((Ae=N==null?void 0:N.find(X=>X.campaignName===f))==null?void 0:Ae.adGroups)||[]:[];return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-row gap-2 items-center mb-4",children:[e.jsx(Ve,{}),e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Google Ads Search Term Insights"})]}),e.jsx("div",{className:"bg-white rounded-xl overflow-hidden border border-gray-200 shadow-md",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsxs(cs,{children:[e.jsx(ds,{asChild:!0,children:e.jsxs(D,{variant:"outline",className:"bg-white border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:[e.jsx(gs,{className:"w-4 h-4 mr-2"}),"Filter"]})}),e.jsx(as,{className:"w-80",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Status"}),e.jsxs(Pe,{onValueChange:J,value:S,children:[e.jsx(Fe,{className:"w-full",children:e.jsx(Le,{placeholder:"Select Status"})}),e.jsxs($e,{children:[e.jsx(de,{value:"all",children:"All Status"}),A.map(X=>e.jsx(de,{value:X,children:X},X))]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Campaign"}),e.jsxs(Pe,{onValueChange:Y,value:f,children:[e.jsx(Fe,{className:"w-full",children:e.jsx(Le,{placeholder:"Select Campaign"})}),e.jsxs($e,{children:[e.jsx(de,{value:"all",children:"All Campaigns"}),N.map(X=>e.jsx(de,{value:X.campaignName,children:X.campaignName},X.campaignName))]})]})]}),f!=="all"&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Ad Group"}),e.jsxs(Pe,{disabled:f==="all",onValueChange:W,value:p,children:[e.jsx(Fe,{className:"w-full",children:e.jsx(Le,{placeholder:"Select Ad Group"})}),e.jsxs($e,{children:[e.jsx(de,{value:"all",children:"All Ad Groups"}),xe.map(X=>e.jsx(de,{value:X,children:X},X))]})]})]})]})})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(pe,{}),e.jsxs(D,{variant:"outline",className:"bg-gray-50 text-gray-600 border-gray-200 hover:bg-gray-100",onClick:H,children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Refresh"]})]})]}),e.jsxs("div",{className:"rounded-md border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"max-h-[380px] overflow-auto rounded-lg",children:l?e.jsx(he,{}):e.jsxs("table",{className:"w-full text-center",children:[e.jsx("thead",{className:"sticky top-0 z-10 bg-[#4A628A] rounded-t-lg",children:e.jsx("tr",{children:y.map(X=>e.jsx("th",{className:"px-4 py-3 text-xs font-medium text-gray-50 uppercase tracking-wider min-w-[200px] cursor-pointer",onClick:()=>z(X.id),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[X.icon,X.header,I===X.id?B==="asc"?e.jsx(As,{className:"ml-1 w-4 h-6 text-[#ffffff]"}):e.jsx(Ms,{className:"ml-1 w-4 h-6 text-[#ffffff]"}):e.jsx(Bs,{className:"ml-1 w-4 h-6 text-gray-300"})]})},X.id))})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[_.map((X,Ne)=>e.jsx("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:y.map(Me=>{const V=X[Me.id],E=Me.id==="status",Z=Me.id==="searchTerm",Q=()=>{if(E){const ae=V?String(V):"",K=(ee=>{switch(ee.trim().toUpperCase()){case"ADDED":return"bg-green-100 text-green-800";case"NONE":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}})(ae);return e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${K}`,children:ae})}if(Z){const ae=V?String(V):"",R=X.performance,K=R==="Best Performing Keyword";return e.jsxs("div",{className:"px-2 py-1 rounded-full font-medium flex flex-col items-center",children:[e.jsx("span",{className:`text-xs ${K?"text-green-600":"text-red-600"}`,children:R}),e.jsx("span",{className:"text-sm mt-1",children:ae})]})}return V};return e.jsx("td",{className:"px-4 py-2.5 text-sm min-w-[200px]",children:Q()},Me.id)})},Ne)),a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:y.length,className:"px-4 py-2 text-sm text-gray-500 text-center",children:"No data available"})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",(j-1)*L+1," to"," ",Math.min(j*L,M||0)," of"," ",M||0," entries"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>u(X=>Math.max(X-1,1)),disabled:j===1,className:"text-gray-600 border-gray-200 hover:bg-gray-50",children:[e.jsx(ms,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",j," of ",x]}),e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>u(X=>X+1),disabled:!d,className:"text-gray-600 border-gray-200 hover:bg-gray-50",children:["Next",e.jsx(Ye,{className:"h-4 w-4 ml-1"})]})]})]})]})]})})]})}const Os={totalConversions:"Total Conversions",totalClicks:"Total Clicks",totalCost:"Total Cost",totalCTR:"Total C T R"},es=100;function $o(){var Q,ae;const s="https://parallels.messold.com",{brandId:r}=re();if(!r)return e.jsx("div",{children:"Error: Brand ID is missing"});const[a,n]=t.useState({campaign:"all",adGroup:"all",ageRange:"all",gender:"all",status:"all",campaignStatus:"all"}),[l,o]=t.useState({campaigns:[],adGroups:[],ageRanges:[],genders:[],campaignAdGroupMap:{},statusOptions:["REMOVED","PAUSED","ENABLED"]}),[j,u]=t.useState([]),[d,m]=t.useState([{id:"age",label:"Age",apiEndpoint:`${s}/api/segment/ageMetrics/${r}`,columns:[],data:[],lastUpdated:null,totalPages:1,currentPage:1},{id:"gender",label:"Gender",apiEndpoint:`${s}/api/segment/genderMetrics/${r}`,columns:[],data:[],lastUpdated:null,totalPages:1,currentPage:1}]),[M,v]=t.useState(1),[x,T]=t.useState(0),[N,g]=t.useState(!0),[f,w]=t.useState(d[0].id),[A,C]=t.useState(1),[p,F]=t.useState(!1),[S,c]=t.useState(!1),[P,O]=t.useState(null),[i,b]=t.useState(["totalClicks","totalCost"]),k=G(R=>R.date.from),L=G(R=>R.date.to),y=t.useMemo(()=>({from:k,to:L}),[k,L]),I=R=>{b(K=>K.includes(R)?K.filter(ee=>ee!==R):[...K,R])},[$,B]=t.useState([]),[h,z]=t.useState([]),_=async(R,K,ee)=>{var oe,ie,Ie;try{F(!0);const Ge=R==="gender"?`${s}/api/segment/genderMetrics/${r}`:`${s}/api/segment/ageMetrics/${r}`,rs={startDate:(K==null?void 0:K.startDate)||(y!=null&&y.from?U(y.from,"yyyy-MM-dd"):""),endDate:(K==null?void 0:K.endDate)||(y!=null&&y.to?U(y.to,"yyyy-MM-dd"):""),page:(K==null?void 0:K.page)||A,limit:(K==null?void 0:K.limit)||es,...(K==null?void 0:K.status)&&{status:K.status},...(K==null?void 0:K.campaign)&&K.campaign!=="all"&&{campaign:K.campaign},...(K==null?void 0:K.adGroup)&&K.adGroup!=="all"&&{adGroup:K.adGroup},...f==="age"&&(K==null?void 0:K.agerange)&&K.agerange!=="all"&&{agerange:K.agerange},...f==="gender"&&(K==null?void 0:K.gender)&&K.gender!=="all"&&{gender:K.gender}};console.log("Fetch Request Body:",rs);const Ce=await le.post(Ge,rs,{withCredentials:!0}),Ze=((oe=Ce.data.genderCampaignAdGroupPairs)==null?void 0:oe.map(Ps=>Ps.campaignName))||[];if(Ce.data.success){const Ps=[...((ie=Ce.data.campaignAdGroupPairs)==null?void 0:ie.map(ue=>ue.campaignName))||[],...((Ie=Ce.data.campaignAdGroupPairs)==null?void 0:Ie.map(ue=>ue.campaignName))||[],...Ze],gt={},jt=[...Ce.data.campaignAdGroupPairs||[],...Ce.data.genderCampaignAdGroupPairs||[]];jt.forEach(ue=>{gt[ue.campaignName]=ue.adGroups||[]});const qa=Array.from(new Set(jt.flatMap(ue=>ue.adGroups||[])));o(ue=>({...ue,campaigns:Array.from(new Set(Ps)),adGroups:qa,campaignAdGroupMap:gt}));const xs=R==="gender"?Ce.data.genderData||[]:Ce.data.ageData||[];if(R==="age"){const ue=new Set(xs.map(ye=>ye.ageRange));$.length===0&&B(Array.from(ue)),o(ye=>({...ye,ageRanges:$.length>0?$:Array.from(ue),genders:ye.genders}))}else{const ue=new Set(xs.map(ye=>ye.gender==="MALE"?"MALE":ye.gender==="FEMALE"?"FEMALE":ye.gender));h.length===0&&z(Array.from(ue)),o(ye=>({...ye,campaigns:[...new Set([...Ps,...Ze])],genders:h.length>0?h:Array.from(ue)}))}u(xs);const en=xs.length>0?Object.keys(xs[0]||{}).filter(ue=>ue!=="adGroupStatus").map(ue=>({id:ue,header:ue==="campaignStatus"?"Campaign Status":ue.replace(/([A-Z])/g," $1").replace(/^./,ye=>ye.toUpperCase()),accessorKey:ue,cell:ye=>{if(ue==="cost")return`$${Number(ye).toFixed(2)}`;if(["roas","conversionsRate","ctr"].includes(ue))return`${(Number(ye)*100).toFixed(2)}%`;if(ue==="campaignStatus"){const Ks={REMOVED:"text-red-600",PAUSED:"text-yellow-600",ENABLED:"text-green-600"}[ye]||"";return e.jsx("span",{className:`font-medium ${Ks}`,children:ye==="REMOVED"?"Removed":ye==="PAUSED"?"Paused":ye==="ENABLED"?"Enabled":ye})}return String(ye)}})):[];m(ue=>ue.map(ye=>ye.id===R?{...ye,columns:en,data:xs,lastUpdated:Date.now()}:ye));const pt=R==="gender"?Ce.data.aggregatedRecords:Ce.data.ageRangeAggregatedMetrics;console.log("Aggregated Data:",pt),console.log("Response Data afterfilter test:",Ce.data);const vt=Object.entries(pt||{}).map(([ue,ye])=>{const Ks=R==="gender"?ue==="MALE"?"Male":ue==="FEMALE"?"Female":ue:ue,yt={[R==="gender"?"gender":"ageRange"]:Ks};if(ye&&typeof ye=="object"&&!Array.isArray(ye)){const Ls=ye;return{...yt,totalConversions:Ls.totalConversions||0,totalClicks:Ls.totalClicks||0,totalCost:Ls.totalCost||0,totalCTR:Ls.totalCTR||0}}return yt});console.log("Processed Graph Data:",vt),O(vt),T(Ce.data.totalRecords||0),v(Ce.data.totalPages||1),g(A*es<Ce.data.totalRecords)}}catch(Ge){console.error("Error fetching data:",Ge),O(null)}finally{F(!1)}},H=(R,K)=>{n(oe=>{const ie={...oe,[R]:K};return R==="campaign"&&(ie.adGroup="all"),ie});const ee={startDate:y!=null&&y.from?U(y.from,"yyyy-MM-dd"):"",endDate:y!=null&&y.to?U(y.to,"yyyy-MM-dd"):"",page:1,limit:es,status:a.status==="all"?void 0:a.status,campaign:a.campaign==="all"?void 0:a.campaign,adGroup:a.adGroup==="all"?void 0:a.adGroup,...f==="age"&&a.ageRange!=="all"&&{agerange:a.ageRange},...f==="gender"&&a.gender!=="all"&&{gender:a.gender}};O(null),_(f,ee)};t.useEffect(()=>{const R={startDate:y!=null&&y.from?U(y.from,"yyyy-MM-dd"):"",endDate:y!=null&&y.to?U(y.to,"yyyy-MM-dd"):"",page:A,limit:es,status:a.status==="all"?void 0:a.status,campaign:a.campaign==="all"?void 0:a.campaign,adGroup:a.adGroup==="all"?void 0:a.adGroup,...f==="age"&&a.ageRange!=="all"&&{agerange:a.ageRange},...f==="gender"&&a.gender!=="all"&&{gender:a.gender}};O(null),console.log("UseEffect Fetch Request:",{activeTab:f,filters:a,requestBody:R}),_(f,R);const K=setInterval(()=>{_(f,R)},3e5);return()=>clearInterval(K)},[f,y,A,a.campaign,a.adGroup,a.ageRange,a.gender,a.status]);const Y=R=>{w(R),C(1);const K={startDate:y!=null&&y.from?U(y.from,"yyyy-MM-dd"):"",endDate:y!=null&&y.to?U(y.to,"yyyy-MM-dd"):"",page:1,limit:es};_(R,K)},W=["campaignName","adGroupName","campaignStatus","ageRange","conversionsValue","conversionsRate","avg_cpc","cost","roas","conversions","clicks","ctr"],[J,xe]=t.useState(null),[Ae,X]=t.useState("asc"),Ne=R=>{J===R?X(K=>K==="asc"?"desc":"asc"):(xe(R),X("asc"))},{columns:Me}=(()=>{const R=d.find(K=>K.id===f);return R?{columns:R.columns}:{columns:[]}})(),V=t.useMemo(()=>J?[...j].sort((R,K)=>{const ee=R[J],oe=K[J];if(typeof ee=="number"&&typeof oe=="number")return Ae==="asc"?ee-oe:oe-ee;const ie=String(ee||"").toLowerCase(),Ie=String(oe||"").toLowerCase();return ie<Ie?Ae==="asc"?-1:1:ie>Ie?Ae==="asc"?1:-1:0}):j,[j,J,Ae]),E=R=>{const K=Math.min(Math.max(1,R),M);C(K);const ee={startDate:y!=null&&y.from?U(y.from,"yyyy-MM-dd"):"",endDate:y!=null&&y.to?U(y.to,"yyyy-MM-dd"):"",page:K,limit:es};_(f,ee)},Z=["#8884d8","#82ca9d","#ffc658","#ff7300"];return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-row gap-2 items-center mb-4",children:[e.jsx(Ve,{}),e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Age and Gender Metrics"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 pb-2 mb-2",children:[e.jsx("div",{className:"flex space-x-2",role:"tablist",children:d.map(R=>e.jsxs(D,{variant:f===R.id?"default":"ghost",onClick:()=>Y(R.id),className:"relative",children:[R.id==="age"?e.jsx(Aa,{className:"w-4 h-4 mr-2"}):e.jsx(Ma,{className:"w-4 h-4 mr-2"}),R.label,f===R.id&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600"})]},R.id))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{}),S&&e.jsx("div",{className:"flex gap-2",children:Object.keys(Os).map(R=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:i.includes(R),onChange:()=>I(R)}),e.jsx("span",{className:"text-sm text-gray-700",children:Os[R]})]},R))}),e.jsx(D,{variant:"outline",size:"icon",onClick:()=>{const R={startDate:y!=null&&y.from?U(y.from,"yyyy-MM-dd"):"",endDate:y!=null&&y.to?U(y.to,"yyyy-MM-dd"):"",page:1,limit:1e3};_(f,R)},disabled:p,children:e.jsx(ce,{className:"h-4 w-4 "})}),e.jsx(D,{variant:"outline",onClick:()=>c(!S),children:S?"Show Table":"Show Graph"}),e.jsxs(cs,{children:[e.jsx(ds,{asChild:!0,children:e.jsxs(D,{variant:"outline",className:"bg-white border-gray-300 hover:bg-gray-50 transition-colors duration-200",children:[e.jsx(gs,{className:"w-4 h-4 mr-2"}),"Filter"]})}),e.jsx(as,{className:"w-80",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Campaign"}),e.jsxs(Pe,{onValueChange:R=>H("campaign",R),value:a.campaign,children:[e.jsx(Fe,{children:e.jsx(Le,{placeholder:"Select campaign"})}),e.jsxs($e,{children:[e.jsx(de,{value:"all",children:"All"}),l.campaigns.map(R=>e.jsx(de,{value:R,children:R},R))]})]})]}),a.campaign!=="all"&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Ad Group"}),e.jsxs(Pe,{onValueChange:R=>H("adGroup",R),value:a.adGroup,children:[e.jsx(Fe,{children:e.jsx(Le,{placeholder:"Select ad group"})}),e.jsxs($e,{children:[e.jsx(de,{value:"all",children:"All Ad Groups"}),(ae=((Q=l.campaignAdGroupMap)==null?void 0:Q[a.campaign])||(f==="gender"?l.adGroups.filter(()=>{if(l&&l.campaignAdGroupMap){const R=Object.keys(l.campaignAdGroupMap).find(()=>{var K,ee;return(ee=(K=l.campaignAdGroupMap)==null?void 0:K[a.campaign])==null?void 0:ee.some(oe=>{var ie,Ie;return(Ie=(ie=l.campaignAdGroupMap)==null?void 0:ie[a.campaign])==null?void 0:Ie.includes(oe)})});return R&&l.campaigns.includes(R)}return!1}):l.adGroups))==null?void 0:ae.map(R=>e.jsx(de,{value:R,children:R},R))]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Status"}),e.jsxs(Pe,{onValueChange:R=>H("status",R),value:a.status,children:[e.jsx(Fe,{children:e.jsx(Le,{placeholder:"Select status"})}),e.jsxs($e,{children:[e.jsx(de,{value:"all",children:"All"}),l.statusOptions.map(R=>e.jsx(de,{value:R,children:R},R))]})]})]}),f==="age"&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Age Range"}),e.jsxs(Pe,{onValueChange:R=>H("ageRange",R),value:a.ageRange,children:[e.jsx(Fe,{children:e.jsx(Le,{placeholder:"Select age range"})}),e.jsxs($e,{children:[e.jsx(de,{value:"all",children:"All"}),l.ageRanges.map(R=>e.jsx(de,{value:R,children:R.replace("AGE_RANGE_","").replace(/_/g,"-")},R))]})]})]}),f==="gender"&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Gender"}),e.jsxs(Pe,{onValueChange:R=>H("gender",R),value:a.gender,children:[e.jsx(Fe,{children:e.jsx(Le,{placeholder:"Select gender"})}),e.jsxs($e,{children:[e.jsx(de,{value:"all",children:"All"}),l.genders.map(R=>e.jsx(de,{value:R,children:R==="MALE"?"Male":R==="FEMALE"?"Female":R},R))]})]})]})]})})]})]})]}),e.jsx("div",{className:"space-y-4",children:p?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-blue-500"})}):S?f==="age"&&P?e.jsx(Xs,{width:"100%",height:300,children:e.jsxs(Qs,{data:P,children:[e.jsx(Mt,{strokeDasharray:"3 3"}),e.jsx(qs,{dataKey:"ageRange"}),e.jsx(et,{}),e.jsx(st,{}),e.jsx(It,{}),i.map((R,K)=>e.jsx(zs,{dataKey:R,fill:Z[K%Z.length],name:Os[R]},R))]})}):f==="gender"&&P?e.jsx(Xs,{width:"100%",height:300,children:e.jsxs(Qs,{data:P,children:[e.jsx(Mt,{strokeDasharray:"3 3"}),e.jsx(qs,{dataKey:"gender"}),e.jsx(et,{}),e.jsx(st,{}),e.jsx(It,{}),i.map((R,K)=>e.jsx(zs,{dataKey:R,fill:Z[K%Z.length],name:Os[R]},R))]})}):null:e.jsxs("div",{className:"rounded-md border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"max-h-[350px] overflow-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"sticky top-0 z-10 bg-[#4A628A]",children:e.jsx("tr",{children:Me.map(R=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-50 uppercase tracking-wider min-w-[150px] cursor-pointer",onClick:()=>W.includes(R.id)&&Ne(R.id),children:e.jsxs("div",{className:"flex items-center gap-1",children:[R.header,W.includes(R.id)&&(J===R.id?Ae==="asc"?e.jsx(As,{className:"ml-1 w-4 h-6 text-[#ffffff]"}):e.jsx(Ms,{className:"ml-1 w-4 h-6 text-[#ffffff]"}):e.jsx(Bs,{className:"ml-1 w-4 h-6 text-gray-300"}))]})},R.id))})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[V.map((R,K)=>e.jsx("tr",{className:"hover:bg-gray-50",children:Me.map(ee=>e.jsx("td",{className:"px-4 py-2.5 text-sm whitespace-nowrap min-w-[150px]",children:ee.cell(R[ee.accessorKey])},ee.id))},K)),V.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:Me.length,className:"px-4 py-4 text-center text-gray-500",children:"No data available"})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-white border-t border-gray-200",children:[e.jsx("div",{className:"text-sm text-gray-700",children:V.length>0?`Showing ${(A-1)*es+1} to ${Math.min(A*es,x)} of ${x} entries`:"Showing 0 entries"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>E(A-1),disabled:A===1,children:[e.jsx(ms,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Page ",A," of ",M]}),e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>E(A+1),disabled:!N,children:["Next",e.jsx(Ye,{className:"h-4 w-4 ml-1"})]})]})]})]})})]})]})}const hs=t.forwardRef(({className:s,...r},a)=>e.jsx(da,{ref:a,className:q("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...r,children:e.jsx($n,{className:q("flex items-center justify-center text-current"),children:e.jsx(nt,{className:"h-4 w-4"})})}));hs.displayName=da.displayName;const Ue=En,He=On,Po=t.forwardRef(({className:s,inset:r,children:a,...n},l)=>e.jsxs(ma,{ref:l,className:q("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",s),...n,children:[a,e.jsx(Kt,{className:"ml-auto"})]}));Po.displayName=ma.displayName;const Lo=t.forwardRef(({className:s,...r},a)=>e.jsx(ua,{ref:a,className:q("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r}));Lo.displayName=ua.displayName;const ze=t.forwardRef(({className:s,sideOffset:r=4,...a},n)=>e.jsx(Pn,{children:e.jsx(ha,{ref:n,sideOffset:r,className:q("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a})}));ze.displayName=ha.displayName;const Se=t.forwardRef(({className:s,inset:r,...a},n)=>e.jsx(xa,{ref:n,className:q("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",r&&"pl-8",s),...a}));Se.displayName=xa.displayName;const Eo=t.forwardRef(({className:s,children:r,checked:a,...n},l)=>e.jsxs(fa,{ref:l,className:q("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:a,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ga,{children:e.jsx(nt,{className:"h-4 w-4"})})}),r]}));Eo.displayName=fa.displayName;const Oo=t.forwardRef(({className:s,children:r,...a},n)=>e.jsxs(ja,{ref:n,className:q("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ga,{children:e.jsx(Ln,{className:"h-2 w-2 fill-current"})})}),r]}));Oo.displayName=ja.displayName;const Ro=t.forwardRef(({className:s,inset:r,...a},n)=>e.jsx(pa,{ref:n,className:q("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",s),...a}));Ro.displayName=pa.displayName;const Do=t.forwardRef(({className:s,...r},a)=>e.jsx(va,{ref:a,className:q("-mx-1 my-1 h-px bg-muted",s),...r}));Do.displayName=va.displayName;const Lt=(s,r)=>s>r?"bg-green-100 text-green-800":s<r?"bg-red-50 text-red-800":(Math.abs(s-r)<1e-4,"bg-yellow-100 text-yellow-700"),zo=({columns:s=[],data:r=[],allTimeData:a=[],isFullScreen:n})=>{const[l,o]=t.useState(null),[j,u]=t.useState("asc"),[d,m]=t.useState(null),[M,v]=t.useState(null),[x,T]=t.useState([]),[N,g]=t.useState(null),[f,w]=t.useState(1),[A,C]=t.useState([]),p=30,F=7,S=s[0]==="Date",c=t.useRef(null),P=t.useRef(null),O=t.useRef(!1),i=t.useRef(r),b=t.useRef([]),k=["Add To Cart Rate","Checkout Rate","Purchase Rate","Sessions"],L=V=>parseFloat(V==null?void 0:V.replace("%","").trim())||0;t.useEffect(()=>{if(!O.current&&c.current&&P.current){const V=c.current.querySelectorAll("thead th"),E=Array.from(V).map(Z=>Math.max(100,Z.clientWidth));T(E),O.current=!0}},[]),t.useEffect(()=>{const V=()=>{if(c.current&&P.current&&O.current){const E=c.current.querySelectorAll("thead th"),Z=Array.from(E).map((Q,ae)=>Math.max(100,x[ae]||Q.clientWidth));T(Z)}};return window.addEventListener("resize",V),()=>window.removeEventListener("resize",V)},[x]);const y=t.useMemo(()=>{const V={};return k.forEach(E=>{const Z=r.filter(ae=>ae[E]!==void 0&&!isNaN(L(ae[E]||"0"))),Q=Z.length>0?Z.reduce((ae,R)=>ae+L(R[E]||"0"),0)/Z.length:0;V[E]=E==="Sessions"?Math.round(Q):parseFloat(Q.toFixed(2))}),V},[r]),I=t.useMemo(()=>{const V={};return k.forEach(E=>{if(a){const Z=a.filter(Q=>Q[E]!==void 0&&!isNaN(L(Q[E]||"0")));V[E]=Z.length>0?Z.reduce((Q,ae)=>Q+L(ae[E]||"0"),0)/Z.length:0}else V[E]=0}),V},[a]),$=t.useMemo(()=>s[0]==="Date"?r.map(()=>({currentLabel:null,allTimeLabel:null})):r.map(V=>{if(!V||!k.every(ee=>V[ee]!==void 0))return{currentLabel:null,allTimeLabel:null};const E=k.some(ee=>{const oe=L(V[ee]||"0"),ie=y[ee];return oe>ie}),Z=k.every(ee=>{const oe=L(V[ee]||"0"),ie=y[ee];return oe<ie}),Q=E?"Current Top":Z?"Current Worst":"",ae=k.some(ee=>{const oe=L(V[ee]||"0"),ie=I[ee];return oe>ie}),R=k.every(ee=>{const oe=L(V[ee]||"0"),ie=I[ee];return oe<ie});return{currentLabel:Q,allTimeLabel:ae?"All Time Top":R?"All Time Worst":""}}),[r,a,y,I,s]),B=(V,E)=>{g(V);const Z=E.pageX,Q=x[V],ae=K=>{const ee=K.pageX-Z,oe=Math.max(100,Q+ee),ie=[...x];ie[V]=oe,T(ie)},R=()=>{g(null),document.removeEventListener("mousemove",ae),document.removeEventListener("mouseup",R)};document.addEventListener("mousemove",ae),document.addEventListener("mouseup",R)},h=t.useMemo(()=>r.map((V,E)=>{var Z,Q;return{...V,currentPerformanceLabel:S?null:((Z=$[E])==null?void 0:Z.currentLabel)||null,allTimePerformanceLabel:S?null:((Q=$[E])==null?void 0:Q.allTimeLabel)||null,Sessions:Number((V==null?void 0:V.Sessions)||0),"Add To Cart Rate":L((V==null?void 0:V["Add To Cart Rate"])||"0"),"Checkout Rate":L((V==null?void 0:V["Checkout Rate"])||"0"),"Purchase Rate":L((V==null?void 0:V["Purchase Rate"])||"0")}}),[r,$,S]),z=t.useMemo(()=>l?[...h].sort((V,E)=>{const Z=typeof V[l]=="number"?V[l]:parseFloat((V[l]||"0").toString().replace("%","").trim()),Q=typeof E[l]=="number"?E[l]:parseFloat((E[l]||"0").toString().replace("%","").trim());return Z<Q?j==="asc"?-1:1:Z>Q?j==="asc"?1:-1:0}):h,[h,l,j]),_=V=>{H(V)&&(l===V?u(j==="asc"?"desc":"asc"):(o(V),u("asc")))},H=V=>["Add To Cart","Checkouts","Sessions","Purchases","Visitors",...k].includes(V),Y=(V,E)=>{d===V&&M===E?(m(null),v(null)):(m(V),v(E))},W=t.useMemo(()=>{const V=S?z:d?z.filter(E=>M==="current"?E.currentPerformanceLabel===d:M==="allTime"?E.allTimePerformanceLabel===d:!1):z;return b.current=V,V},[z,d,M,S]);t.useEffect(()=>{n&&C(b.current.slice(0,p))},[n]),t.useEffect(()=>{n&&(i.current!==r||d!==null||l!==null)&&(C(b.current.slice(0,p)),i.current=r)},[r,d,l,n]);const J=()=>{if(n&&A.length<b.current.length){const V=b.current.slice(A.length,A.length+p);C(E=>[...E,...V])}},xe=V=>{const E=V.currentTarget;E.scrollHeight-E.scrollTop<=E.clientHeight+100&&J()},Ae=t.useMemo(()=>n?A:W.slice((f-1)*F,f*F),[n,A,W,f,F]),X=Math.ceil(W.length/F),Ne=V=>{const E=Math.max(1,Math.min(V,X));w(E)},Me={"Add To Cart":"Add To Cart Rate",Checkouts:"Checkout Rate",Purchases:"Purchase Rate"};return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:P,className:"rounded-md overflow-x-auto relative border",style:{width:"100%",maxHeight:n?"calc(100vh - 105px)":"calc(100vh - 350px)",overflowX:"auto"},onScroll:n?xe:void 0,children:e.jsxs("table",{ref:c,className:"w-full text-center shadow-lg rounded-lg border border-gray-200",style:{tableLayout:"fixed",width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[s[0]!=="Date"&&a&&e.jsxs("th",{className:"font-bold p-2 text-gray-800 text-sm border-b-2 sticky left-0 bg-gray-100 z-30 border-r border-gray-300",style:{width:`${x[0]+10}px`,minWidth:"200px",position:"sticky",left:0,top:0},children:["Performance Label",e.jsx("div",{onMouseDown:V=>B(0,V),className:`absolute right-0 top-0 bottom-0 w-2 cursor-col-resize hover:bg-blue-200 ${N===0?"bg-blue-300":""}`})]}),s.map((V,E)=>{var R;const Z=E===0,Q=Z&&s[0]==="Date",ae=k.includes(V);return e.jsxs("th",{className:`
            font-bold p-2 text-gray-800 text-sm border-b-2 
            capitalize sticky top-0 bg-gray-100 
            border-r border-gray-300 
            ${H(V)?"cursor-pointer":""}
            ${Q?"sticky left-0 z-30":"z-20"}
            ${Z&&s[0]!=="Date"&&a?"sticky left-[150px]":""}
          `,style:{width:`${x[E]+10}px`,minWidth:"200px",...Z&&{left:Q?0:s[0]!=="Date"&&a?x[0]:0},...Q&&{backgroundColor:"rgb(243 244 246)",zIndex:30}},onClick:()=>_(V),children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx("span",{children:V}),H(V)&&e.jsx("span",{className:"ml-2",children:l===V?j==="asc"?e.jsx(As,{className:"w-4 h-4 text-blue-600"}):e.jsx(Ms,{className:"w-4 h-4 text-blue-600"}):e.jsx(Bs,{className:"w-4 h-4 text-gray-500"})})]}),ae&&y[V]!==void 0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["avg: ",V==="Sessions"?Math.round(y[V]):(R=y[V])==null?void 0:R.toFixed(2),V!=="Sessions"?"%":""]})]}),e.jsx("div",{onMouseDown:K=>B(E,K),className:`absolute right-0 top-0 bottom-0 w-2 cursor-col-resize hover:bg-blue-200 ${N===E?"bg-blue-300":""}`})]},V)})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ae.map((V,E)=>e.jsxs("tr",{className:`${E%2===0?"bg-gray-50":"bg-white"} hover:bg-gray-100 transition-colors duration-200 rounded-md`,children:[s[0]!=="Date"&&a&&e.jsx("td",{className:"p-3 text-sm font-normal sticky left-0 bg-white z-20 shadow-[2px_0_0_0_rgba(0,0,0,0.1)] border-r border-gray-300",style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsxs("div",{className:"flex items-center gap-1 min-w-[150px]",children:[V.currentPerformanceLabel&&e.jsxs("span",{onClick:()=>Y(V.currentPerformanceLabel,"current"),className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium ${V.currentPerformanceLabel==="Current Top"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"} ${d===V.currentPerformanceLabel&&M==="current"?"ring-2 ring-offset-1 ring-opacity-60":""} cursor-pointer`,children:[V.currentPerformanceLabel==="Current Top"?e.jsx(As,{size:12,className:"mr-1"}):e.jsx(Ms,{size:12,className:"mr-1"}),V.currentPerformanceLabel.split(" ")[1]]}),V.allTimePerformanceLabel&&e.jsxs("span",{onClick:()=>Y(V.allTimePerformanceLabel,"allTime"),className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium ${V.allTimePerformanceLabel==="All Time Top"?"bg-blue-100 text-blue-800":"bg-orange-100 text-orange-800"} ${d===V.allTimePerformanceLabel&&M==="allTime"?"ring-2 ring-offset-1 ring-opacity-60":""} cursor-pointer`,children:[V.allTimePerformanceLabel==="All Time Top"?e.jsx(jr,{size:12,className:"mr-1"}):e.jsx(pr,{size:12,className:"mr-1"}),"All-time"]})]})}),e.jsx("td",{className:"p-3 text-sm font-normal sticky left-[150px] bg-white z-20 shadow-[2px_0_0_0_rgba(0,0,0,0.1)] border-r border-gray-300",style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",left:`${s[0]!=="Date"?x[0]:0}px`},children:V[s[0]]}),s.slice(1).map(Z=>{const Q=V[Z],ae=k.includes(Z),R=Z in Me;let K="text-gray-800";if(ae)K=Lt(Q,y[Z]);else if(R){const ee=Me[Z],oe=V[ee];K=Lt(oe,y[ee])}return e.jsx("td",{className:`p-3 text-sm font-normal border-r border-gray-300 ${K}`,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:Z.includes("Rate")?`${Q.toFixed(2)}%`:Q})},Z)})]},E))})]})}),!n&&e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(f-1)*F+1," to ",Math.min(f*F,W.length)," of ",W.length," entries"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>Ne(1),disabled:f===1,children:e.jsx(Ta,{className:"h-4 w-4"})}),e.jsx(D,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>Ne(f-1),disabled:f===1,children:e.jsx(ms,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center justify-center text-sm font-medium",children:["Page ",f," of ",X]}),e.jsx(D,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>Ne(f+1),disabled:f===X,children:e.jsx(Ye,{className:"h-4 w-4"})}),e.jsx(D,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>Ne(X),disabled:f===X,children:e.jsx(ka,{className:"h-4 w-4"})})]})]})]})},ys=ls.memo(zo);function bs({columns:s,onFiltersChange:r,filters:a,setFilters:n}){const[l,o]=t.useState(""),[j,u]=t.useState(">"),[d,m]=t.useState("");t.useEffect(()=>{r(a)},[a,r]);const M=()=>{l&&d&&(n([...a,{column:l,operator:j,value:d}]),o(""),m(""))};return e.jsx("div",{children:e.jsxs(Ue,{children:[e.jsx(He,{asChild:!0,children:e.jsx(D,{variant:"outline",size:"icon",children:e.jsx(gs,{className:"h-4 w-4"})})}),e.jsx(ze,{className:"w-80 p-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs(Pe,{value:l,onValueChange:v=>{o(v)},children:[e.jsx(Fe,{children:e.jsx(Le,{placeholder:"Select column"})}),e.jsx($e,{children:s.map(v=>e.jsx(de,{value:v,children:v},v))})]}),e.jsxs(Pe,{value:j,onValueChange:v=>u(v),children:[e.jsx(Fe,{children:e.jsx(Le,{placeholder:"Select operator"})}),e.jsxs($e,{children:[e.jsx(de,{value:">",children:"Greater than"}),e.jsx(de,{value:"<",children:"Less than"}),e.jsx(de,{value:"=",children:"Equal to"})]})]}),e.jsx(Be,{type:"text",placeholder:"Enter filter value",value:d,onChange:v=>m(v.target.value)}),e.jsx(D,{onClick:M,children:"Add Filter"})]})})]})})}const Ja=t.createContext({tokenError:!1,setTokenError:()=>{}}),Go=({children:s})=>{const[r,a]=t.useState(!1);return e.jsx(Ja.Provider,{value:{tokenError:r,setTokenError:a},children:s})},$s=()=>t.useContext(Ja),ve=()=>{const s=js(),{setTokenError:r}=$s(),a=le.create({baseURL:"https://parallels.messold.com",withCredentials:!0});return a.interceptors.response.use(n=>n,n=>{var l,o;return((l=n.response)==null?void 0:l.status)===401?(localStorage.removeItem("user"),s("/")):((o=n.response)==null?void 0:o.status)===403&&r(!0),Promise.reject(n)}),a},_o=({dateRange:s})=>{const[r,a]=t.useState(s),[n,l]=t.useState([]),[o,j]=t.useState([]),[u,d]=t.useState([]),[m,M]=t.useState(!1),{brandId:v}=re(),x=ve(),[T,N]=t.useState([]),[g,f]=t.useState("50"),[w,A]=t.useState([]),[C,p]=t.useState([]),[F,S]=t.useState(!1),{user:c}=Je(),P=["city","country","region","Visitors","Sessions","Add To Cart","Add To Cart Rate","Checkouts","Checkout Rate","Purchases","Purchase Rate"],O=h=>{N(z=>{const _=z.includes(h)?z.filter(H=>H!==h):[...z,h];return p(H=>["city","region","country"].includes(h)?_.includes(h)?H.filter(Y=>Y!==h):[...H,h]:H),P.filter(H=>_.includes(H))})};t.useEffect(()=>{N(P)},[]),t.useEffect(()=>{a(s)},[s]);const i=t.useCallback(async()=>{M(!0);try{const h=r!=null&&r.from?U(r.from,"yyyy-MM-dd"):"",z=r!=null&&r.to?U(r.to,"yyyy-MM-dd"):"",[_,H]=await Promise.all([x.post(`/api/analytics/locationReport/${v}`,{startDate:h||"",endDate:z||"",userId:c==null?void 0:c.id,limit:g,...C.length>0?{filters:{location:C}}:{}},{withCredentials:!0}),x.post(`/api/analytics/locationReport/${v}`,{startDate:"",endDate:"",userId:c==null?void 0:c.id,limit:g,...C.length>0?{filters:{location:C}}:{}},{withCredentials:!0})]),Y=_.data.data||[],W=H.data.data||[];if(d(Y),j(Y),l(W),Y.length>0){const J=Object.keys(Y[0]);N(xe=>xe.length===0?J:xe.filter(Ae=>J.includes(Ae)))}}catch(h){console.error("Error fetching metrics:",h)}finally{M(!1)}},[v,C,r,g]);t.useEffect(()=>{i();const h=setInterval(i,5*60*1e3);return()=>clearInterval(h)},[i]);const b=()=>{i()},k=()=>{S(!F)},L=t.useMemo(()=>P.filter(h=>T.includes(h)),[P,T]),y=t.useCallback(h=>{let z=[...u];h.forEach(_=>{z=z.filter(H=>{const Y=H[_.column];if([">","<","="].includes(_.operator)){const W=parseFloat(Y),J=parseFloat(_.value);switch(_.operator){case">":return W>J;case"<":return W<J;case"=":return W===J;default:return!0}}return!0})}),j(z)},[u]),I=t.useMemo(()=>o,[o]),$=["Add To Cart","Checkouts","Sessions","Purchases","Purchase Rate","Add To Cart Rate","Checkout Rate"],B=h=>{A(w.filter((z,_)=>_!==h))};return e.jsx(te,{className:`mx-4 ${F?"fixed inset-0 z-50 m-0":""}`,children:e.jsx(ne,{className:"mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Location Analytics"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(D,{onClick:b,disabled:m,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${m?"animate-spin":""}`})}),e.jsxs(Ue,{children:[e.jsx(He,{asChild:!0,children:e.jsx(D,{variant:"outline",size:"icon",children:e.jsx(ps,{className:"h-4 w-4"})})}),e.jsx(ze,{className:"w-56",children:P.map(h=>e.jsxs(Se,{className:"flex items-center space-x-2",children:[e.jsx(hs,{id:`column-${h}`,checked:T.includes(h),onCheckedChange:()=>O(h)}),e.jsx("label",{htmlFor:`column-${h}`,className:"flex-1 cursor-pointer",children:h})]},h))})]}),e.jsx(bs,{columns:$,onFiltersChange:y,filters:w,setFilters:A}),e.jsx(D,{onClick:k,size:"icon",variant:"outline",children:F?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})}),e.jsxs(Ue,{children:[e.jsx(He,{asChild:!0,children:e.jsxs(D,{variant:"outline",children:["Show ",g==="10000"?"all":g," rows",e.jsx(qe,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(ze,{children:[e.jsx(Se,{onSelect:()=>f("50"),children:"Show 50 rows"}),e.jsx(Se,{onSelect:()=>f("100"),children:"Show 100 rows"}),e.jsx(Se,{onSelect:()=>f("10000"),children:"Show all rows"})]})]})]})]}),w.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map((h,z)=>e.jsxs("div",{className:"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:[e.jsx("span",{children:`${h.column} ${h.operator} ${h.value}`}),e.jsx("button",{onClick:()=>B(z),className:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","aria-label":"Remove filter",children:e.jsx(ns,{className:"h-3 w-3"})})]},z))}),e.jsx("div",{className:"rounded-md overflow-hidden",children:m?e.jsx(he,{}):e.jsx(ys,{columns:L,data:I,allTimeData:n,isFullScreen:F})})]})})})},Bo=({dateRange:s})=>{const[r,a]=t.useState(s),[n,l]=t.useState([]),[o,j]=t.useState([]),[u,d]=t.useState([]),[m,M]=t.useState([]),[v,x]=t.useState(!1),{brandId:T}=re(),N=ve(),g=r!=null&&r.from?U(r.from,"yyyy-MM-dd"):"",f=r!=null&&r.to?U(r.to,"yyyy-MM-dd"):"",[w,A]=t.useState([]),[C,p]=t.useState("50"),[F,S]=t.useState(!1),{user:c}=Je();t.useEffect(()=>{a(s)},[s]);const P=h=>{A(z=>{const _=z.includes(h)?z.filter(H=>H!==h):[...z,h];return b.filter(H=>_.includes(H))})},O=t.useCallback(async()=>{x(!0);try{const[h,z]=await Promise.all([N.post(`/api/analytics/landingpageReport/${T}`,{startDate:g||"",endDate:f||"",userId:c==null?void 0:c.id,limit:C},{withCredentials:!0}),N.post(`/api/analytics/landingpageReport/${T}`,{startDate:"",endDate:"",userId:c==null?void 0:c.id,limit:C},{withCredentials:!0})]),_=h.data.data||[],H=z.data.data||[];if(M(_),j(_),l(H),_.length>0){const Y=Object.keys(_[0]);A(W=>W.length===0?Y:W.filter(J=>Y.includes(J)))}}catch(h){console.error("Error fetching data:",h)}finally{x(!1)}},[T,g,f,C]);t.useEffect(()=>{O();const h=setInterval(O,15*60*1e3);return()=>clearInterval(h)},[O]);const i=()=>{O()},b=m.length>0?Object.keys(m[0]):[],k=b.filter(h=>w.includes(h)),L=t.useCallback(h=>{let z=[...m];h.forEach(_=>{z=z.filter(H=>{const Y=H[_.column];if([">","<","="].includes(_.operator)){const W=parseFloat(Y),J=parseFloat(_.value);switch(_.operator){case">":return W>J;case"<":return W<J;case"=":return W===J;default:return!0}}return!0})}),j(z)},[m]),y=t.useMemo(()=>o,[o]),I=["Add To Cart","Checkouts","Sessions","Purchases","Purchase Rate","Add To Cart Rate","Checkout Rate"],$=h=>{d(u.filter((z,_)=>_!==h))},B=()=>{S(!F)};return e.jsx(te,{className:`mx-4 ${F?"fixed inset-0 z-50 m-0":""}`,children:e.jsx(ne,{className:"mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Landing Page Analytics"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(D,{onClick:i,disabled:v,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${v?"animate-spin":""}`})}),e.jsxs(Ue,{children:[e.jsx(He,{asChild:!0,children:e.jsx(D,{variant:"outline",size:"icon",children:e.jsx(ps,{className:"h-4 w-4"})})}),e.jsx(ze,{className:"w-56",children:b.map(h=>e.jsxs(Se,{className:"flex items-center space-x-2",children:[e.jsx(hs,{id:`column-${h}`,checked:w.includes(h),onCheckedChange:()=>P(h)}),e.jsx("label",{htmlFor:`column-${h}`,className:"flex-1 cursor-pointer",children:h})]},h))})]}),e.jsx(bs,{columns:I,onFiltersChange:L,filters:u,setFilters:d}),e.jsx(D,{onClick:B,size:"icon",variant:"outline",children:F?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})}),e.jsxs(Ue,{children:[e.jsx(He,{asChild:!0,children:e.jsxs(D,{variant:"outline",children:["Show ",C==="10000"?"all":C," rows",e.jsx(qe,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(ze,{children:[e.jsx(Se,{onSelect:()=>p("50"),children:"Show 50 rows"}),e.jsx(Se,{onSelect:()=>p("100"),children:"Show 100 rows"}),e.jsx(Se,{onSelect:()=>p("10000"),children:"Show all rows"})]})]})]})]}),u.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map((h,z)=>e.jsxs("div",{className:"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:[e.jsx("span",{children:`${h.column} ${h.operator} ${h.value}`}),e.jsx("button",{onClick:()=>$(z),className:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","aria-label":"Remove filter",children:e.jsx(ns,{className:"h-3 w-3"})})]},z))}),e.jsx("div",{className:"rounded-md overflow-hidden",children:v?e.jsx(he,{}):e.jsx(ys,{columns:k,data:y,allTimeData:n,isFullScreen:F})})]})})})},Vo=({dateRange:s})=>{const[r,a]=t.useState(s),[n,l]=t.useState([]),[o,j]=t.useState([]),[u,d]=t.useState([]),[m,M]=t.useState([]),[v,x]=t.useState(!1),{brandId:T}=re(),N=ve(),g=r!=null&&r.from?U(r.from,"yyyy-MM-dd"):"",f=r!=null&&r.to?U(r.to,"yyyy-MM-dd"):"",[w,A]=t.useState([]),[C,p]=t.useState(!1),[F,S]=t.useState("50"),{user:c}=Je();t.useEffect(()=>{a(s)},[s]);const P=h=>{A(z=>{const _=z.includes(h)?z.filter(H=>H!==h):[...z,h];return b.filter(H=>_.includes(H))})},O=t.useCallback(async()=>{x(!0);try{const[h,z]=await Promise.all([N.post(`/api/analytics/agereport/${T}`,{startDate:g||"",endDate:f||"",userId:c==null?void 0:c.id,limit:F},{withCredentials:!0}),N.post(`/api/analytics/agereport/${T}`,{startDate:"",endDate:"",userId:c==null?void 0:c.id,limit:F},{withCredentials:!0})]),_=h.data.data||[],H=z.data.data||[];if(M(_),l(_),j(H),_.length>0){const Y=Object.keys(_[0]);A(W=>W.length===0?Y:W.filter(J=>Y.includes(J)))}}catch(h){console.error("Error fetching data:",h)}finally{x(!1)}},[T,g,f,F]);t.useEffect(()=>{O();const h=setInterval(O,15*60*1e3);return()=>clearInterval(h)},[O]);const i=()=>{O()},b=m.length>0?Object.keys(m[0]):[],k=b.filter(h=>w.includes(h)),L=t.useCallback(h=>{let z=[...m];h.forEach(_=>{z=z.filter(H=>{const Y=H[_.column];if([">","<","="].includes(_.operator)){const W=parseFloat(Y),J=parseFloat(_.value);switch(_.operator){case">":return W>J;case"<":return W<J;case"=":return W===J;default:return!0}}return!0})}),l(z)},[m]),y=h=>{d(u.filter((z,_)=>_!==h))},I=t.useMemo(()=>n,[n]),$=["Add To Cart","Checkouts","Sessions","Purchases","Purchase Rate","Add To Cart Rate","Checkout Rate"],B=()=>{p(!C)};return e.jsx(te,{className:`mx-4 ${C?"fixed inset-0 z-50 m-0":""}`,children:e.jsx(ne,{className:"mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Age Analytics"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(D,{onClick:i,disabled:v,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${v?"animate-spin":""}`})}),e.jsxs(Ue,{children:[e.jsx(He,{asChild:!0,children:e.jsx(D,{variant:"outline",size:"icon",children:e.jsx(ps,{className:"h-4 w-4"})})}),e.jsx(ze,{className:"w-56",children:b.map(h=>e.jsxs(Se,{className:"flex items-center space-x-2",children:[e.jsx(hs,{id:`column-${h}`,checked:w.includes(h),onCheckedChange:()=>P(h)}),e.jsx("label",{htmlFor:`column-${h}`,className:"flex-1 cursor-pointer",children:h})]},h))})]}),e.jsx(bs,{columns:$,onFiltersChange:L,filters:u,setFilters:d}),e.jsx(D,{onClick:B,size:"icon",variant:"outline",children:C?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})}),e.jsxs(Ue,{children:[e.jsx(He,{asChild:!0,children:e.jsxs(D,{variant:"outline",children:["Show ",F==="10000"?"all":F," rows",e.jsx(qe,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(ze,{children:[e.jsx(Se,{onSelect:()=>S("50"),children:"Show 50 rows"}),e.jsx(Se,{onSelect:()=>S("100"),children:"Show 100 rows"}),e.jsx(Se,{onSelect:()=>S("10000"),children:"Show all rows"})]})]})]})]}),u.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map((h,z)=>e.jsxs("div",{className:"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:[e.jsx("span",{children:`${h.column} ${h.operator} ${h.value}`}),e.jsx("button",{onClick:()=>y(z),className:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","aria-label":"Remove filter",children:e.jsx(ns,{className:"h-3 w-3"})})]},z))}),e.jsx("div",{className:"rounded-md overflow-hidden",children:v?e.jsx(he,{}):e.jsx(ys,{columns:k,data:I,allTimeData:o,isFullScreen:C})})]})})})},Uo=({dateRange:s})=>{const[r,a]=t.useState(s),[n,l]=t.useState([]),[o,j]=t.useState([]),[u,d]=t.useState([]),[m,M]=t.useState([]),[v,x]=t.useState(!1),{brandId:T}=re(),{user:N}=Je(),g=ve(),f=r!=null&&r.from?U(r.from,"yyyy-MM-dd"):"",w=r!=null&&r.to?U(r.to,"yyyy-MM-dd"):"",[A,C]=t.useState([]),[p,F]=t.useState("50"),[S,c]=t.useState(!1);t.useEffect(()=>{a(s)},[s]);const P=h=>{C(z=>{const _=z.includes(h)?z.filter(H=>H!==h):[...z,h];return b.filter(H=>_.includes(H))})},O=t.useCallback(async()=>{x(!0);try{const[h,z]=await Promise.all([g.post(`/api/analytics/genderReport/${T}`,{startDate:f||"",endDate:w||"",userId:N==null?void 0:N.id,limit:p},{withCredentials:!0}),g.post(`/api/analytics/genderReport/${T}`,{startDate:"",endDate:"",userId:N==null?void 0:N.id,limit:p},{withCredentials:!0})]),_=h.data.data||[],H=z.data.data||[];if(M(_),l(_),j(H),_.length>0){const Y=Object.keys(_[0]);C(W=>W.length===0?Y:W.filter(J=>Y.includes(J)))}}catch(h){console.error("Error fetching data:",h)}finally{x(!1)}},[T,f,w,p]);t.useEffect(()=>{O();const h=setInterval(O,15*60*1e3);return()=>clearInterval(h)},[O]);const i=()=>{O()},b=m.length>0?Object.keys(m[0]):[],k=b.filter(h=>A.includes(h)),L=t.useCallback(h=>{let z=[...m];h.forEach(_=>{z=z.filter(H=>{const Y=H[_.column];if([">","<","="].includes(_.operator)){const W=parseFloat(Y),J=parseFloat(_.value);switch(_.operator){case">":return W>J;case"<":return W<J;case"=":return W===J;default:return!0}}return!0})}),l(z)},[m]),y=h=>{d(u.filter((z,_)=>_!==h))},I=t.useMemo(()=>n,[n]),$=["Add To Cart","Checkouts","Sessions","Purchases","Purchase Rate","Add To Cart Rate","Checkout Rate"],B=()=>{c(!S)};return e.jsx(te,{className:`mx-4 ${S?"fixed inset-0 z-50 m-0":""}`,children:e.jsx(ne,{className:"mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Gender Analytics"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(D,{onClick:i,disabled:v,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${v?"animate-spin":""}`})}),e.jsxs(Ue,{children:[e.jsx(He,{asChild:!0,children:e.jsx(D,{variant:"outline",size:"icon",children:e.jsx(ps,{className:"h-4 w-4"})})}),e.jsx(ze,{className:"w-56",children:b.map(h=>e.jsxs(Se,{className:"flex items-center space-x-2",children:[e.jsx(hs,{id:`column-${h}`,checked:A.includes(h),onCheckedChange:()=>P(h)}),e.jsx("label",{htmlFor:`column-${h}`,className:"flex-1 cursor-pointer",children:h})]},h))})]}),e.jsx(bs,{columns:$,onFiltersChange:L,filters:u,setFilters:d}),e.jsx(D,{onClick:B,size:"icon",variant:"outline",children:S?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})}),e.jsxs(Ue,{children:[e.jsx(He,{asChild:!0,children:e.jsxs(D,{variant:"outline",children:["Show ",p==="10000"?"all":p," rows",e.jsx(qe,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(ze,{children:[e.jsx(Se,{onSelect:()=>F("50"),children:"Show 50 rows"}),e.jsx(Se,{onSelect:()=>F("100"),children:"Show 100 rows"}),e.jsx(Se,{onSelect:()=>F("10000"),children:"Show all rows"})]})]})]})]}),u.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map((h,z)=>e.jsxs("div",{className:"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:[e.jsx("span",{children:`${h.column} ${h.operator} ${h.value}`}),e.jsx("button",{onClick:()=>y(z),className:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","aria-label":"Remove filter",children:e.jsx(ns,{className:"h-3 w-3"})})]},z))}),e.jsx("div",{className:"rounded-md overflow-hidden",children:v?e.jsx(he,{}):e.jsx(ys,{columns:k,data:I,allTimeData:o,isFullScreen:S})})]})})})},Ho=({dateRange:s})=>{const[r,a]=t.useState(s),[n,l]=t.useState([]),[o,j]=t.useState([]),[u,d]=t.useState([]),[m,M]=t.useState([]),[v,x]=t.useState(!1),{brandId:T}=re(),N=r!=null&&r.from?U(r.from,"yyyy-MM-dd"):"",g=r!=null&&r.to?U(r.to,"yyyy-MM-dd"):"",[f,w]=t.useState([]),[A,C]=t.useState("50"),[p,F]=t.useState(!1),{user:S}=Je(),c=ve();t.useEffect(()=>{a(s)},[s]);const P=h=>{w(z=>{const _=z.includes(h)?z.filter(H=>H!==h):[...z,h];return b.filter(H=>_.includes(H))})},O=t.useCallback(async()=>{x(!0);try{const[h,z]=await Promise.all([c.post(`/api/analytics/channelReport/${T}`,{startDate:N||"",endDate:g||"",userId:S==null?void 0:S.id,limit:A},{withCredentials:!0}),c.post(`/api/analytics/channelReport/${T}`,{startDate:"",endDate:"",userId:S==null?void 0:S.id,limit:A},{withCredentials:!0})]),_=h.data.data||[],H=z.data.data||[];if(M(_),l(_),j(H),_.length>0){const Y=Object.keys(_[0]);w(W=>W.length===0?Y:W.filter(J=>Y.includes(J)))}}catch(h){console.error("Error fetching data:",h)}finally{x(!1)}},[T,N,g,A]);t.useEffect(()=>{O();const h=setInterval(O,15*60*1e3);return()=>clearInterval(h)},[O]);const i=()=>{O()},b=m.length>0?Object.keys(m[0]):[],k=b.filter(h=>f.includes(h)),L=t.useCallback(h=>{let z=[...m];h.forEach(_=>{z=z.filter(H=>{const Y=H[_.column];if([">","<","="].includes(_.operator)){const W=parseFloat(Y),J=parseFloat(_.value);switch(_.operator){case">":return W>J;case"<":return W<J;case"=":return W===J;default:return!0}}return!0})}),l(z)},[m]),y=t.useMemo(()=>n,[n]),I=["Add To Cart","Checkouts","Sessions","Purchases","Purchase Rate","Add To Cart Rate","Checkout Rate"],$=h=>{d(u.filter((z,_)=>_!==h))},B=()=>{p?document.exitFullscreen():document.documentElement.requestFullscreen(),F(!p)};return t.useEffect(()=>{const h=()=>{F(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",h),()=>{document.removeEventListener("fullscreenchange",h)}},[]),e.jsx(te,{className:`mx-4 ${p?"fixed inset-0 z-50 m-0":""}`,children:e.jsx(ne,{className:"mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Referring Channel Analytics"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(D,{onClick:i,disabled:v,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${v?"animate-spin":""}`})}),e.jsxs(Ue,{children:[e.jsx(He,{asChild:!0,children:e.jsx(D,{variant:"outline",size:"icon",children:e.jsx(ps,{className:"h-4 w-4"})})}),e.jsx(ze,{className:"w-56",children:b.map(h=>e.jsxs(Se,{className:"flex items-center space-x-2",children:[e.jsx(hs,{id:`column-${h}`,checked:f.includes(h),onCheckedChange:()=>P(h)}),e.jsx("label",{htmlFor:`column-${h}`,className:"flex-1 cursor-pointer",children:h})]},h))})]}),e.jsx(bs,{columns:I,onFiltersChange:L,filters:u,setFilters:d}),e.jsx(D,{onClick:B,size:"icon",variant:"outline",children:p?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})}),e.jsxs(Ue,{children:[e.jsx(He,{asChild:!0,children:e.jsxs(D,{variant:"outline",children:["Show ",A==="10000"?"all":A," rows",e.jsx(qe,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(ze,{children:[e.jsx(Se,{onSelect:()=>C("50"),children:"Show 50 rows"}),e.jsx(Se,{onSelect:()=>C("100"),children:"Show 100 rows"}),e.jsx(Se,{onSelect:()=>C("10000"),children:"Show all rows"})]})]})]})]}),u.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map((h,z)=>e.jsxs("div",{className:"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:[e.jsx("span",{children:`${h.column} ${h.operator} ${h.value}`}),e.jsx("button",{onClick:()=>$(z),className:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","aria-label":"Remove filter",children:e.jsx(ns,{className:"h-3 w-3"})})]},z))}),e.jsx("div",{className:"rounded-md overflow-hidden",children:v?e.jsx(he,{}):e.jsx(ys,{columns:k,data:y,allTimeData:o,isFullScreen:p})})]})})})};function Ko(){const{brandId:s}=re();if(!s)return console.error("Brand ID is not defined"),e.jsx("div",{children:"Error: Brand ID is missing"});const r=G(o=>o.date.from),a=G(o=>o.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l={from:n.from?new Date(n.from):void 0,to:n.to?new Date(n.to):void 0};return e.jsxs("div",{className:"bg-gray-100 min-h-screen overflow-hidden",children:[e.jsx("nav",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 px-4 py-4 md:px-6 lg:px-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Segment Dashboard"}),e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{})})]})}),e.jsxs("div",{className:"flex flex-col p-6 gap-6 overflow-auto",children:[e.jsx(ko,{}),e.jsx(Fo,{}),e.jsx($o,{}),e.jsx("section",{className:"mb-6",children:e.jsx(_o,{dateRange:l})}),e.jsx("section",{className:"mb-6",children:e.jsx(Bo,{dateRange:l})}),e.jsx("section",{className:"mb-6",children:e.jsx(Ho,{dateRange:l})}),e.jsx("section",{className:"mb-6",children:e.jsx(Vo,{dateRange:l})}),e.jsx("section",{className:"mb-6",children:e.jsx(Uo,{dateRange:l})})]})]})}const Wo=()=>e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Qe,{}),e.jsx("div",{className:"flex-1 h-screen overflow-auto",children:e.jsx(Ko,{})})]}),Yo=()=>{const s=js(),{toast:r}=Vs(),a=fe(),n="https://parallels.messold.com";return t.useEffect(()=>{(async()=>{try{const o=new URLSearchParams(window.location.search),j=o.get("token"),u=o.get("fbToken"),d=o.get("googleRefreshToken"),m=async(M,v,x)=>(await le.get(`${n}${M}?${x}=${v}`,{withCredentials:!0})).data.success?(console.log(`${x} token updated successfully, redirecting to /dashboard`),s("/dashboard"),!0):(console.error(`Failed to update ${x} token`),r({title:"Update Failed",description:`Unable to update ${x} token.`,variant:"destructive"}),s("/"),!1);if(j){console.log("Token found, proceeding with login");const M=await le.post(`${n}/api/auth/login/oauth?auth_token=${j}`,{email:null,password:null});if(M.data.success){console.log("Login successful, redirecting to /dashboard"),a(at(M.data.user)),s("/dashboard");return}else{console.log("Login failed, redirecting to /"),r({title:"Login Failed",description:"Unable to authenticate with Google.",variant:"destructive"}),s("/");return}}if(u){await m("/api/auth/updateTokens/facebook",u,"fbToken");return}if(d){await m("/api/auth/updateTokens/google",d,"googleRefreshToken");return}console.log("No token present, redirecting to /"),s("/")}catch(o){console.error("Error during OAuth callback:",o),r({title:"Error",description:"An error occurred while handling the login callback.",variant:"destructive"}),s("/")}})()},[s,at,r,n]),null},Zo=({dateRange:s})=>{const r=G($=>$.date.from),a=G($=>$.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),[l,o]=t.useState([]),[j,u]=t.useState([]),[d,m]=t.useState(!1),{brandId:M}=re(),v=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",x=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",[T,N]=t.useState([]),[g,f]=t.useState([]),[w,A]=t.useState(!1),C=G($=>$.user.user),p=fe(),F=ve();t.useEffect(()=>{s&&p(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{w||s&&p(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[w,s]);const S=()=>{A(!w)},c=$=>{N(B=>B.includes($)?B.filter(h=>h!==$):[...B,$])},P=t.useCallback(async()=>{m(!0);try{const B=(await F.post(`/api/analytics/atcreport/${M}`,{startDate:v,endDate:x,userId:C==null?void 0:C.id},{withCredentials:!0})).data.data||[];if(u(B),o(B),B.length>0)if(T.length===0){const h=Object.keys(B[0]);N(h)}else{const h=Object.keys(B[0]);N(z=>z.filter(_=>h.includes(_)))}}catch($){console.error("Error fetching dashboard data:",$)}finally{m(!1)}},[v,x,M]);t.useEffect(()=>{P();const $=setInterval(P,15*60*1e3);return()=>clearInterval($)},[P]);const O=()=>{P()},i=j.length>0?Object.keys(j[0]):[],b=i.filter($=>T.includes($)),k=t.useCallback($=>{let B=[...j];$.forEach(h=>{B=B.filter(z=>{const _=z[h.column];if([">","<","="].includes(h.operator)){const H=parseFloat(_),Y=parseFloat(h.value);switch(h.operator){case">":return H>Y;case"<":return H<Y;case"=":return H===Y;default:return!0}}return!0})}),o(B)},[j]),L=t.useMemo(()=>l,[l]),y=["Add To Cart","Checkouts","Sessions","Purchases","Purchase Rate","Add To Cart Rate","Checkout Rate"],I=$=>{f(g.filter((B,h)=>h!==$))};return e.jsx(te,{className:`mx-4 ${w?"fixed inset-0 z-50 m-0":""}`,children:e.jsx(ne,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Daily E-Commerce Analytics"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[w&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{})}),e.jsx(D,{onClick:O,disabled:d,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${d?"animate-spin":""}`})}),e.jsxs(Ue,{children:[e.jsx(He,{asChild:!0,children:e.jsx(D,{variant:"outline",size:"icon",children:e.jsx(ps,{className:"h-4 w-4"})})}),e.jsx(ze,{className:"w-56",children:i.map($=>e.jsxs(Se,{className:"flex items-center space-x-2",children:[e.jsx(hs,{id:`column-${$}`,checked:T.includes($),onCheckedChange:()=>c($)}),e.jsx("label",{htmlFor:`column-${$}`,className:"flex-1 cursor-pointer",children:$})]},$))})]}),e.jsx(bs,{columns:y,onFiltersChange:k,filters:g,setFilters:f}),e.jsx(D,{onClick:S,size:"icon",variant:"outline",children:w?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),g.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(($,B)=>e.jsxs("div",{className:"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:[e.jsx("span",{children:`${$.column} ${$.operator} ${$.value}`}),e.jsx("button",{onClick:()=>I(B),className:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","aria-label":"Remove filter",children:e.jsx(ns,{className:"h-3 w-3"})})]},B))}),e.jsx("div",{className:"rounded-md overflow-hidden",children:d?e.jsx(he,{}):e.jsx(ys,{columns:b,data:L,isFullScreen:w})})]})})})};function Us(){const{user:s}=Je(),r="https://parallels.messold.com",a=async()=>{try{const n=await le.get(`${r}/api/auth/google?context=userLogin`,{withCredentials:!0}),{authUrl:l}=n.data;window.location.href=l}catch(n){console.error("Error getting Google Auth URL:",n)}};return e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"bg-red-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ba,{className:"w-8 h-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"No GA4 Access Found"}),e.jsx("p",{className:"text-gray-600",children:"The current Google account doesn't have access to any GA4 properties"})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ia,{className:"w-5 h-5 text-amber-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Currently signed in as:"}),e.jsx("p",{className:"font-medium text-gray-900",children:s==null?void 0:s.email})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Please sign in with a Google account that has access to GA4 properties to continue."}),e.jsxs("button",{className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 group",onClick:a,children:["Sign in with a different account",e.jsx(it,{className:"w-4 h-4 group-hover:translate-x-1 transition-transform"})]})]})]})})}function Jo({platform:s,open:r,onOpenChange:a,brandId:n,onSuccess:l}){var k;const[o,j]=t.useState(""),[u,d]=t.useState([]),[m,M]=t.useState([]),[v,x]=t.useState([]),[T,N]=t.useState(!1),[g,f]=t.useState(!1),[w,A]=t.useState([]),C="https://parallels.messold.com",p=G(L=>L.user.user),F=p==null?void 0:p.id;console.log(F),t.useEffect(()=>{r&&n&&(async()=>{var y,I;try{const B=(await le.get(`${C}/api/brands/${n}`,{withCredentials:!0})).data,h=[];(y=B.fbAdAccounts)!=null&&y.length&&h.push(...B.fbAdAccounts),B.googleAdAccount&&h.push(B.googleAdAccount),(I=B.ga4Account)!=null&&I.PropertyID&&h.push(B.ga4Account.PropertyID),A(h)}catch($){console.error("Error fetching connected accounts:",$)}})()},[n,r]),t.useEffect(()=>{(async()=>{var y;if(r){f(!0);try{let I="",$=null;switch(s.toLowerCase()){case"google ads":I="/api/setup/google-accounts",$=d;break;case"google analytics":I="/api/setup/ga4-propertyIds",$=M;break;case"facebook":I="/api/setup/fb-ad-accounts",$=x;break}const B=await le.post(`${C}${I}`,{userId:F},{withCredentials:!0});B.status===200&&(N(!1),s.toLowerCase()==="google ads"?$((y=B.data)==null?void 0:y.clientAccounts.filter(h=>!h.hidden)):s.toLowerCase()==="google analytics"?$(B.data.propertiesList||[]):s.toLowerCase()==="facebook"&&$(B.data.adAccounts||[]))}catch(I){S(I,N)}finally{f(!1)}}})()},[s,F,r]);const S=(L,y)=>{const I=L;if(I.response){const{status:$,data:B}=I.response,h=I.code;$===400||$===403?y(!0):$===401||h==="TOKEN_EXPIRED"?(alert("Your Google session has expired. Please log in again."),y(!0)):(console.error("Unhandled Error Status:",$),console.error("Error Message:",B))}else I.request?console.error("No response received:",I.request):console.error("Unexpected Error:",I.message)},c=async(L,y)=>{try{let I={};switch(s.toLowerCase()){case"facebook":I={fbAdAccounts:[L]};break;case"google ads":I={googleAdAccount:L};break;case"google analytics":I={ga4Account:{PropertyID:L}};break}(await le.patch(`${C}/api/brands/update/${n}`,I,{withCredentials:!0})).status===200&&(l==null||l(s,y,L),a(!1))}catch(I){console.error("Error updating brand:",I)}},P=async L=>{let y,I;if("clientId"in L)y=L.clientId,I=`${L.name} (${y})`;else if("propertyId"in L)y=L.propertyId,I=`${L.propertyName} (${y})`;else if("id"in L)y=L.id,I=`${L.adname}`;else return;await c(y,I)},O=async()=>{try{const L=await le.get(`${C}/api/auth/google?context=brandSetup`,{withCredentials:!0}),{authUrl:y}=L.data;window.location.href=y}catch(L){console.error("Error getting Google Auth URL:",L)}},i=async()=>{try{const L=await le.get(`${C}/api/auth/facebook`,{withCredentials:!0});L.data.success&&(window.location.href=L.data.authURL)}catch(L){console.error("Error getting Facebook Auth URL:",L)}},b=()=>{let L=[];switch(s.toLowerCase()){case"google ads":L=u;break;case"google analytics":L=m;break;case"facebook":L=v;break}return L.filter(y=>("clientId"in y?y.name:"propertyName"in y?y.propertyName:y.adname).toLowerCase().includes(o.toLowerCase()))};return e.jsx(Ba,{open:r,onOpenChange:a,children:e.jsxs(dt,{className:"sm:max-w-[425px]",children:[e.jsx(mt,{children:e.jsxs(ut,{children:["Connect ",s," Account"]})}),e.jsx("div",{className:"space-y-4",children:g?e.jsx("div",{className:"flex justify-center py-4",children:"Loading..."}):T?e.jsxs(D,{size:"sm",onClick:s.toLowerCase()==="facebook"?i:O,className:"flex items-center gap-2 bg-white text-black border border-green-800 hover:bg-green-50",children:[s.toLowerCase()==="google ads"&&e.jsxs(e.Fragment,{children:[e.jsx(Ve,{height:"1rem",width:"1rem"}),"Connect to your Google Ads account"]}),s.toLowerCase()==="google analytics"&&e.jsxs(e.Fragment,{children:[e.jsx(be,{height:"1rem",width:"1rem"}),"Connect to your GA4 account"]}),s.toLowerCase()==="facebook"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{height:"1rem",width:"1rem"}),"Connect to your Facebook account"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx(lt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx(Be,{type:"text",placeholder:"Search accounts...",className:"pl-10",value:o,onChange:L=>j(L.target.value)})]}),e.jsx("div",{className:"max-h-[50vh] overflow-auto",children:(k=b())==null?void 0:k.map(L=>{const y=s.toLowerCase()==="google ads",I=s.toLowerCase()==="facebook",$=y?L.clientId:I?L.id:L.propertyId,B=y?L.name:I?L.adname:L.propertyName,h=y?e.jsx(Ve,{height:"1rem",width:"1rem"}):I?e.jsx(De,{height:"1rem",width:"1rem"}):e.jsx(be,{height:"1rem",width:"1rem"}),z=w.includes($);return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded hover:bg-gray-50",children:[e.jsx("span",{children:e.jsxs("div",{className:"flex flex-row items-center gap-3",children:[h,I?`${B}`:`${B} (${$})`]})}),e.jsxs(D,{size:"sm",onClick:()=>P(L),disabled:z,className:z?"bg-gray-400":"bg-blue-600",children:[z&&e.jsx(fs,{className:"h-4 w-4 mr-2"}),z?"Connected":"Connect"]})]},$)})})]})})]})})}const Xo={"google analytics":{title:"Google Analytics 4",description:"Unlock powerful insights for your store",icon:e.jsx(vr,{className:"h-16 w-16 text-blue-500 animate-bounce"}),benefits:[{icon:e.jsx(Ws,{className:"h-8 w-8 text-primary"}),title:"Real-time Analytics",description:"Track visitor behavior as it happens"},{icon:e.jsx(Ns,{className:"h-8 w-8 text-primary"}),title:"Performance Metrics",description:"Monitor your store's key metrics"},{icon:e.jsx(Cs,{className:"h-8 w-8 text-primary"}),title:"Growth Insights",description:"Make data-driven decisions"}],buttonText:"Connect GA4 Now",guideText:"Need help setting up GA4?"},"google ads":{title:"Google Ads",description:"Supercharge your advertising performance",icon:e.jsx(yr,{className:"h-16 w-16 text-red-500 animate-bounce"}),benefits:[{icon:e.jsx(Ws,{className:"h-8 w-8 text-primary"}),title:"Campaign Tracking",description:"Monitor ad performance in real-time"},{icon:e.jsx(Ns,{className:"h-8 w-8 text-primary"}),title:"Conversion Analytics",description:"Track ROI and conversions"},{icon:e.jsx(Cs,{className:"h-8 w-8 text-primary"}),title:"Budget Optimization",description:"Optimize spending across campaigns"}],buttonText:"Connect Google Ads",guideText:"New to Google Ads?"},facebook:{title:"Facebook Ads",description:"Scale your social media advertising",icon:e.jsx(br,{className:"h-16 w-16 text-blue-600 animate-bounce"}),benefits:[{icon:e.jsx(Ws,{className:"h-8 w-8 text-primary"}),title:"Audience Insights",description:"Understand your target audience"},{icon:e.jsx(Ns,{className:"h-8 w-8 text-primary"}),title:"Ad Performance",description:"Track engagement and reach"},{icon:e.jsx(Cs,{className:"h-8 w-8 text-primary"}),title:"ROAS Tracking",description:"Measure advertising return"}],buttonText:"Connect Facebook Ads",guideText:"First time with Facebook Ads?"}},Hs=({platform:s="google analytics",brandId:r,onSuccess:a})=>{const[n,l]=t.useState(!1),o=Xo[s],j=()=>{l(!0)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-secondary/20 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto w-full space-y-8",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:o.icon}),e.jsxs("h1",{className:"text-4xl font-bold tracking-tight",children:["Connect ",o.title]}),e.jsx("p",{className:"text-xl text-muted-foreground",children:o.description})]}),e.jsx(te,{className:"p-6 bg-card/50 backdrop-blur-sm",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("p",{className:"text-lg text-center",children:["You haven't connected ",o.title," yet. You're missing out on valuable insights about your store's performance!"]}),e.jsx("div",{className:"grid md:grid-cols-3 gap-4 my-8",children:o.benefits.map((u,d)=>e.jsxs("div",{className:"flex flex-col items-center text-center p-4 space-y-2",children:[u.icon,e.jsx("h3",{className:"font-semibold",children:u.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u.description})]},d))}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(D,{size:"lg",className:"group",onClick:j,children:[o.buttonText,e.jsx(it,{className:"ml-2 h-4 w-4 group-hover:translate-x-1 transition-transform"})]})})]})}),e.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:[o.guideText," ",e.jsx("a",{href:"#",className:"text-primary hover:underline",children:"Check out our guide"})]})]})}),e.jsx(Jo,{platform:o.title,open:n,onOpenChange:l,brandId:r,onSuccess:a})]})},Qo=()=>{const{brandId:s}=re(),a=G(m=>m.brand.brands).find(m=>m._id===s),n=(a==null?void 0:a.ga4Account)??!1,{tokenError:l}=$s(),o=G(m=>m.date.from),j=G(m=>m.date.to),u=t.useMemo(()=>({from:o,to:j}),[o,j]),d={from:u.from?new Date(u.from):void 0,to:u.to?new Date(u.to):void 0};return e.jsxs("div",{className:"flex h-screen bg-gray-100",children:[e.jsx(Qe,{}),e.jsx("div",{className:"flex-1 h-screen overflow-auto",children:l?e.jsx(Us,{}):n?e.jsxs(e.Fragment,{children:[e.jsx(us,{title:"E-Commerce Insighhts",Icon:Na,showDatePicker:!0}),e.jsx("section",{className:"my-6",children:e.jsx(Zo,{dateRange:d})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Hs,{platform:"google analytics",brandId:s??"",onSuccess:(m,M,v)=>{console.log(`Successfully connected ${m} account: ${M} (${v})`)}})," "]})})]})};function we({data:s,primaryColumn:r,secondaryColumns:a,monthlyDataKey:n,monthlyMetrics:l,isFullScreen:o,rows:j,isAdsTable:u}){const[d,m]=t.useState(1),[M,v]=t.useState([]),x=j||8,T=30,N=()=>o?u?"max-h-[calc(100vh-90px)]":"max-h-[calc(100vh-130px)]":"max-h-[400px]",g=t.useMemo(()=>{if(!Array.isArray(s))return console.error("Data is not an array:",s),[];const y=$=>["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt($)-1],I=new Set;return s.forEach($=>{const B=$[n];Array.isArray(B)&&B.forEach(h=>{if(h!=null&&h.Month){const z=h.Month.slice(0,4),_=h.Month.slice(4);I.add(`${y(_)}-${z}`)}})}),Array.from(I).reverse()},[s,n]),f=t.useMemo(()=>{const y=[];return s.forEach((I,$)=>{l.forEach((B,h)=>{y.push({dataIndex:$,metricIndex:h})})}),y},[s,l]),w=()=>{v(y=>[...y,...f.slice(y.length,y.length+T)])};t.useEffect(()=>{o&&v(f.slice(0,T))},[o,f]);const A=y=>{const{scrollTop:I,scrollHeight:$,clientHeight:B}=y.currentTarget;$-I<=B+100&&w()},C=t.useMemo(()=>o?M:f.slice((d-1)*x,d*x),[o,f,M,d]),p=t.useMemo(()=>{let y=0,I=0,$=0,B=0,h=0,z=0,_=0,H=0,Y=0;return s.forEach(W=>{typeof W["Total Sessions"]=="number"&&typeof W["Avg Conv. Rate"]=="number"&&(y+=Number(W["Total Sessions"]),I+=Number(W["Avg Conv. Rate"]),$++),typeof W["Total Spend"]=="number"&&typeof W["Total Purchase ROAS"]=="number"&&(B+=Number(W["Total Spend"]),h+=Number(W["Total Purchase ROAS"]),z++),typeof W["Total Cost"]=="number"&&typeof W["Conv. Value / Cost"]=="number"&&(_+=Number(W["Total Cost"]),H+=Number(W["Conv. Value / Cost"]),Y++)}),{avgSessions:$>0?y/$:0,avgConvRate:$>0?I/$:0,avgSpend:z>0?B/z:0,avgPurchaseROAS:z>0?h/z:0,avgCost:Y>0?_/Y:0,avgConvValuePerCost:Y>0?H/Y:0}},[s]);t.useEffect(()=>{o||m(1)},[o]);const F=({sessions:y,convRate:I,spend:$,purchaseROAS:B,cost:h,convValuePerCost:z})=>{const _=y!==void 0&&y>=p.avgSessions,H=I!==void 0&&I>=p.avgConvRate,Y=$!==void 0&&$>=p.avgSpend,W=B!==void 0&&B>=p.avgPurchaseROAS,J=h!==void 0&&h>=p.avgCost,xe=z!==void 0&&z>=p.avgConvValuePerCost;return _&&H?"bg-green-100":_&&!H?"bg-blue-100":!_&&H?"bg-yellow-100":Y&&W?"bg-green-100":Y&&!W?"bg-blue-100":!Y&&W?"bg-yellow-100":J&&xe?"bg-green-100":J&&!xe?"bg-blue-100":!J&&xe?"bg-yellow-100":"bg-red-50"},S=(y,I)=>{if(typeof y=="number")switch(I){case"spend":return Math.round(y).toLocaleString();case"percentage":return`${y.toFixed(2)} %`;default:return y.toFixed(2)}return y},c=(y,I)=>{if(!y)return e.jsx("td",{className:"w-[100px] text-right whitespace-nowrap p-2 text-xs border-r border-border bg-background",children:"-"});const $=y[I];let B="bg-background";return(I==="Sessions"||I==="Conv. Rate")&&typeof y.Sessions=="number"&&typeof y["Conv. Rate"]=="number"&&(B=F({sessions:Number(y.Sessions),convRate:Number(y["Conv. Rate"])})),(I==="Spend"||I==="Purchase ROAS")&&typeof y.Spend=="number"&&typeof y["Purchase ROAS"]=="number"&&(B=F({spend:Number(y.Spend),purchaseROAS:Number(y["Purchase ROAS"])})),(I==="Cost"||I==="Conv. Value/ Cost")&&typeof y.Cost=="number"&&typeof y["Conv. Value/ Cost"]=="number"&&(B=F({cost:Number(y.Cost),convValuePerCost:Number(y["Conv. Value/ Cost"])})),e.jsxs("td",{className:`w-[100px]  text-right whitespace-nowrap p-2 text-xs border-r border-border ${B}`,children:[S($,I.toLowerCase().includes("rate")?"percentage":I.toLowerCase().includes("spend")||I.toLowerCase().includes("cost")?"spend":"default"),I==="Conv. Rate"&&e.jsx("div",{className:"text-xs text-muted-foreground",children:`Purchases: ${y.Purchases??0}`}),I==="Cost"&&e.jsx("div",{className:"text-xs text-muted-foreground",children:`clicks: ${y.Clicks??0}`}),I==="Conv. Value/ Cost"&&e.jsx("div",{className:"text-xs text-muted-foreground",children:`conv. rate: ${Number(y["Conversion Rate"]).toFixed(2)??0} %`}),I==="Purchase ROAS"&&e.jsx("div",{className:"text-xs text-muted-foreground",children:`PCV: ${Number(y["Purchase Conversion Value"]).toFixed(2)??0}`})]})},P=(y,I,$,B)=>{const h=y[I];if(typeof h!="number")return e.jsx("td",{className:"sticky top-0 min-w-[130px] p-2 text-xs border-r border-border bg-background",style:{left:`${230+B*130}px`},children:""});let z="bg-background";if($&&I&&(I.includes("Sessions")||I.includes("Rate"))){const W=y["Total Sessions"],J=y["Avg Conv. Rate"];z=F({sessions:W,convRate:J})}if($&&I&&(I.includes("Spend")||I.includes("ROAS"))){const W=y["Total Spend"],J=y["Total Purchase ROAS"];z=F({spend:W,purchaseROAS:J})}if($&&I&&(I.includes("Cost")||I.includes("Conv. Value / Cost"))){const W=y["Total Cost"],J=y["Conv. Value / Cost"];z=F({cost:W,convValuePerCost:J})}const _=typeof y["Total Purchases"]=="number"?y["Total Purchases"].toLocaleString():null,H=typeof y["Total Conv. Value"]=="number"?y["Total Conv. Value"].toFixed(2):null,Y=typeof y["Total PCV"]=="number"?y["Total PCV"].toFixed(2):null;return e.jsx("td",{className:`sticky top-0 min-w-[130px] p-2 text-xs border-r border-border ${z}`,style:{left:`${230+B*130}px`},children:$.toLowerCase()==="cost"&&I==="Total Cost"?e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{children:S(h,"spend")})}):$.toLowerCase()==="conv. value/ cost"&&I==="Conv. Value / Cost"?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:S(h)}),H&&e.jsxs("span",{className:"text-xs text-gray-500 mt-1",children:["Total Conv. Value: ",H]})]}):$.toLowerCase()==="sessions"&&I.includes("Sessions")?S(h):$.toLowerCase()==="conv. rate"&&I.includes("Rate")?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:S(h,"percentage")}),_&&e.jsxs("span",{className:"text-xs text-gray-500 mt-1",children:["Total Purchases: ",_]})]}):$.toLowerCase()==="spend"&&I.includes("Total Spend")?S(h,"spend"):$.toLowerCase()=="purchase roas"&&I.includes("Total Purchase ROAS")?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:S(h)}),Y&&e.jsxs("span",{className:"text-xs text-gray-500 mt-1",children:["Total PCV: ",Y]})]}):""})},O=(y,I)=>{const $=l[I];let B="bg-background";if(a){const h=y["Total Sessions"],z=y["Avg Conv. Rate"],_=y["Total Spend"],H=y["Total Purchase ROAS"],Y=y["Total Cost"],W=y["Conv. Value / Cost"];$==="Sessions"||$==="Conv. Rate"?B=F({sessions:h,convRate:z}):$==="Spend"||$==="Purchase ROAS"?B=F({spend:_,purchaseROAS:H}):($==="Cost"||$==="Conv. Value/ Cost")&&(B=F({cost:Y,convValuePerCost:W}))}return e.jsxs("tr",{children:[e.jsx("td",{className:`sticky left-0 min-w-[130px] max-w-[200px] p-2 text-xs border-r border-border ${B}`,children:I===0&&(typeof y[r]=="string"||typeof y[r]=="number")?S(y[r]):""}),e.jsx("td",{className:`sticky left-[130px] min-w-[100px] whitespace-nowrap p-2 text-xs border-r border-border ${B}`,children:$}),a==null?void 0:a.map((h,z)=>P(y,h,$,z)),g.map(h=>{const z=xe=>["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].indexOf(xe)+1,[_,H]=h.split("-"),Y=z(_),W=`${H}${Y.toString().padStart(2,"0")}`,J=y[n].find(xe=>xe.Month===W);return c(J,$)})]},`${y[r]}-${$}`)},i=f.length,b=Math.ceil(i/x),k=y=>{const I=Math.max(1,Math.min(y,b));m(I)},L=(y,I)=>{let $="";return y==="Total Sessions"?$=`(avg: ${Math.round(p.avgSessions).toLocaleString()})`:y==="Avg Conv. Rate"?$=`(avg: ${p.avgConvRate.toFixed(2)}%)`:y==="Total Spend"?$=`(avg: ${Math.round(p.avgSpend).toLocaleString()})`:y==="Total Purchase ROAS"?$=`(avg: ${Math.round(p.avgPurchaseROAS).toFixed(2)})`:y==="Total Cost"?$=`(avg: ${Math.round(p.avgCost).toLocaleString()})`:y==="Conv. Value / Cost"&&($=`(avg: ${Math.round(p.avgConvValuePerCost).toFixed(2)})`),e.jsx("th",{className:"sticky top-0 min-w-[130px] w-[150px] z-20 px-2 py-2.5 text-left text-sm font-semibold text-black/70 border-r border-border bg-slate-100",style:{left:`${230+I*130}px`},children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:y}),$&&e.jsx("span",{className:"text-xs text-muted-foreground font-normal",children:$})]})},y)};return e.jsxs("div",{className:"w-full border border-border rounded-lg flex flex-col",children:[e.jsx("div",{className:`relative overflow-x-auto ${N()}`,onScroll:o?A:void 0,children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 top-0 min-w-[130px]  w-[150px] z-20 px-2 py-2.5 text-left text-sm font-semibold text-black/70 border-r border-border bg-slate-100",children:r}),e.jsx("th",{className:"sticky left-[130px] top-0 min-w-[100px] w-[150px] z-20 px-2 py-2.5 text-left text-sm font-semibold text-black/70 border-r border-border bg-slate-100",children:"Metric"}),a==null?void 0:a.map((y,I)=>L(y,I)),g.map(y=>e.jsx("th",{className:"sticky top-0 min-w-[100px] z-10 px-2 py-2.5 text-right text-sm font-semibold text-black/70 whitespace-nowrap border-r border-border bg-zinc-50",children:y},y))]})}),e.jsx("tbody",{className:"divide-y divide-border",children:C.map(({dataIndex:y,metricIndex:I})=>O(s[y],I))})]})}),!o&&e.jsxs("div",{className:"border-t border-border p-2.5 flex items-center justify-between bg-background",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(d-1)*x+1,"-",Math.min(d*x,i)," of ",i," rows"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>k(1),disabled:d===1,children:e.jsx(Ta,{className:"h-4 w-4"})}),e.jsx(D,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>k(d-1),disabled:d===1,children:e.jsx(ms,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center justify-center text-sm",children:["Page ",d," of ",b]}),e.jsx(D,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>k(d+1),disabled:d===b,children:e.jsx(Ye,{className:"h-4 w-4"})}),e.jsx(D,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>k(b),disabled:d===b,children:e.jsx(ka,{className:"h-4 w-4"})})]})]})]})}const Ee=({data:s,primaryColumn:r})=>{var j,u;const[a,n]=t.useState(null),l=t.useMemo(()=>{let d=0,m=0,M=0;return s.forEach(v=>{typeof v["Total Sessions"]=="number"&&typeof v["Avg Conv. Rate"]=="number"&&(d+=Number(v["Total Sessions"]),m+=Number(v["Avg Conv. Rate"]),M++)}),{avgSessions:d/M,avgConvRate:m/M}},[s]),o=t.useMemo(()=>{const d={"Top Performers":[],"High Traffic":[],"Good Converters":[],Underperformers:[]};return s.forEach(m=>{const M=Number(m["Total Sessions"]),v=Number(m["Avg Conv. Rate"]),x=String(m[r]),T=M>=l.avgSessions,N=v>=l.avgConvRate;T&&N?d["Top Performers"].push(x):T&&!N?d["High Traffic"].push(x):!T&&N?d["Good Converters"].push(x):d.Underperformers.push(x)}),[{name:"Top Performers",color:"text-green-700",bgColor:"bg-green-100",count:d["Top Performers"].length,items:d["Top Performers"]},{name:"High Traffic",color:"text-blue-700",bgColor:"bg-blue-100",count:d["High Traffic"].length,items:d["High Traffic"]},{name:"Good Converters",color:"text-yellow-700",bgColor:"bg-yellow-100",count:d["Good Converters"].length,items:d["Good Converters"]},{name:"Underperformers",color:"text-red-700",bgColor:"bg-red-50",count:d.Underperformers.length,items:d.Underperformers}]},[s,l,r]);return e.jsxs("div",{className:"my-2.5 border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"flex items-stretch h-9",children:o.map(d=>e.jsx("div",{className:`relative flex-grow ${d.bgColor} cursor-pointer transition-all duration-300 ease-in-out`,onClick:()=>n(a===d.name?null:d.name),children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:`text-xs font-medium ${d.color} ${a===d.name?"underline":""}`,children:[d.name," (",d.count,")"]})})},d.name))}),a&&e.jsxs("div",{className:"p-4 bg-white border-t border-gray-200",children:[e.jsx("h3",{className:`text-lg font-semibold mb-2 ${(j=o.find(d=>d.name===a))==null?void 0:j.color}`,children:a}),e.jsx("ul",{className:"grid grid-cols-4 list-disc pl-5 max-h-40 overflow-y-auto gap-4",children:(u=o.find(d=>d.name===a))==null?void 0:u.items.map((d,m)=>e.jsx("li",{className:"text-sm mb-1 break-words w-full",children:d},m))})]})]})},qo={green:{patternType:"solid",fgColor:{rgb:"DCFCE7"}},blue:{patternType:"solid",fgColor:{rgb:"DBEAFE"}},yellow:{patternType:"solid",fgColor:{rgb:"FEF9C3"}},red:{patternType:"solid",fgColor:{rgb:"FEF2F2"}},header:{patternType:"solid",fgColor:{rgb:"F1F5F9"}}},el=s=>{let r=0,a=0,n=0;return s.forEach(l=>{typeof l["Total Sessions"]=="number"&&typeof l["Avg Conv. Rate"]=="number"&&(r+=Number(l["Total Sessions"]),a+=Number(l["Avg Conv. Rate"]),n++)}),{avgSessions:r/n,avgConvRate:a/n}},sl=(s,r,a,n,l)=>{if((s==="Sessions"||s==="Conv. Rate")&&typeof r=="number"&&typeof a=="number"){const o=r>=n.avgSessions,j=a>=n.avgConvRate;return o&&j?l.green:o&&!j?l.blue:!o&&j?l.yellow:l.red}},tl=(s,r,a,n,l,o,j,u)=>{const d=is.utils.decode_range(s["!ref"]||"A1");for(let m=d.s.c;m<=d.e.c;m++){const M=is.utils.encode_cell({r:0,c:m});s[M]||(s[M]={v:""}),s[M].s={fill:j.header,font:{bold:!0,color:{rgb:"64748B"}},alignment:{horizontal:"left"}}}r.forEach((m,M)=>{o.forEach((v,x)=>{const T=M*o.length+x+2,N=2,g=a.length+n.length+1;for(let f=N;f<=g;f++){const w=is.utils.encode_cell({r:T-1,c:f});s[w]||(s[w]={v:""});let A={font:{color:{rgb:"000000"}},alignment:{horizontal:"right"},format:v==="Conv. Rate"?"0.00%":"#,##0"},C,p;if(f<N+n.length)C=m["Total Sessions"],p=m["Avg Conv. Rate"];else{const S=f-(N+n.length),c=a[S],P=m[l].find(O=>`${O.Month.slice(0,4)}-${O.Month.slice(4)}`===c);P&&(C=P.Sessions,p=P["Conv. Rate"])}const F=sl(v,C,p,u,j);F&&(A.fill=F),s[w].s=A}})})},Oe=({data:s,fileName:r,primaryColumn:a,secondaryColumns:n,monthlyDataKey:l,monthlyMetrics:o,buttonClassName:j="",disabled:u=!1})=>{const d=()=>{const m=is.utils.book_new(),M=[],v=el(s),x=Array.from(new Set(s.flatMap(f=>f[l].map(w=>`${w.Month.slice(0,4)}-${w.Month.slice(4)}`)))).sort().reverse(),T=[a,"Metric",...n,...x];M.push(T),s.forEach(f=>{o.forEach(w=>{const A=[];A.push(w===o[0]?f[a]:""),A.push(w),n.forEach(C=>{const p=f[C];A.push(typeof p=="number"?Number(p.toFixed(2)):null)}),x.forEach(C=>{const p=f[l].find(S=>`${S.Month.slice(0,4)}-${S.Month.slice(4)}`===C),F=p?p[w]:null;A.push(typeof F=="number"?Number(F.toFixed(2)):null)}),M.push(A)})});const N=is.utils.aoa_to_sheet(M);tl(N,s,x,n,l,o,qo,v);const g=[{wch:20},{wch:12},...n.map(()=>({wch:15})),...x.map(()=>({wch:12}))];N["!cols"]=g,is.utils.book_append_sheet(m,N,"Conversion Data"),is.writeFile(m,`${r}.xlsx`)};return e.jsx(D,{onClick:d,size:"icon",variant:"outline",className:j,disabled:u,children:e.jsx(wr,{className:"h-4 w-4"})})},al={},Xa=_s({name:"conversionFilters",initialState:al,reducers:{setFilter:(s,r)=>{const{componentId:a,column:n,filter:l}=r.payload;s[a]||(s[a]={}),JSON.stringify(s[a][n])!==JSON.stringify(l)&&(s[a][n]=l)},clearFilters:(s,r)=>{const a=r.payload;Object.keys(s[a]||{}).length>0&&(s[a]={})}}}),{setFilter:nl,clearFilters:rl}=Xa.actions,ol=Xa.reducer,ll=["Total Sessions","Avg Conv Rate","Total Cost","Conv. Value / Cost"];function Te({componentId:s,availableColumns:r=ll}){const a=fe(),n=G(f=>f.conversionFilters[s]||{}),[l,o]=t.useState(r[0]),[j,u]=t.useState(">"),[d,m]=t.useState(void 0),[M,v]=t.useState(!1),x=()=>{if(d===void 0||isNaN(d)){alert("Please enter a valid value");return}a(nl({componentId:s,column:l,filter:{value:d,operator:j}})),v(!1)},T=()=>{a(rl(s)),o(r[0]),u(">"),m(void 0),v(!1)},N=Object.values(n).some(f=>f!==null),g=Object.entries(n).filter(([f,w])=>w!==null).map(([f,w])=>`${f}: ${w==null?void 0:w.operator} ${w==null?void 0:w.value}`).join(", ");return e.jsx(ct,{children:e.jsxs(Ts,{open:N,children:[e.jsxs(Ue,{open:M,onOpenChange:v,children:[e.jsx(He,{asChild:!0,children:e.jsx(ks,{children:e.jsx(D,{variant:"outline",size:"icon",children:e.jsx(gs,{className:`h-4 w-4 ${N?"text-blue-500":""}`})})})}),e.jsxs(ze,{className:"w-80 p-4 flex flex-col gap-4",children:[e.jsxs(Pe,{onValueChange:f=>o(f),value:l,children:[e.jsx(Fe,{children:e.jsx(Le,{placeholder:"Select Column"})}),e.jsx($e,{children:r.map(f=>e.jsx(de,{value:f,children:f},f))})]}),e.jsxs(Pe,{onValueChange:u,value:j,children:[e.jsx(Fe,{children:e.jsx(Le,{placeholder:"Select Operator"})}),e.jsxs($e,{children:[e.jsx(de,{value:">",children:"Greater Than ( > )"}),e.jsx(de,{value:">=",children:"Greater Than or Equal To ( >= )"}),e.jsx(de,{value:"<",children:"Less Than ( < )"}),e.jsx(de,{value:"<=",children:"Less Than or Equal To ( <= )"}),e.jsx(de,{value:"==",children:"Equal To ( == )"})]})]}),e.jsx(Be,{type:"number",placeholder:"Enter Value",value:d===void 0?"":d,onChange:f=>m(parseFloat(f.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex flex-row gap-2 items-center justify-center w-full",children:[e.jsx(D,{onClick:x,className:"w-full",children:"Add Filter"}),e.jsx(D,{variant:"destructive",className:"w-full",onClick:T,children:"Clear"})]})]})]}),e.jsx(vs,{children:g})]})})}const il=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(!1),v="device-conversion",x=G(i=>i.user.user,me),{brandId:T}=re(),N=()=>{M(!m)},g=ve(),f=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",w=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",A=G(i=>i.conversionFilters[v]||{},me),C=t.useMemo(()=>Object.entries(A).reduce((i,[b,k])=>{if(k){const L={"Total Sessions":"sessionsFilter","Avg Conv Rate":"convRateFilter"}[b]||b;i[L]=k}return i},{}),[A]),p=t.useCallback(async()=>{d(!0);try{const b=(await g.post(`/api/analytics/deviceTypeConversionReport/${T}`,{userId:x==null?void 0:x.id,startDate:f,endDate:w,...C})).data||[];j(b)}catch(i){console.error("Error fetching data:",i)}finally{d(!1)}},[T,f,w,C,x==null?void 0:x.id]);t.useEffect(()=>{p();const i=setInterval(p,15*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const F=()=>{p()},S="Device",c=["Total Sessions","Avg Conv. Rate"],P="MonthlyData",O=["Sessions","Conv. Rate"];return e.jsx(te,{className:`${m?"fixed inset-0 z-50 m-0":""}`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Device based Conversion"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}})}),e.jsx(D,{onClick:F,disabled:u,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(Te,{componentId:v}),e.jsx(Oe,{data:(o==null?void 0:o.data)||[],fileName:`${S}_Conversion_Report`,primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,disabled:u}),e.jsx(D,{onClick:N,size:"icon",variant:"outline",children:m?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:u?e.jsx(he,{}):e.jsxs("div",{children:[e.jsx(Ee,{data:(o==null?void 0:o.data)||[],primaryColumn:S}),e.jsx(we,{data:(o==null?void 0:o.data)||[],primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,isFullScreen:m})]})})]})})},cl=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(!1),v="gender-conversion",x=G(i=>i.user.user,me),{brandId:T}=re(),N=()=>{M(!m)},g=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",f=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",w=ve(),A=G(i=>i.conversionFilters[v]||{},me),C=t.useMemo(()=>Object.entries(A).reduce((i,[b,k])=>{if(k){const L={"Total Sessions":"sessionsFilter","Avg Conv Rate":"convRateFilter"}[b]||b;i[L]=k}return i},{}),[A]),p=t.useCallback(async()=>{d(!0);try{const b=(await w.post(`/api/analytics/genderConversionReport/${T}`,{userId:x==null?void 0:x.id,startDate:g,endDate:f,...C})).data||[];j(b)}catch(i){console.error("Error fetching data:",i)}finally{d(!1)}},[T,g,f,C,x==null?void 0:x.id]);t.useEffect(()=>{p();const i=setInterval(p,15*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const F=()=>{p()},S="Gender",c=["Total Sessions","Avg Conv. Rate"],P="MonthlyData",O=["Sessions","Conv. Rate"];return e.jsx(te,{className:`${m?"fixed inset-0 z-50 m-0":""}`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Gender based Conversion"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}})}),e.jsx(D,{onClick:F,disabled:u,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(Te,{componentId:v}),e.jsx(Oe,{data:(o==null?void 0:o.data)||[],fileName:`${S}_Conversion_Report`,primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,disabled:u}),e.jsx(D,{onClick:N,size:"icon",variant:"outline",children:m?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:u?e.jsx(he,{}):e.jsxs("div",{children:[e.jsx(Ee,{data:(o==null?void 0:o.data)||[],primaryColumn:S}),e.jsx(we,{data:(o==null?void 0:o.data)||[],primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,isFullScreen:m})]})})]})})},dl=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),[l,o]=t.useState(null),[j,u]=t.useState(!0),[d,m]=t.useState(!1),M=fe(),v="age-conversion",x=G(i=>i.conversionFilters[v]||{},me),T=G(i=>i.user.user,me),{brandId:N}=re(),g=()=>{m(!d)},f=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",w=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",A=ve(),C=t.useMemo(()=>Object.entries(x).reduce((i,[b,k])=>{if(k){const L={"Total Sessions":"sessionsFilter","Avg Conv Rate":"convRateFilter"}[b]||b;i[L]=k}return i},{}),[x]),p=t.useCallback(async()=>{u(!0);try{const b=(await A.post(`/api/analytics/ageConversionReport/${N}`,{userId:T==null?void 0:T.id,startDate:f,endDate:w,...C},{withCredentials:!0})).data||[];o(b)}catch(i){console.error("Error fetching data:",i)}finally{u(!1)}},[N,f,w,C,T==null?void 0:T.id]);t.useEffect(()=>{p();const i=setInterval(p,15*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&M(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{d||s&&M(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[d,s]);const F=()=>{p()},S="Age",c=["Total Sessions","Avg Conv. Rate"],P="MonthlyData",O=["Sessions","Conv. Rate"];return e.jsx(te,{className:`${d?"fixed inset-0 z-50 m-0":""}`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Age based Conversion"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[d&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}})}),e.jsx(D,{onClick:F,disabled:j,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${j?"animate-spin":""}`})}),e.jsx(Te,{componentId:v}),e.jsx(Oe,{data:(l==null?void 0:l.data)||[],fileName:`${S}_Conversion_Report`,primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,disabled:j}),e.jsx(D,{onClick:g,size:"icon",variant:"outline",children:d?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:j?e.jsx(he,{}):e.jsxs("div",{children:[e.jsx(Ee,{data:(l==null?void 0:l.data)||[],primaryColumn:S}),e.jsx(we,{data:(l==null?void 0:l.data)||[],primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,isFullScreen:d})]})})]})})},ml=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(!1),v="interest-conversion",x=G(i=>i.user.user,me),{brandId:T}=re(),N=()=>{M(!m)},g=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",f=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",w=ve(),A=G(i=>i.conversionFilters[v]||{},me),C=t.useMemo(()=>Object.entries(A).reduce((i,[b,k])=>{if(k){const L={"Total Sessions":"sessionsFilter","Avg Conv Rate":"convRateFilter"}[b]||b;i[L]=k}return i},{}),[A]),p=t.useCallback(async()=>{d(!0);try{const b=(await w.post(`/api/analytics/interestConversionReport/${T}`,{userId:x==null?void 0:x.id,startDate:g,endDate:f,...C})).data||[];j(b)}catch(i){console.error("Error fetching data:",i)}finally{d(!1)}},[T,g,f,C,x==null?void 0:x.id]);t.useEffect(()=>{p();const i=setInterval(p,15*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const F=()=>{p()},S="Interest",c=["Total Sessions","Avg Conv. Rate"],P="MonthlyData",O=["Sessions","Conv. Rate"];return e.jsx(te,{className:`${m?"fixed inset-0 z-50 m-0":""}`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Interest based Conversion"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}})}),e.jsx(D,{onClick:F,disabled:u,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(Te,{componentId:v}),e.jsx(Oe,{data:(o==null?void 0:o.data)||[],fileName:`${S}_Conversion_Report`,primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,disabled:u}),e.jsx(D,{onClick:N,size:"icon",variant:"outline",children:m?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:u?e.jsx(he,{}):e.jsxs("div",{children:[e.jsx(Ee,{data:(o==null?void 0:o.data)||[],primaryColumn:S}),e.jsx(we,{data:(o==null?void 0:o.data)||[],primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,isFullScreen:m})]})})]})})},ul=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(!1),v="operatingSystem-conversion",x=G(i=>i.user.user,me),{brandId:T}=re(),N=()=>{M(!m)},g=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",f=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",w=ve(),A=G(i=>i.conversionFilters[v]||{},me),C=t.useMemo(()=>Object.entries(A).reduce((i,[b,k])=>{if(k){const L={"Total Sessions":"sessionsFilter","Avg Conv Rate":"convRateFilter"}[b]||b;i[L]=k}return i},{}),[A]),p=t.useCallback(async()=>{d(!0);try{const b=(await w.post(`/api/analytics/operatingSystemConversionReport/${T}`,{userId:x==null?void 0:x.id,startDate:g,endDate:f,...C})).data||[];j(b)}catch(i){console.error("Error fetching data:",i)}finally{d(!1)}},[T,g,f,C,x==null?void 0:x.id]);t.useEffect(()=>{p();const i=setInterval(p,15*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const F=()=>{p()},S="Operating System",c=["Total Sessions","Avg Conv. Rate"],P="MonthlyData",O=["Sessions","Conv. Rate"];return e.jsx(te,{className:`${m?"fixed inset-0 z-50 m-0":""} overflow-auto`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Operating System based Conversion"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}})}),e.jsx(D,{onClick:F,disabled:u,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(Te,{componentId:v}),e.jsx(Oe,{data:(o==null?void 0:o.data)||[],fileName:`${S}_Conversion_Report`,primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,disabled:u}),e.jsx(D,{onClick:N,size:"icon",variant:"outline",children:m?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:u?e.jsx(he,{}):e.jsxs("div",{children:[e.jsx(Ee,{data:(o==null?void 0:o.data)||[],primaryColumn:S}),e.jsx(we,{data:(o==null?void 0:o.data)||[],primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,isFullScreen:m})]})})]})})},hl=({dateRange:s})=>{const r=G(k=>k.date.from),a=G(k=>k.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(!1),v="browser-conversion",x=G(k=>k.user.user),{brandId:T}=re(),N=()=>{M(!m)},{sessionsFilter:g,convRateFilter:f}=G(k=>k.conversionFilters[v]||{sessionsFilter:null,convRateFilter:null}),w=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",A=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",C=ve(),p=G(k=>k.conversionFilters[v]||{},me),F=t.useMemo(()=>Object.entries(p).reduce((k,[L,y])=>{if(y){const I={"Total Sessions":"sessionsFilter","Avg Conv Rate":"convRateFilter"}[L]||L;k[I]=y}return k},{}),[p]),S=t.useCallback(async()=>{d(!0);try{const L=(await C.post(`/api/analytics/browserConversionReport/${T}`,{userId:x==null?void 0:x.id,startDate:w,endDate:A,sessionsFilter:g,convRateFilter:f})).data||[];j(L)}catch(k){console.error("Error fetching data:",k)}finally{d(!1)}},[T,w,A,F,x==null?void 0:x.id]);t.useEffect(()=>{S();const k=setInterval(S,15*60*1e3);return()=>clearInterval(k)},[S]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const c=()=>{S()},P="Browser",O=["Total Sessions","Avg Conv. Rate"],i="MonthlyData",b=["Sessions","Conv. Rate"];return e.jsx(te,{className:`${m?"fixed inset-0 z-50 m-0":""}`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Browser based Conversion"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}})}),e.jsx(D,{onClick:c,disabled:u,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(Te,{componentId:v}),e.jsx(Oe,{data:(o==null?void 0:o.data)||[],fileName:`${P}_Conversion_Report`,primaryColumn:P,secondaryColumns:O,monthlyDataKey:i,monthlyMetrics:b,disabled:u}),e.jsx(D,{onClick:N,size:"icon",variant:"outline",children:m?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:u?e.jsx(he,{}):e.jsxs("div",{children:[e.jsx(Ee,{data:(o==null?void 0:o.data)||[],primaryColumn:P}),e.jsx(we,{data:(o==null?void 0:o.data)||[],primaryColumn:P,secondaryColumns:O,monthlyDataKey:i,monthlyMetrics:b,isFullScreen:m})]})})]})})},xl=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(!1),v="source-conversion",x=G(i=>i.user.user,me),{brandId:T}=re(),N=()=>{M(!m)},g=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",f=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",w=ve(),A=G(i=>i.conversionFilters[v]||{},me),C=t.useMemo(()=>Object.entries(A).reduce((i,[b,k])=>{if(k){const L={"Total Sessions":"sessionsFilter","Avg Conv Rate":"convRateFilter"}[b]||b;i[L]=k}return i},{}),[A]),p=t.useCallback(async()=>{d(!0);try{const b=(await w.post(`/api/analytics/sourceConversionReport/${T}`,{userId:x==null?void 0:x.id,startDate:g,endDate:f,...C})).data||[];j(b)}catch(i){console.error("Error fetching data:",i)}finally{d(!1)}},[T,g,f,C,x==null?void 0:x.id]);t.useEffect(()=>{p();const i=setInterval(p,15*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const F=()=>{p()},S="Source",c=["Total Sessions","Avg Conv. Rate"],P="MonthlyData",O=["Sessions","Conv. Rate"];return e.jsx(te,{className:`${m?"fixed inset-0 z-50 m-0":""}`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Source based Conversion"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}})}),e.jsx(D,{onClick:F,disabled:u,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(Te,{componentId:v}),e.jsx(Oe,{data:(o==null?void 0:o.data)||[],fileName:`${S}_Conversion_Report`,primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,disabled:u}),e.jsx(D,{onClick:N,size:"icon",variant:"outline",children:m?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:u?e.jsx(he,{}):e.jsxs("div",{children:[e.jsx(Ee,{data:(o==null?void 0:o.data)||[],primaryColumn:S}),e.jsx(we,{data:(o==null?void 0:o.data)||[],primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,isFullScreen:m})]})})]})})},fl=()=>{const s=G(g=>g.date.from),r=G(g=>g.date.to),a=t.useMemo(()=>({from:s,to:r}),[s,r]),{brandId:n}=re(),o=G(g=>g.brand.brands).find(g=>g._id===n),j=(o==null?void 0:o.ga4Account)??!1,{tokenError:u}=$s(),[d,m]=t.useState("age"),M=t.useRef(null),v=[{color:"bg-green-100",condition:"High Traffic, High Conversion"},{color:"bg-blue-100",condition:"High Traffic, Low Conversion"},{color:"bg-yellow-100",condition:"Low Traffic, High Conversion"},{color:"bg-red-50",condition:"Low Traffic, Low Conversion"}],x=[{label:"Age",value:"age"},{label:"Gender",value:"gender"},{label:"Interest",value:"interest"},{label:"Device",value:"device"},{label:"Operating System",value:"operatingSystem"},{label:"Browser",value:"browser"},{label:"Source",value:"source"}],T={age:t.useRef(null),gender:t.useRef(null),interest:t.useRef(null),device:t.useRef(null),operatingSystem:t.useRef(null),browser:t.useRef(null),source:t.useRef(null)};t.useEffect(()=>{if(!M.current)return;const g=new IntersectionObserver(f=>{f.forEach(w=>{if(w.isIntersecting){const A=w.target.id;m(A)}})},{root:M.current,threshold:.7,rootMargin:"0px 0px 0px 0px"});return Object.keys(T).forEach(f=>{const w=T[f].current;w&&g.observe(w)}),()=>g.disconnect()},[]);const N=g=>{m(g);const f=T[g];if(f.current&&M.current){const C=f.current.getBoundingClientRect().top-140;M.current.scrollBy({top:C,behavior:"smooth"})}};return u?e.jsx(Us,{}):!j&&!j?e.jsx(Hs,{platform:"google analytics",brandId:n??"",onSuccess:(g,f,w)=>{console.log(`Successfully connected ${g} account: ${f} (${w})`)}}):e.jsxs("div",{className:"flex h-screen bg-gray-100",children:[e.jsx(Qe,{}),e.jsxs("div",{className:"flex-1 h-screen overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex-none",children:[e.jsx(us,{title:"Audience & Traffic sources",Icon:ot,showDatePicker:!0,showColorPalette:!0,colorInfo:v}),e.jsx("div",{className:"bg-white px-6 sticky top-0 z-10",children:e.jsx(Fs,{tabs:x,activeTab:d,onTabChange:N})})]}),e.jsx("div",{ref:M,className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"px-6 py-4 space-y-6",children:[e.jsx("div",{id:"age",ref:T.age,children:e.jsx(dl,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})}),e.jsx("div",{id:"gender",ref:T.gender,children:e.jsx(cl,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})}),e.jsx("div",{id:"interest",ref:T.interest,children:e.jsx(ml,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})}),e.jsx("div",{id:"device",ref:T.device,children:e.jsx(il,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})}),e.jsx("div",{id:"operatingSystem",ref:T.operatingSystem,children:e.jsx(ul,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})}),e.jsx("div",{id:"browser",ref:T.browser,children:e.jsx(hl,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})}),e.jsx("div",{id:"source",ref:T.source,children:e.jsx(xl,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})})]})})]})]})},gl=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(!1),v="city-conversion",x=G(i=>i.user.user,me),{brandId:T}=re(),N=()=>{M(!m)},g=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",f=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",w=ve(),A=G(i=>i.conversionFilters[v]||{},me),C=t.useMemo(()=>Object.entries(A).reduce((i,[b,k])=>{if(k){const L={"Total Sessions":"sessionsFilter","Avg Conv Rate":"convRateFilter"}[b]||b;i[L]=k}return i},{}),[A]),p=t.useCallback(async()=>{d(!0);try{const b=(await w.post(`/api/analytics/cityConversionReport/${T}`,{userId:x==null?void 0:x.id,startDate:g,endDate:f,...C})).data||[];j(b)}catch(i){console.error("Error fetching data:",i)}finally{d(!1)}},[T,g,f,C,x==null?void 0:x.id]);t.useEffect(()=>{p();const i=setInterval(p,15*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const F=()=>{p()},S="City",c=["Total Sessions","Avg Conv. Rate"],P="MonthlyData",O=["Sessions","Conv. Rate"];return e.jsx(te,{className:`${m?"fixed inset-0 z-50 m-0":""} overflow-auto`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"City based Conversion"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}})}),e.jsx(D,{onClick:F,disabled:u,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(Te,{componentId:v}),e.jsx(Oe,{data:(o==null?void 0:o.data)||[],fileName:`${S}_Conversion_Report`,primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,disabled:u}),e.jsx(D,{onClick:N,size:"icon",variant:"outline",children:m?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:u?e.jsx(he,{}):e.jsxs("div",{children:[e.jsx(Ee,{data:(o==null?void 0:o.data)||[],primaryColumn:S}),e.jsx(we,{data:(o==null?void 0:o.data)||[],primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,isFullScreen:m})]})})]})})},jl=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(!1),v="channel-conversion",x=G(i=>i.user.user,me),{brandId:T}=re(),N=()=>{M(!m)},g=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",f=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",w=ve(),A=G(i=>i.conversionFilters[v]||{},me),C=t.useMemo(()=>Object.entries(A).reduce((i,[b,k])=>{if(k){const L={"Total Sessions":"sessionsFilter","Avg Conv Rate":"convRateFilter"}[b]||b;i[L]=k}return i},{}),[A]),p=t.useCallback(async()=>{d(!0);try{const b=(await w.post(`/api/analytics/channelConversionReport/${T}`,{userId:x==null?void 0:x.id,startDate:g,endDate:f,...C})).data||[];j(b)}catch(i){console.error("Error fetching data:",i)}finally{d(!1)}},[T,g,f,C,x==null?void 0:x.id]);t.useEffect(()=>{p();const i=setInterval(p,15*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const F=()=>{p()},S="Channel",c=["Total Sessions","Avg Conv. Rate"],P="MonthlyData",O=["Sessions","Conv. Rate"];return e.jsx(te,{className:`${m?"fixed inset-0 z-50 m-0":""}`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Channel based Conversion"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}})}),e.jsx(D,{onClick:F,disabled:u,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(Te,{componentId:v}),e.jsx(Oe,{data:(o==null?void 0:o.data)||[],fileName:`${S}_Conversion_Report`,primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,disabled:u}),e.jsx(D,{onClick:N,size:"icon",variant:"outline",children:m?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:u?e.jsx(he,{}):e.jsxs("div",{children:[e.jsx(Ee,{data:(o==null?void 0:o.data)||[],primaryColumn:S}),e.jsx(we,{data:(o==null?void 0:o.data)||[],primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,isFullScreen:m})]})})]})})},pl=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(!1),v="region-conversion",x=G(i=>i.user.user,me),{brandId:T}=re(),N=()=>{M(!m)},g=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",f=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",w=ve(),A=G(i=>i.conversionFilters[v]||{},me),C=t.useMemo(()=>Object.entries(A).reduce((i,[b,k])=>{if(k){const L={"Total Sessions":"sessionsFilter","Avg Conv Rate":"convRateFilter"}[b]||b;i[L]=k}return i},{}),[A]),p=t.useCallback(async()=>{d(!0);try{const b=(await w.post(`/api/analytics/regionConversionReport/${T}`,{userId:x==null?void 0:x.id,startDate:g,endDate:f,...C})).data||[];j(b)}catch(i){console.error("Error fetching data:",i)}finally{d(!1)}},[T,g,f,C,x==null?void 0:x.id]);t.useEffect(()=>{p();const i=setInterval(p,15*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const F=()=>{p()},S="Region",c=["Total Sessions","Avg Conv. Rate"],P="MonthlyData",O=["Sessions","Conv. Rate"];return e.jsx(te,{className:`${m?"fixed inset-0 z-50 m-0":""}`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Region based Conversion"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}})}),e.jsx(D,{onClick:F,disabled:u,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(Te,{componentId:v}),e.jsx(Oe,{data:(o==null?void 0:o.data)||[],fileName:`${S}_Conversion_Report`,primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,disabled:u}),e.jsx(D,{onClick:N,size:"icon",variant:"outline",children:m?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:u?e.jsx(he,{}):e.jsxs("div",{children:[e.jsx(Ee,{data:(o==null?void 0:o.data)||[],primaryColumn:S}),e.jsx(we,{data:(o==null?void 0:o.data)||[],primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,isFullScreen:m})]})})]})})},vl=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(!1),v="landingPage-conversion",x=G(i=>i.user.user,me),{brandId:T}=re(),N=()=>{M(!m)},g=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",f=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",w=ve(),A=G(i=>i.conversionFilters[v]||{},me),C=t.useMemo(()=>Object.entries(A).reduce((i,[b,k])=>{if(k){const L={"Total Sessions":"sessionsFilter","Avg Conv Rate":"convRateFilter"}[b]||b;i[L]=k}return i},{}),[A]),p=t.useCallback(async()=>{d(!0);try{const b=(await w.post(`/api/analytics/pageConversionReport/${T}`,{userId:x==null?void 0:x.id,startDate:g,endDate:f,...C})).data||[];j(b)}catch(i){console.error("Error fetching data:",i)}finally{d(!1)}},[T,g,f,C,x==null?void 0:x.id]);t.useEffect(()=>{p();const i=setInterval(p,15*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const F=()=>{p()},S="Landing Page",c=["Total Sessions","Avg Conv. Rate"],P="MonthlyData",O=["Sessions","Conv. Rate"];return e.jsx(te,{className:`${m?"fixed inset-0 z-50 m-0":""} overflow-auto`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Landing Page based Conversion"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}})}),e.jsx(D,{onClick:F,disabled:u,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(Te,{componentId:v}),e.jsx(Oe,{data:(o==null?void 0:o.data)||[],fileName:`${S}_Conversion_Report`,primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,disabled:u}),e.jsx(D,{onClick:N,size:"icon",variant:"outline",children:m?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:u?e.jsx(he,{}):e.jsxs("div",{children:[e.jsx(Ee,{data:(o==null?void 0:o.data)||[],primaryColumn:S}),e.jsx(we,{data:(o==null?void 0:o.data)||[],primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,isFullScreen:m})]})})]})})},yl=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(!1),v="campaign-conversion",x=G(i=>i.user.user,me),{brandId:T}=re(),N=()=>{M(!m)},g=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",f=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",w=ve(),A=G(i=>i.conversionFilters[v]||{},me),C=t.useMemo(()=>Object.entries(A).reduce((i,[b,k])=>{if(k){const L={"Total Sessions":"sessionsFilter","Avg Conv Rate":"convRateFilter"}[b]||b;i[L]=k}return i},{}),[A]),p=t.useCallback(async()=>{d(!0);try{const b=(await w.post(`/api/analytics/campaignConversionReport/${T}`,{userId:x==null?void 0:x.id,startDate:g,endDate:f,...C})).data||[];j(b)}catch(i){console.error("Error fetching data:",i)}finally{d(!1)}},[T,g,f,C,x==null?void 0:x.id]);t.useEffect(()=>{p();const i=setInterval(p,15*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const F=()=>{p()},S="Campaign",c=["Total Sessions","Avg Conv. Rate"],P="MonthlyData",O=["Sessions","Conv. Rate"];return e.jsx(te,{className:`${m?"fixed inset-0 z-50 m-0":""}`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Campaign based Conversion"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}})}),e.jsx(D,{onClick:F,disabled:u,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(Te,{componentId:v}),e.jsx(Oe,{data:(o==null?void 0:o.data)||[],fileName:`${S}_Conversion_Report`,primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,disabled:u}),e.jsx(D,{onClick:N,size:"icon",variant:"outline",children:m?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:u?e.jsx(he,{}):e.jsxs("div",{children:[e.jsx(Ee,{data:(o==null?void 0:o.data)||[],primaryColumn:S}),e.jsx(we,{data:(o==null?void 0:o.data)||[],primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,isFullScreen:m})]})})]})})},bl=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(!1),v="pagePath-conversion",x=G(i=>i.user.user,me),{brandId:T}=re(),N=()=>{M(!m)},g=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",f=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",w=ve(),A=G(i=>i.conversionFilters[v]||{},me),C=t.useMemo(()=>Object.entries(A).reduce((i,[b,k])=>{if(k){const L={"Total Sessions":"sessionsFilter","Avg Conv Rate":"convRateFilter"}[b]||b;i[L]=k}return i},{}),[A]),p=t.useCallback(async()=>{d(!0);try{const b=(await w.post(`/api/analytics/pagePathConversionReport/${T}`,{userId:x==null?void 0:x.id,startDate:g,endDate:f,...C})).data||[];j(b)}catch(i){console.error("Error fetching data:",i)}finally{d(!1)}},[T,g,f,C,x==null?void 0:x.id]);t.useEffect(()=>{p();const i=setInterval(p,5*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const F=()=>{p()},S="Page Path",c=["Total Sessions","Avg Conv. Rate"],P="MonthlyData",O=["Sessions","Conv. Rate"];return e.jsx(te,{className:`${m?"fixed inset-0 z-50 m-0":""} overflow-auto`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Page path based Conversion"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}})}),e.jsx(D,{onClick:F,disabled:u,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(Te,{componentId:v}),e.jsx(Oe,{data:(o==null?void 0:o.data)||[],fileName:`${S}_Conversion_Report`,primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,disabled:u}),e.jsx(D,{onClick:N,size:"icon",variant:"outline",children:m?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:u?e.jsx(he,{}):e.jsxs("div",{children:[e.jsx(Ee,{data:(o==null?void 0:o.data)||[],primaryColumn:S}),e.jsx(we,{data:(o==null?void 0:o.data)||[],primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,isFullScreen:m})]})})]})})},wl=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(!1),v="pageTitle-conversion",x=G(i=>i.user.user,me),{brandId:T}=re(),N=()=>{M(!m)},g=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",f=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",w=ve(),A=G(i=>i.conversionFilters[v]||{},me),C=t.useMemo(()=>Object.entries(A).reduce((i,[b,k])=>{if(k){const L={"Total Sessions":"sessionsFilter","Avg Conv Rate":"convRateFilter"}[b]||b;i[L]=k}return i},{}),[A]),p=t.useCallback(async()=>{d(!0);try{const b=(await w.post(`/api/analytics/pageTitleConversionReport/${T}`,{userId:x==null?void 0:x.id,startDate:g,endDate:f,...C},{withCredentials:!0})).data||[];j(b)}catch(i){console.error("Error fetching data:",i)}finally{d(!1)}},[T,g,f,C,x==null?void 0:x.id]);t.useEffect(()=>{p();const i=setInterval(p,15*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const F=()=>{p()},S="Page Title",c=["Total Sessions","Avg Conv. Rate"],P="MonthlyData",O=["Sessions","Conv. Rate"];return e.jsx(te,{className:`${m?"fixed inset-0 z-50 m-0":""} overflow-auto`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Page Title based Conversion"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}})}),e.jsx(D,{onClick:F,disabled:u,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(Te,{componentId:v}),e.jsx(Oe,{data:(o==null?void 0:o.data)||[],fileName:`${S}_Conversion_Report`,primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,disabled:u}),e.jsx(D,{onClick:N,size:"icon",variant:"outline",children:m?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:u?e.jsx(he,{}):e.jsxs("div",{children:[e.jsx(Ee,{data:(o==null?void 0:o.data)||[],primaryColumn:S}),e.jsx(we,{data:(o==null?void 0:o.data)||[],primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,isFullScreen:m})]})})]})})},Nl=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(!1),v="country-conversion",x=G(i=>i.user.user,me),{brandId:T}=re(),N=()=>{M(!m)},g=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",f=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",w=ve(),A=G(i=>i.conversionFilters[v]||{},me),C=t.useMemo(()=>Object.entries(A).reduce((i,[b,k])=>{if(k){const L={"Total Sessions":"sessionsFilter","Avg Conv Rate":"convRateFilter"}[b]||b;i[L]=k}return i},{}),[A]),p=t.useCallback(async()=>{d(!0);try{const b=(await w.post(`/api/analytics/countryConversionReport/${T}`,{userId:x==null?void 0:x.id,startDate:g,endDate:f,...C})).data||[];j(b)}catch(i){console.error("Error fetching data:",i)}finally{d(!1)}},[T,g,f,C,x==null?void 0:x.id]);t.useEffect(()=>{p();const i=setInterval(p,15*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const F=()=>{p()},S="Country",c=["Total Sessions","Avg Conv. Rate"],P="MonthlyData",O=["Sessions","Conv. Rate"];return e.jsx(te,{className:`${m?"fixed inset-0 z-50 m-0":""}`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Country based Conversion"}),e.jsx(be,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{defaultDate:{from:new Date(new Date().getFullYear(),new Date().getMonth(),1),to:new Date}})}),e.jsx(D,{onClick:F,disabled:u,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(Te,{componentId:v}),e.jsx(Oe,{data:(o==null?void 0:o.data)||[],fileName:`${S}_Conversion_Report`,primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,disabled:u}),e.jsx(D,{onClick:N,size:"icon",variant:"outline",children:m?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:u?e.jsx(he,{}):e.jsxs("div",{children:[e.jsx(Ee,{data:(o==null?void 0:o.data)||[],primaryColumn:S}),e.jsx(we,{data:(o==null?void 0:o.data)||[],primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,isFullScreen:m})]})})]})})},Cl=()=>{const s=G(g=>g.date.from),r=G(g=>g.date.to),a=t.useMemo(()=>({from:s,to:r}),[s,r]),{brandId:n}=re(),o=G(g=>g.brand.brands).find(g=>g._id===n),j=(o==null?void 0:o.ga4Account)??!1,{tokenError:u}=$s(),[d,m]=t.useState("channel"),M=t.useRef(null),v=[{color:"bg-green-100",condition:"High Traffic, High Conversion"},{color:"bg-blue-100",condition:"High Traffic, Low Conversion"},{color:"bg-yellow-100",condition:"Low Traffic, High Conversion"},{color:"bg-red-50",condition:"Low Traffic, Low Conversion"}],x=[{label:"Channel",value:"channel"},{label:"Campaign",value:"campaign"},{label:"Country",value:"country"},{label:"City",value:"city"},{label:"Region",value:"region"},{label:"Landing Page",value:"landingPage"},{label:"Page Path",value:"pagePath"},{label:"Page Title",value:"pageTitle"}],T={country:t.useRef(null),city:t.useRef(null),region:t.useRef(null),channel:t.useRef(null),campaign:t.useRef(null),landingPage:t.useRef(null),pagePath:t.useRef(null),pageTitle:t.useRef(null)};t.useEffect(()=>{if(!M.current)return;const g=new IntersectionObserver(f=>{f.forEach(w=>{if(w.isIntersecting){const A=w.target.id;m(A)}})},{root:M.current,threshold:.7,rootMargin:"0px 0px 0px 0px"});return Object.keys(T).forEach(f=>{const w=T[f].current;w&&g.observe(w)}),()=>g.disconnect()},[]);const N=g=>{m(g);const f=T[g];if(f.current&&M.current){const C=f.current.getBoundingClientRect().top-140;M.current.scrollBy({top:C,behavior:"smooth"})}};return u?e.jsx(Us,{}):!j&&!j?e.jsx(Hs,{platform:"google analytics",brandId:n??"",onSuccess:(g,f,w)=>{console.log(`Successfully connected ${g} account: ${f} (${w})`)}}):e.jsxs("div",{className:"flex h-screen bg-gray-100",children:[e.jsx(Qe,{}),e.jsxs("div",{className:"flex-1 h-screen overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex-none",children:[e.jsx(us,{title:"Campaign and Website Performance",Icon:ot,showDatePicker:!0,showColorPalette:!0,colorInfo:v}),e.jsx("div",{className:"bg-white px-6 sticky top-0 z-10",children:e.jsx(Fs,{tabs:x,activeTab:d,onTabChange:N})})]}),e.jsx("div",{ref:M,className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"px-6 py-4 space-y-6",children:[e.jsx("div",{id:"channel",ref:T.channel,children:e.jsx(jl,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})}),e.jsx("div",{id:"campaign",ref:T.campaign,children:e.jsx(yl,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})}),e.jsx("div",{id:"country",ref:T.country,children:e.jsx(Nl,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})}),e.jsx("div",{id:"city",ref:T.city,children:e.jsx(gl,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})}),e.jsx("div",{id:"region",ref:T.region,children:e.jsx(pl,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})}),e.jsx("div",{id:"landingPage",ref:T.landingPage,children:e.jsx(vl,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})}),e.jsx("div",{id:"pagePath",ref:T.pagePath,children:e.jsx(bl,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})}),e.jsx("div",{id:"pageTitle",ref:T.pageTitle,children:e.jsx(wl,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})})]})})]})]})},Sl=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(!1),v=G(i=>i.user.user,me),{brandId:x}=re(),T=()=>{M(!m)},N=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",g=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",f=ve(),w="google-ads-search-term",A=G(i=>i.conversionFilters[w]||{},me),C=t.useMemo(()=>Object.entries(A).reduce((i,[b,k])=>{if(k){const L={"Total Cost":"costFilter","Conv. Value / Cost":"convValuePerCostFilter"}[b]||b;i[L]=k}return i},{}),[A]),p=t.useCallback(async()=>{var i;d(!0);try{const k=((i=(await f.post(`/api/segment/searchTerm/${x}`,{userId:v==null?void 0:v.id,startDate:N,endDate:g,...C})).data)==null?void 0:i.data)||[];j({reportType:"Search Term",data:k})}catch(b){console.error("Error fetching data:",b)}finally{d(!1)}},[x,N,g,v==null?void 0:v.id,C]);t.useEffect(()=>{p();const i=setInterval(p,15*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const F=()=>{p()},S="Search Term",c=["Total Cost","Conv. Value / Cost"],P="MonthlyData",O=["Cost","Conv. Value/ Cost"];return e.jsx(te,{className:`${m?"fixed inset-0 z-50 m-0":""}`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Search Term Insights"}),e.jsx(Ve,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{})}),e.jsx(D,{onClick:F,disabled:u,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(Te,{componentId:w,availableColumns:["Total Cost","Conv. Value / Cost"]}),e.jsx(D,{onClick:T,size:"icon",variant:"outline",children:m?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:u?e.jsx(he,{}):e.jsx("div",{children:e.jsx(we,{data:(o==null?void 0:o.data)||[],primaryColumn:S,secondaryColumns:c,monthlyDataKey:P,monthlyMetrics:O,isFullScreen:m,isAdsTable:!0})})})]})})},Al=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),[l,o]=t.useState(null),[j,u]=t.useState(!0),[d,m]=t.useState(!1),M=fe(),v=G(i=>i.user.user,me),{brandId:x}=re(),T=()=>{m(!d)},N=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",g=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",f=ve(),w="google-ads-age",A=G(i=>i.conversionFilters[w]||{},me),C=t.useMemo(()=>Object.entries(A).reduce((i,[b,k])=>{if(k){const L={"Total Cost":"costFilter","Conv. Value / Cost":"convValuePerCostFilter"}[b]||b;i[L]=k}return i},{}),[A]),p=t.useCallback(async()=>{u(!0);try{const b=(await f.post(`/api/segment/age/${x}`,{userId:v==null?void 0:v.id,startDate:N,endDate:g,...C},{withCredentials:!0})).data||[];o(b)}catch(i){console.error("Error fetching data:",i)}finally{u(!1)}},[x,N,g,C,v==null?void 0:v.id]);t.useEffect(()=>{p();const i=setInterval(p,15*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&M(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{d||s&&M(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[d,s]);const F=()=>{p()},S="Age Range",c="MonthlyData",P=["Total Cost","Conv. Value / Cost"],O=["Cost","Conv. Value/ Cost"];return e.jsx(te,{className:`${d?"fixed inset-0 z-50 m-0":""}`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Age Insights"}),e.jsx(Ve,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[d&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{})}),e.jsx(D,{onClick:F,disabled:j,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${j?"animate-spin":""}`})}),e.jsx(Te,{componentId:w,availableColumns:["Total Cost","Conv. Value / Cost"]}),e.jsx(D,{onClick:T,size:"icon",variant:"outline",children:d?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:j?e.jsx(he,{}):e.jsx("div",{children:e.jsx(we,{data:(l==null?void 0:l.data)||[],primaryColumn:S,secondaryColumns:P,monthlyDataKey:c,monthlyMetrics:O,isFullScreen:d,isAdsTable:!0})})})]})})},Ml=({dateRange:s})=>{const r=G(i=>i.date.from),a=G(i=>i.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),[l,o]=t.useState(null),[j,u]=t.useState(!0),[d,m]=t.useState(!1),M=fe(),v=G(i=>i.user.user),{brandId:x}=re(),T=()=>{m(!d)},N=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",g=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",f=ve(),w="google-ads-gender",A=G(i=>i.conversionFilters[w]||{},me),C=t.useMemo(()=>Object.entries(A).reduce((i,[b,k])=>{if(k){const L={"Total Cost":"costFilter","Conv. Value / Cost":"convValuePerCostFilter"}[b]||b;i[L]=k}return i},{}),[A]),p=t.useCallback(async()=>{u(!0);try{const b=(await f.post(`/api/segment/gender/${x}`,{userId:v==null?void 0:v.id,startDate:N,endDate:g,...C},{withCredentials:!0})).data||[];o(b)}catch(i){console.error("Error fetching data:",i)}finally{u(!1)}},[x,N,g,C,v==null?void 0:v.id]);t.useEffect(()=>{p();const i=setInterval(p,15*60*1e3);return()=>clearInterval(i)},[p]),t.useEffect(()=>{s&&M(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{d||s&&M(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[d,s]);const F=()=>{p()},S="Gender",c="MonthlyData",P=["Total Cost","Conv. Value / Cost"],O=["Cost","Conv. Value/ Cost"];return e.jsx(te,{className:`${d?"fixed inset-0 z-50 m-0":""}`,children:e.jsxs(ne,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Gender Insights"}),e.jsx(Ve,{})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[d&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{})}),e.jsx(D,{onClick:F,disabled:j,size:"icon",variant:"outline",children:e.jsx(ce,{className:`h-4 w-4 ${j?"animate-spin":""}`})}),e.jsx(Te,{componentId:w,availableColumns:["Total Cost","Conv. Value / Cost"]}),e.jsx(D,{onClick:T,size:"icon",variant:"outline",children:d?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"rounded-md overflow-hidden",children:j?e.jsx(he,{}):e.jsx("div",{children:e.jsx(we,{data:(l==null?void 0:l.data)||[],primaryColumn:S,secondaryColumns:P,monthlyDataKey:c,monthlyMetrics:O,isFullScreen:d,isAdsTable:!0})})})]})})},Il=()=>{const s=G(N=>N.date.from),r=G(N=>N.date.to),a=t.useMemo(()=>({from:s,to:r}),[s,r]),[n,l]=t.useState("searchterm"),o=t.useRef(null),j=G(N=>N.brand.brands),{brandId:u}=re(),d=j.find(N=>N._id===u),m=d!=null&&d.googleAdAccount?d.googleAdAccount.length>0:!1,{tokenError:M}=$s(),v=[{label:"Search Term",value:"searchterm"},{label:"Age",value:"age"},{label:"Gender",value:"gender"}],x={searchterm:t.useRef(null),age:t.useRef(null),gender:t.useRef(null)};t.useEffect(()=>{if(!o.current)return;const N=new IntersectionObserver(g=>{g.forEach(f=>{if(f.isIntersecting){const w=f.target.id;l(w)}})},{root:o.current,threshold:.7,rootMargin:"0px 0px 0px 0px"});return Object.keys(x).forEach(g=>{const f=x[g].current;f&&N.observe(f)}),()=>N.disconnect()},[]);const T=N=>{l(N);const g=x[N];if(g.current&&o.current){const A=g.current.getBoundingClientRect().top-140;o.current.scrollBy({top:A,behavior:"smooth"})}};return e.jsxs("div",{className:"flex h-screen bg-gray-100",children:[e.jsx(Qe,{}),e.jsx("div",{className:"flex-1 h-screen overflow-hidden flex flex-col",children:M?e.jsx(Us,{}):m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-none",children:[e.jsx(us,{showDatePicker:!0,Icon:Nr,title:"Google Ads Reports"}),e.jsx("div",{className:"bg-white px-6 sticky top-0 z-10",children:e.jsx(Fs,{tabs:v,activeTab:n,onTabChange:T})})]}),e.jsx("div",{ref:o,className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"px-6 py-4 space-y-6",children:[e.jsx("div",{id:"searchterm",ref:x.searchterm,children:e.jsx(Sl,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})}),e.jsx("div",{id:"age",ref:x.age,children:e.jsx(Al,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})}),e.jsx("div",{id:"gender",ref:x.gender,children:e.jsx(Ml,{dateRange:{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}})})]})})]}):e.jsx(e.Fragment,{children:e.jsx(Hs,{platform:"google ads",brandId:u??"",onSuccess:(N,g,f)=>{console.log(`Successfully connected ${N} account: ${g} (${f})`)}})})})]})},Tl=({dateRange:s})=>{const r=G(c=>c.date.from),a=G(c=>c.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),[l,o]=t.useState(null),[j,u]=t.useState(!0),[d,m]=t.useState(""),M=fe(),v=G(c=>c.user.user),{brandId:x}=re(),T=c=>{m(d===c?"":c)},N=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",g=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",f=ve(),w=t.useCallback(async()=>{u(!0);try{const P=(await f.post(`/api/fbReport/audience/${x}`,{userId:v==null?void 0:v.id,startDate:N,endDate:g},{withCredentials:!0})).data||[];o(P)}catch(c){console.error("Error fetching data:",c)}finally{u(!1)}},[x,N,g]);t.useEffect(()=>{w();const c=setInterval(w,15*60*1e3);return()=>clearInterval(c)},[w]),t.useEffect(()=>{s&&M(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{d||s&&M(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[d,s]);const A=()=>{w()},C="Audience Segments",p="MonthlyData",F=["Total Spend","Total Purchase ROAS"],S=["Spend","Purchase ROAS"];return e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{}),e.jsx("div",{children:e.jsx("h2",{className:"text-xl font-semibold tracking-tight",children:"Audience Segments Insights"})})]})}),j?e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx(he,{})}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:l==null?void 0:l.data.map((c,P)=>e.jsxs(te,{className:`${d===c.account_name?"fixed inset-0 z-50 m-0 bg-background p-2 overflow-auto":"rounded-md"}`,children:[e.jsx(ke,{className:"bg-white rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full"}),e.jsx(Re,{className:"text-lg font-medium",children:c.account_name})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[d&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{})}),e.jsx(D,{onClick:A,disabled:j,size:"sm",variant:"outline",className:"hover:bg-muted",children:e.jsx(ce,{className:`h-4 w-4 ${j?"animate-spin":""}`})}),e.jsx(D,{onClick:()=>T(c.account_name),size:"sm",variant:"outline",className:"hover:bg-muted",children:d===c.account_name?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]})}),e.jsx(ne,{className:"p-0",children:e.jsx("div",{className:"rounded-b-lg overflow-hidden px-2.5 pb-2.5",children:e.jsx(we,{data:c.audienceData,primaryColumn:C,secondaryColumns:F,monthlyDataKey:p,monthlyMetrics:S,isFullScreen:d===c.account_name,isAdsTable:!0})})})]},P))})]})},kl=({dateRange:s})=>{const r=G(c=>c.date.from),a=G(c=>c.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(""),v=G(c=>c.user.user),{brandId:x}=re(),T=c=>{M(m===c?"":c)},N=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",g=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",f=ve(),w=t.useCallback(async()=>{d(!0);try{const P=(await f.post(`/api/fbReport/placement/${x}`,{userId:v==null?void 0:v.id,startDate:N,endDate:g},{withCredentials:!0})).data||[];j(P)}catch(c){console.error("Error fetching data:",c)}finally{d(!1)}},[x,N,g]);t.useEffect(()=>{w();const c=setInterval(w,15*60*1e3);return()=>clearInterval(c)},[w]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const A=()=>{w()},C="Placements",p="MonthlyData",F=["Total Spend","Total Purchase ROAS"],S=["Spend","Purchase ROAS"];return e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{}),e.jsx("div",{children:e.jsx("h2",{className:"text-xl font-semibold tracking-tight",children:"Placements Insights"})})]})}),u?e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx(he,{})}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:o==null?void 0:o.data.map((c,P)=>e.jsxs(te,{className:`${m===c.account_name?"fixed inset-0 z-50 m-0 bg-background p-2 overflow-auto":"rounded-md"}`,children:[e.jsx(ke,{className:"bg-white rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full"}),e.jsx(Re,{className:"text-lg font-medium",children:c.account_name})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{})}),e.jsx(D,{onClick:A,disabled:u,size:"sm",variant:"outline",className:"hover:bg-muted",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(D,{onClick:()=>T(c.account_name),size:"sm",variant:"outline",className:"hover:bg-muted",children:m===c.account_name?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]})}),e.jsx(ne,{className:"p-0",children:e.jsx("div",{className:"rounded-b-lg overflow-hidden px-2.5 pb-2.5",children:e.jsx(we,{data:c.placementData,primaryColumn:C,secondaryColumns:F,monthlyDataKey:p,monthlyMetrics:S,isFullScreen:m===c.account_name,isAdsTable:!0})})})]},P))})]})},Fl=({dateRange:s})=>{const r=G(c=>c.date.from),a=G(c=>c.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),[l,o]=t.useState(null),[j,u]=t.useState(!0),[d,m]=t.useState(""),M=fe(),v=G(c=>c.user.user),{brandId:x}=re(),T=c=>{m(d===c?"":c)},N=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",g=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",f=ve(),w=t.useCallback(async()=>{u(!0);try{const P=(await f.post(`/api/fbReport/platform/${x}`,{userId:v==null?void 0:v.id,startDate:N,endDate:g},{withCredentials:!0})).data||[];o(P)}catch(c){console.error("Error fetching data:",c)}finally{u(!1)}},[x,N,g]);t.useEffect(()=>{w();const c=setInterval(w,15*60*1e3);return()=>clearInterval(c)},[w]),t.useEffect(()=>{s&&M(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{d||s&&M(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[d,s]);const A=()=>{w()},C="Platforms",p="MonthlyData",F=["Total Spend","Total Purchase ROAS"],S=["Spend","Purchase ROAS"];return e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{}),e.jsx("div",{children:e.jsx("h2",{className:"text-xl font-semibold tracking-tight",children:"Platform Insights"})})]})}),j?e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx(he,{})}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:l==null?void 0:l.data.map((c,P)=>e.jsxs(te,{className:`${d===c.account_name?"fixed inset-0 z-50 m-0 bg-background p-2 overflow-auto":"rounded-md"}`,children:[e.jsx(ke,{className:"bg-white rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full"}),e.jsx(Re,{className:"text-lg font-medium",children:c.account_name})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[d&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{})}),e.jsx(D,{onClick:A,disabled:j,size:"sm",variant:"outline",className:"hover:bg-muted",children:e.jsx(ce,{className:`h-4 w-4 ${j?"animate-spin":""}`})}),e.jsx(D,{onClick:()=>T(c.account_name),size:"sm",variant:"outline",className:"hover:bg-muted",children:d===c.account_name?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]})}),e.jsx(ne,{className:"p-0",children:e.jsx("div",{className:"rounded-b-lg overflow-hidden px-2.5 pb-2.5",children:e.jsx(we,{data:c.platformData,primaryColumn:C,secondaryColumns:F,monthlyDataKey:p,monthlyMetrics:S,isFullScreen:d===c.account_name,isAdsTable:!0})})})]},P))})]})},$l=({dateRange:s})=>{const r=G(c=>c.date.from),a=G(c=>c.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(""),v=G(c=>c.user.user),{brandId:x}=re(),T=c=>{M(m===c?"":c)},N=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",g=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",f=ve(),w=t.useCallback(async()=>{d(!0);try{const P=(await f.post(`/api/fbReport/country/${x}`,{userId:v==null?void 0:v.id,startDate:N,endDate:g},{withCredentials:!0})).data||[];j(P)}catch(c){console.error("Error fetching data:",c)}finally{d(!1)}},[x,N,g]);t.useEffect(()=>{w();const c=setInterval(w,15*60*1e3);return()=>clearInterval(c)},[w]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const A=()=>{w()},C="Country",p="MonthlyData",F=["Total Spend","Total Purchase ROAS"],S=["Spend","Purchase ROAS"];return e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{}),e.jsx("div",{children:e.jsx("h2",{className:"text-xl font-semibold tracking-tight",children:"Country Insights"})})]})}),u?e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx(he,{})}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:o==null?void 0:o.data.map((c,P)=>e.jsxs(te,{className:`${m===c.account_name?"fixed inset-0 z-50 m-0 bg-background p-2 overflow-auto":"rounded-md"}`,children:[e.jsx(ke,{className:"bg-white rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full"}),e.jsx(Re,{className:"text-lg font-medium",children:c.account_name})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{})}),e.jsx(D,{onClick:A,disabled:u,size:"sm",variant:"outline",className:"hover:bg-muted",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(D,{onClick:()=>T(c.account_name),size:"sm",variant:"outline",className:"hover:bg-muted",children:m===c.account_name?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]})}),e.jsx(ne,{className:"p-0",children:e.jsx("div",{className:"rounded-b-lg overflow-hidden px-2.5 pb-2.5",children:e.jsx(we,{data:c.countryData,primaryColumn:C,secondaryColumns:F,monthlyDataKey:p,monthlyMetrics:S,isFullScreen:m===c.account_name,isAdsTable:!0})})})]},P))})]})},Pl=({dateRange:s})=>{const r=G(c=>c.date.from),a=G(c=>c.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(""),v=G(c=>c.user.user),{brandId:x}=re(),T=c=>{M(m===c?"":c)},N=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",g=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",f=ve(),w=t.useCallback(async()=>{d(!0);try{const P=(await f.post(`/api/fbReport/device/${x}`,{userId:v==null?void 0:v.id,startDate:N,endDate:g},{withCredentials:!0})).data||[];j(P)}catch(c){console.error("Error fetching data:",c)}finally{d(!1)}},[x,N,g]);t.useEffect(()=>{w();const c=setInterval(w,15*60*1e3);return()=>clearInterval(c)},[w]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const A=()=>{w()},C="Device",p="MonthlyData",F=["Total Spend","Total Purchase ROAS"],S=["Spend","Purchase ROAS"];return e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{}),e.jsx("div",{children:e.jsx("h2",{className:"text-xl font-semibold tracking-tight",children:"Device Insights"})})]})}),u?e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx(he,{})}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:o==null?void 0:o.data.map((c,P)=>e.jsxs(te,{className:`${m===c.account_name?"fixed inset-0 z-50 m-0 bg-background p-2 overflow-auto":"rounded-md"}`,children:[e.jsx(ke,{className:"bg-white rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full"}),e.jsx(Re,{className:"text-lg font-medium",children:c.account_name})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{})}),e.jsx(D,{onClick:A,disabled:u,size:"sm",variant:"outline",className:"hover:bg-muted",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(D,{onClick:()=>T(c.account_name),size:"sm",variant:"outline",className:"hover:bg-muted",children:m===c.account_name?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]})}),e.jsx(ne,{className:"p-0",children:e.jsx("div",{className:"rounded-b-lg overflow-hidden px-2.5 pb-2.5",children:e.jsx(we,{data:c.deviceData,primaryColumn:C,secondaryColumns:F,monthlyDataKey:p,monthlyMetrics:S,isFullScreen:m===c.account_name,isAdsTable:!0})})})]},P))})]})},Ll=({dateRange:s})=>{const r=G(c=>c.date.from),a=G(c=>c.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),l=fe(),[o,j]=t.useState(null),[u,d]=t.useState(!0),[m,M]=t.useState(""),v=G(c=>c.user.user),{brandId:x}=re(),T=c=>{M(m===c?"":c)},N=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",g=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",f=ve(),w=t.useCallback(async()=>{d(!0);try{const P=(await f.post(`/api/fbReport/gender/${x}`,{userId:v==null?void 0:v.id,startDate:N,endDate:g},{withCredentials:!0})).data||[];j(P)}catch(c){console.error("Error fetching data:",c)}finally{d(!1)}},[x,N,g]);t.useEffect(()=>{w();const c=setInterval(w,15*60*1e3);return()=>clearInterval(c)},[w]),t.useEffect(()=>{s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{m||s&&l(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[m,s]);const A=()=>{w()},C="Gender",p="MonthlyData",F=["Total Spend","Total Purchase ROAS"],S=["Spend","Purchase ROAS"];return e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{}),e.jsx("div",{children:e.jsx("h2",{className:"text-xl font-semibold tracking-tight",children:"Gender Insights"})})]})}),u?e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx(he,{})}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:o==null?void 0:o.data.map((c,P)=>e.jsxs(te,{className:`${m===c.account_name?"fixed inset-0 z-50 m-0 bg-background p-2 overflow-auto":"rounded-md"}`,children:[e.jsx(ke,{className:"bg-white rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full"}),e.jsx(Re,{className:"text-lg font-medium",children:c.account_name})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[m&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{})}),e.jsx(D,{onClick:A,disabled:u,size:"sm",variant:"outline",className:"hover:bg-muted",children:e.jsx(ce,{className:`h-4 w-4 ${u?"animate-spin":""}`})}),e.jsx(D,{onClick:()=>T(c.account_name),size:"sm",variant:"outline",className:"hover:bg-muted",children:m===c.account_name?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]})}),e.jsx(ne,{className:"p-0",children:e.jsx("div",{className:"rounded-b-lg overflow-hidden px-2.5 pb-2.5",children:e.jsx(we,{data:c.genderData,primaryColumn:C,secondaryColumns:F,monthlyDataKey:p,monthlyMetrics:S,isFullScreen:m===c.account_name,isAdsTable:!0})})})]},P))})]})},El=({dateRange:s})=>{const r=G(c=>c.date.from),a=G(c=>c.date.to),n=t.useMemo(()=>({from:r,to:a}),[r,a]),[l,o]=t.useState(null),[j,u]=t.useState(!0),[d,m]=t.useState(""),M=fe(),v=G(c=>c.user.user),{brandId:x}=re(),T=c=>{m(d===c?"":c)},N=n!=null&&n.from?U(n.from,"yyyy-MM-dd"):"",g=n!=null&&n.to?U(n.to,"yyyy-MM-dd"):"",f=ve(),w=t.useCallback(async()=>{u(!0);try{const P=(await f.post(`/api/fbReport/age/${x}`,{userId:v==null?void 0:v.id,startDate:N,endDate:g},{withCredentials:!0})).data||[];o(P)}catch(c){console.error("Error fetching data:",c)}finally{u(!1)}},[x,N,g]);t.useEffect(()=>{w();const c=setInterval(w,15*60*1e3);return()=>clearInterval(c)},[w]),t.useEffect(()=>{s&&M(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[s]),t.useEffect(()=>{d||s&&M(se({from:s.from?s.from.toISOString():void 0,to:s.to?s.to.toISOString():void 0}))},[d,s]);const A="Age",C="MonthlyData",p=["Total Spend","Total Purchase ROAS"],F=["Spend","Purchase ROAS"],S=()=>{w()};return e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{}),e.jsx("div",{children:e.jsx("h2",{className:"text-xl font-semibold tracking-tight",children:"Age Insights"})})]})}),j?e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx(he,{})}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:l==null?void 0:l.data.map((c,P)=>e.jsxs(te,{className:`${d===c.account_name?"fixed inset-0 z-50 m-0 bg-background p-2 overflow-auto":"rounded-md"}`,children:[e.jsx(ke,{className:"bg-white rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full"}),e.jsx(Re,{className:"text-lg font-medium",children:c.account_name})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[d&&e.jsx("div",{className:"transition-transform duration-300 ease-in-out hover:scale-105",children:e.jsx(pe,{})}),e.jsx(D,{onClick:S,disabled:j,size:"sm",variant:"outline",className:"hover:bg-muted",children:e.jsx(ce,{className:`h-4 w-4 ${j?"animate-spin":""}`})}),e.jsx(D,{onClick:()=>T(c.account_name),size:"sm",variant:"outline",className:"hover:bg-muted",children:d===c.account_name?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]})}),e.jsx(ne,{className:"p-0",children:e.jsx("div",{className:"rounded-b-lg overflow-hidden px-2.5 pb-2.5",children:e.jsx(we,{data:c.ageData,primaryColumn:A,secondaryColumns:p,monthlyDataKey:C,monthlyMetrics:F,isFullScreen:d===c.account_name,isAdsTable:!0})})})]},P))})]})},Ol=()=>{const s=G(d=>d.date.from),r=G(d=>d.date.to),a=t.useMemo(()=>({from:s,to:r}),[s,r]),[n,l]=t.useState("age"),o={from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0},j=[{label:"Age",value:"age"},{label:"Gender",value:"gender"},{label:"Country",value:"country"},{label:"Platform",value:"platform"},{label:"Placement",value:"placement"},{label:"Impression Device",value:"impressionDevice"},{label:"Audience Segments",value:"audienceSegments"}],u=d=>{l(d)};return e.jsxs("div",{className:"flex h-screen bg-gray-100",children:[e.jsx(Qe,{}),e.jsxs("div",{className:"flex-1 h-screen overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex-none",children:[e.jsx(us,{title:"Meta Reports",Icon:ya,showDatePicker:!0}),e.jsx("div",{className:"bg-white px-6 sticky top-0 z-10",children:e.jsx(Fs,{tabs:j,activeTab:n,onTabChange:u})})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"px-6 py-4 space-y-6",children:[n==="audienceSegments"&&e.jsx("div",{id:"audienceSegments",children:e.jsx(Tl,{dateRange:o})}),n==="placement"&&e.jsx("div",{id:"placement",children:e.jsx(kl,{dateRange:o})}),n==="platform"&&e.jsx("div",{id:"platform",children:e.jsx(Fl,{dateRange:o})}),n==="country"&&e.jsx("div",{id:"country",children:e.jsx($l,{dateRange:o})}),n==="impressionDevice"&&e.jsx("div",{id:"impressionDevice",children:e.jsx(Pl,{dateRange:o})}),n==="gender"&&e.jsx("div",{id:"gender",children:e.jsx(Ll,{dateRange:o})}),n==="age"&&e.jsx("div",{id:"age",children:e.jsx(El,{dateRange:o})})]})})]})]})},Rl=$r({conversionFilters:ol,brand:Jr,user:Br,date:lo}),Dl={key:"root",storage:kr,whitelist:["conversionFilters","brand","user","date"]},zl=Tr(Dl,Rl),Qa=Gn({reducer:zl,middleware:s=>s({serializableCheck:{ignoredActions:["persist/PERSIST","persist/REHYDRATE","persist/REGISTER"]}})}),Gl=Ir(Qa);function _l(){return e.jsx(zn,{store:Qa,children:e.jsx(Fr,{loading:null,persistor:Gl,children:e.jsx(Pr,{children:e.jsx(bo,{children:e.jsx(Go,{children:e.jsxs(an,{children:[e.jsx(Wr,{}),e.jsxs(Bn,{children:[e.jsx(Ke,{path:"/",element:e.jsx(Vr,{})}),e.jsx(Ke,{path:"/dashboard",element:e.jsx(yo,{})}),e.jsx(Ke,{path:"/analytics-dashboard/:brandId",element:e.jsx(mo,{})}),e.jsx(Ke,{path:"/ecommerce-reports/:brandId",element:e.jsx(Qo,{})}),e.jsx(Ke,{path:"/ad-metrics/:brandId",element:e.jsx(No,{})}),e.jsx(Ke,{path:"/performance-metrics",element:e.jsx(To,{})}),e.jsx(Ke,{path:"/segment-dashboard/:brandId",element:e.jsx(Wo,{})}),e.jsx(Ke,{path:"/meta-reports/:brandId",element:e.jsx(Ol,{})}),e.jsx(Ke,{path:"/google-ads-hub/:brandId",element:e.jsx(Il,{})}),e.jsx(Ke,{path:"/conversion-reports/:brandId/demographics",element:e.jsx(fl,{})}),e.jsx(Ke,{path:"/conversion-reports/:brandId/performance",element:e.jsx(Cl,{})}),e.jsx(Ke,{path:"/callback",element:e.jsx(Yo,{})})]})]})})})})})})}sn(document.getElementById("root")).render(e.jsx(t.StrictMode,{children:e.jsx(_l,{})}));
//# sourceMappingURL=index-D76JgtYS.js.map
